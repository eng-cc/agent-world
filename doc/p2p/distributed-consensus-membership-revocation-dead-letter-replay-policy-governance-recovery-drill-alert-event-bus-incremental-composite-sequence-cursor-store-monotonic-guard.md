# Agent World Runtime：成员目录吊销死信回放策略治理恢复演练告警事件总线复合序号游标状态单调推进守卫（P3.42）

## 目标
- 在 P3.41 游标状态持久化基础上，增加存储层单调推进校验，阻止游标被旧值覆盖回退。
- 将游标比较规则统一为复合键比较：`(since_event_at_ms, since_node_id, since_node_event_offset)`。
- 保持已有一体化续拉接口不变，仅增强状态保存时的安全约束。

## 范围
- **包含**：
  - 新增复合游标比较辅助函数。
  - 在内存/文件游标状态 store 中启用“禁止回退写入”校验。
  - 新增单元测试覆盖：允许前进、允许幂等同值、拒绝回退。
- **不包含**：
  - 多消费者分布式锁/租约
  - 跨进程事务级并发控制
  - 游标状态网络同步协议

## 接口/数据
- 比较维度：
  - `since_event_at_ms`
  - `since_node_id`（`None` 视为最小值）
  - `since_node_event_offset`
- 存储行为：
  - 新值 > 旧值：允许
  - 新值 == 旧值：允许（幂等）
  - 新值 < 旧值：拒绝并返回 `DistributedValidationFailed`

## 里程碑
- M1：完成设计文档与项目管理文档。
- M2：完成游标比较与单调守卫实现。
- M3：完成回退拒绝测试覆盖。
- M4：完成验证、总项目文档与 devlog 更新。

## 风险
- **比较语义风险**：`since_node_id` 依赖字典序，若 consumer 使用不同规范化策略，可能造成推进顺序歧义。
- **历史数据兼容风险**：旧状态数据缺失字段时需保持兼容默认值，避免误判为回退。
