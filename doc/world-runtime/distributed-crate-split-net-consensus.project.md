# Agent World Runtime：`agent_world_net` + `agent_world_consensus` 拆分（项目管理文档）

## 任务拆解
- [x] T1：新增设计文档与项目管理文档（本文件）。
- [x] T2：新建 `agent_world_net` / `agent_world_consensus` crate，并接入 workspace。
- [x] T3：完成 net/consensus 导出能力面，确保 `distributed_membership_sync` 纳入 `agent_world_consensus`。
- [x] T4：完成编译与定向测试回归，回写文档状态并收口。
- [x] T5：将 `distributed_net` 核心实现下沉到 `agent_world_net`（`InMemoryNetwork` 与网络 trait/type）。
- [x] T6：完成扩展阶段回归验证与文档收口。
- [x] T7：将 `distributed_dht` 核心实现下沉到 `agent_world_net`（`InMemoryDht` 与 DHT trait/type）。
- [x] T8：完成二次扩展阶段回归验证与文档收口。
- [x] T9：将 `distributed_client` 核心实现下沉到 `agent_world_net`（请求编解码、DHT provider 路由、错误映射）。
- [x] T10：完成三次扩展阶段回归验证与文档收口。
- [x] T11：将 `distributed_gateway` 核心实现下沉到 `agent_world_net`（Action 发布网关与回执类型）。
- [x] T12：完成四次扩展阶段回归验证与文档收口。
- [x] T13：将 `distributed_index` 核心实现下沉到 `agent_world_net`（head/provider 索引发布与查询 helper）。
- [x] T14：完成五次扩展阶段回归验证与文档收口。
- [x] T15：完成 `agent_world_net` 内部模块化拆分（`lib.rs` 多文件拆分 + 单测迁移，导出 API 不变）。
- [x] T16：完成六次扩展阶段回归验证与文档收口。
- [x] T17：将 `distributed_index_store` / `distributed_provider_cache` / `distributed_dht_cache` 核心实现下沉到 `agent_world_net`（导出 API 不变）。
- [x] T18：完成七次扩展阶段回归验证与文档收口。
- [x] T19：将 `distributed_head_follow` / `distributed_observer` 核心实现下沉到 `agent_world_net`（导出 API 不变）。
- [x] T20：完成八次扩展阶段回归验证与文档收口。
- [x] T21：将 `distributed_observer_replay` 核心实现下沉到 `agent_world_net`，并由 `head_follow` 复用。
- [x] T22：完成九次扩展阶段回归验证与文档收口。
- [x] T23：将 `distributed_bootstrap` 核心实现下沉到 `agent_world_net`，并由 `head_follow` 复用。
- [x] T24：完成十次扩展阶段回归验证与文档收口。
- [x] T25：将 `distributed_consensus` 核心实现下沉到 `agent_world_consensus`（导出 API 不变）。
- [x] T26：完成十一次扩展阶段回归验证与文档收口。
- [x] T27：将 `distributed_lease` / `distributed_mempool` 核心实现下沉到 `agent_world_consensus`（导出 API 不变）。
- [x] T28：完成十二次扩展阶段回归验证与文档收口。
- [x] T29：将 `distributed_membership_sync` 的签名/审计/同步核心（不含 recovery/reconciliation）下沉到 `agent_world_consensus`（导出 API 不变）。
- [x] T30：完成十三次扩展阶段回归验证与文档收口。
- [x] T31：将 `distributed_membership_sync/reconciliation.rs` 核心实现下沉到 `agent_world_consensus`（导出 API 不变）。
- [x] T32：完成十四次扩展阶段回归验证与文档收口。
- [x] T33：将 `distributed_membership_sync/recovery.rs` 告警恢复核心实现下沉到 `agent_world_consensus`（导出 API 不变）。
- [x] T34：完成十五次扩展阶段回归验证与文档收口。
- [x] T35：将 `distributed_membership_sync/recovery/replay.rs` 核心实现下沉到 `agent_world_consensus`（导出 API 不变）。
- [x] T36：完成十六次扩展阶段回归验证与文档收口。
- [x] T37：将 `distributed_membership_sync/recovery/replay_audit.rs` 核心实现下沉到 `agent_world_consensus`（导出 API 不变）。
- [x] T38：完成十七次扩展阶段回归验证与文档收口。
- [x] T39：将 `distributed_membership_sync/recovery/replay_archive*.rs` 核心实现下沉到 `agent_world_consensus`（导出 API 不变）。
- [x] T40：完成十八次扩展阶段回归验证与文档收口。
- [x] T41：将 `distributed_storage.rs` 核心实现下沉到 `agent_world_net`（导出 API 不变）。
- [x] T42：将 `distributed_validation.rs` 核心实现下沉到 `agent_world_net`（导出 API 不变）。
- [x] T43：完成十九次扩展阶段回归验证与文档收口。
- [x] T44：将 `libp2p_net.rs` 核心实现下沉到 `agent_world_net`（导出 API 不变，feature=`libp2p`）。
- [x] T45：完成二十次扩展阶段回归验证与文档收口。
- [x] T46：增强 `agent_world_net` 的 `Libp2pNetwork` 可观测性并补齐跨节点 smoke test（feature=`libp2p`）。
- [x] T47：完成二十一次扩展阶段回归验证与文档收口。
- [x] T48：将 `agent_world::runtime` 的 `distributed_net/dht/gateway/lease/mempool` 改为直接复用 `agent_world_net`/`agent_world_consensus` 同源实现（`include!`），保持导出 API 不变。
- [x] T49：完成二十二次扩展阶段回归验证与文档收口（workspace 级 `cargo test --workspace` + 文档回写）。
- [x] T50：将 `agent_world::runtime` 的 `distributed_client/index/index_store/provider_cache/dht_cache` 改为直接复用 `agent_world_net` 同源实现（`include!`），保持导出 API 不变。
- [x] T51：完成二十三次扩展阶段回归验证与文档收口（workspace 级 `cargo test --workspace` + 文档回写）。
- [x] T52：将 `agent_world::runtime` 的 `distributed_bootstrap/head_follow/observer/observer_replay/storage/validation` 改为直接复用 `agent_world_net` 同源实现（`include!`），保持导出 API 不变。
- [x] T53：完成二十四次扩展阶段回归验证与文档收口（workspace 级 `cargo test --workspace` + 文档回写）。
- [x] T54：将 `agent_world::runtime` 的 `distributed_consensus` 改为直接复用 `agent_world_consensus` 同源实现（`include!`），保持导出 API 不变。
- [x] T55：完成二十五次扩展阶段回归验证与文档收口（workspace 级 `cargo test --workspace` + 文档回写）。
- [x] T56：将 `agent_world::runtime` 的 `distributed_membership_sync` 主体改为直接复用 `agent_world_consensus/src/membership.rs`（`include!` + `shared` 包装），保持 runtime 的 `reconciliation/recovery` 导出 API 不变。
- [x] T57：完成二十六次扩展阶段回归验证与文档收口（workspace 级 `cargo test --workspace` + 文档回写）。
- [x] T58：将 `agent_world::runtime::distributed_membership_sync::reconciliation` 改为直接复用 `agent_world_consensus/src/membership_reconciliation.rs`（`include!`），保持导出 API 不变。
- [x] T59：完成二十七次扩展阶段回归验证与文档收口（workspace 级 `cargo test --workspace` + 文档回写）。
- [x] T60：将 `agent_world::runtime::distributed_membership_sync::recovery` 改为路径模块复用 `agent_world_consensus/src/membership_recovery/mod.rs`（`#[path]` + alias 层），保持导出 API 不变。
- [x] T61：完成二十八次扩展阶段回归验证与文档收口（workspace 级 `cargo test --workspace` + 文档回写）。
- [x] T62：删除 `agent_world::runtime/distributed_membership_sync/recovery/*` 未编译旧实现文件，收敛为 `recovery.rs` 单入口同源复用结构。
- [x] T63：完成二十九次扩展阶段回归验证与文档收口（workspace 级 `cargo test --workspace` + 文档回写）。

## 依赖
- `crates/agent_world/src/runtime/mod.rs`
- `crates/agent_world/src/runtime/distributed_net.rs`
- `crates/agent_world/src/runtime/libp2p_net.rs`
- `crates/agent_world/src/runtime/distributed_consensus.rs`
- `crates/agent_world/src/runtime/distributed_membership_sync.rs`
- `crates/agent_world/src/runtime/distributed_dht.rs`
- `crates/agent_world/src/runtime/distributed_client.rs`
- `crates/agent_world/src/runtime/distributed_gateway.rs`
- `crates/agent_world/src/runtime/distributed_index.rs`
- `crates/agent_world/src/runtime/distributed_consensus.rs`
- `crates/agent_world/src/runtime/distributed_lease.rs`
- `crates/agent_world/src/runtime/distributed_mempool.rs`
- `crates/agent_world_net/src/lib.rs`
- `crates/agent_world_net/src/network.rs`
- `crates/agent_world_net/src/dht.rs`
- `crates/agent_world_net/src/index.rs`
- `crates/agent_world_net/src/client.rs`
- `crates/agent_world_net/src/gateway.rs`
- `crates/agent_world_net/src/util.rs`
- `crates/agent_world_net/src/tests.rs`
- `crates/agent_world_net/src/index_store.rs`
- `crates/agent_world_net/src/provider_cache.rs`
- `crates/agent_world_net/src/dht_cache.rs`
- `crates/agent_world_net/src/head_follow.rs`
- `crates/agent_world_net/src/observer.rs`
- `crates/agent_world_net/src/observer_replay.rs`
- `crates/agent_world_net/src/bootstrap.rs`
- `crates/agent_world_consensus/src/lib.rs`
- `crates/agent_world_consensus/src/quorum.rs`
- `crates/agent_world_consensus/src/lease.rs`
- `crates/agent_world_consensus/src/mempool.rs`
- `crates/agent_world_consensus/src/membership.rs`
- `crates/agent_world_consensus/src/membership_logic.rs`
- `crates/agent_world_consensus/src/membership_reconciliation.rs`
- `crates/agent_world_consensus/src/membership_reconciliation_tests.rs`
- `crates/agent_world_consensus/src/membership_recovery/mod.rs`
- `crates/agent_world_consensus/src/membership_recovery/types.rs`
- `crates/agent_world_consensus/src/membership_recovery/stores.rs`
- `crates/agent_world_consensus/src/membership_recovery/dead_letter.rs`
- `crates/agent_world_consensus/src/membership_recovery_tests.rs`
- `crates/agent_world_consensus/src/membership_recovery/replay.rs`
- `crates/agent_world_consensus/src/membership_dead_letter_replay_tests.rs`
- `crates/agent_world_consensus/src/membership_dead_letter_replay_persistence_tests.rs`
- `crates/agent_world_consensus/src/membership_recovery/replay_audit.rs`
- `crates/agent_world_consensus/src/membership_dead_letter_replay_audit_tests.rs`
- `crates/agent_world_consensus/src/membership_recovery/replay_archive.rs`
- `crates/agent_world_consensus/src/membership_recovery/replay_archive_tiered.rs`
- `crates/agent_world_consensus/src/membership_recovery/replay_archive_federated.rs`
- `crates/agent_world_consensus/src/membership_dead_letter_replay_archive_tests.rs`
- `crates/agent_world_net/src/execution_storage.rs`
- `crates/agent_world_net/src/head_validation.rs`
- `crates/agent_world_net/src/libp2p_net.rs`
- `crates/agent_world/src/lib.rs`
- `crates/agent_world/src/runtime/distributed_net.rs`
- `crates/agent_world/src/runtime/distributed_dht.rs`
- `crates/agent_world/src/runtime/distributed_gateway.rs`
- `crates/agent_world/src/runtime/distributed_lease.rs`
- `crates/agent_world/src/runtime/distributed_mempool.rs`
- `crates/agent_world/src/runtime/distributed_client.rs`
- `crates/agent_world/src/runtime/distributed_index.rs`
- `crates/agent_world/src/runtime/distributed_index_store.rs`
- `crates/agent_world/src/runtime/distributed_provider_cache.rs`
- `crates/agent_world/src/runtime/distributed_dht_cache.rs`
- `crates/agent_world/src/runtime/distributed_bootstrap.rs`
- `crates/agent_world/src/runtime/distributed_head_follow.rs`
- `crates/agent_world/src/runtime/distributed_observer.rs`
- `crates/agent_world/src/runtime/distributed_observer_replay.rs`
- `crates/agent_world/src/runtime/distributed_storage.rs`
- `crates/agent_world/src/runtime/distributed_validation.rs`
- `crates/agent_world_net/src/client.rs`
- `crates/agent_world_net/src/index.rs`
- `crates/agent_world_net/src/index_store.rs`
- `crates/agent_world_net/src/provider_cache.rs`
- `crates/agent_world_net/src/dht_cache.rs`
- `crates/agent_world_net/src/bootstrap.rs`
- `crates/agent_world_net/src/head_follow.rs`
- `crates/agent_world_net/src/observer.rs`
- `crates/agent_world_net/src/observer_replay.rs`
- `crates/agent_world_net/src/execution_storage.rs`
- `crates/agent_world_net/src/head_validation.rs`
- `crates/agent_world_net/src/util.rs`
- `crates/agent_world/src/runtime/distributed_consensus.rs`
- `crates/agent_world_consensus/src/quorum.rs`
- `crates/agent_world_consensus/src/lib.rs`

## 状态
- 当前阶段：二十九次扩展阶段已收口（T62~T63 全部完成）。
- 下一步：继续收敛 `distributed_membership_sync.rs` 中超长 recovery re-export 列表，按能力分组降低维护成本并清理无效导入 warning。
- 最近更新：2026-02-13
