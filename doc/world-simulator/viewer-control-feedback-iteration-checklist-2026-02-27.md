# Viewer 控制反馈迭代清单（2026-02-27）

## 目标
- 基于 `card_2026_02_27_19_47_08.md` 的玩家反馈，聚焦修复“指令 accepted 但不推进”的控制黑盒问题。
- 将“可玩”提升到“可理解、可预测、可复盘”，优先提升控制代理感与稳定推进感。
- 在不改核心玩法规则的前提下，通过控制反馈、状态可视化、失败解释提升留存意愿。

## 范围

### In Scope
- Viewer 侧控制反馈体验：
  - `play/pause/step/seek` 的结果可视化（已接收、已执行、未推进原因）。
  - “下一步建议”提示（当控制未产生推进时）。
  - 无进展窗口的显式提示与恢复动作入口。
- Web Test API/调试口径增强：
  - 控制请求链路增加可观测字段（入队、命中、阻断原因、推进增量）。
  - A/B 卡片量化指标延续（TTFC/有效命中率/无进展窗口）。
- 可玩性复测流程对齐：
  - `run-game-test-ab.sh` 指标继续作为回归基线。

### Out of Scope
- Runtime 经济/战争/治理规则重设计。
- 新增核心玩法系统或新地图内容。
- 大规模视觉重构与主题改版。

## 接口/数据
- 控制反馈统一结果模型（Viewer 展示层）：
  - `accepted`：是否通过语义校验。
  - `enqueued`：是否进入执行队列。
  - `progressed`：是否在窗口期内产生 `tick/eventSeq` 增量。
  - `blocked_reason`：未推进原因枚举（如节流、前置条件未满足、动作冲突）。
  - `next_action_hint`：推荐下一步动作。
- 回归指标目标（来自当前卡片问题画像）：
  - `TTFC`：目标 `< 3500ms`（当前 `4895ms`）。
  - `effectiveControlHitRate`：目标 `>= 85%`（当前 `66.7%`）。
  - `maxNoProgressWindowMs`：目标 `< 2500ms`（当前 `6072ms`）。
  - B 段（`step/seek`）目标从 `FAIL` 提升到 `PASS`。

## 迭代清单（设计优先级）

### P0（必须先做）
1. `step/seek` 未推进原因可视化
   - 在控制反馈区显示“为何未推进 + 可执行替代动作”。
   - 验收：出现 accepted 但未推进时，玩家可在 1 屏内看到原因与下一步建议。
2. 控制三态反馈落地（已接收/执行中/已生效）
   - 将当前“queued control request”升级为阶段化状态反馈。
   - 验收：玩家可区分“系统听懂了但还未生效”和“系统拒绝执行”。
3. 无进展窗口恢复按钮
   - 当 connected 且 2.5 秒无推进时，展示“推荐动作”快捷入口（如 `seek`/`play`）。
   - 验收：无进展时不再静默，仅通过 UI 可触发恢复动作。

### P1（高价值）
1. 指令语义发现路径
   - 在右侧引导区提供可用动作列表（含参数示例）。
   - 验收：玩家不需要外部文档即可发现 `play/pause/step/seek`。
2. 失败反馈标准化文案
   - `unsupported action`、`precondition not met` 等错误提示语义统一，减少术语噪音。
   - 验收：玩家对失败原因主观评分从“一半一半”提升到“大多数可解释”。
3. 首局控制练习段（微教程）
   - 通过 2~3 个小目标让玩家快速建立“发指令->推进”心智。
   - 验收：Q2/Q4/Q5 至少提升一档。

### P2（增强项）
1. 控制历史时间线
   - 展示最近 N 次控制请求与结果（含推进增量）。
2. 录屏+指标自动摘要
   - 在 A/B 产物中自动生成“失败分段原因摘要”，减少人工读日志成本。
3. 长稳体验补丁
   - 针对 `AudioContext` 等非致命警告做玩家侧降噪说明。

## 里程碑
- M1：控制反馈可解释化（P0 完成）
  - 目标：B 段不再“accepted 但黑盒”。
- M2：指令发现与失败提示标准化（P1 完成）
  - 目标：首局控制学习成本显著下降。
- M3：复测稳定与工具增强（P2 完成）
  - 目标：迭代诊断效率提升，持续可观测。

## 风险
- 风险：反馈信息过多导致 UI 噪音上升。
  - 缓解：默认显示关键信息，详细原因折叠展开。
- 风险：未推进原因枚举不完整，造成误导。
  - 缓解：先覆盖高频阻断路径，日志保留 `unknown` 回退。
- 风险：指标优化依赖 runtime 行为，Viewer 单边优化受限。
  - 缓解：在文档中明确 Viewer 可控项与 runtime 依赖项，分阶段验收。

## 验收口径
- 量化：
  - `TTFC < 3500ms`
  - `effectiveControlHitRate >= 85%`
  - `maxNoProgressWindowMs < 2500ms`
  - A/B 分段：A=PASS，B=PASS
- 主观（卡片）：
  - Q2/Q4/Q5 至少提升一档
  - Q16（再玩一局意愿）从 `3` 提升到 `4` 或以上
  - Q20（失控时刻）从“黑盒不知原因”转为“可定位原因”
