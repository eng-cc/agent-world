# Viewer 控制可预期性改版任务清单（2026-02-28）

## 目标
- 以“玩家控制代理感”为第一目标，修复 `accepted` 但无推进造成的失控感。
- 将最近多轮卡片中的 B 段不稳定问题（`step` 二次调用不推进）收敛为可解释、可恢复、可量化。
- 在不改核心玩法规则前提下，把首局体验从“看情况”提升到“可能会继续玩”。

## 范围

### In Scope
- 控制反馈语义升级：`accepted` 与 `completed` 分层呈现（入队/执行/完成/阻断）。
- 无进展窗口恢复设计：connected 且无推进时给出原因 + 推荐动作。
- 指令可发现性：首局内直接展示动作白名单与最小参数示例。
- A/B 量化回归：沿用 `run-game-test-ab.sh` 指标并新增体验门槛。

### Out of Scope
- 核心经济/战斗/治理规则重构。
- 新地图/新剧情/新资源系统。
- UI 全量视觉风格重做。

## 接口/数据

### 现状基线（最近 6 轮卡片）
- B 段通过率：`1/6`（仅 `card_2026_02_27_21_04_46.md` 通过）。
- 有效控制命中率：多数轮次 `2/3 (66.7%)`，最佳轮次 `3/3 (100%)`。
- 无进展窗口：多数轮次约 `4.5s~6.1s`。
- 主观意愿：多数轮次 Q16=`3`（看情况），稳定轮次提升到 Q16=`4`（可能会继续玩）。

### 目标指标（发布门槛）
- `TTFC`：p50 `<= 3000ms`，p90 `<= 5000ms`。
- `effectiveControlHitRate`：`>= 85%`。
- `maxNoProgressWindowMs`：`<= 2500ms`。
- B 段通过率：最近 10 轮 A/B 复测中 `>= 80%`。
- 主观门槛：Q16（再玩一局）平均分 `>= 4.0`，且“看情况”占比 `< 40%`。

### 反馈状态模型（UI 对玩家展示）
- `received`：指令已接收并通过参数校验。
- `executing`：指令执行中，等待世界增量。
- `completed_advanced`：执行完成且有推进（`tick/eventSeq` 增量）。
- `completed_no_progress`：执行完成但无推进，必须附带 `reason` 与 `next_action_hint`。
- `blocked`：未入队或被拒绝，展示可用动作集合。

## 可执行任务清单（设计拆解）

### P0（本周，必须完成）
1. 控制反馈语义面板改版
- 交付：在主面板显示 `received/executing/completed/blocked` 四态。
- 验收：玩家无需读日志即可区分“听懂但未生效”和“被拒绝”。

2. 无进展恢复 CTA
- 交付：connected 且 `>2.5s` 无推进时显示恢复建议（`play`/`step`/等待条件提示）。
- 验收：卡片 Q20 不再出现“我不知道下一步做什么”的表述。

3. B 段一致性守护
- 交付：将 `step` 二次调用结果在 UI 中显式标注“本次无可推进事件”或“推进成功”。
- 验收：A/B 脚本中 B 段 FAIL 需附带明确原因分类，不允许“未知失败”。

### P1（次周，高价值）
1. 首局动作发现模块
- 交付：默认展示可用动作白名单 + 最小参数示例。
- 验收：Q2/Q4 至少提升一档（抽样 5 轮）。

2. 失败文案标准化
- 交付：统一 `unsupported action`、`timeout_no_progress`、`precondition not met` 的玩家文案。
- 验收：Q11（能解释发生了什么）达“基本能解释”及以上占比 `>= 80%`。

3. 控制历史短时间线
- 交付：展示最近 N 次控制输入与推进增量。
- 验收：复盘时可在 30 秒内定位失败指令。

### P2（增强项）
1. 录屏摘要自动化
- 交付：A/B 产物自动生成“失败原因摘要 + 建议下一步动作”。
2. 体验降噪
- 交付：对非致命警告提供玩家侧降噪说明（避免误判为崩溃）。

## A/B 实验矩阵

### 实验 A：无进展提示时机
- A 组：`2.5s` 弹出恢复提示。
- B 组：`1.5s` 弹出恢复提示。
- 观察：`maxNoProgressWindowMs`、Q13 节奏评分、误触率。

### 实验 B：反馈密度
- A 组：仅显示核心状态 + 一行建议。
- B 组：显示完整状态 + 原因 + 建议 + 最近一次控制历史。
- 观察：Q11/Q12（可解释/可预测）与界面噪音投诉率。

### 实验 C：首局动作引导
- A 组：无首局动作引导。
- B 组：首局展示动作白名单 + 示例参数。
- 观察：TTFC、Q2/Q4、Q16。

### 实验止损规则
- 任一实验组若出现：
  - `B 段通过率 < 50%` 连续 3 轮，或
  - `maxNoProgressWindowMs > 7000ms` 连续 2 轮，
  - 则立即回退到上一稳定配置。

## 里程碑
- M1（P0 完成）：控制反馈可解释 + 可恢复。
- M2（P1 完成）：首局学习成本下降，主观评分抬升。
- M3（P2 完成）：回归分析自动化，迭代效率提升。

## 风险
- 风险：反馈信息增多导致 UI 认知负担上升。
  - 缓解：默认简版，详细信息折叠。
- 风险：`completed_no_progress` 原因枚举不完整导致误导。
  - 缓解：保留 `unknown` 并要求日志附带内部 reason code。
- 风险：指标受 runtime 行为影响，Viewer 单边优化见效有限。
  - 缓解：A/B 报告分离“Viewer 问题”与“runtime 依赖问题”。
