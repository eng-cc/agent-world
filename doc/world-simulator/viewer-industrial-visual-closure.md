# Viewer 工业风可视化缺口收敛（对标《异星工厂》《工业巨头》）

## 目标
- 在不破坏现有调试可视化能力的前提下，补齐“工业经营可读性”。
- 按四个任务组分阶段推进：
  - 任务 A：产线可视化 + 物流网络可视化（对应缺口 1、2）
  - 任务 B：经营面板（对应缺口 3）
  - 任务 C：多尺度运营导航 + 告警根因链（对应缺口 5、6）
  - 任务 D：产品化表现层（对应缺口 7）
- 交付标准：每个任务组都必须有可见 UI、可回归测试、可复跑验证命令。

## 范围

### In Scope
- 基于现有 `WorldSnapshot + WorldEvent` 协议，新增工业观察视图与摘要指标。
- 复用已有 3D 覆盖层与右侧面板框架，优先增量实现，不重写 viewer 主架构。
- 为产线、物流、经营、告警提供“可定位、可量化、可回放”的可视化输出。

### Out of Scope
- 不新增玩家直接建造/手操动作协议（保持 prompt-only 运营约束）。
- 不改模拟内核经济规则语义；本阶段以“可视化表达增强”为主。
- 不一次性引入完整美术资产管线（先做可控的产品化基础层）。

## 接口 / 数据

### 任务 A：产线 + 物流（1、2）
- 产线摘要（Production Lines）：
  - 来源：`module_visual_entities` + `CompoundRefined` + `ModuleVisualEntityUpserted`。
  - 指标：工厂/配方/制成品可视实体数量、近期产线更新次数、近期硬件产出。
- 物流路由（Logistics Routes）：
  - 来源：`ResourceTransferred` + `PowerTransferred`。
  - 指标：活跃路由数、传输事件数、路由级吞吐（electricity/hardware/data/power）与损耗。

### 任务 B：经营面板（3）
- 经营驾驶舱（Economy Dashboard）：
  - 来源：资源账本事件、功率交易事件、产线产出事件。
  - 指标：供需缺口、成本结构、收益趋势、库存健康度。

### 任务 C：多尺度导航 + 告警根因（5、6）
- 多尺度运营导航：
  - 视角：世界 -> 区域 -> 节点三层聚焦。
  - 能力：热点快速定位、跨层跳转、问题对象一键聚焦。
- 告警根因链：
  - 来源：`ActionRejected`、资源不足、交易失败、产线停摆等事件。
  - 输出：告警等级、根因路径、建议处置入口。

### 任务 D：产品化表现层（7）
- 视觉风格层：信息层级、关键态强调、统一语义色板。
- 反馈层：关键事件动效/状态过渡（轻量、可关）。
- 目标：在不牺牲调试信息密度的前提下，提升“第一眼可读性”。

## 里程碑
- M0：文档与任务基线（本轮）
- M1：任务 A 收口（产线 + 物流）
- M2：任务 B 收口（经营面板）
- M3：任务 C 收口（多尺度导航 + 告警根因）
- M4：任务 D 收口（产品化表现层）

## 风险
- 数据语义不足风险：现有事件对“完整经营指标”覆盖不够，需先做代理指标与降级提示。
- 信息过载风险：新增面板可能挤压现有调试信息，需要模块化显隐与默认分层。
- 性能风险：路由聚合与告警分析可能增加 UI 负担，需要窗口化与采样策略。
- 回归风险：右侧面板改动容易影响既有快照测试，需要最小侵入与补充单测。
