# Viewer 发行体验改造（第七阶段：整体布局重构与指挥优先）

## 目标
- 以“游戏世界优先 + 指挥能力不丢失”为核心，重构 Player 模式布局，不再让右侧工具式面板主导体验。
- 保证玩家在任意时刻都能快速进入 Agent 指挥链路（Chat/Command），避免“入口被隐藏”。
- 通过分层信息架构降低首次进入的信息压力，并保留进阶信息的可达性。

## 范围
- `crates/agent_world_viewer` 的 Player 模式布局与交互重构：
  - 引入 Player 布局预设（任务/指挥/情报）与快捷切换条。
  - 强化隐藏状态下的指挥入口（边缘入口卡可直接进入指挥态）。
  - 调整 Player 默认模块可见性，确保指挥链路默认可达。
  - 收紧右侧面板宽度预算，避免画面被面板长期挤占。
- Director 模式保持现有调试导向行为不变。

## 非目标
- 不改动 `agent_world` 核心仿真协议与事件语义。
- 不改动 `third_party`。
- 不在本阶段引入新后端接口或外部 UI 框架。

## 接口/数据

### 输入数据（复用）
- `RightPanelLayoutState`：控制面板隐藏/折叠状态与快捷切换行为。
- `RightPanelModuleVisibilityState`：控制 chat/overview/event_link 等模块层级显隐。
- `ViewerState` / `ViewerSelection`：继续用于 Player HUD、任务引导、上下文提示。

### UI 行为新增
- Player 布局预设：
  - 任务态：世界观察与引导优先，压制非关键调试信息。
  - 指挥态：聊天与命令路径优先，确保对 Agent 的输入效率。
  - 情报态：事件联动与信息复盘优先。
- 隐藏面板入口增强：
  - 在隐藏状态下提供“直接进入指挥态”的显式入口（不需要先手动翻层找 chat）。

## 里程碑
- M1：第七阶段建档完成（设计 + 项管）。
- M2：Player 布局预设与快捷切换条落地，并有单测覆盖。
- M3：隐藏状态指挥入口增强与 Player 默认可见性策略落地，并有单测覆盖。
- M4：回归测试 + Web 闭环验收 + 文档收口。

## 风险
- 布局切换状态过多导致认知负担提升。
  - 对策：仅保留 3 个预设，文案固定，切换后可预测。
- 预设切换破坏现有 Player 引导闭环。
  - 对策：预设只调整面板与模块可见性，不改 guide step 判定语义。
- 宽度收紧后信息阅读空间不足。
  - 对策：保留窄屏内联 chat 回退路径，并通过 Web 闭环截图校验可读性。
