# Viewer 发行体验改造（游戏化优先）

## 目标
- 将 `agent_world_viewer` 默认体验从“调试工具”切换为“可发行游戏前端”。
- 保持世界画面为第一视觉焦点，隐藏技术细节并改为按需显式唤出。
- 提升新玩家可上手性：进入后快速知道“当前目标”和“下一步动作”。
- 增强情绪反馈：关键事件必须有可感知的视觉/文本反馈。

## 范围
- 修改 `crates/agent_world_viewer` 的默认 UI 行为与展示优先级。
- 引入面向玩家的体验模式（Player）与保留调试能力的模式（Director）。
- 优化默认模块可见性、默认面板状态、入口可发现性、基础提示层。
- 在不改协议字段的前提下，重排现有状态信息在 UI 中的展示方式。

## 非目标
- 本阶段不改动 `agent_world` 网络协议与仿真核心业务逻辑。
- 本阶段不引入重资产美术包（大型模型/贴图替换作为后续任务）。
- 本阶段不改动 third_party 代码。

## 接口/数据

### 环境变量与模式解析
- 新增环境变量：`AGENT_WORLD_VIEWER_EXPERIENCE_MODE`
  - `player`：默认玩家模式（世界优先、面板默认隐藏）。
  - `director`：导演/调试模式（保持现有可观测能力）。
- 未设置或非法值时，默认 `player`。

### 运行时资源
- 新增资源：`ViewerExperienceMode`（Player/Director）。
- 新增启动策略：按模式覆盖以下默认状态。
  - `RightPanelLayoutState`（是否默认隐藏面板、顶部折叠）。
  - `RightPanelModuleVisibilityState`（默认模块集合）。

### UI 结构约束
- Player 模式默认：
  - 右侧主面板隐藏。
  - 保留单点“打开面板”入口。
  - 打开后仅显示轻量模块（总览优先，技术模块按需展开）。
- Director 模式默认：
  - 保持现有调试导向行为。

### 可发现性增强
- 为关键入口增加显式提示文案（例如：快捷键提示、模式提示）。
- 不依赖用户阅读手册即可发现“如何打开面板”和“如何聚焦对象”。

## 里程碑
- [x] M1：文档与任务拆解完成（设计文档 + 项目管理文档）。
- [x] M2：体验模式框架落地（资源、环境变量、默认策略切换）。
- [x] M3：Player 模式默认降噪落地（默认隐藏面板 + 轻量默认模块）。
- [x] M4：入口可发现性与基础提示完成（面板入口提示、模式提示）。
- [x] M5：测试回归、项目文档状态回写、devlog 收口。

## 验收指标
- 默认启动时，世界画面可视占比显著提升（右侧大面板不再常驻）。
- 新用户无需文档可在首屏找到“打开面板”入口。
- Player 模式下首屏技术模块数量明显减少。
- Director 模式仍可访问原有调试能力。

## 风险
- 默认隐藏面板可能导致“信息不可见”感受上升。
  - 对策：提供显式入口按钮与清晰提示文案。
- 双模式并行可能引入状态分歧。
  - 对策：模式策略仅影响“默认值”，运行时状态保持统一数据结构。
- 旧测试可能绑定既有默认 UI 行为。
  - 对策：补充模式相关测试并更新默认行为断言。

## 当前结论
- 默认体验已切换至 `Player`：右侧面板默认隐藏，首屏世界视图占比显著提高。
- 已保留 `Director` 路径：通过 `AGENT_WORLD_VIEWER_EXPERIENCE_MODE=director` 可回到调试导向默认值。
- Web 闭环 smoke 已验证：
  - `window.__AW_TEST__` 可用；
  - `connectionStatus=connected`；
  - `canvasCount=1`；
  - console 无 error（仅浏览器 warning）。
