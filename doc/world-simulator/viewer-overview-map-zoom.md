# Viewer 全览图缩放切换（设计文档）

## 目标
- 参考 Factorio 的双层可视化思路，在 2D 视图引入“近景细节态 / 全览图态”自动切换机制。
- 默认使用更高放大系数（更近视角），优先保证 Agent 及其关联内容可读。
- 当用户缩放到阈值后自动切换为全览图语义，显示简化标记层，减少细节噪声。
- 不改变 world snapshot 协议，仅在 viewer 端完成。

## 范围

### In Scope
- 新增 2D 缩放层级状态机（`Detail` / `Overview`），采用带迟滞的阈值切换防抖。
- 调整 2D 默认 orbit 半径，使默认进入细节态并提升 Agent 可见性。
- 全览图态下切换可见性策略：
  - 显示 `TwoDMapMarker`。
  - 隐藏细节几何（Agent 细节实体与 frag 分块几何）。
- 维持 3D 模式行为不变（进入 3D 时按细节态处理）。
- 补充单测覆盖阈值切换、可见性联动与默认倍率口径。

### Out of Scope
- 不新增新的网络消息或 snapshot 字段。
- 不改右侧面板结构与交互按钮布局。
- 不引入复杂 minimap UI 组件（仅做已有场景实体可见性层切换）。

## 接口 / 数据
- 新增 viewer 运行态资源：
  - `TwoDZoomTier`：`Detail | Overview`。
- 新增细节可见性组件标记：
  - `DetailZoomEntity`：用于在全览图态批量隐藏细节实体。
- 2D 缩放逻辑：
  - 默认半径按世界尺度推导到细节态默认值（不再以世界全宽为默认视野）。
  - 根据 orbit 半径与世界尺度计算进入/退出全览阈值（迟滞）。
- 相机与标记联动：
  - `TwoDMapMarker` 仅在 `TwoD + Overview` 可见。
  - `DetailZoomEntity` 在 `TwoD + Overview` 隐藏，其余场景可见。

## 里程碑
- **OVZ1**：输出设计文档与项目管理文档。
- **OVZ2**：完成双层缩放状态机与默认缩放口径改造。
- **OVZ3**：完成全览图可见性联动与测试回归。
- **OVZ4**：更新项目文档状态与开发日志收口。

## 风险
- 默认更近的初始倍率可能让部分用户感知“初始视野偏窄”。
- 若阈值设置不合理，可能出现频繁切换或切换过晚。
- 全览图态隐藏细节后，点选命中目标需要依赖简化标记，可能改变既有点选习惯。
