# Viewer 2D/3D WASD 相机移动设计

## 目标
- 为 `agent_world_viewer` 增加键盘 `W/A/S/D` 相机移动能力，降低仅依赖鼠标拖拽的交互成本。
- 保持 2D 与 3D 两种视角都可用，形成统一的基础导航体验。
- 不破坏现有鼠标旋转/平移/缩放、自动聚焦与 2D/3D 模式切换逻辑。

## 范围
- 范围内：
  - 在 `camera_controls` 中接入 `W/A/S/D` 输入轴，驱动 `OrbitCamera.focus` 平面移动。
  - 2D/3D 模式均支持键盘移动，方向以当前相机朝向投影到水平面计算。
  - 增加输入冲突保护：当右侧 EGUI 文本输入占用键盘时，不触发 WASD 相机移动。
  - 补充单元测试与最小回归（`test_tier_required`）。
- 范围外：
  - 不新增飞行模式（如 `Q/E` 升降）或第一人称控制。
  - 不改动相机缩放/旋转参数口径，不重构 `OrbitCamera` 数据结构。
  - 不改动 Viewer 协议与服务端数据模型。

## 接口 / 数据

### 1) 输入侧
- 使用 `ButtonInput<KeyCode>` 读取 `KeyW/KeyA/KeyS/KeyD` 的按键状态。
- 输入轴定义：
  - `x = D - A`（左右平移）
  - `y = W - S`（前后平移）

### 2) 相机侧
- WASD 仅修改 `OrbitCamera.focus`，不直接改 `yaw/pitch/radius`。
- 位移方向基于相机当前朝向（`yaw/pitch`）投影到水平面（XZ）：
  - `forward`：相机前向在 XZ 平面投影
  - `right`：相机右向在 XZ 平面投影
- 速度按 `orbit.radius` 与时间步长缩放，保证不同缩放层级下移动体验相对稳定。

### 3) 输入冲突保护
- 仅在光标位于 3D 视口时响应 WASD（与现有鼠标交互边界一致）。
- 若 EGUI 声明当前需要键盘输入（例如 Prompt 文本框），WASD 不生效。

## 里程碑
- WCM1：完成设计/项目文档输出并挂载总项目文档。
- WCM2：完成 `camera_controls` 中 WASD 移动实现（2D/3D 共用）。
- WCM3：补齐单元测试并通过 `test_tier_required` 最小闭环。
- WCM4：更新使用手册、项目状态与开发日志收口。

## 风险
- 输入冲突风险：WASD 可能影响右侧文本输入体验。
  - 缓解：增加 EGUI 键盘占用检测，键盘占用时禁用相机移动。
- 方向感知风险：3D 下 pitch 较大时，前后移动若包含垂直分量会产生违和感。
  - 缓解：将方向向量投影到 XZ 平面，仅做平面移动。
- 速度体感风险：缩放很近或很远时可能“过慢/过快”。
  - 缓解：速度与 `orbit.radius` 联动，并通过测试与手工回归验证基础可用性。
