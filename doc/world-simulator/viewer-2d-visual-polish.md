# Viewer 2D 可视化精修（地图可读性增强）

## 目标
- 解决当前 2D 观察态“信息点不突出、层次弱、第一眼过于空”的问题。
- 保持现有 3D 视角表达与交互不退化，精修仅针对 2D 可读性。
- 交付可回归的实现：有测试、有截图闭环、有可开关或可控行为。

## 范围

### In Scope
- 在 2D 视角补充地图符号层（Location/Agent 重点标记）。
- 为 2D 视角提升标签可见策略（远距衰减、容量、遮挡阈值）。
- 在 2D 视角强化流向覆盖层表达（平面化流线 + 方向箭头头部）。
- 增加模式同步逻辑：2D 显示地图符号层，3D 隐藏。
- 补充对应单元测试与可视化截图回归闭环。

### Out of Scope
- 不调整 world 协议、事件模型、快照结构。
- 不重做材质库与 3D 物理表达方案。
- 不新增玩家建造/拖拽编辑交互（仍维持观察/调试定位）。

## 接口 / 数据

### 1) 2D 地图符号层
- 在场景实体层新增 2D 专用 marker 组件（仅用于可视化显示控制）。
- Location/Agent 在构建子节点时附加 2D 平面符号（高对比、低厚度）。
- 运行时根据 `ViewerCameraMode` 同步 `Visibility`：
  - `TwoD` => `Visible`
  - `ThreeD` => `Hidden`

### 2) 标签 LOD 的 2D 配置
- 在 `update_label_lod` 中按 `ViewerCameraMode` 区分 LOD 参数：
  - 2D：更宽的可见距离、更高标签容量、更宽松遮挡配额。
  - 3D：保持现有策略。
- 保持 selected label 优先策略不变。

### 3) 验证方式
- 代码侧：`agent_world_viewer` 单测通过。
- 视觉侧：运行截图脚本闭环，确认 2D 第一眼可读性提升。

### 4) 2D 流向覆盖层（工业化表达）
- 在 `world_overlay` 渲染链路中按 `ViewerCameraMode` 分支 flow 几何参数：
  - 2D：统一到平面高度（减少纵向遮挡）、线宽增强（提升可见性）。
  - 3D：保持原有空间路径表现。
- 2D 模式在 flow 终点补充箭头头部（Power/Trade 共用几何，不同材质配色）。
- 保持现有 overlay 开关与批量预算策略不变。

## 里程碑
- M0：设计文档与项目管理文档（本轮）。
- M1：2D 地图符号层落地与模式联动。
- M2：2D 标签 LOD 增强与回归测试。
- M3：截图闭环与文档状态收口。
- M4：2D 流向覆盖层工业化表达（平面化 + 箭头）与回归收口。

## 风险
- 2D 标记过强导致 3D 视觉污染。
  - 缓解：专用 marker 仅在 2D 可见。
- 标签放宽后信息过载。
  - 缓解：仅提高上限，不取消 LOD；仍保留 selected 优先。
- 场景元素增多导致渲染开销上升。
  - 缓解：marker 使用轻量几何，且仅在 2D 显示。
- 流向箭头过密导致画面噪声。
  - 缓解：沿用现有 flow 批处理上限，2D 仅增强头部表达，不放宽数量预算。
