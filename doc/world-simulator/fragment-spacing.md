# Agent World Simulator：小行星碎片最小间距（设计文档）

本分册定义小行星带碎片生成的**最小间距约束**，用于保证碎片分布的稀疏性与可解释性。

## 目标
- 为碎片生成器引入**最小间距**约束，确保碎片之间至少相隔 500 m。
- 提供可配置字段，便于在不同场景下调整或关闭该约束。
- 保持生成器在同一 seed 下的**确定性**输出。

## 范围

### In Scope
- `DustConfig` 增加最小间距字段（cm 计量）。
- `generate_fragments` 在生成碎片时应用最小间距约束。
- 补充最小间距单元测试与文档同步。

### Out of Scope
- 真实轨道动力学与碰撞/引力模拟。
- 运行时动态调整碎片位置或密度。
- 大规模空间索引优化（如体素索引或 k-d tree），仅使用简单距离检查。

## 接口 / 数据

### DustConfig
- `min_fragment_spacing_cm: i64`
  - **含义**：碎片之间的最小表面间距（cm）。
  - **默认值**：`50_000`（500 m）。
  - **约束**：若值 `<= 0`，则视为不启用最小间距限制。

### 场景覆盖
- 场景文件可通过 `dust.min_fragment_spacing_cm` 覆盖默认间距；未设置则沿用 `WorldConfig.dust`。

### 最小间距判定
- 对候选碎片与已放置碎片做距离校验。
- 判定条件（表面间距）：
  - `distance(center_a, center_b) >= radius_a + radius_b + min_fragment_spacing_cm`
- 使用平方距离避免频繁开方。

### 生成策略（简化）
- 仍采用当前体素 + 泊松采样生成候选数量。
- 每个候选碎片最多尝试固定次数放置（如 8 次），若均不满足间距则跳过。
- 该策略在相同 seed 与配置下保持确定性。

## 里程碑
- **S1**：输出设计文档与项目管理文档。
- **S2**：扩展配置字段、生成器最小间距校验与单元测试。

## 风险
- 间距约束可能降低实际生成数量，导致密度偏离期望。
- 简单的全量距离检查在高密度场景下可能带来性能开销。
- 若 `min_fragment_spacing_cm` 过大，可能出现碎片数量极低的情况。
