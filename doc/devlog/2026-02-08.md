- 日期：2026-02-08
- 完成内容：继续执行 `doc/world-simulator/rendering-physical-accuracy.project.md`，完成 RPA-5（小行星带光照模型接入）。
- 完成内容：在 `crates/agent_world_viewer/src/viewer_3d_config.rs` 新增光照/曝光计算链路：`directional_illuminance_lux()`、`exposure_scale()`、`exposed_illuminance_lux()`，统一 `1/d²` 辐照度与 EV100 曝光口径。
- 完成内容：将 `setup_3d_scene` 光源从 `PointLight` 切换为 `DirectionalLight`，并使用 `exposed_illuminance_lux()` 作为场景主光照度（`crates/agent_world_viewer/src/main.rs`）。
- 完成内容：新增/增强 RPA-5 回归测试：`asteroid_belt_irradiance_is_monotonic_in_2_2_to_3_2_au`、`exposure_ev100_controls_exposed_illuminance_lux`、`exposed_illuminance_respects_clamp_range`，覆盖小行星带距离区间单调性、曝光调节方向性与上下界夹紧。
- 完成内容：完成 RPA-6：在 `crates/agent_world_viewer/src/ui_text.rs` 增加解释性物理显示：Location 详情新增 `Radiation Visual`（`power_unit_j/time_step_s/reference_area_m2` 换算 `power(W)` 与 `flux(W/m2)`），Agent 详情新增 `Thermal Visual`（`thermal_ratio` 与 `heat_low/heat_mid/heat_high` 阈值映射）。
- 完成内容：完成 RPA-6：补充中文本地化映射（`crates/agent_world_viewer/src/ui_locale_text.rs`），支持“热态可视/辐射可视”与阈值颜色标签显示。
- 完成内容：完成 RPA-7：补充回归测试 `ui_text::tests::thermal_ratio_color_follows_design_thresholds`、`ui_text::tests::radiation_visual_metrics_convert_to_power_and_flux`，并增强 UI 集成测试覆盖 `Thermal Visual` 与 `Radiation Visual` 文本输出（`crates/agent_world_viewer/src/tests_selection_details.rs`）。
- 完成内容：修复启动阶段 `B0001` 查询冲突：`floating_origin::update_floating_origin` 对 root/camera 查询增加 `Without<>` 互斥约束，确保 `Transform` 访问不冲突（`crates/agent_world_viewer/src/floating_origin.rs`）。
- 完成内容：完成 RPA-8：执行截图闭环调试 `./scripts/capture-viewer-frame.sh --scenario llm_bootstrap --addr 127.0.0.1:5064 --tick-ms 300 --viewer-wait 8`（通过），产出截图 `.tmp/screens/window.png`。
- 完成内容：按单文件行数约束完成拆分：`crates/agent_world_viewer/src/tests.rs` 拆分出 `tests_selection_details.rs`，`crates/agent_world_viewer/src/ui_text.rs` 拆分出 `ui_text_tests.rs`；拆分后相关文件均低于 1200 行。
- 完成内容：更新项目管理文档 `doc/world-simulator/rendering-physical-accuracy.project.md`，将 RPA-6/RPA-7/RPA-8 标记完成并收口状态。
- 完成内容：运行检查 `env -u RUSTC_WRAPPER cargo fmt --all -- --check`（通过）。
- 完成内容：运行测试 `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer -- --nocapture`（通过，82 tests）。
- 完成内容：运行检查 `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`（通过）。
- 完成内容：继续执行 `doc/world-simulator/rendering-physical-accuracy.project.md`，完成 RPA-9（世界摘要物理口径可观测性）。
- 完成内容：扩展 `ui_text::world_summary`，新增 `Render Physical` 状态块：在摘要中显示单位比例、相机裁剪面、恒星距离、辐照度、曝光后照度、EV100、辐射参考面积（`crates/agent_world_viewer/src/ui_text.rs`）。
- 完成内容：在 `update_ui` 链路接入物理配置摘要输出，并补充中文本地化映射（`crates/agent_world_viewer/src/main.rs`、`crates/agent_world_viewer/src/ui_locale_text.rs`）。
- 完成内容：新增回归测试 `world_summary_includes_physical_render_block_when_enabled`、`world_summary_displays_physical_flag_when_disabled`，并更新 UI 集成测试断言（`crates/agent_world_viewer/src/ui_text_tests.rs`、`crates/agent_world_viewer/src/tests.rs`）。
- 遗留事项：无（`rendering-physical-accuracy.project.md` 分册任务全部完成，含 RPA-9）。
- 日期：2026-02-08
- 完成内容：完成 M4 电力子系统文档一致性校对，确认 `doc/m4-power-system.md` 与 `doc/m4-power-system.project.md` 需要按当前实现更新。
- 完成内容：更新 `doc/m4-power-system.md`，同步实现口径：电量饱和扣减（不为负）、移动电耗按 `time_step_s/power_unit_j` 标定、`process_power_tick` 热散逸耦合、`LowPower/Critical` 当前为状态信号、`WorldKernel` 接口签名与现状一致。
- 完成内容：更新 `doc/m4-power-system.project.md`，将 M4.2 的设施字段描述对齐为 `power_plants/power_storages`，并在状态区补充本次设计对齐说明。
- 完成内容：运行测试 `env -u RUSTC_WRAPPER cargo test -p agent_world power_tick_dissipates_more_heat_when_hotter -- --nocapture`（通过）。
- 遗留事项：后续如落地 `Critical` 强制动作限制或新增设施查询接口，需继续同步 M4 文档。
- 日期：2026-02-08
- 完成内容：完成 `doc/world-simulator.md` 与 M4 电力文档交叉一致性巡检，识别并修正“普通资源转移规则”与“电力跨 Location 交易规则”的文档边界。
- 完成内容：更新 `doc/world-simulator.md`：明确 `TransferResource` 仍要求同地，补充 M4.3 电力交易（`BuyPower`/`SellPower`）跨 Location 传输损耗/距离限制与 Agent 共址约束。
- 完成内容：在 `doc/world-simulator.md` 里程碑区新增 “M4 交叉引用（当前实现）”，标注 M4.1~M4.3 已完成、M4.4 待后续。
- 完成内容：更新 `doc/world-simulator.project.md` 的社会系统任务说明与状态区最近更新，指向本次 M4 交叉对齐结果。
- 完成内容：运行测试 `env -u RUSTC_WRAPPER cargo test -p agent_world power_transfer_rejects_out_of_range -- --nocapture`（通过）。
- 遗留事项：后续若 `TransferResource` 放开跨 Location 或 M4.4 落地，需同步更新 world-simulator 主文档与项目状态描述。
- 日期：2026-02-08
- 完成内容：基于用户提出的“Agent 默认模块”需求，新增设计分册 `doc/world-runtime/agent-default-modules.md`，定义默认七模块：身体、发电、储能、感知、移动、记忆、存储。
- 完成内容：在设计分册中补齐身体接口槽位模型（不同机体规格可配置初始槽位）与扩容规则：扩容需消耗 `interface_module_item`，并新增扩容动作/事件草案。
- 完成内容：在设计分册中明确存储模块 `m1.storage.cargo` 的实体级存储口径（矿物、未安装模块、接口模块），给出 `CargoState/CargoEntry` 草案。
- 完成内容：新增项目管理文档 `doc/world-runtime/agent-default-modules.project.md`，拆解 ADM-S1~ADM-S5 任务、依赖与阶段状态。
- 完成内容：更新 `doc/world-runtime.md` 分册索引，加入 Agent 默认模块体系入口；更新 `doc/world-runtime.project.md` 新增 ADM 任务段并回写状态。
- 遗留事项：接口模块获取机制（制造/交易/回收/任务奖励）仍待定，后续需独立分册定稿并接入 runtime 动作链路。
- 日期：2026-02-08
- 完成内容：推进 ADM-S2，实现 `AgentState.body_state`（`AgentBodyState/BodyModuleSlot/CargoEntityEntry`）并提供默认 7 槽机体配置，支持扩容等级与 cargo 实体库存。
- 完成内容：新增 runtime 动作 `Action::ExpandBodyInterface`，接入事件链路 `DomainEvent::BodyInterfaceExpanded/BodyInterfaceExpandRejected`，并在 `action_to_event` 中完成校验逻辑（agent 存在、item 非空、库存可用、槽位上限）。
- 完成内容：在 `WorldState::apply_domain_event` 中落地扩容状态更新：消费 `interface_module_item`、更新 `slot_capacity/expansion_level`、追加新 `universal` 槽位。
- 完成内容：新增 `World::add_agent_cargo_entity` 辅助接口，用于接口模块实体库存写入与合并校验（ID/数量/size 一致性）。
- 完成内容：更新模块路由标签与分支覆盖（`world/module_runtime.rs`、`runtime/builtin_modules*.rs`）以兼容新增 Action/DomainEvent，保持编译闭环。
- 完成内容：新增 ADM-S2 回归测试（`runtime/tests/body.rs`）：扩容成功消耗、缺货拒绝、缺失 agent 拒绝、snapshot/restore 持久化。
- 完成内容：更新项目管理文档 `doc/world-runtime/agent-default-modules.project.md`，将 ADM-S2 三项任务标记完成并回写阶段状态。
- 完成内容：运行 `env -u RUSTC_WRAPPER cargo check -p agent_world`（通过）。
- 完成内容：运行 `env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::body -- --nocapture`（通过，11 tests）。
- 完成内容：运行 `env -u RUSTC_WRAPPER cargo fmt --all -- --check`（通过）。
- 遗留事项：ADM-S3（`m1.sensor.basic` / `m1.mobility.basic` / `m1.memory.core` / `m1.storage.cargo` 默认模块）尚未实现，后续按项目计划继续推进。
- 日期：2026-02-08
- 完成内容：推进 `doc/world-runtime/agent-default-modules.project.md`，完成 ADM-S3：实现默认模块 `m1.sensor.basic`、`m1.mobility.basic`、`m1.memory.core`、`m1.storage.cargo`（`crates/agent_world/src/runtime/builtin_modules.rs`）。
- 完成内容：在 runtime 导出新增默认模块标识并扩展模块安装流程（`crates/agent_world/src/runtime/mod.rs`、`crates/agent_world/src/runtime/world/bootstrap_power.rs`），新增 `World::install_m1_agent_default_modules` 并约束版本幂等安装。
- 完成内容：新增默认模块回归测试（`crates/agent_world/src/runtime/tests/agent_default_modules.rs`）并补充安装入口测试（`crates/agent_world/src/runtime/tests/power_bootstrap.rs`、`crates/agent_world/src/runtime/tests/mod.rs`）。
- 完成内容：运行检查 `env -u RUSTC_WRAPPER cargo fmt --all -- --check`（通过）。
- 完成内容：运行检查 `env -u RUSTC_WRAPPER cargo check -p agent_world`（通过）。
- 完成内容：运行测试 `env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::agent_default_modules -- --nocapture`（通过，4 tests）。
- 完成内容：运行测试 `env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::power_bootstrap::install_agent_default_modules -- --nocapture`（通过，2 tests）。
- 遗留事项：ADM-S4 仍需接入“场景初始化是否安装默认模块包”开关；ADM-S5 仍需补齐更完整的集成测试与收口文档。
- 日期：2026-02-08
- 完成内容：推进 `doc/world-runtime/agent-default-modules.project.md`，完成 ADM-S4：新增场景初始化安装入口 `World::install_m1_scenario_bootstrap_modules(actor, config)`，支持通过 `M1ScenarioBootstrapConfig.install_default_module_package` 控制是否安装默认模块包（`crates/agent_world/src/runtime/world/bootstrap_power.rs`）。
- 完成内容：导出场景开关配置类型（`crates/agent_world/src/runtime/world/mod.rs`、`crates/agent_world/src/runtime/mod.rs`），保持外部调用路径稳定。
- 完成内容：补充 ADM-S4 回归测试（`crates/agent_world/src/runtime/tests/power_bootstrap.rs`）：覆盖“默认模块包开关关闭”与“场景安装入口幂等”场景。
- 完成内容：更新项目文档状态（`doc/world-runtime/agent-default-modules.project.md`、`doc/world-runtime.project.md`），将 ADM-S4 标记完成。
- 完成内容：运行检查 `env -u RUSTC_WRAPPER cargo fmt --all`（通过）。
- 完成内容：运行检查 `env -u RUSTC_WRAPPER cargo check -p agent_world`（通过）。
- 完成内容：运行测试 `env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::power_bootstrap::install_scenario_bootstrap_modules -- --nocapture`（通过，2 tests）。
- 完成内容：运行测试 `env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::power_bootstrap::install_agent_default_modules -- --nocapture`（通过，2 tests）。
- 遗留事项：ADM-S5 仍需补齐默认模块回放一致性、低电降级协同与更完整文档收口。
