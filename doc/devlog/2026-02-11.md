- 日期：2026-02-11
- 完成内容：新增《Viewer 面向开放世界沙盒的可玩化准备（阶段计划）》设计文档（`doc/world-simulator/viewer-open-world-sandbox-readiness.md`），聚焦缺口 1/2/4/5，并明确“玩家交互仅允许修改 Agent prompt”的硬约束。
- 完成内容：新增对应项目管理文档（`doc/world-simulator/viewer-open-world-sandbox-readiness.project.md`），完成 OWR0~OWR5 任务拆解、依赖与状态定义。
- 完成内容：回写总项目文档 `doc/world-simulator.project.md`，挂载新分册入口并登记 OWR 主线待办。
- 完成内容：按文档任务执行基线校验 `env -u RUSTC_WRAPPER cargo check`（通过）。
- 完成内容：完成 OWR1 代码落地（`Observe/Prompt Ops` 双模式 UI 骨架），新增 Prompt-only 约束提示、Agent 目标选择、Prompt 草稿编辑区与审计占位区（`crates/agent_world_viewer/src/egui_right_panel.rs`）。
- 完成内容：新增 `ViewerPanelMode` 与 `AGENT_WORLD_VIEWER_PANEL_MODE` 启动模式支持（`crates/agent_world_viewer/src/main.rs`、`app_bootstrap.rs`），补充 i18n 文案与测试（`i18n.rs`、`egui_right_panel_tests.rs`）。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer`（通过，144 tests）。
- 完成内容：执行截图闭环验证（Prompt Ops 模式）：`AGENT_WORLD_VIEWER_PANEL_MODE=prompt_ops ./scripts/capture-viewer-frame.sh --scenario triad --addr 127.0.0.1:5141 --tick-ms 300 --viewer-wait 10`（通过，`/.tmp/screens/window.png` 可见 Prompt Ops 面板）。
- 遗留事项：按 OWR1 + OWR2 先实现 Observe/Prompt Ops 双模式与 prompt_control 协议闭环；TODO-3（动作玩法闭环）与 TODO-6（产品化能力）暂不纳入本轮。

- 日期：2026-02-11
- 完成内容：完成 OWR3.1 / VPP5，新增选中视觉强调层（光晕）并与原有缩放反馈叠加，选中态可见性更强（`crates/agent_world_viewer/src/selection_emphasis.rs`、`crates/agent_world_viewer/src/app_bootstrap.rs`、`crates/agent_world_viewer/src/main.rs`）。
- 完成内容：补充 OWR3.1 单测并执行 `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer selection_emphasis`（通过）。
- 遗留事项：继续推进 OWR3.2（标签 LOD：距离衰减、数量上限、遮挡降权）。

- 日期：2026-02-11
- 完成内容：完成 OWR3.2 / VPP6，新增标签 LOD 系统并接入配置（距离衰减、同屏上限、遮挡降权与选中标签优先），输出运行期统计 `LabelLodStats`（`crates/agent_world_viewer/src/label_lod.rs`、`crates/agent_world_viewer/src/viewer_3d_config.rs`、`crates/agent_world_viewer/src/app_bootstrap.rs`、`crates/agent_world_viewer/src/main.rs`）。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer`（通过，150 tests）。
- 遗留事项：继续推进 OWR3.3（覆盖层/网格线批处理与节流）。

- 日期：2026-02-11
- 完成内容：完成 OWR3.3 / VPP7，覆盖层链路新增节流与批处理（按 tick/事件增量刷新、热力与流向实体数量上限、流向段合批），并新增 `OverlayRenderRuntime` 运行时状态（`crates/agent_world_viewer/src/world_overlay.rs`、`crates/agent_world_viewer/src/app_bootstrap.rs`）。
- 完成内容：完成网格线更新节流与 LOD 可见性控制（相机移动阈值触发、远距 chunk 线隐藏、overlay 开关联动）（`crates/agent_world_viewer/src/camera_controls.rs`、`crates/agent_world_viewer/src/viewer_3d_config.rs`）。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer`（通过，153 tests）。
- 遗留事项：继续推进 OWR3.4（右侧总览接入渲染性能摘要）。

- 日期：2026-02-11
- 完成内容：完成 OWR3.4 / VPP8，新增渲染性能采样与摘要资源（`RenderPerfSummary`），统计帧时间 avg/p95、对象数、可见标签数、覆盖层实体数、事件窗口与预算降级状态（`crates/agent_world_viewer/src/render_perf_summary.rs`、`crates/agent_world_viewer/src/app_bootstrap.rs`）。
- 完成内容：右侧总览接入性能摘要展示，并补充 UI 回归测试（`crates/agent_world_viewer/src/egui_right_panel.rs`、`crates/agent_world_viewer/src/egui_right_panel_tests.rs`）。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer`（通过，157 tests）。
- 遗留事项：继续推进 OWR3.5（2D/3D 与联动全回归验证）。

- 日期：2026-02-11
- 完成内容：完成 OWR3.5 / VPP9 联动回归，执行 `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer`（通过，157 tests）并完成 llm 场景截图闭环（`.tmp/screens/window.png`）。
- 完成内容：完成 OWR3 文档收口：更新设计文档实施进展、更新 OWR 与 VPP 项目管理状态、回写总项目文档主线进度（`doc/world-simulator/viewer-open-world-sandbox-readiness.md`、`doc/world-simulator/viewer-open-world-sandbox-readiness.project.md`、`doc/world-simulator/viewer-3d-polish-performance.project.md`、`doc/world-simulator.project.md`）。
- 遗留事项：进入 OWR4（规模化稳定性）任务链路。
- 完成内容：启动并完成 LMSO28 峰值收敛任务（双阈值预算 + 高波动输入源压缩），代码变更：
  - `crates/agent_world/src/simulator/llm_agent/prompt_assembly.rs`
  - `crates/agent_world/src/simulator/llm_agent.rs`
- 完成内容：在 Prompt 组装层新增 soft/hard 峰值预算收敛：超 soft 优先压缩 `history/memory/step`，超 hard 进一步强压并在必要时降级软段，优先保留协议与 schema 段。
- 完成内容：收敛输入源上限：`module_history` 的 `args/result`、`memory_digest` 与 observation 可见对象注入量进一步压缩。
- 完成内容：新增并通过单测：
  - `prompt_budget_peak_targets_are_below_effective_budget`
  - `prompt_budget_peak_targets_are_stricter_near_finalize_phase`
  - `prompt_budget_peak_budget_enforces_hard_target_on_large_inputs`
- 完成内容：完成 30 tick 回归验证：
  - 命令：`env -u RUSTC_WRAPPER cargo run -p agent_world --bin world_llm_agent_demo -- llm_bootstrap --ticks 30 --report-json .tmp/lmso28_peak_30_final/report.json`
  - 对比基线 `.tmp/lmso27b_replan_30/report.json`：
    - `llm_input_chars_max 14216 -> 9373`
    - `llm_input_chars_avg 1786 -> 1121`
    - `llm_input_chars_total 53604 -> 33654`
    - `module_call 9 -> 2`
    - 稳定性保持：`llm_errors=0`、`parse_errors=0`
- 完成内容：更新设计/项目管理文档与 README：
  - `doc/world-simulator/llm-prompt-multi-step-orchestration.md`
  - `doc/world-simulator/llm-prompt-multi-step-orchestration.project.md`
  - `README.md`
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo check -p agent_world` 与针对性 `cargo test`（通过）。
- 遗留事项：进入 LMSO29，重点优化动作失败率（`action_success`）并保持当前峰值收敛成果。

---

- 日期：2026-02-11
- 完成内容：启动并完成 LMSO29 首轮（可用性与稳定性收敛）：
  - 新增设计文档：`doc/world-simulator/llm-lmso29-stability.md`
  - 新增项目管理文档：`doc/world-simulator/llm-lmso29-stability.project.md`
- 完成内容：代码改造（轻度放宽 token 预算 + 稳定性约束提示）：
  - `crates/agent_world/src/simulator/llm_agent.rs`（PromptBudget 轻度放宽）
  - `crates/agent_world/src/simulator/llm_agent/prompt_assembly.rs`（预算常量与输出约束）
  - `crates/agent_world/src/simulator/llm_agent/behavior_loop.rs`（每轮输出约束补充）
  - `crates/agent_world/src/simulator/llm_agent/tests.rs`（预算/提示词相关回归单测）
- 完成内容：验证通过：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world prompt_budget_peak_targets_use_relaxed_reserve_values -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world llm_prompt_profile_uses_relaxed_token_budget_for_stability -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world llm_agent_prompt_contains_execute_until_and_exploration_guidance -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world`
- 完成内容：30 tick 回归与对比：
  - 命令：`env -u RUSTC_WRAPPER cargo run -p agent_world --bin world_llm_agent_demo -- llm_bootstrap --ticks 30 --report-json .tmp/lmso29_final_30_promptfix/report.json`
  - 基线：`.tmp/lmso28_peak_30_final/report.json`
  - 当前：`.tmp/lmso29_final_30_promptfix/report.json`
  - 结果：`llm_errors=0`、`prompt_section_clipped=0`，但 `parse_errors=1`、`action_success 28 -> 27`，输入体积回升（`llm_input_chars_avg 1121 -> 2213`）。
- 遗留事项：进入 LMSO29.1，优先回收动作失败率与 parse/repair 波动，再决定是否继续放宽 token 预算。

---

- 日期：2026-02-11
- 完成内容：启动并完成 LMSO30（多场景评测基线）：
  - 新增设计文档：`doc/world-simulator/llm-multi-scenario-evaluation.md`
  - 新增项目管理文档：`doc/world-simulator/llm-multi-scenario-evaluation.project.md`
- 完成内容：改造压测脚本 `scripts/llm-longrun-stress.sh`：
  - 支持 `--scenario` 多次传入与 `--scenarios <csv>` 混用。
  - 多场景模式输出分场景产物：`<out-dir>/scenarios/<scenario>/{report.json,run.log,summary.txt}`。
  - 多场景模式输出聚合产物：`<out-dir>/report.json`、`<out-dir>/summary.txt`、`<out-dir>/run.log`。
  - 聚合指标新增：`action_success_total/action_failure_total`、`llm_input_chars_total/avg_mean/max_peak`、`module_call_total`、`plan_total` 等。
- 完成内容：更新 README 多场景使用说明：
  - 新增示例：`./scripts/llm-longrun-stress.sh --ticks 30 --scenarios llm_bootstrap,power_bootstrap,resource_bootstrap --out-dir .tmp/llm_stress_multi_30 --no-llm-io`
- 完成内容：完成多场景 30 tick 回归验证：
  - 命令：`./scripts/llm-longrun-stress.sh --ticks 30 --scenarios llm_bootstrap,power_bootstrap,resource_bootstrap --out-dir .tmp/lmso30_multi_30 --no-llm-io --max-parse-errors 5 --max-repair-rounds-max 5`
  - 聚合结果（`.tmp/lmso30_multi_30/summary.txt`）：
    - `action_success_total=86`，`action_failure_total=1`
    - `llm_errors_total=0`，`parse_errors_total=3`
    - `llm_input_chars_avg_mean=1399`，`llm_input_chars_max_peak=20680`
    - `module_call_total=8`，`plan_total=16`
  - 分场景结果：
    - `llm_bootstrap`：`parse_errors=0`
    - `power_bootstrap`：`parse_errors=2`
    - `resource_bootstrap`：`parse_errors=1`
- 遗留事项：进入 LMSO31，优先回收跨场景 parse_error（先压 `power_bootstrap/resource_bootstrap`），并将评测集合扩展到 5 场景（含 `twin_region_bootstrap`、`triad_region_bootstrap`）。

---

- 日期：2026-02-11
- 完成内容：补充执行 5 场景 30 tick 闭环回归（固定场景集扩样）：
  - 命令：`./scripts/llm-longrun-stress.sh --ticks 30 --scenarios llm_bootstrap,power_bootstrap,resource_bootstrap,twin_region_bootstrap,triad_region_bootstrap --out-dir .tmp/lmso30_multi_5scenes_30 --no-llm-io --max-parse-errors 5 --max-repair-rounds-max 5`
  - 输出：`.tmp/lmso30_multi_5scenes_30/report.json`、`.tmp/lmso30_multi_5scenes_30/summary.txt` 与各场景子目录产物。
- 完成内容：5 场景聚合结果：
  - `action_success_total=140`，`action_failure_total=9`
  - `llm_errors_total=0`，`parse_errors_total=0`
  - `llm_input_chars_avg_mean=2072`，`llm_input_chars_max_peak=19584`
  - `module_call_total=29`，`plan_total=32`
- 完成内容：分场景关键观察：
  - `llm_bootstrap`：`action_success=26`、`action_failure=4`、`llm_input_chars_avg=3275`
  - `power_bootstrap`：`action_success=30`、`action_failure=0`、`llm_input_chars_avg=1209`
  - `resource_bootstrap`：`action_success=30`、`action_failure=0`、`llm_input_chars_avg=1224`
  - `twin_region_bootstrap`：`action_success=27`、`action_failure=2`、`llm_input_chars_avg=2721`
  - `triad_region_bootstrap`：`action_success=27`、`action_failure=3`、`llm_input_chars_avg=1931`
- 完成内容：更新多场景评测设计/项目文档，补充 5 场景基线与“单次采样波动”结论。
- 遗留事项：进入 LMSO31，采用固定 5 场景集做重复采样（建议 N>=3），以趋势统计替代单次结论，并优先回收 `llm_bootstrap/twin_region/triad_region` 的动作失败。

---

- 日期：2026-02-11
- 完成内容：补充并行能力（多场景）：
  - `scripts/llm-longrun-stress.sh` 新增 `--jobs <n>`，支持多场景并行执行（默认 `1`，串行兼容不变）。
  - 聚合 `summary.txt` 新增 `jobs` 字段；聚合 `report.json` 新增 `jobs` 字段。
- 完成内容：并行冒烟验证：
  - 命令：`./scripts/llm-longrun-stress.sh --ticks 1 --scenarios llm_bootstrap,power_bootstrap --jobs 2 --out-dir .tmp/lmso30_parallel_smoke --no-llm-io --max-parse-errors 5 --max-repair-rounds-max 5`
  - 结果：并行执行通过，产物完整（分场景与聚合结果均可用）。
- 完成内容：更新 README 与 LMSO30 设计/项目管理文档，补充并行参数说明。
- 遗留事项：进入 LMSO31 时增加重复采样参数（`--repeats`）并与 `--jobs` 组合验证稳定性。

---

- 日期：2026-02-11
- 完成内容：执行 `--jobs 5` 的 5 场景 30 tick 并行全量回归：
  - 命令：`./scripts/llm-longrun-stress.sh --ticks 30 --scenarios llm_bootstrap,power_bootstrap,resource_bootstrap,twin_region_bootstrap,triad_region_bootstrap --jobs 5 --out-dir .tmp/lmso30_multi_5scenes_30_jobs5 --no-llm-io --max-parse-errors 5 --max-repair-rounds-max 5`
  - 输出：`.tmp/lmso30_multi_5scenes_30_jobs5/report.json`、`.tmp/lmso30_multi_5scenes_30_jobs5/summary.txt`、`.tmp/lmso30_multi_5scenes_30_jobs5_driver.log`
- 完成内容：并行回归聚合结果：
  - `action_success_total=138`，`action_failure_total=7`
  - `llm_errors_total=0`，`parse_errors_total=4`
  - `llm_input_chars_avg_mean=1948`，`llm_input_chars_max_peak=20903`
  - `module_call_total=21`，`plan_total=35`
- 完成内容：更新 LMSO30 设计/项目文档，补充并行全量回归结果。
- 遗留事项：LMSO31 优先收敛 `resource_bootstrap/twin_region_bootstrap` 的 parse 波动，并引入重复采样统计（`--repeats`）。
