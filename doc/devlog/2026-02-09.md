- 日期：2026-02-09
- 完成内容：补齐 `agent_world_viewer` 对 `AgentDecisionTrace` 新增字段 `llm_effect_intents`、`llm_effect_receipts` 的测试构造兼容（`diagnosis.rs`、`timeline_controls.rs`、`tests.rs`、`tests_selection_details.rs`）。
- 完成内容：更新 `selection_linking.rs` 对新增事件 `LlmEffectQueued`/`LlmReceiptAppended` 的目标映射与 Agent 匹配分支，恢复枚举匹配穷尽性并保持选择联动可用。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo fmt --all -- --check`（通过）。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo test`（通过，全仓测试通过，含 `agent_world_viewer` 84 tests）。
- 遗留事项：无。
- 日期：2026-02-09
- 完成内容：新增《Viewer 文本可选中与复制能力设计》与项目管理文档（`doc/world-simulator/viewer-copyable-text.md`、`doc/world-simulator/viewer-copyable-text.project.md`）。
- 完成内容：`agent_world_viewer` 接入 `bevy_egui`，新增 `copyable_text.rs` 复制面板，聚合状态/选择/摘要/活动/详情/事件/诊断/联动/时间轴/覆盖层文本为可选中内容。
- 完成内容：Top Controls 新增“隐藏/显示复制窗”按钮，支持中英文文案切换并联动 `CopyableTextPanelState`。
- 完成内容：补充测试（`i18n.rs`、`panel_layout.rs`、`copyable_text.rs`），覆盖文案本地化与按钮开关行为。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo fmt --all -- --check`（通过）。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`（通过）。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer`（通过，88 tests）。
- 遗留事项：可按需补充“复制内容分类筛选”与“一键复制当前分组”交互。
- 日期：2026-02-09
- 完成内容：按 UI 截图闭环流程复现并定位 `bevy_egui` 中文显示方块字问题（Bevy UI 正常、EGUI 异常）。
- 完成内容：在 `copyable_text.rs` 为 EGUI 注入 `ms-yahei.ttf`（`FontDefinitions` + `Proportional/Monospace` family），并将初始化改为一次性本地状态。
- 完成内容：去除复制面板文本 `monospace()` 强制样式，避免退回英文默认 monospace 字体导致 CJK 缺字。
- 完成内容：执行截图闭环 `./scripts/capture-viewer-frame.sh --scenario llm_bootstrap --addr 127.0.0.1:5024 --tick-ms 300 --viewer-wait 8`，确认 EGUI 中文可读。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`（通过）。
- 完成内容：执行定向测试（`copyable_text::tests::install_cjk_font_registers_font_and_priority`、`panel_layout::tests::copyable_panel_toggle_button_flips_state_and_label`、`i18n::tests::copyable_toggle_label_is_localized`，通过）。
- 遗留事项：可继续评估为 EGUI 单独保留 CJK monospace 字体（若后续需要严格等宽对齐展示）。
- 日期：2026-02-09
- 完成内容：补充复制面板中文标题纯逻辑测试 `copyable_text::tests::copy_panel_title_is_localized`，覆盖 `ZhCn/EnUs` 标题映射。
- 完成内容：小幅重构复制面板文案函数（`copy_panel_title` / `copy_panel_hint`）以支持可测试化并保持行为不变。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo fmt --all`（通过）。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer copyable_text::tests::copy_panel_title_is_localized -- --exact`（通过）。
- 遗留事项：无。
- 日期：2026-02-09
- 完成内容：新增《Viewer 右侧 2D UI 迁移到 bevy_egui（SidePanel）设计》与项目管理文档（`doc/world-simulator/viewer-egui-right-panel.md`、`doc/world-simulator/viewer-egui-right-panel.project.md`）。
- 完成内容：完成 ER3~ER8 的迁移任务拆解与依赖识别，为后续分步实施提供基线。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer copyable_text::tests::copy_panel_title_is_localized -- --exact`（通过）。
- 遗留事项：进入 ER3，落地 EGUI SidePanel 骨架并开始替换旧 Bevy UI 入口。
- 日期：2026-02-09
- 完成内容：落地 `bevy_egui::SidePanel::right` 右侧面板（`egui_right_panel.rs`），将顶部控制、状态/选择、覆盖层、诊断、事件联动、时间轴、可复制文本分组整合到 EGUI 面板。
- 完成内容：新增 `RightPanelWidthState` 运行时宽度同步，`update_3d_viewport`、`orbit_camera_controls`、`pick_3d_selection` 改为读取 EGUI 实际面板宽度，保持 3D 交互边界一致。
- 完成内容：抽取并复用联动/时间轴/事件点击 action（`selection_linking.rs`、`timeline_controls.rs`、`event_click_list.rs`），避免 UI 迁移时业务逻辑重复。
- 完成内容：在 `copyable_text.rs` 暴露 EGUI CJK 字体初始化方法，并在右侧面板初始化 `ms-yahei.ttf`，确认中文文本显示正常。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo fmt --all`（通过）。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`（通过）。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer`（通过，90 tests）。
- 完成内容：执行截图闭环 `./scripts/capture-viewer-frame.sh --scenario llm_bootstrap --addr 127.0.0.1:5025 --tick-ms 300 --viewer-wait 8`，确认右侧 EGUI panel 与中文渲染正常。
- 遗留事项：继续执行 ER6，清理旧 Bevy 2D 右侧面板相关系统注册与无用代码，收敛 dead_code 警告。
- 日期：2026-02-09
- 完成内容：执行 ER6 清理，移除旧 Bevy 右侧 UI 遗留代码路径（不再使用的按钮视觉/标签更新链路、复制浮窗渲染函数、旧滚动处理实现）。
- 完成内容：`button_feedback.rs` 收敛为 Step 加载状态核心逻辑；`copyable_text.rs` 收敛为 EGUI 右侧面板复用文案与字体初始化能力。
- 完成内容：`timeline_controls.rs` 与 `world_overlay.rs` 清理未使用字段/更新函数，`panel_layout.rs`、`panel_scroll.rs` 将仅用于单测的处理函数迁移到 `#[cfg(test)]`，消除主构建 dead_code/unused 警告。
- 完成内容：`main.rs` 移除旧 `control_labels` 引用与旧 UI 相关附着；`control_labels.rs` 已不再被编译路径使用（保留文件待后续可写策略允许时删除）。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo fmt --all`（通过）。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`（通过，0 warnings）。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer`（通过，87 tests）。
- 完成内容：执行截图闭环 `./scripts/capture-viewer-frame.sh --scenario llm_bootstrap --addr 127.0.0.1:5026 --tick-ms 300 --viewer-wait 8`，确认右侧 EGUI panel 正常。
- 遗留事项：`crates/agent_world_viewer/src/control_labels.rs` 文件体仍在仓库但已脱离编译路径，待允许删除文件时可清理。
- 日期：2026-02-09
- 完成内容：按迁移收尾要求物理删除遗留文件 `crates/agent_world_viewer/src/control_labels.rs`，避免仓库保留无用模块。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`（通过）。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer`（通过，87 tests）。
- 遗留事项：无。
- 日期：2026-02-09
- 完成内容：新增《Viewer 可视化观察体验优化设计》与项目管理文档（`doc/world-simulator/viewer-observability-visual-optimization.md`、`doc/world-simulator/viewer-observability-visual-optimization.project.md`）。
- 完成内容：明确本轮优化方向为“观察导向”，不新增一键复制，优先提升面板直观总览能力与脚本场景预校验能力。
- 遗留事项：进入 VO3/VO4，实施脚本预校验与右侧面板布局优化。
- 日期：2026-02-09
- 完成内容：实施 P1：`scripts/capture-viewer-frame.sh` 新增场景白名单、别名映射（`triad`/`twin` 等）与参数预校验，非法场景可提前报错并给出可用列表。
- 完成内容：实施 P3（观察导向）：右侧面板增加总览指标（tick/事件数/轨迹数/观察模式），诊断/联动/时间轴默认直出；详情区文案从“复制”改为“观察/对比”，不新增一键复制。
- 完成内容：右侧面板默认宽度改为自适应（按窗口宽度比例并做上下限夹取），改善不同分辨率下的可视平衡。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo fmt --all`（通过）。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`（通过）。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer`（通过，88 tests）。
- 完成内容：执行脚本验证：
  - 非法场景 `triad_bad` 返回校验错误（符合预期）；
  - 别名场景 `triad` 自动映射为 `triad_region_bootstrap` 并成功抓图。
- 遗留事项：无。
- 日期：2026-02-09
- 完成内容：右侧总览新增颜色状态灯（连接/健康/观察模式），实现一眼判读当前系统状态。
- 完成内容：健康灯按 `ActionRejected` 事件数量分级（正常/告警/高风险），并补充对应单测。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo fmt --all`、`cargo check -p agent_world_viewer`、`cargo test -p agent_world_viewer`（通过，90 tests）。
- 完成内容：执行截图闭环 `./scripts/capture-viewer-frame.sh --scenario triad --addr 127.0.0.1:5036 --tick-ms 300 --viewer-wait 10`，验证状态灯显示正常。
- 遗留事项：无。
- 日期：2026-02-09
- 完成内容：按“边改边看”闭环定位并修复 3D 半屏空白问题，移除 `update_3d_viewport` 对相机 viewport 的硬裁剪，改为全窗口渲染以避免右侧大面积未渲染区域。
- 完成内容：右侧 EGUI 面板宽度策略收敛（默认/最小/最大与比例同步下调），并对事件行与提示文案做截断/换行处理，避免长文本将面板挤到过宽。
- 完成内容：执行 `./scripts/capture-viewer-frame.sh --scenario triad --addr 127.0.0.1:5039 --tick-ms 300 --viewer-wait 10`、`--addr 127.0.0.1:5041`、`--addr 127.0.0.1:5042` 连续对比，确认 3D 区域占比提升（最终约 65% / 35%）。
- 完成内容：执行 `env -u RUSTC_WRAPPER cargo fmt --all`、`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer`（通过，90 tests）、`env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`（通过）。
- 遗留事项：可继续将“状态明细”拆成固定高优先摘要 + 可折叠低频明细，进一步降低右侧纵向拥挤。
