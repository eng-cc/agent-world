- 日期：2026-02-12
- 完成内容：新增《内核不变量回归与规则 Hook 基座》设计文档与项目管理文档：
  - `doc/world-simulator/kernel-rule-hook-foundation.md`
  - `doc/world-simulator/kernel-rule-hook-foundation.project.md`
- 完成内容：完成 KRH-1（内核动作行为基线回归测试），新增 `kernel_action_behavior_snapshot_stays_stable`，固定 `WorldKernel` 关键动作路径的事件快照基线：
  - `crates/agent_world/src/simulator/tests/kernel_rule_invariants.rs`
  - `crates/agent_world/src/simulator/tests/mod.rs`
- 完成内容：执行并通过测试：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world kernel_action_behavior_snapshot_stays_stable -- --nocapture`
- 完成内容：回写项目管理文档状态：
  - `doc/world-simulator/kernel-rule-hook-foundation.project.md`（KRH-1 标记完成，KRH-2 进行中）
  - `doc/world-simulator.project.md`（新增 KRH 分组与状态）
- 遗留事项：继续推进 KRH-2，在 `WorldKernel::step` 接入 pre_action/post_action Hook（默认 no-op，行为不变）。
- 日期：2026-02-12
- 完成内容：完成 KRH-2（`WorldKernel::step` 接入 pre/post hook 脚手架，默认未注册为 no-op）：
  - `crates/agent_world/src/simulator/kernel/mod.rs`
  - `crates/agent_world/src/simulator/kernel/step.rs`
  - `crates/agent_world/src/simulator/kernel/persistence.rs`
- 完成内容：新增并通过 KRH-2 回归测试：
  - `kernel_rule_hooks_default_path_keeps_action_behavior`
  - `kernel_rule_hooks_run_in_registration_order`
  - `kernel_post_action_hook_receives_emitted_event`
  - `kernel_action_behavior_snapshot_stays_stable`
  - 测试命令：`env -u RUSTC_WRAPPER cargo test -p agent_world kernel_rule_hooks_default_path_keeps_action_behavior -- --nocapture && env -u RUSTC_WRAPPER cargo test -p agent_world kernel_rule_hooks_run_in_registration_order -- --nocapture && env -u RUSTC_WRAPPER cargo test -p agent_world kernel_post_action_hook_receives_emitted_event -- --nocapture && env -u RUSTC_WRAPPER cargo test -p agent_world kernel_action_behavior_snapshot_stays_stable -- --nocapture`
- 完成内容：更新 KRH 项目管理文档与总项目文档状态，标记 KRH-2 完成：
  - `doc/world-simulator/kernel-rule-hook-foundation.project.md`
  - `doc/world-simulator.project.md`
- 遗留事项：按当前保守策略暂不推进 KRH-3（规则决策结构与合并），等待下一步指令。
- 日期：2026-02-12
- 完成内容：完成 KRH-3（模拟器规则决策结构与合并）：
  - 新增 `KernelRuleCost`、`KernelRuleVerdict`、`KernelRuleDecision`、`KernelRuleDecisionMergeError`、`merge_kernel_rule_decisions`
  - `WorldKernel::step` 接入 pre-action 决策合并与 deny/modify/allow 执行路径
  - `RejectReason` 新增 `RuleDenied { notes }`
  - 代码文件：
    - `crates/agent_world/src/simulator/kernel/types.rs`
    - `crates/agent_world/src/simulator/kernel/mod.rs`
    - `crates/agent_world/src/simulator/kernel/step.rs`
    - `crates/agent_world/src/simulator/mod.rs`
- 完成内容：新增 KRH-3 测试并通过：
  - `crates/agent_world/src/simulator/tests/kernel_rule_decisions.rs`
  - `crates/agent_world/src/simulator/tests/mod.rs`
  - 兼容更新：`crates/agent_world/src/simulator/tests/kernel.rs`
- 完成内容：执行并通过测试：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world kernel_rule_decisions -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world kernel_action_behavior_snapshot_stays_stable -- --nocapture`
- 完成内容：回写 KRH 项目管理文档与总项目文档，标记 KRH-3 完成：
  - `doc/world-simulator/kernel-rule-hook-foundation.project.md`
  - `doc/world-simulator.project.md`
- 遗留事项：继续推进 KRH-4（回归验证、文档与 devlog 收口）。
- 日期：2026-02-12
- 完成内容：完成 KRH-4（回归验证、文档与 devlog 收口）：
  - 执行并通过回归测试：`env -u RUSTC_WRAPPER cargo test -p agent_world`
  - 任务状态收口：`doc/world-simulator/kernel-rule-hook-foundation.project.md`（KRH-1~KRH-4 全部完成）
  - 总项目文档同步：`doc/world-simulator.project.md`
- 遗留事项：KRH 基座阶段已完成，后续是否进入下一阶段（规则 `cost` 生效 / wasm 规则执行器接线）待确认。
- 日期：2026-02-12
- 完成内容：启动 KWR（规则 Wasm 化就绪第二阶段）文档任务：
  - 新增设计文档：`doc/world-simulator/kernel-rule-wasm-readiness.md`
  - 新增项目管理文档：`doc/world-simulator/kernel-rule-wasm-readiness.project.md`
  - 总项目文档新增 KWR 分组并挂载任务：`doc/world-simulator.project.md`
- 遗留事项：继续推进 KWR-1（pre-action hook 上下文扩展）与 KWR-2 测试。
- 日期：2026-02-12
- 完成内容：完成 KWR-1（pre-action hook 上下文扩展）：
  - `add_pre_action_rule_hook` 接口签名调整为 `Fn(ActionId, &Action, &WorldKernel) -> KernelRuleDecision`
  - `WorldKernel::step` 调用 pre-action hook 时传入只读内核上下文
  - 同步更新规则相关测试闭包签名
  - 代码文件：
    - `crates/agent_world/src/simulator/kernel/mod.rs`
    - `crates/agent_world/src/simulator/kernel/step.rs`
    - `crates/agent_world/src/simulator/tests/kernel.rs`
    - `crates/agent_world/src/simulator/tests/kernel_rule_decisions.rs`
- 完成内容：执行并通过测试：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world kernel_rule -- --nocapture`
- 完成内容：回写 KWR 项目管理文档与总项目文档状态，标记 KWR-1 完成：
  - `doc/world-simulator/kernel-rule-wasm-readiness.project.md`
  - `doc/world-simulator.project.md`
- 遗留事项：继续推进 KWR-2（基于上下文的规则测试：时间/模型状态读取）。
- 日期：2026-02-12
- 完成内容：完成 KWR-2（基于上下文的规则测试）：
  - 新增 `kernel_pre_action_rule_can_read_kernel_time_context`，验证 pre-hook 可读取 `kernel.time()` 并影响 allow/deny。
  - 新增 `kernel_pre_action_rule_can_read_model_state_context`，验证 pre-hook 可读取 `kernel.model()` 并基于 location 存在性执行 deny/modify。
  - 代码文件：
    - `crates/agent_world/src/simulator/tests/kernel_rule_decisions.rs`
- 完成内容：执行并通过测试：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world kernel_rule -- --nocapture`
- 完成内容：回写 KWR 项目管理文档与总项目文档状态，标记 KWR-2 完成：
  - `doc/world-simulator/kernel-rule-wasm-readiness.project.md`
  - `doc/world-simulator.project.md`
- 遗留事项：KWR-3（回归验证与文档收口）待下一步指令。
- 日期：2026-02-12
- 完成内容：完成 KWR-3（回归验证与文档收口）：
  - 执行并通过回归测试：`env -u RUSTC_WRAPPER cargo test -p agent_world`
  - KWR 项目管理文档收口：`doc/world-simulator/kernel-rule-wasm-readiness.project.md`（KWR-0~KWR-3 全部完成）
  - 总项目文档同步：`doc/world-simulator.project.md`（KWR-3 标记完成并更新最近状态）
- 遗留事项：KWR 第二阶段已完成，后续是否进入下一阶段（规则 wasm 执行接线 / `KernelRuleCost` 生效）待确认。
- 完成内容：新增 `agent_world_proto` 抽离方案文档与项目管理文档：
  - `doc/world-runtime/agent-world-proto.md`
  - `doc/world-runtime/agent-world-proto.project.md`
- 完成内容：执行并通过编译检查：
  - `env -u RUSTC_WRAPPER cargo check`
- 遗留事项：继续完成 T2/T3（新建 crate、迁移协议类型与 trait、完成 runtime 适配与回归）。
- 日期：2026-02-12
- 完成内容：完成 T2（新建 `agent_world_proto` 并迁移协议类型与 trait）：
  - 新增 crate：`crates/agent_world_proto`
  - 迁移协议类型：`crates/agent_world_proto/src/distributed.rs`
  - 迁移 trait 定义：`crates/agent_world_proto/src/distributed_net.rs`、`crates/agent_world_proto/src/distributed_dht.rs`
  - `agent_world` 侧接入新 crate：workspace 与依赖更新，`runtime/distributed*.rs` 改为桥接/实现对接
- 完成内容：执行并通过检查与定向测试：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world -p agent_world_proto`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_proto`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --lib in_memory_publish_delivers_to_subscribers`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --lib in_memory_dht_tracks_world_head`
- 遗留事项：继续完成 T3（项目文档收口、最终状态回写、补充回归确认并提交）。
- 日期：2026-02-12
- 完成内容：完成 T3 收口（`agent_world` 侧适配回归与最终状态回写）：
  - 项目文档状态更新：`doc/world-runtime/agent-world-proto.project.md`（T3 标记完成，阶段改为全部完成）
  - 回归验证通过：`env -u RUSTC_WRAPPER cargo test -p agent_world --test distributed_module_fetch`
  - 补充修复：`crates/agent_world/tests/distributed_bootstrap.rs` 引入 `agent_world_proto` trait 作用域，修复全量测试下 trait 方法解析失败
  - 补充回归通过：`env -u RUSTC_WRAPPER cargo test -p agent_world --test distributed_bootstrap`
  - 编译检查通过：`env -u RUSTC_WRAPPER cargo check`
- 遗留事项：当前抽离目标已完成；后续如有新增跨 crate 协议抽象，可继续沉淀到 `agent_world_proto`。
- 完成内容：完成 OWR2-Client（Viewer Prompt Ops 交互闭环）实现：
  - 新增 Prompt 控制回执状态资源 `PromptControlUiState`（`crates/agent_world_viewer/src/prompt_control_state.rs`），接入 `poll_viewer_messages` 对 `PromptControlAck/Error` 的处理，避免业务错误将连接状态误判为断开（`crates/agent_world_viewer/src/main.rs`）。
  - Prompt Ops 面板接入真实请求链路：`preview/apply/rollback` 请求发送、回滚版本输入、在线/离线提示、服务端回执成功/失败消息展示（`crates/agent_world_viewer/src/prompt_ops_panel.rs`）。
  - Prompt Ops 面板新增“载入当前配置”、字段级差异预览（当前配置 vs 草稿）、审计区 `AgentPromptUpdated` 事件展示（tick/version/operation/fields/digest）。
  - 为满足单 Rust 文件行数约束，将 Prompt Ops 面板从 `egui_right_panel.rs` 拆分为独立模块 `prompt_ops_panel.rs`；`egui_right_panel.rs` 仅保留编排与公共区块。
  - 补充测试：
    - `crates/agent_world_viewer/src/prompt_control_state.rs`：回执状态资源行为测试。
    - `crates/agent_world_viewer/src/tests_prompt_control.rs`：`poll_viewer_messages` 的 ack/error 成功/失败路径测试。
    - `crates/agent_world_viewer/src/prompt_ops_panel.rs`：三态 patch 语义、审计过滤顺序、Agent 收集测试。
    - `crates/agent_world_viewer/src/egui_right_panel_tests.rs`：Prompt Ops 面板渲染断言更新。
- 完成内容：更新 OWR 文档状态：
  - `doc/world-simulator/viewer-open-world-sandbox-readiness.project.md`：`OWR2-Client` 标记完成，阶段推进到 `OWR4`。
  - `doc/world-simulator/viewer-open-world-sandbox-readiness.md`：新增 2026-02-12 实施进展与验证记录。
- 完成内容：执行并通过验证命令：
  - `env -u RUSTC_WRAPPER cargo fmt --all`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer prompt_control -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer prompt_ops -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
- 遗留事项：推进 OWR4（规模化稳定性）任务链路：事件窗口策略、对象增量刷新、自动降级策略、压测基线。

- 日期：2026-02-12
- 完成内容：完成 OWR4.1（事件窗口策略）实现：
  - 新增事件窗口策略模块 `crates/agent_world_viewer/src/event_window.rs`，提供滚动窗口 + 采样压缩器：事件流入时优先保留近期全量区，对旧事件按采样步长保留，窗口稳定在上限内。
  - 启动配置新增 OWR4.1 配置项（环境变量）并接入运行时：
    - `AGENT_WORLD_VIEWER_EVENT_WINDOW_SIZE`
    - `AGENT_WORLD_VIEWER_EVENT_WINDOW_RECENT`
    - `AGENT_WORLD_VIEWER_EVENT_SAMPLE_STRIDE`
  - `poll_viewer_messages` 的 `ViewerResponse::Event` 路径切换为策略化窗口写入；`decision_traces` 保持原有上限裁剪逻辑。
  - 补充测试：
    - `event_window.rs`：配置归一化、默认回退、采样窗口、纯滚动窗口测试。
    - `tests.rs`：新增 `poll_viewer_messages_applies_event_window_sampling_policy`，验证消息轮询入口在高事件流下按策略压缩。
- 完成内容：更新 OWR 文档状态：
  - `doc/world-simulator/viewer-open-world-sandbox-readiness.project.md`：`OWR4.1` 标记完成，下一阶段更新为 `OWR4.2`。
  - `doc/world-simulator/viewer-open-world-sandbox-readiness.md`：补充 OWR4.1 实施进展、配置项与验证记录。
- 完成内容：执行并通过验证命令：
  - `env -u RUSTC_WRAPPER cargo fmt --all`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
- 遗留事项：继续推进 OWR4 后续任务（`OWR4.2` 场景对象增量刷新、`OWR4.3` 自动降级策略、`OWR4.4` 压测脚本与模板、`OWR4.5` 跨版本基线）。

- 日期：2026-02-12
- 完成内容：完成 OWR4.2（场景对象增量刷新）实现：
  - 新增 `crates/agent_world_viewer/src/scene_dirty_refresh.rs`，实现“全量重建判定 + 脏区更新”：
    - 全量重建触发条件：首次快照、时间回退、空间配置变化、fragment 可见性变化；
    - 非上述情况走增量刷新：按对象级别刷新 location/agent/chunk，避免每 tick 全量销毁重建。
  - `update_3d_scene` 接入增量刷新路径；全量重建只在必要条件触发，其余 tick 走脏区更新。
  - `scene_helpers.rs` 中 `apply_events_to_scene` 改为基于 `last_event_id` 去重，不再按 `snapshot_time` 过滤事件时间，保证消息时序波动时增量应用稳定。
  - 对外暴露增量刷新所需 helper（`location_visual_radius_cm`、`agent_module_counts_in_snapshot`）用于脏区判断与更新。
  - 新增测试：
    - `scene_dirty_refresh::tests::scene_requires_full_rebuild_only_for_topology_or_time_regression`
    - `scene_dirty_refresh::tests::location_needs_refresh_detects_cached_delta`
    - `scene_dirty_refresh::tests::agent_needs_refresh_detects_module_and_location_delta`
- 完成内容：更新 OWR 文档状态：
  - `doc/world-simulator/viewer-open-world-sandbox-readiness.project.md`：`OWR4.2` 标记完成，下一阶段调整为 `OWR4.3`。
  - `doc/world-simulator/viewer-open-world-sandbox-readiness.md`：补充 OWR4.2 实施与验证记录。
- 完成内容：执行并通过验证命令：
  - `env -u RUSTC_WRAPPER cargo fmt --all`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
- 遗留事项：继续推进 OWR4 后续任务（`OWR4.3` 自动降级策略、`OWR4.4` 压测脚本与模板、`OWR4.5` 跨版本基线）。

- 日期：2026-02-12
- 完成内容：完成 OWR4.3（自动降级策略）实现：
  - 新增 `crates/agent_world_viewer/src/auto_degrade.rs`，实现基于渲染压力的自动降级状态机（带滞回）：
    - Level 1：压缩标签上限；
    - Level 2：继续压缩标签并关闭 heat overlay；
    - Level 3：继续压缩标签并关闭 flow overlay。
  - 支持压力回落后逐级恢复，并回放到进入降级前的基线开关/标签配置，避免降级策略把 UI 永久锁在低配档。
  - 新增环境变量 `AGENT_WORLD_VIEWER_AUTO_DEGRADE`（默认开启）控制策略开关。
  - 在 UI 启动链路接入 `AutoDegradeConfig/AutoDegradeState` 资源，并把 `update_auto_degrade_policy` 接入 `sample_render_perf_summary` 后的系统链。
  - 新增自动降级回归测试：
    - `auto_degrade_escalates_then_recovers_with_hysteresis`
    - `auto_degrade_restores_baseline_at_level_zero`
- 完成内容：更新 OWR 文档状态：
  - `doc/world-simulator/viewer-open-world-sandbox-readiness.project.md`：`OWR4.3` 标记完成，下一阶段更新为 `OWR4.4`。
  - `doc/world-simulator/viewer-open-world-sandbox-readiness.md`：补充 OWR4.3 实施与验证记录。
- 完成内容：执行并通过验证命令：
  - `env -u RUSTC_WRAPPER cargo fmt --all`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
- 遗留事项：继续推进 OWR4 后续任务（`OWR4.4` 压测脚本与模板、`OWR4.5` 跨版本基线）。

- 日期：2026-02-12
- 完成内容：完成 OWR4.4（压测脚本与报告模板）实现：
  - 新增脚本 `scripts/viewer-owr4-stress.sh`，用于 triad/llm 高负载场景压测：
    - 默认场景：`triad_region_bootstrap,llm_bootstrap`；
    - `llm_bootstrap` 自动启用 `--llm`；
    - viewer 以 `headless + online` 模式运行并采集事件窗口计数；
    - 输出 `metrics.csv` 与 `summary.md` 到 `.tmp/viewer_owr4_stress/<timestamp>/`。
  - 新增压测报告模板 `doc/world-simulator/viewer-open-world-sandbox-readiness.stress-report.template.md`，统一记录运行信息、脚本汇总、渲染指标补录、异常与结论。
- 完成内容：更新 OWR 文档状态：
  - `doc/world-simulator/viewer-open-world-sandbox-readiness.project.md`：`OWR4.4` 标记完成，下一阶段调整为 `OWR4.5`。
  - `doc/world-simulator/viewer-open-world-sandbox-readiness.md`：补充 OWR4.4 实施与验证记录。
- 完成内容：执行并通过验证命令：
  - `bash -n scripts/viewer-owr4-stress.sh`
  - `./scripts/viewer-owr4-stress.sh --help`
  - `./scripts/viewer-owr4-stress.sh --duration-secs 5 --tick-ms 300 --scenarios triad_region_bootstrap --no-prewarm --out-dir .tmp/viewer_owr4_stress_smoke`
- 遗留事项：推进 OWR4.5（跨版本基线：帧时间、事件吞吐、丢帧/卡顿指标）。

- 日期：2026-02-12
- 完成内容：完成 OWR4.5（跨版本基线）实现与采样：
  - 新增基线文档 `doc/world-simulator/viewer-open-world-sandbox-readiness.baseline.md`，固化当前版本 triad/llm（fallback）基线。
  - viewer 新增 `perf_probe`：
    - 配置项：`AGENT_WORLD_VIEWER_PERF_PROBE`、`AGENT_WORLD_VIEWER_PERF_PROBE_INTERVAL_SECS`、`AGENT_WORLD_VIEWER_PERF_BUDGET_MS`；
    - 周期输出 `avg/p95/over_budget_pct/event_window/auto_degrade`，用于脚本化采样和跨版本对比。
  - headless/UI 自动播放链路补齐：
    - headless 模式默认自动 `Play`（可用 `AGENT_WORLD_VIEWER_HEADLESS_AUTO_PLAY` 关闭）；
    - 新增 `AGENT_WORLD_VIEWER_AUTO_PLAY=1`，支持 UI（截图闭环）场景自动进入播放态，保证 perf probe 在动态负载下采样。
  - 压测与采样产物落地：
    - 吞吐：`artifacts/owr4_baseline/20260212-130428/metrics.csv`
      - triad `events/s=2.50`
      - llm_bootstrap（`script_fallback(no_openai_key)`）`events/s=2.67`
    - 帧时间/卡顿：`artifacts/owr4_baseline/20260212-130428/frame_probe/*.log`
      - triad `avg=17.13ms p95=22.47ms over_budget_pct=2.85%`
      - llm_bootstrap(fallback) `avg=17.78ms p95=21.43ms over_budget_pct=1.38%`
- 完成内容：更新 OWR 文档状态：
  - `doc/world-simulator/viewer-open-world-sandbox-readiness.project.md`：`OWR4.5` 标记完成，OWR4 全链路收口。
  - `doc/world-simulator/viewer-open-world-sandbox-readiness.md`：补充 OWR4.5 实施与验证记录。
- 完成内容：执行并通过验证命令：
  - `env -u RUSTC_WRAPPER cargo fmt --all`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer headless_auto_play -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer perf_probe -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
  - `./scripts/viewer-owr4-stress.sh --duration-secs 12 --tick-ms 200 --out-dir artifacts/owr4_baseline --no-prewarm`
  - `AGENT_WORLD_VIEWER_AUTO_PLAY=1 AGENT_WORLD_VIEWER_PERF_PROBE=1 AGENT_WORLD_VIEWER_PERF_PROBE_INTERVAL_SECS=1 AGENT_WORLD_VIEWER_PERF_BUDGET_MS=33 ./scripts/capture-viewer-frame.sh --scenario triad_region_bootstrap --addr 127.0.0.1:5640 --tick-ms 200 --viewer-wait 10 --no-prewarm --keep-tmp`
  - `AGENT_WORLD_VIEWER_AUTO_PLAY=1 AGENT_WORLD_VIEWER_PERF_PROBE=1 AGENT_WORLD_VIEWER_PERF_PROBE_INTERVAL_SECS=1 AGENT_WORLD_VIEWER_PERF_BUDGET_MS=33 ./scripts/capture-viewer-frame.sh --scenario llm_bootstrap --addr 127.0.0.1:5641 --tick-ms 200 --viewer-wait 10 --no-prewarm --keep-tmp`
- 遗留事项：后续版本按同口径复跑 `artifacts/owr4_baseline` 流程并填充基线对比模板。

- 日期：2026-02-12
- 完成内容：完成 OWR4.5 基线产物归档策略调整（不保留原始 `artifacts`）：
  - 将 OWR4.5 结论性基线数据（`events/s`、`frame_ms_avg/p95`、`over_budget_pct`）迁移并固化到项目管理文档 `doc/world-simulator/viewer-open-world-sandbox-readiness.project.md`。
  - 设计文档 `doc/world-simulator/viewer-open-world-sandbox-readiness.md` 同步口径：不再引用独立 baseline 文档与仓库内 artifacts 路径，改为指向项目管理文档的结论归档。
  - 移除版本库中的原始基线产物与独立基线文档：
    - `artifacts/owr4_baseline/20260212-130428/*`
    - `doc/world-simulator/viewer-open-world-sandbox-readiness.baseline.md`
  - `.gitignore` 新增 `artifacts/owr4_baseline/`，避免后续基线运行产物再次进入版本库。
- 完成内容：执行并通过验证命令：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
- 遗留事项：后续版本复跑 OWR4 基线时，仅更新项目管理文档中的结论表，不提交原始截图/日志产物。
- 日期：2026-02-12
- 完成内容：启动 KWE（规则 Wasm 执行接线基础第三阶段）文档任务：
  - 新增设计文档：`doc/world-simulator/kernel-rule-wasm-executor-foundation.md`
  - 新增项目管理文档：`doc/world-simulator/kernel-rule-wasm-executor-foundation.project.md`
  - 总项目文档新增 KWE 分组并挂载任务：`doc/world-simulator.project.md`
- 遗留事项：继续推进 KWE-1（规则 wasm 输入/输出契约与 pre-action 评估入口）与 KWE-2 测试。
- 日期：2026-02-12
- 完成内容：完成 KWE-1（规则 wasm 输入/输出契约与 pre-action 可选评估入口）：
  - 新增规则 wasm 契约数据结构：`KernelRuleModuleContext`、`KernelRuleModuleInput`、`KernelRuleModuleOutput`
  - `WorldKernel` 新增可选 wasm pre-action 评估器接线：
    - `set_pre_action_wasm_rule_evaluator(...)`
    - `clear_pre_action_wasm_rule_evaluator()`
  - `WorldKernel::step` pre-action 阶段支持执行 wasm 评估器并并入规则决策 merge（失败转 `RuleDenied` 备注）
  - 代码文件：
    - `crates/agent_world/src/simulator/kernel/types.rs`
    - `crates/agent_world/src/simulator/kernel/mod.rs`
    - `crates/agent_world/src/simulator/kernel/step.rs`
    - `crates/agent_world/src/simulator/mod.rs`
- 完成内容：回写 KWE 项目管理文档与总项目文档状态，标记 KWE-1 完成：
  - `doc/world-simulator/kernel-rule-wasm-executor-foundation.project.md`
  - `doc/world-simulator.project.md`
- 遗留事项：继续推进 KWE-2（wasm 接线测试：allow/deny/modify/错误兜底）。
- 日期：2026-02-12
- 完成内容：完成 KWE-2（wasm 接线测试补齐）：
  - 新增 `kernel_wasm_rule_bridge.rs`，覆盖四条路径：
    - allow + 上下文读取
    - modify override
    - deny reject
    - evaluator error -> `RuleDenied` 兜底
  - 测试入口挂载：
    - `crates/agent_world/src/simulator/tests/mod.rs`
  - 代码文件：
    - `crates/agent_world/src/simulator/tests/kernel_wasm_rule_bridge.rs`
    - `crates/agent_world/src/simulator/tests/mod.rs`
- 完成内容：执行并通过测试：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world kernel_wasm_pre_action_evaluator -- --nocapture`
- 完成内容：回写 KWE 项目管理文档与总项目文档状态，标记 KWE-2 完成：
  - `doc/world-simulator/kernel-rule-wasm-executor-foundation.project.md`
  - `doc/world-simulator.project.md`
- 遗留事项：继续推进 KWE-3（回归验证与文档收口）。
- 日期：2026-02-12
- 完成内容：完成 KWE-3（回归验证与文档收口）：
  - 执行并通过回归测试：`env -u RUSTC_WRAPPER cargo test -p agent_world`
  - KWE 项目管理文档收口：`doc/world-simulator/kernel-rule-wasm-executor-foundation.project.md`（KWE-0~KWE-3 全部完成）
  - 总项目文档同步：`doc/world-simulator.project.md`（KWE-3 标记完成并更新最近状态）
- 遗留事项：KWE 第三阶段已完成，后续是否进入下一阶段（真实 wasm sandbox 执行接线 / 规则 cost 扣费生效）待确认。
- 日期：2026-02-12
- 完成内容：启动 KWS（规则 Wasm Sandbox 桥接第四阶段）文档任务：
  - 新增设计文档：`doc/world-simulator/kernel-rule-wasm-sandbox-bridge.md`
  - 新增项目管理文档：`doc/world-simulator/kernel-rule-wasm-sandbox-bridge.project.md`
  - 总项目文档新增 KWS 分组并挂载任务：`doc/world-simulator.project.md`
- 遗留事项：继续推进 KWS-1（ModuleSandbox 桥接 API 与输入输出转换）与 KWS-2 测试。
- 日期：2026-02-12
- 完成内容：完成 KWS-1（ModuleSandbox 桥接 API 与输入/输出转换）：
  - `WorldKernel` 新增 `set_pre_action_wasm_rule_module_evaluator(...)`，支持通过 runtime `ModuleSandbox` 执行 pre-action 规则模块。
  - 新增 simulator -> runtime 调用映射：
    - `KernelRuleModuleInput` -> `ModuleCallInput`（CBOR）
    - 解析 `ModuleOutput.emits` 中 `rule.decision` -> `KernelRuleDecision`
  - 输出约束：
    - 无 `rule.decision` emit 视为 `allow`
    - 多 decision / payload 非法 / action_id 不匹配视为 evaluator 错误（由上层转 `RuleDenied`）
  - 代码文件：
    - `crates/agent_world/src/simulator/kernel/mod.rs`
- 完成内容：执行并通过测试：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world kernel_rule -- --nocapture`
- 完成内容：回写 KWS 项目管理文档与总项目文档状态，标记 KWS-1 完成：
  - `doc/world-simulator/kernel-rule-wasm-sandbox-bridge.project.md`
  - `doc/world-simulator.project.md`
- 遗留事项：继续推进 KWS-2（sandbox 桥接测试）。
- 日期：2026-02-12
- 完成内容：完成 KWS-2（sandbox 桥接测试补齐）：
  - 新增 `kernel_wasm_sandbox_bridge.rs`，覆盖桥接核心路径：
    - 请求编码与 allow 默认路径
    - modify override
    - deny reject
    - sandbox failure -> `RuleDenied` 兜底
  - 测试入口挂载：
    - `crates/agent_world/src/simulator/tests/mod.rs`
  - 代码文件：
    - `crates/agent_world/src/simulator/tests/kernel_wasm_sandbox_bridge.rs`
    - `crates/agent_world/src/simulator/tests/mod.rs`
- 完成内容：执行并通过测试：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world kernel_wasm_sandbox_bridge -- --nocapture`
- 完成内容：回写 KWS 项目管理文档与总项目文档状态，标记 KWS-2 完成：
  - `doc/world-simulator/kernel-rule-wasm-sandbox-bridge.project.md`
  - `doc/world-simulator.project.md`
- 遗留事项：继续推进 KWS-3（回归验证与文档收口）。
- 日期：2026-02-12
- 完成内容：完成 KWS-3（回归验证与文档收口）：
  - 执行并通过回归测试：`env -u RUSTC_WRAPPER cargo test -p agent_world`
  - KWS 项目管理文档收口：`doc/world-simulator/kernel-rule-wasm-sandbox-bridge.project.md`（KWS-0~KWS-3 全部完成）
  - 总项目文档同步：`doc/world-simulator.project.md`（KWS-3 标记完成并更新最近状态）
- 遗留事项：KWS 第四阶段已完成，后续是否进入下一阶段（规则模块装载/治理接入、`KernelRuleCost` 扣费落账）待确认。
- 日期：2026-02-12
- 完成内容：启动 KWM（规则 Wasm 模块装载治理第五阶段）文档任务：
  - 新增设计文档：`doc/world-simulator/kernel-rule-wasm-module-governance.md`
  - 新增项目管理文档：`doc/world-simulator/kernel-rule-wasm-module-governance.project.md`
  - 总项目文档新增 KWM 分组并挂载任务：`doc/world-simulator.project.md`
- 遗留事项：继续推进 KWM-1（artifact 注册表与按 hash 激活 API）与 KWM-2 测试。
- 日期：2026-02-12
- 完成内容：完成 KWM-1（artifact 注册表与按 hash 激活 API）：
  - `WorldKernel` 增加 runtime-only artifact 注册管理：
    - `register_pre_action_wasm_rule_artifact(...)`
    - `remove_pre_action_wasm_rule_artifact(...)`
  - 新增按 hash 激活 API：
    - `set_pre_action_wasm_rule_module_from_registry(...)`
  - 约束：
    - 空 hash / 空 bytes 拒绝注册
    - 同 hash 重复注册不同 bytes 返回错误，防止误覆盖
  - 代码文件：
    - `crates/agent_world/src/simulator/kernel/mod.rs`
- 完成内容：执行并通过测试：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world kernel_rule -- --nocapture`
- 完成内容：回写 KWM 项目管理文档与总项目文档状态，标记 KWM-1 完成：
  - `doc/world-simulator/kernel-rule-wasm-module-governance.project.md`
  - `doc/world-simulator.project.md`
- 遗留事项：继续推进 KWM-2（装载治理测试）。
- 日期：2026-02-12
- 完成内容：完成 KWM-2（装载治理测试）：
  - 在 `crates/agent_world/src/simulator/tests/kernel_wasm_sandbox_bridge.rs` 新增并通过 3 条治理路径测试：
    - `kernel_wasm_artifact_registry_activation_fails_when_hash_missing`
    - `kernel_wasm_artifact_registry_rejects_conflicting_duplicate_hash`
    - `kernel_wasm_artifact_registry_activation_uses_registered_bytes`
  - 覆盖 missing hash、冲突注册、按注册表激活成功三条核心路径。
- 完成内容：执行并通过测试：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world kernel_wasm_sandbox_bridge -- --nocapture`
- 完成内容：回写 KWM 项目管理文档与总项目文档状态，标记 KWM-2 完成：
  - `doc/world-simulator/kernel-rule-wasm-module-governance.project.md`
  - `doc/world-simulator.project.md`
- 遗留事项：继续推进 KWM-3（回归验证、文档与 devlog 收口）。
- 日期：2026-02-12
- 完成内容：完成 KWM-3（回归验证、文档与 devlog 收口）：
  - 执行并通过回归测试：`env -u RUSTC_WRAPPER cargo test -p agent_world`
  - KWM 项目管理文档收口：`doc/world-simulator/kernel-rule-wasm-module-governance.project.md`（KWM-0~KWM-3 全部完成）
  - 总项目文档同步：`doc/world-simulator.project.md`（KWM-3 标记完成并更新最近状态）
- 遗留事项：KWM 第五阶段已完成，后续是否进入下一阶段（规则 cost 扣费落账 / 装载治理扩展）待确认。
- 日期：2026-02-12
- 完成内容：启动 KWT（Rust 到 Wasm 编译套件）文档任务：
  - 新增设计文档：`doc/world-simulator/rust-wasm-build-suite.md`
  - 新增项目管理文档：`doc/world-simulator/rust-wasm-build-suite.project.md`
  - 总项目文档新增 KWT 分组并挂载任务：`doc/world-simulator.project.md`
- 遗留事项：继续推进 KWT-1（Rust->Wasm 构建套件主功能：CLI + 脚本封装）。
- 完成内容：启动 GitHub Pages 四期“精简科技感升级”文档任务：
  - 新增设计文档：`doc/github-pages-lean-tech-refresh.md`
  - 新增项目管理文档：`doc/github-pages-lean-tech-refresh.project.md`
- 完成内容：明确四期任务分组（信息架构瘦身 / 视觉系统升级 / 验证收口），状态更新为执行中。
- 遗留事项：继续推进页面双语改造与样式升级实现。
- 日期：2026-02-12
- 完成内容：完成 GitHub Pages 四期“精简科技感升级”实现：
  - 双语页面结构瘦身与重排：
    - `site/index.html`
    - `site/en/index.html`
  - 收敛导航到关键锚点，删除冗余模块，压缩 Hero 与正文文案密度。
  - 保留并简化证据链：3 场景切换（minimal/twin/triad）+ 事件样例 + 时间线。
  - 样式系统重设：
    - `site/assets/styles.css`
    - 新字体组合（Space Grotesk/IBM Plex Sans/IBM Plex Mono）
    - 新色板与层级（主强化、次弱化），降低“全局同强度高亮”噪声。
- 完成内容：验证与收口：
  - 静态结构自检（双语 section/nav/proof 标记对齐）
  - 编译检查通过：`env -u RUSTC_WRAPPER cargo check`
  - 项目管理文档收口：`doc/github-pages-lean-tech-refresh.project.md`
- 遗留事项：四期目标已完成；后续可按传播需求增加“改造前后对比”专题或短演示素材。
- 日期：2026-02-12
- 完成内容：启动 GitHub Pages 四期增量任务“Hero 动态背景层”：
  - 新增设计文档：`doc/github-pages-hero-motion-layer.md`
  - 新增项目管理文档：`doc/github-pages-hero-motion-layer.project.md`
- 完成内容：明确实现任务拆解（Canvas 接入、降级策略、验证收口）。
- 遗留事项：继续推进中英文 Hero Canvas 实现与样式/可访问性集成。
- 日期：2026-02-12
- 完成内容：完成 GitHub Pages Hero 动态背景层增量实现：
  - 双语 Hero 接入 Canvas 动态层：
    - `site/index.html`
    - `site/en/index.html`
  - 新增轻量动画循环：`site/assets/app.js`
    - 粒子节点 + 邻近连线 + 扫描光带
    - 小屏降采样（按视口面积动态控制节点数）
    - 页面不可见自动暂停，恢复后继续
    - `prefers-reduced-motion` 自动停用动画
  - 新增 Hero Canvas 层级样式：`site/assets/styles.css`
    - 动效层位于文本下方，确保标题与 CTA 可读
- 完成内容：执行并通过验证：
  - 静态结构自检（`data-hero-canvas` / `bindHeroCanvas` / 可访问性标记）
  - 编译检查：`env -u RUSTC_WRAPPER cargo check`
  - 项目管理文档收口：`doc/github-pages-hero-motion-layer.project.md`
- 遗留事项：当前动态层任务已完成；后续可按需要加入更细颗粒的交互联动效果。
- 日期：2026-02-12
- 完成内容：启动 GitHub Pages 四期增量任务“Hero 指针微交互”：
  - 新增设计文档：`doc/github-pages-hero-pointer-interaction.md`
  - 新增项目管理文档：`doc/github-pages-hero-pointer-interaction.project.md`
- 完成内容：明确实现范围（鼠标/触摸联动、扫描光带短时增强、降级保护）。
- 遗留事项：继续推进 `bindHeroCanvas` 指针联动实现与验证。
- 日期：2026-02-12
- 完成内容：完成 Hero 指针微交互联动实现：
  - 扩展 `site/assets/app.js` 的 `bindHeroCanvas()`：
    - 新增鼠标/触摸指针状态采集（`pointermove` / `pointerdown` / `pointerleave` / `pointercancel` / `pointerup`）
    - 指针邻域节点响应：轻微扰动与亮度增强
    - 扫描光带交互态增强：速度与亮度短时提升并衰减
    - 新增交互能量衰减机制，避免持续高亮
  - 稳态保护：
    - `prefers-reduced-motion` 下保持停用
    - 页面隐藏时停止动画并清理交互态，恢复时继续
    - 触摸监听为被动模式，不阻断滚动
- 完成内容：验证与收口：
  - `app.js` 语法校验通过（Node `new Function`）
  - 编译检查通过：`env -u RUSTC_WRAPPER cargo check`
  - 项目管理文档收口：`doc/github-pages-hero-pointer-interaction.project.md`
- 遗留事项：当前指针微交互任务已完成；后续可按需要增加点击脉冲波效果。
- 日期：2026-02-12
- 完成内容：启动 GitHub Pages 架构图 SVG 精修任务：
  - 新增设计文档：`doc/github-pages-architecture-svg-refresh.md`
  - 新增项目管理文档：`doc/github-pages-architecture-svg-refresh.project.md`
- 完成内容：明确图稿优化目标（科技感提升、层次清晰、引用路径不变）。
- 遗留事项：继续完成 `site/assets/images/architecture-flow.svg` 重绘与验证。
- 日期：2026-02-12
- 完成内容：完成 GitHub Pages 架构图 SVG 精修：
  - 重绘文件：`site/assets/images/architecture-flow.svg`
  - 主要优化：
    - 主流程层重排（Runtime -> Simulator -> Viewer -> LLM/Modules）
    - 底层能力区重构（Persistence and Evidence Bus / Control and Feedback Loop）
    - 背景网格、连接箭头、光带与节点图标统一科技风样式
    - 文案压缩为“一节点一职责”，提升图面可读性
- 完成内容：验证与收口：
  - SVG 结构校验（`title/desc/aria-labelledby`、`<svg>...</svg>` 包络）
  - 编译检查通过：`env -u RUSTC_WRAPPER cargo check -p agent_world_proto`
  - 项目管理文档收口：`doc/github-pages-architecture-svg-refresh.project.md`
- 遗留事项：当前架构图精修任务已完成；可按传播场景追加小尺寸简化图版本。
- 日期：2026-02-12
- 完成内容：启动 GitHub Pages 内容状态同步任务（代码一致性修正）：
  - 新增设计文档：`doc/github-pages-content-sync-2026-02-12.md`
  - 新增项目管理文档：`doc/github-pages-content-sync-2026-02-12.project.md`
- 完成内容：明确同步范围（中英文路线图状态、关键指标文案、README 站点亮点）。
- 遗留事项：继续完成页面与 README 实际文案更新并收口。
- 日期：2026-02-12
- 完成内容：完成 GitHub Pages 内容状态同步：更新 `site/index.html`、`site/en/index.html`（路线图 M3/M4/M5、3 种运行模式、近期更新）与 `README.md`（站点亮点截至 2026-02-12）。
- 完成内容：完成 CN/EN 文案一致性自检，并执行通过 `env -u RUSTC_WRAPPER cargo check`。
- 遗留事项：本任务已收口，后续随项目阶段推进继续滚动同步页面状态文案。
- 日期：2026-02-12；完成内容：启动 GitHub Pages 视觉细节打磨 V2，新增设计文档 `doc/github-pages-visual-polish-v2-2026-02-12.md` 与项目管理文档 `doc/github-pages-visual-polish-v2-2026-02-12.project.md`，并执行通过 `env -u RUSTC_WRAPPER cargo check`；遗留事项：继续完成页面样式优化与截图回归收口。
- 日期：2026-02-12；完成内容：完成 GitHub Pages 视觉细节打磨 V2，实现 `site/assets/styles.css`（移动端密度优化、Hero 指标层级强化、证据条高亮分层、路线图状态图标与 active 轻量动态并支持 reduced-motion 降级）及 `site/index.html`/`site/en/index.html` 结构标记同步；完成截图回归（`output/playwright/v2-cn-desktop.png`、`output/playwright/v2-cn-mobile.png`、`output/playwright/v2-en-desktop.png`、`output/playwright/v2-en-mobile.png`）并执行通过 `env -u RUSTC_WRAPPER cargo check`；遗留事项：当前任务已收口。
- 日期：2026-02-12
- 完成内容：完成 T4（扩展 `agent_world_proto` 设计/项目文档，纳入共识成员变更协议类型抽离范围）：
  - 设计文档更新：`doc/world-runtime/agent-world-proto.md`
  - 项目管理文档更新：`doc/world-runtime/agent-world-proto.project.md`（新增 T4/T5，状态切换为 T4 完成、T5 进行中）
- 完成内容：执行并通过最小回归：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_proto`
- 遗留事项：继续完成 T5（新增 `distributed_consensus` 协议模块并完成 `agent_world` 侧适配与回归）。
- 日期：2026-02-12
- 完成内容：完成 T5（共识成员变更协议类型迁移到 `agent_world_proto` 并完成 runtime 适配）：
  - 新增协议模块：`crates/agent_world_proto/src/distributed_consensus.rs`
  - crate 导出更新：`crates/agent_world_proto/src/lib.rs`
  - `agent_world` 侧改为复用 proto 类型并保持现有 API：`crates/agent_world/src/runtime/distributed_consensus.rs`
  - 项目管理文档收口：`doc/world-runtime/agent-world-proto.project.md`（T5 标记完成，T1~T5 全部完成）
- 完成内容：执行并通过回归：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world -p agent_world_proto`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_proto`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --lib membership_add_validator_updates_threshold`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --lib publish_and_drain_membership_change_announcement`
- 遗留事项：当前 `agent_world_proto` 第二阶段抽离完成；后续按需继续迁移其他跨节点协议结构。
- 日期：2026-02-12
- 完成内容：新增 `agent_world_net` + `agent_world_consensus` 拆分设计文档与项目管理文档：
  - `doc/world-runtime/distributed-crate-split-net-consensus.md`
  - `doc/world-runtime/distributed-crate-split-net-consensus.project.md`
- 完成内容：执行并通过最小编译检查：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world`
- 遗留事项：继续完成 T2/T3/T4（新 crate 脚手架、导出能力面、回归与收口）。
- 日期：2026-02-12
- 完成内容：完成 T2（新建 `agent_world_net` / `agent_world_consensus` crate 并接入 workspace）：
  - workspace 接线：`Cargo.toml` 新增两个 member
  - 新建 crate：`crates/agent_world_net`、`crates/agent_world_consensus`
- 完成内容：执行并通过定向编译检查：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world_consensus`
- 遗留事项：继续完成 T3（导出能力面落地，含 `distributed_membership_sync` 归入 `agent_world_consensus`）。
- 日期：2026-02-12
- 完成内容：完成 T3（net/consensus 导出能力面落地）：
  - `agent_world_net` 导出网络能力边界：`crates/agent_world_net/src/lib.rs`
  - `agent_world_consensus` 导出共识与 membership sync 能力边界：`crates/agent_world_consensus/src/lib.rs`
  - 两个 crate 接入 `agent_world` 依赖，并为 `agent_world_net` 增加 `libp2p` feature 透传：`crates/agent_world_net/Cargo.toml`、`crates/agent_world_consensus/Cargo.toml`
  - 项目管理文档状态更新：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T3 标记完成，T4 进行中）
- 完成内容：执行并通过定向编译检查：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world_consensus -p agent_world`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net --features libp2p`
- 遗留事项：继续完成 T4（定向测试回归、项目文档收口）。
- 日期：2026-02-12
- 完成内容：完成 T4（编译/测试回归与文档收口）：
  - 项目管理文档收口：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T4 标记完成，T1~T4 全部完成）
- 完成内容：执行并通过定向回归：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_net --lib`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --lib membership_add_validator_updates_threshold -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --lib publish_and_drain_membership_change_announcement -- --nocapture`
- 完成内容：提交钩子回归通过（自动执行）：
  - `env -u RUSTC_WRAPPER cargo test`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features wasmtime`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --test viewer_live_integration --features viewer_live_integration`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --test viewer_offline_integration`
- 遗留事项：当前 `agent_world_net` + `agent_world_consensus` 拆分阶段完成；后续仅在需要时推进实现物理迁移。
- 日期：2026-02-12
- 完成内容：启动 net/consensus 拆分扩展阶段并完成 T5（`distributed_net` 核心实现下沉到 `agent_world_net`）：
  - 设计文档扩展阶段范围更新：`doc/world-runtime/distributed-crate-split-net-consensus.md`
  - 项目管理文档新增 T5/T6 并标记 T5 完成：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`
  - `agent_world_net` 内新增本地网络实现：
    - `DistributedNetwork` trait（基于 `WorldError`）
    - `InMemoryNetwork` 实现（publish/subscribe/request/register handler）
    - 代码文件：`crates/agent_world_net/src/lib.rs`
  - `agent_world_net` 新增 `agent_world_proto` 依赖：`crates/agent_world_net/Cargo.toml`
- 完成内容：执行并通过定向验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_net --lib`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --lib in_memory_publish_delivers_to_subscribers -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --lib in_memory_request_invokes_handler -- --nocapture`
- 遗留事项：继续完成 T6（扩展阶段回归验证与文档收口）。
- 日期：2026-02-12
- 完成内容：完成 T6（扩展阶段回归与文档收口）：
  - 项目管理文档收口：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T1~T6 全部完成）
- 完成内容：执行并通过扩展阶段回归：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world_consensus -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 完成内容：提交钩子回归通过（自动执行）：
  - `env -u RUSTC_WRAPPER cargo test`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features wasmtime`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --test viewer_live_integration --features viewer_live_integration`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --test viewer_offline_integration`
- 遗留事项：当前 `agent_world_net` + `agent_world_consensus` 拆分扩展阶段已完成；后续按需继续迁移其余 net/consensus 实现。
- 日期：2026-02-12
- 完成内容：启动二次扩展阶段文档任务（DHT 迁移）：
  - 设计文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.md`（新增二次扩展阶段范围与里程碑 P7/P8）
  - 项目管理文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（新增 T7/T8，并切换状态为 T7 进行中）
- 遗留事项：继续完成 T7（`distributed_dht` 核心实现下沉到 `agent_world_net`）。
- 日期：2026-02-12
- 完成内容：完成 T7（`distributed_dht` 核心实现下沉到 `agent_world_net`）：
  - `agent_world_net` 新增 DHT 边界实现：
    - `DistributedDht` trait（基于 `WorldError`）
    - `InMemoryDht` 实现（provider/head/membership 读写）
  - DHT 协议类型导出改为 `agent_world_proto` 驱动：
    - `MembershipDirectorySnapshot`
    - `ProviderRecord`
  - 代码文件：`crates/agent_world_net/src/lib.rs`
  - 项目管理文档状态更新：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T7 标记完成，T8 进行中）
- 完成内容：执行并通过定向验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_net --lib`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --lib in_memory_dht_stores_providers -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --lib in_memory_dht_tracks_membership_directory_snapshot -- --nocapture`
- 遗留事项：继续完成 T8（二次扩展阶段回归与文档收口）。
- 日期：2026-02-12
- 完成内容：完成 T8（二次扩展阶段回归与文档收口）：
  - 项目管理文档收口：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T1~T8 全部完成）
- 完成内容：执行并通过扩展回归：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net --features libp2p`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world_consensus -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 遗留事项：当前二次扩展阶段已完成；后续按需继续迁移其余 net/consensus 实现。
- 日期：2026-02-12
- 完成内容：启动三次扩展阶段文档任务（`distributed_client` 迁移）：
  - 设计文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.md`（新增三次扩展阶段范围与里程碑 P9/P10）
  - 项目管理文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（新增 T9/T10，并切换状态为 T9 进行中）
- 完成内容：执行并通过最小验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net`
- 遗留事项：继续完成 T9（将 `distributed_client` 核心实现下沉到 `agent_world_net`）。
- 日期：2026-02-12
- 完成内容：完成 T9（`distributed_client` 核心实现下沉到 `agent_world_net`）：
  - `agent_world_net` 新增本地 `DistributedClient` 实现，覆盖：
    - 请求/响应编解码（含 canonical CBOR helper）
    - DHT provider 路由与失败回退逻辑（`fetch_blob_from_dht`）
    - 错误响应映射（`ErrorResponse` -> `WorldError::NetworkRequestFailed`）
  - `agent_world_net` 导出面切换为本地 `DistributedClient`（不再重导出 `agent_world::runtime::DistributedClient`）
  - 新增/扩展 net crate 单测覆盖 client 路径：
    - world head 获取
    - provider 列表透传
    - module manifest/artifact 通过 DHT provider 获取
    - 错误响应映射
  - 代码文件：
    - `crates/agent_world_net/src/lib.rs`
    - `crates/agent_world_net/Cargo.toml`
  - 项目管理文档状态更新：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T9 标记完成，T10 进行中）
- 完成内容：执行并通过定向验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_net --lib`
- 遗留事项：继续完成 T10（三次扩展阶段回归验证与文档收口）。
- 日期：2026-02-12
- 完成内容：完成 T10（三次扩展阶段回归验证与文档收口）：
  - 项目管理文档收口：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T1~T10 全部完成）
- 完成内容：执行并通过扩展回归：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net --features libp2p`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world_consensus -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 遗留事项：当前三次扩展阶段已完成；后续按需继续迁移其余 net/consensus 实现。
- 日期：2026-02-12
- 完成内容：启动四次扩展阶段文档任务（`distributed_gateway` 迁移）：
  - 设计文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.md`（新增四次扩展阶段范围与里程碑 P11/P12）
  - 项目管理文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（新增 T11/T12，并切换状态为 T11 进行中）
- 完成内容：执行并通过最小验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net`
- 遗留事项：继续完成 T11（将 `distributed_gateway` 核心实现下沉到 `agent_world_net`）。
- 日期：2026-02-12
- 完成内容：完成 T11（`distributed_gateway` 核心实现下沉到 `agent_world_net`）：
  - `agent_world_net` 新增本地网关能力：
    - `SubmitActionReceipt`
    - `ActionGateway` trait
    - `NetworkGateway` 实现（复用 `topic_action` 与 canonical CBOR 编码发布 action）
  - `agent_world_net` 导出面切换为本地 gateway 类型（不再重导出 `agent_world::runtime` 对应类型）
  - 新增 net crate 单测：`gateway_publishes_action`，覆盖 topic 发布与回执时间戳行为
  - 代码文件：
    - `crates/agent_world_net/src/lib.rs`
  - 项目管理文档状态更新：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T11 标记完成，T12 进行中）
- 完成内容：执行并通过定向验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_net --lib`
- 遗留事项：继续完成 T12（四次扩展阶段回归验证与文档收口）。
- 日期：2026-02-12
- 完成内容：完成 T12（四次扩展阶段回归验证与文档收口）：
  - 项目管理文档收口：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T1~T12 全部完成）
- 完成内容：执行并通过扩展回归：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net --features libp2p`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world_consensus -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 遗留事项：当前四次扩展阶段已完成；后续按需继续迁移其余 net/consensus 实现。
- 日期：2026-02-12
- 完成内容：启动五次扩展阶段文档任务（`distributed_index` 迁移）：
  - 设计文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.md`（新增五次扩展阶段范围与里程碑 P13/P14）
  - 项目管理文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（新增 T13/T14，并切换状态为 T13 进行中）
- 完成内容：执行并通过最小验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net`
- 遗留事项：继续完成 T13（将 `distributed_index` 核心实现下沉到 `agent_world_net`）。
- 日期：2026-02-12
- 完成内容：完成 T13（`distributed_index` 核心实现下沉到 `agent_world_net`）：
  - `agent_world_net` 新增本地索引发布能力：
    - `IndexPublishResult`
    - `publish_world_head`
    - `publish_execution_providers`
    - `publish_execution_providers_cached`
    - `query_providers`
  - `agent_world_net` 导出面切换为本地 index helper（不再重导出 `agent_world::runtime` 对应实现）
  - 新增 net crate 单测覆盖：
    - `publish_execution_providers_indexes_all_hashes`
    - `publish_execution_providers_cached_indexes_all_hashes`
  - 代码文件：
    - `crates/agent_world_net/src/lib.rs`
  - 项目管理文档状态更新：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T13 标记完成，T14 进行中）
- 完成内容：执行并通过定向验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_net --lib`
- 遗留事项：继续完成 T14（五次扩展阶段回归验证与文档收口）。
- 日期：2026-02-12
- 完成内容：完成 T14（五次扩展阶段回归验证与文档收口）：
  - 项目管理文档收口：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T1~T14 全部完成）
- 完成内容：执行并通过扩展回归：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net --features libp2p`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world_consensus -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 遗留事项：五次扩展阶段已收口；下一步继续推进 `agent_world_net` 模块化拆分并迁移后续分布式实现。
- 日期：2026-02-12
- 完成内容：启动六次扩展阶段文档任务（`agent_world_net` 模块化拆分）：
  - 设计文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.md`（新增六次扩展阶段范围与里程碑 P15/P16）
  - 项目管理文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（新增 T15/T16，并切换状态为 T15 进行中）
- 完成内容：执行并通过最小验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net`
- 遗留事项：继续完成 T15（`agent_world_net` 多文件模块化拆分与单测迁移）。
- 日期：2026-02-12
- 完成内容：完成 T15（`agent_world_net` 内部模块化拆分）：
  - `agent_world_net` 拆分为多文件结构：
    - `crates/agent_world_net/src/network.rs`
    - `crates/agent_world_net/src/dht.rs`
    - `crates/agent_world_net/src/index.rs`
    - `crates/agent_world_net/src/client.rs`
    - `crates/agent_world_net/src/gateway.rs`
    - `crates/agent_world_net/src/util.rs`
  - `crates/agent_world_net/src/lib.rs` 收敛为导出入口，`agent_world_net` 对外 API 保持不变。
  - `agent_world_net` 单测迁移到 `crates/agent_world_net/src/tests.rs`。
  - 项目管理文档状态更新：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T15 标记完成，T16 进行中）。
- 完成内容：执行并通过定向验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_net --lib`
- 遗留事项：继续完成 T16（六次扩展阶段回归验证与文档收口）。
- 日期：2026-02-12
- 完成内容：完成 T16（六次扩展阶段回归验证与文档收口）：
  - 项目管理文档收口：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T1~T16 全部完成）
- 完成内容：执行并通过扩展回归：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net --features libp2p`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world_consensus -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 遗留事项：六次扩展阶段已收口；后续按需继续迁移 `agent_world_net` / `agent_world_consensus` 剩余实现。
- 日期：2026-02-12
- 完成内容：启动七次扩展阶段文档任务（cache/index store 迁移）：
  - 设计文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.md`（新增七次扩展阶段范围与里程碑 P17/P18）
  - 项目管理文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（新增 T17/T18，并切换状态为 T17 进行中）
- 完成内容：执行并通过最小验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net`
- 遗留事项：继续完成 T17（`distributed_index_store` / `distributed_provider_cache` / `distributed_dht_cache` 下沉到 `agent_world_net`）。
- 日期：2026-02-12
- 完成内容：完成 T17（cache/index store 核心实现下沉到 `agent_world_net`）：
  - `agent_world_net` 新增本地缓存与索引存储模块：
    - `crates/agent_world_net/src/index_store.rs`
    - `crates/agent_world_net/src/provider_cache.rs`
    - `crates/agent_world_net/src/dht_cache.rs`
  - `agent_world_net` 导出面切换为本地实现：
    - `DistributedIndexStore` / `HeadIndexRecord` / `InMemoryIndexStore`
    - `ProviderCache` / `ProviderCacheConfig`
    - `CachedDht` / `DhtCacheConfig`
  - `crates/agent_world_net/src/index.rs` 改为依赖本地 `ProviderCache`，避免再透传 runtime 对应实现。
  - 项目管理文档状态更新：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T17 标记完成，T18 进行中）。
- 完成内容：执行并通过定向验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_net --lib`
- 遗留事项：继续完成 T18（七次扩展阶段回归验证与文档收口）。
- 日期：2026-02-12
- 完成内容：完成 T18（七次扩展阶段回归验证与文档收口）：
  - 项目管理文档收口：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T1~T18 全部完成）
- 完成内容：执行并通过扩展回归：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net --features libp2p`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world_consensus -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 遗留事项：七次扩展阶段已收口；后续按需继续迁移 `agent_world_net` / `agent_world_consensus` 剩余实现。
- 日期：2026-02-12
- 完成内容：启动八次扩展阶段文档任务（observer/head_follow 迁移）：
  - 设计文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.md`（新增八次扩展阶段范围与里程碑 P19/P20）
  - 项目管理文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（新增 T19/T20，并切换状态为 T19 进行中）
- 完成内容：执行并通过最小验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net`
- 遗留事项：继续完成 T19（`distributed_head_follow` / `distributed_observer` 下沉到 `agent_world_net`）。
- 日期：2026-02-12
- 完成内容：完成 T19（observer/head_follow 核心实现下沉到 `agent_world_net`）：
  - `agent_world_net` 新增本地观察链路模块：
    - `crates/agent_world_net/src/head_follow.rs`
    - `crates/agent_world_net/src/observer.rs`
  - `agent_world_net` 导出面切换为本地实现：
    - `HeadFollower` / `HeadUpdateDecision`
    - `ObserverClient` / `ObserverSubscription`
    - `HeadSyncResult` / `HeadSyncReport` / `HeadFollowReport`
  - `head_follow` 内复用 runtime 的 `BlobStore` / `World` / `validate_head_update` / `JournalSegmentRef` / `blake3_hex`，并适配本地 `DistributedClient`/`DistributedDht` 的 bootstrap/replay 路径。
  - 项目管理文档状态更新：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T19 标记完成，T20 进行中）。
- 完成内容：执行并通过定向验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_net --lib`
- 遗留事项：继续完成 T20（八次扩展阶段回归验证与文档收口）。
- 日期：2026-02-12
- 完成内容：完成 T20（八次扩展阶段回归验证与文档收口）：
  - 项目管理文档收口：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T1~T20 全部完成）
- 完成内容：执行并通过扩展回归：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net --features libp2p`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world_consensus -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 遗留事项：八次扩展阶段已收口；后续按需继续迁移 `agent_world_net` / `agent_world_consensus` 剩余实现。
- 日期：2026-02-12
- 完成内容：启动九次扩展阶段文档任务（observer replay 迁移）：
  - 设计文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.md`（新增九次扩展阶段范围与里程碑 P21/P22）
  - 项目管理文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（新增 T21/T22，并切换状态为 T21 进行中）
- 完成内容：执行并通过最小验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net`
- 遗留事项：继续完成 T21（`distributed_observer_replay` 下沉到 `agent_world_net` 并复用到 `head_follow`）。
- 日期：2026-02-12
- 完成内容：完成 T21（`distributed_observer_replay` 核心实现下沉到 `agent_world_net`，并由 `head_follow` 复用）：
  - 新增回放校验模块：`crates/agent_world_net/src/observer_replay.rs`
  - `head_follow` 移除本地重复 replay 实现，改为复用 `observer_replay`：
    - `crates/agent_world_net/src/head_follow.rs`
  - `agent_world_net` 导出新增 replay 能力：
    - `crates/agent_world_net/src/lib.rs`
  - 项目管理文档状态更新：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T21 标记完成，T22 进行中）
- 完成内容：执行并通过定向验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_net --lib`
- 遗留事项：继续完成 T22（九次扩展阶段回归验证与文档收口）。
- 日期：2026-02-12
- 完成内容：完成 T22（九次扩展阶段回归验证与文档收口）：
  - 项目管理文档收口：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T1~T22 全部完成）
- 完成内容：执行并通过扩展回归：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net --features libp2p`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world_consensus -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 遗留事项：九次扩展阶段已收口；后续按需继续规划 `agent_world_net` / `agent_world_consensus` 的进一步物理迁移。
- 日期：2026-02-12
- 完成内容：启动十次扩展阶段文档任务（bootstrap 迁移）：
  - 设计文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.md`（新增十次扩展阶段范围与里程碑 P23/P24）
  - 项目管理文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（新增 T23/T24，并切换状态为 T23 进行中）
- 完成内容：执行并通过最小验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net`
- 遗留事项：继续完成 T23（`distributed_bootstrap` 下沉到 `agent_world_net` 并复用到 `head_follow`）。
- 日期：2026-02-12
- 完成内容：完成 T23（`distributed_bootstrap` 核心实现下沉到 `agent_world_net`，并由 `head_follow` 复用）：
  - 新增 bootstrap 模块：`crates/agent_world_net/src/bootstrap.rs`
  - `head_follow` 移除本地 bootstrap 实现，改为复用 `bootstrap`：
    - `crates/agent_world_net/src/head_follow.rs`
  - `agent_world_net` 导出新增 bootstrap 能力：
    - `crates/agent_world_net/src/lib.rs`
  - 项目管理文档状态更新：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T23 标记完成，T24 进行中）
- 完成内容：执行并通过定向验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_net --lib`
- 遗留事项：继续完成 T24（十次扩展阶段回归验证与文档收口）。
- 日期：2026-02-12
- 完成内容：完成 T24（十次扩展阶段回归验证与文档收口）：
  - 项目管理文档收口：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T1~T24 全部完成）
- 完成内容：执行并通过扩展回归：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net --features libp2p`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world_consensus -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 遗留事项：十次扩展阶段已收口；后续按需继续规划 `agent_world_net` / `agent_world_consensus` 的进一步物理迁移。
- 日期：2026-02-12
- 完成内容：启动十一次扩展阶段文档任务（consensus 主流程迁移）：
  - 设计文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.md`（新增十一次扩展阶段范围与里程碑 P25/P26）
  - 项目管理文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（新增 T25/T26，并切换状态为 T25 进行中）
- 完成内容：执行并通过最小验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_consensus`
- 遗留事项：继续完成 T25（`distributed_consensus` 下沉到 `agent_world_consensus`）。
- 日期：2026-02-12
- 完成内容：完成 T25（`distributed_consensus` 核心实现下沉到 `agent_world_consensus`）：
  - 新增共识核心模块：`crates/agent_world_consensus/src/quorum.rs`
    - 迁移 `QuorumConsensus`、提案/投票 helper、membership 变更与快照读写能力
    - 保持 `CONSENSUS_SNAPSHOT_VERSION`、`Consensus*` 类型与行为语义一致
  - `agent_world_consensus` 导出面切换到本地 consensus 实现，同时保持 membership sync 导出不变：
    - `crates/agent_world_consensus/src/lib.rs`
  - `agent_world_consensus` 新增依赖：`agent_world_proto` / `serde` / `serde_json`
    - `crates/agent_world_consensus/Cargo.toml`
  - 项目管理文档状态更新：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T25 标记完成，T26 进行中）
- 完成内容：执行并通过定向验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_consensus -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 遗留事项：继续完成 T26（十一次扩展阶段回归验证与文档收口）。
- 日期：2026-02-12
- 完成内容：完成 T26（十一次扩展阶段回归验证与文档收口）：
  - 项目管理文档收口：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T1~T26 全部完成）
- 完成内容：执行并通过扩展回归：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net --features libp2p`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world_consensus -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 遗留事项：十一次扩展阶段已收口；后续按需继续规划 `agent_world_net` / `agent_world_consensus` 的进一步物理迁移。
- 日期：2026-02-12
- 完成内容：启动十二次扩展阶段文档任务（lease/mempool 迁移）：
  - 设计文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.md`（新增十二次扩展阶段范围与里程碑 P27/P28）
  - 项目管理文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（新增 T27/T28，并切换状态为 T27 进行中）
- 完成内容：执行并通过最小验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_consensus`
- 遗留事项：继续完成 T27（`distributed_lease` / `distributed_mempool` 下沉到 `agent_world_consensus`）。
- 日期：2026-02-12
- 完成内容：完成 T27（`distributed_lease` / `distributed_mempool` 核心实现下沉到 `agent_world_consensus`）：
  - `agent_world_consensus` 新增本地 lease/mempool 模块并接管导出：
    - `crates/agent_world_consensus/src/lease.rs`
    - `crates/agent_world_consensus/src/mempool.rs`
    - `crates/agent_world_consensus/src/lib.rs`
  - `mempool` 模块补齐 canonical CBOR helper，避免依赖 `agent_world::runtime::util` 私有实现。
  - `agent_world_consensus` 新增依赖 `serde_cbor`：
    - `crates/agent_world_consensus/Cargo.toml`
    - `Cargo.lock`
  - 项目管理文档状态更新：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T27 标记完成，T28 进行中）
- 完成内容：执行并通过定向验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_consensus -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 遗留事项：继续完成 T28（十二次扩展阶段回归验证与文档收口）。
- 日期：2026-02-12
- 完成内容：完成 T28（十二次扩展阶段回归验证与文档收口）：
  - 项目管理文档收口：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T1~T28 全部完成）
- 完成内容：执行并通过扩展回归：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net --features libp2p`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world_consensus -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 遗留事项：十二次扩展阶段已收口；后续按需继续规划 `agent_world_consensus` 内 `distributed_membership_sync` 的分阶段物理迁移。
- 日期：2026-02-12
- 完成内容：启动十三次扩展阶段文档任务（membership sync 核心切片迁移）：
  - 设计文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.md`（新增十三次扩展阶段范围与里程碑 P29/P30）
  - 项目管理文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（新增 T29/T30，并切换状态为 T29 进行中）
- 完成内容：执行并通过最小验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_consensus`
- 遗留事项：继续完成 T29（将 membership sync 签名/审计/同步核心下沉到 `agent_world_consensus`）。
- 日期：2026-02-12
- 完成内容：完成 T29（`distributed_membership_sync` 签名/审计/同步核心下沉到 `agent_world_consensus`）：
  - 新增 membership 模块与逻辑 helper：
    - `crates/agent_world_consensus/src/membership.rs`
    - `crates/agent_world_consensus/src/membership_logic.rs`
  - `MembershipSyncClient`、签名 keyring、restore/revocation policy、audit store 改为 `agent_world_consensus` 本地实现；
  - `agent_world_consensus` 导出面切换为本地 membership 核心导出，`recovery/reconciliation` 相关类型继续桥接 runtime 导出：
    - `crates/agent_world_consensus/src/lib.rs`
  - `agent_world_consensus` 新增依赖：
    - `crates/agent_world_consensus/Cargo.toml`
    - `Cargo.lock`
  - 项目管理文档状态更新：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T29 标记完成，T30 进行中）
- 完成内容：执行并通过定向验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_consensus -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 遗留事项：继续完成 T30（十三次扩展阶段回归验证与文档收口）。
- 日期：2026-02-12
- 完成内容：完成 T30（十三次扩展阶段回归验证与文档收口）：
  - 项目管理文档收口：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T1~T30 全部完成）
- 完成内容：执行并通过扩展回归：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net --features libp2p`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world_consensus -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 遗留事项：十三次扩展阶段已收口；后续按需继续规划 `distributed_membership_sync` 的 `recovery/reconciliation` 子系统迁移。
- 日期：2026-02-12
- 完成内容：启动十四次扩展阶段文档任务（membership reconcile 迁移）：
  - 设计文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.md`（新增十四次扩展阶段范围与里程碑 P31/P32）
  - 项目管理文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（新增 T31/T32，并切换状态为 T31 进行中）
- 完成内容：执行并通过最小验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_consensus`
- 遗留事项：继续完成 T31（将 `distributed_membership_sync/reconciliation.rs` 核心实现下沉到 `agent_world_consensus`）。
- 日期：2026-02-12
- 完成内容：完成 T31（`distributed_membership_sync/reconciliation.rs` 核心实现下沉到 `agent_world_consensus`）：
  - 新增 reconciliation 模块与测试：
    - `crates/agent_world_consensus/src/membership_reconciliation.rs`
    - `crates/agent_world_consensus/src/membership_reconciliation_tests.rs`
  - `agent_world_consensus` 导出面切换为本地 reconciliation 导出，并补充测试模块挂载：
    - `crates/agent_world_consensus/src/lib.rs`
  - `MembershipSyncClient` 网络句柄改为 crate 内可见，用于 reconciliation 扩展实现发布流程：
    - `crates/agent_world_consensus/src/membership.rs`
  - 项目管理文档状态更新：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T31 标记完成，T32 进行中）
- 完成内容：执行并通过定向验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_consensus -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 遗留事项：继续完成 T32（十四次扩展阶段回归验证与文档收口）。
- 日期：2026-02-12
- 完成内容：完成 T32（十四次扩展阶段回归验证与文档收口）：
  - 项目管理文档收口：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T31~T32 全部完成，十四次扩展阶段已收口）
  - 执行并通过扩展回归：
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_net --features libp2p`
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world_consensus -p agent_world`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 遗留事项：后续如需继续拆分 `distributed_membership_sync`，优先迁移 `recovery` 子系统（保持导出 API 兼容，按切片逐步下沉）。
- 日期：2026-02-12
- 完成内容：启动十五次扩展阶段文档任务（membership recovery 迁移）：
  - 设计文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.md`（新增十五次扩展阶段范围与里程碑 P33/P34）
  - 项目管理文档扩展：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（新增 T33/T34，并切换状态为 T33 进行中）
- 日期：2026-02-12
- 完成内容：完成 T33（`distributed_membership_sync/recovery.rs` 告警恢复核心实现下沉到 `agent_world_consensus`）：
  - 新增 recovery 模块（多文件拆分满足行数约束）与测试：
    - `crates/agent_world_consensus/src/membership_recovery/mod.rs`
    - `crates/agent_world_consensus/src/membership_recovery/types.rs`
    - `crates/agent_world_consensus/src/membership_recovery/stores.rs`
    - `crates/agent_world_consensus/src/membership_recovery/dead_letter.rs`
    - `crates/agent_world_consensus/src/membership_recovery_tests.rs`
  - `agent_world_consensus` 导出面切换为本地 recovery 导出（其余 replay/governance 相关仍桥接 runtime 导出）：
    - `crates/agent_world_consensus/src/lib.rs`
  - 项目管理文档状态更新：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T33 标记完成，T34 进行中）
- 完成内容：执行并通过定向验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_consensus -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 遗留事项：继续完成 T34（十五次扩展阶段回归验证与文档收口）。
- 日期：2026-02-12
- 完成内容：完成 T34（十五次扩展阶段回归验证与文档收口）：
  - 项目管理文档收口：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T33~T34 全部完成，十五次扩展阶段已收口）
  - 执行并通过扩展回归：
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_net --features libp2p`
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world_consensus -p agent_world`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 遗留事项：后续如需继续迁移 `distributed_membership_sync`，可继续下沉 `recovery/replay*.rs`（replay policy/governance/归档），保持导出 API 兼容并按切片逐步推进。
- 日期：2026-02-12
- 完成内容：完成 T35（`distributed_membership_sync/recovery/replay.rs` dead-letter replay policy 核心实现下沉到 `agent_world_consensus`）：
  - 新增 replay 模块：
    - `crates/agent_world_consensus/src/membership_recovery/replay.rs`
  - `agent_world_consensus` 的 `membership_recovery` 导出新增 replay policy/state store 能力，并从 runtime re-export 切换到本地导出：
    - `crates/agent_world_consensus/src/membership_recovery/mod.rs`
    - `crates/agent_world_consensus/src/lib.rs`
  - 新增 dead-letter replay 单测与持久化单测：
    - `crates/agent_world_consensus/src/membership_dead_letter_replay_tests.rs`
    - `crates/agent_world_consensus/src/membership_dead_letter_replay_persistence_tests.rs`
  - 文档更新：
    - `doc/world-runtime/distributed-crate-split-net-consensus.md`（新增十六次扩展阶段范围与里程碑 P35/P36）
    - `doc/world-runtime/distributed-crate-split-net-consensus.project.md`（新增 T35/T36，并标记 T35 完成）
- 完成内容：执行并通过定向验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_consensus -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 遗留事项：继续完成 T36（十六次扩展阶段回归验证与文档收口）。
- 日期：2026-02-12
- 完成内容：完成 T36（十六次扩展阶段回归验证与文档收口）：
  - 项目管理文档收口：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T35~T36 全部完成，十六次扩展阶段已收口）
  - 执行并通过扩展回归：
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_net --features libp2p`
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world_consensus -p agent_world`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 遗留事项：后续如需继续迁移 `distributed_membership_sync`，可继续下沉 `recovery/replay_audit.rs` / `recovery/replay_archive*.rs`（governance/归档/联邦 event bus），保持导出 API 兼容并按切片逐步推进。
- 日期：2026-02-12
- 完成内容：完成 KWT-1（Rust->Wasm 构建套件主功能）：
  - 新增独立工具 crate：
    - `tools/wasm_build_suite/Cargo.toml`
    - `tools/wasm_build_suite/src/lib.rs`
    - `tools/wasm_build_suite/src/main.rs`
  - 新增脚本封装：
    - `scripts/build-wasm-module.sh`
  - 能力：
    - 支持 `build --module-id --manifest-path [--out-dir] [--profile] [--target] [--dry-run]`
    - 基于 `cargo metadata` 解析目标信息并定位 wasm 产物路径
    - 执行 Rust crate 到 `wasm32-unknown-unknown` 构建并输出标准化 metadata
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo test --manifest-path tools/wasm_build_suite/Cargo.toml`
  - `scripts/build-wasm-module.sh --module-id m.test --manifest-path crates/agent_world/Cargo.toml --dry-run`
- 完成内容：回写 KWT 项目管理文档与总项目文档状态，标记 KWT-1 完成：
  - `doc/world-simulator/rust-wasm-build-suite.project.md`
  - `doc/world-simulator.project.md`
- 遗留事项：继续推进 KWT-2（构建套件测试与最小模板闭环）。
- 日期：2026-02-12
- 完成内容：完成 KWT-2（构建套件测试与最小模板闭环）：
  - 新增构建套件单元测试与私有逻辑覆盖：
    - `tools/wasm_build_suite/src/lib.rs`
    - 覆盖 `validate_request` 参数校验、artifact 路径解析、target 名称归一化、`cdylib` 优先选择
  - 新增最小 Rust wasm 模板：
    - `tools/wasm_build_suite/templates/minimal_module/Cargo.toml`
    - `tools/wasm_build_suite/templates/minimal_module/src/lib.rs`
  - 新增集成测试闭环：
    - `tools/wasm_build_suite/tests/minimal_template.rs`
    - 覆盖 dry-run 路径解析与真实构建后 `.wasm + metadata` 校验
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo fmt --manifest-path tools/wasm_build_suite/Cargo.toml`
  - `env -u RUSTC_WRAPPER cargo test --manifest-path tools/wasm_build_suite/Cargo.toml`
  - `rustup target add wasm32-unknown-unknown`
  - `scripts/build-wasm-module.sh --module-id kwt.template.script --manifest-path tools/wasm_build_suite/templates/minimal_module/Cargo.toml --out-dir .tmp/wasm-build-suite-smoke --profile dev`
- 完成内容：回写 KWT 项目管理文档与总项目文档状态，标记 KWT-2 完成：
  - `doc/world-simulator/rust-wasm-build-suite.project.md`
  - `doc/world-simulator.project.md`
- 遗留事项：继续推进 KWT-3（回归验证与文档收口）。
- 日期：2026-02-12
- 完成内容：完成 KWT-3（回归验证、文档与 devlog 收口）：
  - 执行构建套件回归：
    - `env -u RUSTC_WRAPPER cargo test --manifest-path tools/wasm_build_suite/Cargo.toml`
    - `scripts/build-wasm-module.sh --module-id kwt.regress.dry --manifest-path tools/wasm_build_suite/templates/minimal_module/Cargo.toml --out-dir .tmp/wasm-build-suite-regression --profile dev --dry-run`
    - `scripts/build-wasm-module.sh --module-id kwt.regress.real --manifest-path tools/wasm_build_suite/templates/minimal_module/Cargo.toml --out-dir .tmp/wasm-build-suite-regression --profile dev`
  - 项目文档收口：
    - `doc/world-simulator/rust-wasm-build-suite.project.md`（KWT-0~KWT-3 全部完成）
    - `doc/world-simulator.project.md`（KWT-3 标记完成并更新最近状态）
- 遗留事项：KWT 阶段已收口；后续按 wasm 模块治理与发布需求继续扩展构建套件能力。
- 日期：2026-02-12
- 完成内容：启动 BMS（Builtin 模块独立 Crate 化）文档任务：
  - 新增设计文档：`doc/world-runtime/builtin-wasm-crate-split.md`
  - 新增项目管理文档：`doc/world-runtime/builtin-wasm-crate-split.project.md`
  - 总项目文档挂载 BMS 任务分组：`doc/world-runtime.project.md`
- 遗留事项：继续推进 BMS-1（新建独立 crate 并迁移首个 builtin wasm 模块 `m1.rule.move`）。
- 日期：2026-02-12
- 完成内容：完成 BMS-1（独立 crate + `m1.rule.move` wasm 样板）：
  - 新增 workspace crate：
    - `crates/agent_world_builtin_wasm/Cargo.toml`
    - `crates/agent_world_builtin_wasm/src/lib.rs`
  - crate 能力：
    - 导出 wasm ABI：`alloc` / `reduce` / `call`
    - 内置 `m1.rule.move` 样板输出 `rule.decision`（allow）事件
    - 补充单元测试覆盖输入 action_id 解码与兜底路径
  - workspace 成员更新：`Cargo.toml`
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo fmt --manifest-path crates/agent_world_builtin_wasm/Cargo.toml`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_builtin_wasm`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_builtin_wasm --target wasm32-unknown-unknown`
- 完成内容：回写 BMS 项目管理文档与总项目文档状态，标记 BMS-1 完成：
  - `doc/world-runtime/builtin-wasm-crate-split.project.md`
  - `doc/world-runtime.project.md`
- 遗留事项：继续推进 BMS-2（接入构建脚本并补充验证）。
- 日期：2026-02-12
- 完成内容：完成 BMS-2（builtin wasm 构建脚本接线）：
  - 新增脚本：`scripts/build-builtin-wasm-modules.sh`
  - 能力：按模块 id 映射独立 crate，调用 `scripts/build-wasm-module.sh` 生成 wasm 与 metadata
  - 当前接入模块：`m1.rule.move`
- 完成内容：执行并通过验证：
  - `bash -n scripts/build-builtin-wasm-modules.sh`
  - `./scripts/build-builtin-wasm-modules.sh --list`
  - `./scripts/build-builtin-wasm-modules.sh --module-id m1.rule.move --out-dir .tmp/builtin-wasm-smoke --profile dev --dry-run`
  - `./scripts/build-builtin-wasm-modules.sh --module-id m1.rule.move --out-dir .tmp/builtin-wasm-smoke --profile dev`
  - `env -u RUSTC_WRAPPER cargo test --manifest-path tools/wasm_build_suite/Cargo.toml`
- 完成内容：回写 BMS 项目管理文档与总项目文档状态，标记 BMS-2 完成：
  - `doc/world-runtime/builtin-wasm-crate-split.project.md`
  - `doc/world-runtime.project.md`
- 遗留事项：继续推进 BMS-3（回归验证、文档与 devlog 收口）。
- 日期：2026-02-12
- 完成内容：完成 BMS-3（回归验证、文档与 devlog 收口）：
  - 回归验证通过：
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_builtin_wasm`
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_builtin_wasm --target wasm32-unknown-unknown`
    - `env -u RUSTC_WRAPPER cargo test --manifest-path tools/wasm_build_suite/Cargo.toml`
    - `./scripts/build-builtin-wasm-modules.sh --module-id m1.rule.move --out-dir .tmp/builtin-wasm-regression --profile dev --dry-run`
    - `./scripts/build-builtin-wasm-modules.sh --module-id m1.rule.move --out-dir .tmp/builtin-wasm-regression --profile dev`
  - 项目文档收口：
    - `doc/world-runtime/builtin-wasm-crate-split.project.md`（BMS-0~BMS-3 全部完成）
    - `doc/world-runtime.project.md`（BMS-3 标记完成并更新最近状态）
- 遗留事项：按模块优先级继续迁移 `m1.rule.visibility`/`m1.rule.transfer`/`m1.body.core` 等剩余 builtin 到独立 wasm crate 流水线。
- 日期：2026-02-12
- 完成内容：启动 BMS 第二阶段（visibility/transfer 迁移）文档任务：
  - 更新设计文档范围与里程碑：`doc/world-runtime/builtin-wasm-crate-split.md`
  - 扩展项目管理文档任务（BMS-4~BMS-7）：`doc/world-runtime/builtin-wasm-crate-split.project.md`
  - 总项目文档同步新增 BMS-4~BMS-7：`doc/world-runtime.project.md`
- 遗留事项：继续完成 BMS-5（迁移 `m1.rule.visibility` 到独立 wasm crate）。
- 日期：2026-02-12
- 完成内容：完成 BMS-5（迁移 `m1.rule.visibility` 到独立 wasm crate）：
  - `agent_world_builtin_wasm` 改为按 `module_id` 分派执行：
    - 保持 `m1.rule.move` 样板行为（allow 决策）。
    - 新增 `m1.rule.visibility` wasm 行为：支持 `QueryObservation` 生成 `rule.decision`（modify + `EmitObservation` override），并在事件路径维护位置状态（`AgentRegistered` / `AgentMoved`）。
  - 补充单元测试覆盖：
    - `visibility_rule_emits_observation_override`
    - `visibility_rule_denies_when_agent_missing`
    - `visibility_rule_updates_position_state_on_event`
    - 保留并更新 move/invalid 输入兜底测试。
  - 代码文件：
    - `crates/agent_world_builtin_wasm/src/lib.rs`
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo fmt --all`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_builtin_wasm`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_builtin_wasm --target wasm32-unknown-unknown`
- 完成内容：回写项目管理文档状态，标记 BMS-5 完成：
  - `doc/world-runtime/builtin-wasm-crate-split.project.md`
  - `doc/world-runtime.project.md`
- 遗留事项：继续推进 BMS-6（迁移 `m1.rule.transfer` 并扩展构建脚本）。
- 日期：2026-02-12
- 完成内容：完成 BMS-6（迁移 `m1.rule.transfer` 到独立 wasm crate，扩展构建脚本）：
  - `agent_world_builtin_wasm` 新增 `m1.rule.transfer` 规则行为：
    - 支持 `TransferResource` 决策路径（modify + `EmitResourceTransfer` override）。
    - 覆盖 deny 路径（数量非正、非同位、缺失位置状态）。
    - 复用事件路径维护位置状态（`AgentRegistered` / `AgentMoved`）。
  - 构建脚本扩展：
    - `scripts/build-builtin-wasm-modules.sh` 映射与默认列表新增 `m1.rule.visibility`、`m1.rule.transfer`。
  - 补充/通过单元测试（含 transfer 场景）：
    - `transfer_rule_emits_resource_transfer_override_when_colocated`
    - `transfer_rule_denies_when_amount_not_positive`
    - `transfer_rule_denies_when_agents_not_colocated`
    - `transfer_rule_updates_position_state_on_event`
  - 代码文件：
    - `crates/agent_world_builtin_wasm/src/lib.rs`
    - `scripts/build-builtin-wasm-modules.sh`
- 完成内容：执行并通过验证：
  - `bash -n scripts/build-builtin-wasm-modules.sh`
  - `./scripts/build-builtin-wasm-modules.sh --list`
  - `env -u RUSTC_WRAPPER cargo fmt --all`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_builtin_wasm`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_builtin_wasm --target wasm32-unknown-unknown`
  - `./scripts/build-builtin-wasm-modules.sh --module-id m1.rule.visibility --module-id m1.rule.transfer --out-dir .tmp/builtin-wasm-bms6 --profile dev --dry-run`
  - `./scripts/build-builtin-wasm-modules.sh --module-id m1.rule.visibility --module-id m1.rule.transfer --out-dir .tmp/builtin-wasm-bms6 --profile dev`
- 完成内容：回写项目管理文档状态，标记 BMS-6 完成：
  - `doc/world-runtime/builtin-wasm-crate-split.project.md`
  - `doc/world-runtime.project.md`
- 遗留事项：继续推进 BMS-7（回归验证与文档收口）。
- 日期：2026-02-12
- 完成内容：完成 BMS-7（回归验证、文档与 devlog 收口）：
  - 执行并通过回归验证：
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_builtin_wasm`
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_builtin_wasm --target wasm32-unknown-unknown`
    - `env -u RUSTC_WRAPPER cargo test --manifest-path tools/wasm_build_suite/Cargo.toml`
    - `./scripts/build-builtin-wasm-modules.sh --module-id m1.rule.move --module-id m1.rule.visibility --module-id m1.rule.transfer --out-dir .tmp/builtin-wasm-regression --profile dev --dry-run`
    - `./scripts/build-builtin-wasm-modules.sh --module-id m1.rule.move --module-id m1.rule.visibility --module-id m1.rule.transfer --out-dir .tmp/builtin-wasm-regression --profile dev`
  - 三个 builtin 规则模块构建产物验证通过：
    - `m1.rule.move`
    - `m1.rule.visibility`
    - `m1.rule.transfer`
- 完成内容：项目管理文档收口：
  - `doc/world-runtime/builtin-wasm-crate-split.project.md`（BMS-0~BMS-7 全部完成）
  - `doc/world-runtime.project.md`（BMS-7 标记完成并更新最近状态）
- 遗留事项：后续按模块优先级继续迁移剩余 builtin（例如 `m1.body.core`）到独立 wasm crate。
- 日期：2026-02-12
- 完成内容：启动 BMS 第三阶段（`m1.body.core` 迁移）文档任务：
  - 更新设计文档范围与里程碑：`doc/world-runtime/builtin-wasm-crate-split.md`
  - 扩展项目管理文档任务（BMS-8~BMS-11）：`doc/world-runtime/builtin-wasm-crate-split.project.md`
  - 总项目文档同步新增 BMS-8~BMS-11：`doc/world-runtime.project.md`
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_builtin_wasm`
- 遗留事项：继续完成 BMS-9（迁移 `m1.body.core` 到独立 wasm crate）。
- 日期：2026-02-12
- 完成内容：完成 BMS-9（迁移 `m1.body.core` 到独立 wasm crate）：
  - `agent_world_builtin_wasm` 新增 `m1.body.core` 规则行为：
    - 支持 `BodyAction` 决策路径：`modify + EmitBodyAttributes` override。
    - 追加体态动作电力成本（`electricity=-10`）。
    - 对 `payload` 解码失败输出 deny 决策（`body action payload decode failed`）。
  - 补充并通过单元测试：
    - `body_module_emits_emit_body_attributes_override_and_cost`
    - `body_module_denies_when_payload_decode_failed`
  - 代码文件：
    - `crates/agent_world_builtin_wasm/src/lib.rs`
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo fmt --all`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_builtin_wasm`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_builtin_wasm --target wasm32-unknown-unknown`
- 完成内容：回写项目管理文档状态，标记 BMS-9 完成：
  - `doc/world-runtime/builtin-wasm-crate-split.project.md`
  - `doc/world-runtime.project.md`
- 遗留事项：继续推进 BMS-10（扩展构建脚本支持 `m1.body.core`）。
- 日期：2026-02-12
- 完成内容：完成 BMS-10（扩展构建脚本支持 `m1.body.core`）：
  - `scripts/build-builtin-wasm-modules.sh` 增加 `m1.body.core` 映射与默认构建列表。
  - 代码文件：
    - `scripts/build-builtin-wasm-modules.sh`
- 完成内容：执行并通过验证：
  - `bash -n scripts/build-builtin-wasm-modules.sh`
  - `./scripts/build-builtin-wasm-modules.sh --list`
  - `./scripts/build-builtin-wasm-modules.sh --module-id m1.body.core --out-dir .tmp/builtin-wasm-bms10 --profile dev --dry-run`
  - `./scripts/build-builtin-wasm-modules.sh --module-id m1.body.core --out-dir .tmp/builtin-wasm-bms10 --profile dev`
- 完成内容：回写项目管理文档状态，标记 BMS-10 完成：
  - `doc/world-runtime/builtin-wasm-crate-split.project.md`
  - `doc/world-runtime.project.md`
- 遗留事项：继续推进 BMS-11（回归验证与文档收口）。
- 日期：2026-02-12
- 完成内容：完成 BMS-11（回归验证、文档与 devlog 收口）：
  - 执行并通过回归验证：
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_builtin_wasm`
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_builtin_wasm --target wasm32-unknown-unknown`
    - `env -u RUSTC_WRAPPER cargo test --manifest-path tools/wasm_build_suite/Cargo.toml`
    - `./scripts/build-builtin-wasm-modules.sh --module-id m1.rule.move --module-id m1.rule.visibility --module-id m1.rule.transfer --module-id m1.body.core --out-dir .tmp/builtin-wasm-regression --profile dev --dry-run`
    - `./scripts/build-builtin-wasm-modules.sh --module-id m1.rule.move --module-id m1.rule.visibility --module-id m1.rule.transfer --module-id m1.body.core --out-dir .tmp/builtin-wasm-regression --profile dev`
  - 四个 builtin 模块构建产物验证通过：
    - `m1.rule.move`
    - `m1.rule.visibility`
    - `m1.rule.transfer`
    - `m1.body.core`
- 完成内容：项目管理文档收口：
  - `doc/world-runtime/builtin-wasm-crate-split.project.md`（BMS-0~BMS-11 全部完成）
  - `doc/world-runtime.project.md`（BMS-11 标记完成并更新最近状态）
- 遗留事项：按优先级继续迁移剩余 builtin（例如 `m1.sensor.basic`、`m1.mobility.basic`）到独立 wasm crate。

- 日期：2026-02-12
- 完成内容：完成 T37（`distributed_membership_sync/recovery/replay_audit.rs` 核心实现下沉到 `agent_world_consensus`）：
  - 新增 replay audit 模块：
    - `crates/agent_world_consensus/src/membership_recovery/replay_audit.rs`
  - `agent_world_consensus` 的 `membership_recovery` 导出新增 audit/alert/governance store 与 helper，并从 runtime re-export 切换到本地导出：
    - `crates/agent_world_consensus/src/membership_recovery/mod.rs`
    - `crates/agent_world_consensus/src/lib.rs`
  - 新增 dead-letter replay audit 单测：
    - `crates/agent_world_consensus/src/membership_dead_letter_replay_audit_tests.rs`
  - 文档更新：
    - `doc/world-runtime/distributed-crate-split-net-consensus.md`（新增十七次扩展阶段范围与里程碑 P37/P38）
    - `doc/world-runtime/distributed-crate-split-net-consensus.project.md`（新增 T37/T38，并标记 T37 完成）
- 完成内容：执行并通过定向验证：
  - `env -u RUSTC_WRAPPER cargo fmt --all`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_consensus -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 遗留事项：继续完成 T38（十七次扩展阶段回归验证与文档收口）。

- 日期：2026-02-12
- 完成内容：完成 T38（十七次扩展阶段回归验证与文档收口）：
  - 项目管理文档收口：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T37~T38 全部完成，十七次扩展阶段已收口）
  - 执行并通过扩展回归：
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_net --features libp2p`
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world_consensus -p agent_world`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 遗留事项：后续如需继续迁移 `distributed_membership_sync`，可继续下沉 `recovery/replay_archive*.rs`（归档/联邦 event bus），保持导出 API 兼容并按切片逐步推进。

- 日期：2026-02-12
- 完成内容：完成 T39（`distributed_membership_sync/recovery/replay_archive*.rs` 核心实现下沉到 `agent_world_consensus`）：
  - 新增 replay archive 模块：
    - `crates/agent_world_consensus/src/membership_recovery/replay_archive.rs`
    - `crates/agent_world_consensus/src/membership_recovery/replay_archive_tiered.rs`
    - `crates/agent_world_consensus/src/membership_recovery/replay_archive_federated.rs`
  - `agent_world_consensus` 的 `membership_recovery` 导出新增归档/联邦 event bus 能力，并从 runtime re-export 切换到本地导出：
    - `crates/agent_world_consensus/src/membership_recovery/mod.rs`
    - `crates/agent_world_consensus/src/lib.rs`
  - 新增 dead-letter replay archive 单测：
    - `crates/agent_world_consensus/src/membership_dead_letter_replay_archive_tests.rs`
  - 文档更新：
    - `doc/world-runtime/distributed-crate-split-net-consensus.md`（新增十八次扩展阶段范围与里程碑 P39/P40）
    - `doc/world-runtime/distributed-crate-split-net-consensus.project.md`（新增 T39/T40，并标记 T39 完成）
- 完成内容：执行并通过定向验证：
  - `env -u RUSTC_WRAPPER cargo fmt --all`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_consensus -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 遗留事项：继续完成 T40（十八次扩展阶段回归验证与文档收口）。

- 日期：2026-02-12
- 完成内容：完成 T40（十八次扩展阶段回归验证与文档收口）：
  - 项目管理文档收口：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T39~T40 全部完成，十八次扩展阶段已收口）
  - 执行并通过扩展回归：
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_net --features libp2p`
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world_consensus -p agent_world`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
- 遗留事项：后续如需继续推进 `distributed_membership_sync` 的 crate 收敛，可进一步把 runtime 实现文件物理迁移到 `agent_world_consensus`，并逐步移除 runtime bridge 导出。

- 日期：2026-02-12
- 完成内容：完成 T41（`distributed_storage.rs` 核心实现下沉到 `agent_world_net`）：
  - 新增执行结果写入模块：
    - `crates/agent_world_net/src/execution_storage.rs`
  - `agent_world_net` 导出新增 `store_execution_result` 与 `ExecutionWriteConfig/ExecutionWriteResult`（保持类型与语义兼容）：
    - `crates/agent_world_net/src/lib.rs`
  - `agent_world_net` 内部测试切换为使用 crate 导出（避免直接依赖 runtime 导出）：
    - `crates/agent_world_net/src/bootstrap.rs`
    - `crates/agent_world_net/src/observer_replay.rs`
    - `crates/agent_world_net/src/tests.rs`
  - 文档更新：
    - `doc/world-runtime/distributed-crate-split-net-consensus.md`（新增十九次扩展阶段范围与里程碑 P41~P43）
    - `doc/world-runtime/distributed-crate-split-net-consensus.project.md`（新增 T41~T43，并标记 T41 完成）
- 完成内容：执行并通过定向验证：
  - `env -u RUSTC_WRAPPER cargo fmt --all`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_net --lib`
- 遗留事项：继续完成 T42（`distributed_validation.rs` 下沉到 `agent_world_net`）。

- 日期：2026-02-12
- 完成内容：完成 T42（`distributed_validation.rs` 核心实现下沉到 `agent_world_net`）：
  - 新增 head 校验模块：
    - `crates/agent_world_net/src/head_validation.rs`
  - `agent_world_net` 导出新增 `validate_head_update/assemble_snapshot/assemble_journal` 与 `HeadValidationResult`（保持类型与语义兼容）：
    - `crates/agent_world_net/src/lib.rs`
  - `observer_replay` 切换为使用 `agent_world_net` 内部校验实现（避免直接依赖 runtime 校验导出）：
    - `crates/agent_world_net/src/observer_replay.rs`
  - 项目管理文档状态更新：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T42 标记完成，T43 待收口）
- 完成内容：执行并通过定向验证：
  - `env -u RUSTC_WRAPPER cargo fmt --all`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_net --lib`
- 遗留事项：继续完成 T43（十九次扩展阶段回归验证与文档收口）。

- 日期：2026-02-12
- 完成内容：完成 T43（十九次扩展阶段回归验证与文档收口）：
  - 项目管理文档收口：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T41~T43 全部完成，十九次扩展阶段已收口）
  - 执行并通过扩展回归：
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_net --features libp2p`
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world_consensus -p agent_world`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_net --lib`
- 遗留事项：后续如需继续拆分，可考虑把 `libp2p` 实现从 `agent_world` runtime 下沉到 `agent_world_net`，并补齐 CI 对 `--features libp2p` 的覆盖。

- 日期：2026-02-12
- 完成内容：完成 T44（将 `libp2p_net.rs` 核心实现下沉到 `agent_world_net`，feature=`libp2p`）：
  - 新增 `agent_world_net` 侧 `Libp2pNetwork` / `Libp2pNetworkConfig` 实现与最小单测：
    - `crates/agent_world_net/src/libp2p_net.rs`
  - `agent_world_net` 导出面切换为从本 crate 导出 `Libp2pNetwork*`（不再重导出 runtime 对应实现）：
    - `crates/agent_world_net/src/lib.rs`
  - `agent_world_net` 的 `libp2p` feature 改为由 crate 自身可选依赖驱动：
    - `crates/agent_world_net/Cargo.toml`
- 完成内容：执行并通过定向验证：
  - `env -u RUSTC_WRAPPER cargo fmt --all`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net --features libp2p`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_net --features libp2p --lib`
- 遗留事项：继续完成 T45（二十次扩展阶段回归验证与文档收口），并补齐 CI 对 `agent_world_net --features libp2p` 的覆盖。

- 日期：2026-02-12
- 完成内容：完成 T45（二十次扩展阶段回归验证与文档收口）：
  - CI 测试脚本补齐 `agent_world_net --features libp2p` 覆盖：
    - `scripts/ci-tests.sh`
  - 项目管理文档收口：`doc/world-runtime/distributed-crate-split-net-consensus.project.md`（T44~T45 全部完成，二十次扩展阶段已收口）
- 完成内容：执行并通过回归验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net --features libp2p`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net -p agent_world_consensus -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_consensus --lib`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_net --features libp2p --lib`
- 遗留事项：本阶段已收口；后续按需继续推进更多 runtime 实现的物理迁移或抽象收敛。
- 日期：2026-02-12
- 完成内容：启动 BMS 第四阶段（`m1.sensor.basic` 迁移）文档任务：
  - 更新设计文档范围与里程碑：`doc/world-runtime/builtin-wasm-crate-split.md`
  - 扩展项目管理文档任务（BMS-12~BMS-15）：`doc/world-runtime/builtin-wasm-crate-split.project.md`
  - 总项目文档同步新增 BMS-12~BMS-15：`doc/world-runtime.project.md`
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_builtin_wasm`
- 遗留事项：继续完成 BMS-13（迁移 `m1.sensor.basic` 到独立 wasm crate）。
- 日期：2026-02-12
- 完成内容：完成 BMS-13（迁移 `m1.sensor.basic` 到独立 wasm crate）：
  - `agent_world_builtin_wasm` 新增 `m1.sensor.basic` 入口：
    - 行为对齐 native `M1SensorModule`，复用 `m1.rule.visibility` 逻辑链路。
  - 补充并通过单元测试：
    - `sensor_module_reuses_visibility_behavior`
  - 代码文件：
    - `crates/agent_world_builtin_wasm/src/lib.rs`
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo fmt --all`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_builtin_wasm`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_builtin_wasm --target wasm32-unknown-unknown`
- 完成内容：回写项目管理文档状态，标记 BMS-13 完成：
  - `doc/world-runtime/builtin-wasm-crate-split.project.md`
  - `doc/world-runtime.project.md`
- 遗留事项：继续推进 BMS-14（扩展构建脚本支持 `m1.sensor.basic`）。
- 日期：2026-02-12
- 完成内容：完成 BMS-14（扩展构建脚本支持 `m1.sensor.basic`）：
  - `scripts/build-builtin-wasm-modules.sh` 增加 `m1.sensor.basic` 映射与默认构建列表。
  - 代码文件：
    - `scripts/build-builtin-wasm-modules.sh`
- 完成内容：执行并通过验证：
  - `bash -n scripts/build-builtin-wasm-modules.sh`
  - `./scripts/build-builtin-wasm-modules.sh --list`
  - `./scripts/build-builtin-wasm-modules.sh --module-id m1.sensor.basic --out-dir .tmp/builtin-wasm-bms14 --profile dev --dry-run`
  - `./scripts/build-builtin-wasm-modules.sh --module-id m1.sensor.basic --out-dir .tmp/builtin-wasm-bms14 --profile dev`
- 完成内容：回写项目管理文档状态，标记 BMS-14 完成：
  - `doc/world-runtime/builtin-wasm-crate-split.project.md`
  - `doc/world-runtime.project.md`
- 遗留事项：继续推进 BMS-15（回归验证与文档收口）。
- 日期：2026-02-12
- 完成内容：完成 BMS-15（回归验证、文档与 devlog 收口）：
  - 执行并通过回归验证：
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_builtin_wasm`
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_builtin_wasm --target wasm32-unknown-unknown`
    - `env -u RUSTC_WRAPPER cargo test --manifest-path tools/wasm_build_suite/Cargo.toml`
    - `./scripts/build-builtin-wasm-modules.sh --module-id m1.rule.move --module-id m1.rule.visibility --module-id m1.rule.transfer --module-id m1.body.core --module-id m1.sensor.basic --out-dir .tmp/builtin-wasm-regression --profile dev --dry-run`
    - `./scripts/build-builtin-wasm-modules.sh --module-id m1.rule.move --module-id m1.rule.visibility --module-id m1.rule.transfer --module-id m1.body.core --module-id m1.sensor.basic --out-dir .tmp/builtin-wasm-regression --profile dev`
  - 五个 builtin wasm 模块构建产物验证通过：
    - `m1.rule.move`
    - `m1.rule.visibility`
    - `m1.rule.transfer`
    - `m1.body.core`
    - `m1.sensor.basic`
  - 项目文档收口：
    - `doc/world-runtime/builtin-wasm-crate-split.project.md`（BMS-0~BMS-15 全部完成）
    - `doc/world-runtime.project.md`（BMS-15 标记完成并更新最近状态）
- 遗留事项：继续按优先级推进下一批 builtin 迁移（建议 `m1.mobility.basic`）。
- 日期：2026-02-12
- 完成内容：启动 BMS 第五阶段（`m1.mobility.basic` 迁移）文档任务：
  - 更新设计文档范围、接口与里程碑：`doc/world-runtime/builtin-wasm-crate-split.md`
  - 扩展项目管理文档任务（BMS-16~BMS-19）：`doc/world-runtime/builtin-wasm-crate-split.project.md`
  - 总项目文档同步新增 BMS-16~BMS-19：`doc/world-runtime.project.md`
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_builtin_wasm`
- 遗留事项：继续完成 BMS-17（迁移 `m1.mobility.basic` 到独立 wasm crate）。
- 日期：2026-02-12
- 完成内容：完成 BMS-17（迁移 `m1.mobility.basic` 到独立 wasm crate）：
  - `agent_world_builtin_wasm` 新增 `m1.mobility.basic` 入口：
    - 行为对齐 native `M1MobilityModule` 封装语义，复用 `m1.rule.move` 输出逻辑。
  - 补充并通过单元测试：
    - `mobility_module_reuses_move_rule_behavior`
  - 代码文件：
    - `crates/agent_world_builtin_wasm/src/lib.rs`
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo fmt --manifest-path crates/agent_world_builtin_wasm/Cargo.toml`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_builtin_wasm`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_builtin_wasm --target wasm32-unknown-unknown`
- 完成内容：回写项目管理文档状态，标记 BMS-17 完成：
  - `doc/world-runtime/builtin-wasm-crate-split.project.md`
  - `doc/world-runtime.project.md`
- 遗留事项：继续推进 BMS-18（扩展构建脚本支持 `m1.mobility.basic`）。
- 日期：2026-02-12
- 完成内容：完成 BMS-18（扩展构建脚本支持 `m1.mobility.basic`）：
  - `scripts/build-builtin-wasm-modules.sh` 增加 `m1.mobility.basic` 映射与默认构建列表。
  - 代码文件：
    - `scripts/build-builtin-wasm-modules.sh`
- 完成内容：执行并通过验证：
  - `bash -n scripts/build-builtin-wasm-modules.sh`
  - `./scripts/build-builtin-wasm-modules.sh --list`
  - `./scripts/build-builtin-wasm-modules.sh --module-id m1.mobility.basic --out-dir .tmp/builtin-wasm-bms18 --profile dev --dry-run`
  - `./scripts/build-builtin-wasm-modules.sh --module-id m1.mobility.basic --out-dir .tmp/builtin-wasm-bms18 --profile dev`
- 完成内容：回写项目管理文档状态，标记 BMS-18 完成：
  - `doc/world-runtime/builtin-wasm-crate-split.project.md`
  - `doc/world-runtime.project.md`
- 遗留事项：继续推进 BMS-19（回归验证与文档收口）。
- 日期：2026-02-12
- 完成内容：完成 BMS-19（回归验证、文档与 devlog 收口）：
  - 执行并通过回归验证：
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_builtin_wasm`
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_builtin_wasm --target wasm32-unknown-unknown`
    - `env -u RUSTC_WRAPPER cargo test --manifest-path tools/wasm_build_suite/Cargo.toml`
    - `./scripts/build-builtin-wasm-modules.sh --module-id m1.rule.move --module-id m1.rule.visibility --module-id m1.rule.transfer --module-id m1.body.core --module-id m1.sensor.basic --module-id m1.mobility.basic --out-dir .tmp/builtin-wasm-regression --profile dev --dry-run`
    - `./scripts/build-builtin-wasm-modules.sh --module-id m1.rule.move --module-id m1.rule.visibility --module-id m1.rule.transfer --module-id m1.body.core --module-id m1.sensor.basic --module-id m1.mobility.basic --out-dir .tmp/builtin-wasm-regression --profile dev`
  - 六个 builtin wasm 模块构建产物验证通过：
    - `m1.rule.move`
    - `m1.rule.visibility`
    - `m1.rule.transfer`
    - `m1.body.core`
    - `m1.sensor.basic`
    - `m1.mobility.basic`
  - 项目文档收口：
    - `doc/world-runtime/builtin-wasm-crate-split.project.md`（BMS-0~BMS-19 全部完成）
    - `doc/world-runtime.project.md`（BMS-19 标记完成并更新最近状态）
- 遗留事项：按优先级继续迁移下一批 builtin（建议 `m1.memory.core`）。
- 日期：2026-02-12
- 完成内容：启动 BMS 第六阶段（`m1.memory.core` 迁移）文档任务：
  - 更新设计文档范围、接口与里程碑：`doc/world-runtime/builtin-wasm-crate-split.md`
  - 扩展项目管理文档任务（BMS-20~BMS-23）：`doc/world-runtime/builtin-wasm-crate-split.project.md`
  - 总项目文档同步新增 BMS-20~BMS-23：`doc/world-runtime.project.md`
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_builtin_wasm`
- 遗留事项：继续完成 BMS-21（迁移 `m1.memory.core` 到独立 wasm crate）。
- 日期：2026-02-12
- 完成内容：完成 BMS-21（迁移 `m1.memory.core` 到独立 wasm crate）：
  - `agent_world_builtin_wasm` 新增 `m1.memory.core` 行为：
    - 解析 domain event 并写入 memory state（`kind + agent_id + time`）。
    - 对齐 native 标签映射：`agent_registered/agent_moved/action_rejected/observation/body_attributes/body_interface/resource_transferred`。
    - 实现最大 256 条窗口裁剪，保持状态大小可控。
  - 补充并通过单元测试：
    - `memory_module_records_domain_event_and_agent_id`
    - `memory_module_tracks_observation_and_action_rejected_labels`
    - `memory_module_drops_old_entries_when_capacity_exceeded`
  - 代码文件：
    - `crates/agent_world_builtin_wasm/src/lib.rs`
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo fmt --manifest-path crates/agent_world_builtin_wasm/Cargo.toml`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_builtin_wasm`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_builtin_wasm --target wasm32-unknown-unknown`
- 完成内容：回写项目管理文档状态，标记 BMS-21 完成：
  - `doc/world-runtime/builtin-wasm-crate-split.project.md`
  - `doc/world-runtime.project.md`
- 遗留事项：继续推进 BMS-22（扩展构建脚本支持 `m1.memory.core`）。
- 日期：2026-02-12
- 完成内容：完成 BMS-22（扩展构建脚本支持 `m1.memory.core`）：
  - `scripts/build-builtin-wasm-modules.sh` 增加 `m1.memory.core` 映射与默认构建列表。
  - 代码文件：
    - `scripts/build-builtin-wasm-modules.sh`
- 完成内容：执行并通过验证：
  - `bash -n scripts/build-builtin-wasm-modules.sh`
  - `./scripts/build-builtin-wasm-modules.sh --list`
  - `./scripts/build-builtin-wasm-modules.sh --module-id m1.memory.core --out-dir .tmp/builtin-wasm-bms22 --profile dev --dry-run`
  - `./scripts/build-builtin-wasm-modules.sh --module-id m1.memory.core --out-dir .tmp/builtin-wasm-bms22 --profile dev`
- 完成内容：回写项目管理文档状态，标记 BMS-22 完成：
  - `doc/world-runtime/builtin-wasm-crate-split.project.md`
  - `doc/world-runtime.project.md`
- 遗留事项：继续推进 BMS-23（回归验证与文档收口）。
- 日期：2026-02-12
- 完成内容：完成 BMS-23（回归验证、文档与 devlog 收口）：
  - 执行并通过回归验证：
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_builtin_wasm`
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_builtin_wasm --target wasm32-unknown-unknown`
    - `env -u RUSTC_WRAPPER cargo test --manifest-path tools/wasm_build_suite/Cargo.toml`
    - `./scripts/build-builtin-wasm-modules.sh --module-id m1.rule.move --module-id m1.rule.visibility --module-id m1.rule.transfer --module-id m1.body.core --module-id m1.sensor.basic --module-id m1.mobility.basic --module-id m1.memory.core --out-dir .tmp/builtin-wasm-regression --profile dev --dry-run`
    - `./scripts/build-builtin-wasm-modules.sh --module-id m1.rule.move --module-id m1.rule.visibility --module-id m1.rule.transfer --module-id m1.body.core --module-id m1.sensor.basic --module-id m1.mobility.basic --module-id m1.memory.core --out-dir .tmp/builtin-wasm-regression --profile dev`
  - 七个 builtin wasm 模块构建产物验证通过：
    - `m1.rule.move`
    - `m1.rule.visibility`
    - `m1.rule.transfer`
    - `m1.body.core`
    - `m1.sensor.basic`
    - `m1.mobility.basic`
    - `m1.memory.core`
  - 项目文档收口：
    - `doc/world-runtime/builtin-wasm-crate-split.project.md`（BMS-0~BMS-23 全部完成）
    - `doc/world-runtime.project.md`（BMS-23 标记完成并更新最近状态）
- 遗留事项：按优先级继续迁移下一批 builtin（建议 `m1.storage.cargo`）。
- 日期：2026-02-12
- 完成内容：启动 BMS 第七阶段（`m1.storage.cargo` 迁移）文档任务：
  - 更新设计文档范围、接口与里程碑：`doc/world-runtime/builtin-wasm-crate-split.md`
  - 扩展项目管理文档任务（BMS-24~BMS-27）：`doc/world-runtime/builtin-wasm-crate-split.project.md`
  - 总项目文档同步新增 BMS-24~BMS-27：`doc/world-runtime.project.md`
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_builtin_wasm`
- 遗留事项：继续完成 BMS-25（迁移 `m1.storage.cargo` 到独立 wasm crate）。
- 日期：2026-02-12
- 完成内容：完成 BMS-25（迁移 `m1.storage.cargo` 到独立 wasm crate）：
  - `agent_world_builtin_wasm` 新增 `m1.storage.cargo` 入口与状态处理逻辑：
    - 处理 `BodyInterfaceExpanded`：累计 `consumed_interface_items`、更新 `agent_expansion_levels`（对齐 native 语义）。
    - 处理 `BodyInterfaceExpandRejected`：累计 `reject_count`（饱和加法）。
  - 新增独立模块文件承载逻辑与测试：`crates/agent_world_builtin_wasm/src/storage_cargo_module.rs`
  - 路由接线与模块 ID 常量：
    - `crates/agent_world_builtin_wasm/src/lib.rs`
- 完成内容：新增并通过单元测试：
  - `storage_cargo_module_tracks_expand_events`
  - `storage_cargo_module_counts_rejections_with_saturation`
  - `storage_cargo_module_ignores_non_target_domain_events`
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo fmt --manifest-path crates/agent_world_builtin_wasm/Cargo.toml`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_builtin_wasm`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_builtin_wasm --target wasm32-unknown-unknown`
- 完成内容：回写项目管理文档状态，标记 BMS-25 完成：
  - `doc/world-runtime/builtin-wasm-crate-split.project.md`
  - `doc/world-runtime.project.md`
- 遗留事项：继续推进 BMS-26（扩展构建脚本支持 `m1.storage.cargo`）。
- 日期：2026-02-12
- 完成内容：完成 BMS-26（扩展构建脚本支持 `m1.storage.cargo`）：
  - `scripts/build-builtin-wasm-modules.sh` 增加 `m1.storage.cargo` 映射与默认构建列表。
  - 代码文件：
    - `scripts/build-builtin-wasm-modules.sh`
- 完成内容：执行并通过验证：
  - `bash -n scripts/build-builtin-wasm-modules.sh`
  - `./scripts/build-builtin-wasm-modules.sh --list`
  - `./scripts/build-builtin-wasm-modules.sh --module-id m1.storage.cargo --out-dir .tmp/builtin-wasm-bms26 --profile dev --dry-run`
  - `./scripts/build-builtin-wasm-modules.sh --module-id m1.storage.cargo --out-dir .tmp/builtin-wasm-bms26 --profile dev`
- 完成内容：回写项目管理文档状态，标记 BMS-26 完成：
  - `doc/world-runtime/builtin-wasm-crate-split.project.md`
  - `doc/world-runtime.project.md`
- 遗留事项：继续推进 BMS-27（回归验证与文档收口）。
- 日期：2026-02-12
- 完成内容：完成 BMS-27（回归验证、文档与 devlog 收口）：
  - 执行并通过回归验证：
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_builtin_wasm`
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_builtin_wasm --target wasm32-unknown-unknown`
    - `env -u RUSTC_WRAPPER cargo test --manifest-path tools/wasm_build_suite/Cargo.toml`
    - `./scripts/build-builtin-wasm-modules.sh --module-id m1.rule.move --module-id m1.rule.visibility --module-id m1.rule.transfer --module-id m1.body.core --module-id m1.sensor.basic --module-id m1.mobility.basic --module-id m1.memory.core --module-id m1.storage.cargo --out-dir .tmp/builtin-wasm-regression --profile dev --dry-run`
    - `./scripts/build-builtin-wasm-modules.sh --module-id m1.rule.move --module-id m1.rule.visibility --module-id m1.rule.transfer --module-id m1.body.core --module-id m1.sensor.basic --module-id m1.mobility.basic --module-id m1.memory.core --module-id m1.storage.cargo --out-dir .tmp/builtin-wasm-regression --profile dev`
  - 八个 builtin wasm 模块构建产物验证通过（hash 一致）：
    - `m1.rule.move`
    - `m1.rule.visibility`
    - `m1.rule.transfer`
    - `m1.body.core`
    - `m1.sensor.basic`
    - `m1.mobility.basic`
    - `m1.memory.core`
    - `m1.storage.cargo`
  - 产物摘要：
    - `wasm_hash_sha256=44a23a2b88d584142d2b9385a082ffeeb40819d9f4dccec2b3378bf7f953192b`
    - `wasm_size_bytes=7555583`
  - 项目文档收口：
    - `doc/world-runtime/builtin-wasm-crate-split.project.md`（BMS-0~BMS-27 全部完成）
    - `doc/world-runtime.project.md`（BMS-27 标记完成并更新最近状态）
- 遗留事项：按优先级继续迁移下一批 builtin（建议 `m1.power.radiation_harvest`、`m1.power.storage`）。
- 日期：2026-02-12
- 完成内容：启动 BMS 第八阶段（`m1.power.radiation_harvest` / `m1.power.storage` 迁移）文档任务：
  - 更新设计文档范围、接口与里程碑：`doc/world-runtime/builtin-wasm-crate-split.md`
  - 扩展项目管理文档任务（BMS-28~BMS-31）：`doc/world-runtime/builtin-wasm-crate-split.project.md`
  - 总项目文档同步新增 BMS-28~BMS-31：`doc/world-runtime.project.md`
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_builtin_wasm`
- 遗留事项：继续完成 BMS-29（迁移 `m1.power.radiation_harvest` / `m1.power.storage` 到独立 wasm crate）。
- 日期：2026-02-12
- 完成内容：完成 BMS-29（迁移 `m1.power.radiation_harvest` / `m1.power.storage` 到独立 wasm crate）：
  - `agent_world_builtin_wasm` 新增 power 模块行为：
    - `m1.power.radiation_harvest`：动作阶段按位置采集电量并发出 `power.radiation_harvest`；事件阶段同步 agent 位置信息。
    - `m1.power.storage`：动作阶段“采集 + move 扣费 + rule decision”，事件阶段注册/移动与电量上下界裁剪。
  - 新增独立模块文件承载实现与测试：`crates/agent_world_builtin_wasm/src/power_modules.rs`
  - 路由接线与模块 ID/参数常量：
    - `crates/agent_world_builtin_wasm/src/lib.rs`
- 完成内容：新增并通过单元测试：
  - `radiation_power_module_harvests_and_emits`
  - `radiation_power_module_tracks_register_and_move_events`
  - `storage_power_module_registers_initial_level`
  - `storage_power_module_denies_when_insufficient`
  - `storage_power_module_allows_move_and_consumes_power`
  - `storage_power_module_clamps_levels_on_event`
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo fmt --manifest-path crates/agent_world_builtin_wasm/Cargo.toml`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_builtin_wasm`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_builtin_wasm --target wasm32-unknown-unknown`
- 完成内容：回写项目管理文档状态，标记 BMS-29 完成：
  - `doc/world-runtime/builtin-wasm-crate-split.project.md`
  - `doc/world-runtime.project.md`
- 遗留事项：继续推进 BMS-30（扩展构建脚本支持 `m1.power.radiation_harvest` / `m1.power.storage`）。
