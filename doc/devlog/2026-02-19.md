- 日期：2026-02-19
- 时刻：2026-02-19 00:01:55 CST
- 完成内容：完成“将系统性应用测试手册迁移到项目根目录并提交”任务。
  - 将 `doc/testing/systematic-application-testing-manual.md` 迁移为 `systematic-application-testing-manual.md`。
  - 更新项目管理文档 `doc/testing/systematic-application-testing-manual.project.md` 中的设计文档路径、任务拆解（新增 T8）与状态时间。
  - 保持手册正文内容与 TODO 项不变，仅调整存放位置与引用口径。
- 测试：
  - `./scripts/ci-tests.sh required`
- 遗留事项：
  - 无（后续按手册 TODO-1/TODO-2 单独任务推进）。

- 日期：2026-02-19
- 时刻：2026-02-19 00:09:53 CST
- 完成内容：完成“AGENTS.md 测试章节迁移 + 文档引用收敛”任务。
  - 将 `AGENTS.md` 中“Agent 专用：UI Web 闭环调试”由长流程改为短入口与约束，避免双维护。
  - 将原章节中的 fallback 规则与推荐约定补充进 `testing-manual.md`（S6 补充约定）。
  - 更新项目管理文档 `doc/testing/systematic-application-testing-manual.project.md`，新增 T10 并回写状态说明。
- 测试：
  - `./scripts/ci-tests.sh required`
- 遗留事项：
  - 无（执行入口已统一，后续仅在 `testing-manual.md` 维护详细流程）。
- 时刻：2026-02-19 00:18:40 CST
- 完成内容：完成 README 生产级缺口收口（二次）T0 文档建档。
  - 新增设计文档：`doc/readme-prod-gap1245-wasm-repl-topology-player.md`。
  - 新增项目管理文档：`doc/readme-prod-gap1245-wasm-repl-topology-player.project.md`。
  - 项目管理文档状态初始化：T0 完成，T1~T5 待执行。
- 测试：
  - `env -u RUSTC_WRAPPER cargo check`
- 遗留事项：
  - 执行 T1：默认构建启用 `wasmtime` 并补齐测试。

- 日期：2026-02-19
- 时刻：2026-02-19 00:21:33 CST
- 完成内容：完成 README 缺口收口 T1（默认构建启用 `wasmtime`）。
  - `crates/agent_world/Cargo.toml`：`default` feature 从空集调整为 `["wasmtime"]`，默认构建具备真实 WASM 执行能力。
  - `doc/readme-prod-gap1245-wasm-repl-topology-player.project.md`：回写 T1 状态为完成。
- 测试：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world --features test_tier_required`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_wasm_executor --features wasmtime`
- 遗留事项：
  - 执行 T2：实现 node libp2p replication request/handler 通道。

- 日期：2026-02-19
- 时刻：2026-02-19 00:41:02 CST
- 完成内容：完成 T2（node libp2p replication request/handler 通道）。
  - `crates/agent_world_node/src/libp2p_replication_network.rs`：
    - 接入 `request_response` 行为，与既有 `gossipsub` 并行运行。
    - `request` 实现为：有可达 peer 走远端 RR，无 peer 回退本地 handler。
    - `register_handler` 实现为线程内 handler 表注册，并用于本地 fallback 与远端请求处理。
    - 增加连接/监听状态与错误跟踪，支撑 RR 集成测试稳定等待。
    - 新增测试：本地 fallback、双节点 RR 互通。
  - `crates/agent_world_node/Cargo.toml`：补齐 `libp2p` features（`request-response`、`cbor`）。
  - `doc/readme-prod-gap1245-wasm-repl-topology-player.project.md`：回写 T2 完成，下一步切换到 T3。
- 测试：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_node`
- 遗留事项：
  - 执行 T3：实现跨主机 `triad_distributed` 拓扑并补齐 CLI/启动测试。

- 日期：2026-02-19
- 时刻：2026-02-19 00:47:13 CST
- 完成内容：完成 T3（跨主机 `triad_distributed` 拓扑）。
  - `crates/agent_world/src/bin/world_viewer_live/cli.rs`：
    - `--topology` 新增 `triad_distributed`。
    - 新增显式 triad 地址参数：`--triad-sequencer-gossip`、`--triad-storage-gossip`、`--triad-observer-gossip`。
    - 新增 `triad_distributed` 参数校验（节点启用、共识门控、三地址必填且互异、与 `--node-gossip-*` 互斥）。
  - `crates/agent_world/src/bin/world_viewer_live.rs`：
    - 新增 `start_triad_distributed_live_node`，单进程单角色启动（`--node-role` 决定角色）。
    - 三角色节点 ID 固定派生：`<node-id>-sequencer|storage|observer`，validator 集固定 `34/33/33`。
    - 新增可复用的 `attach_optional_replication_network`，`single` 与 `triad_distributed` 共享 libp2p replication 挂接路径。
  - `crates/agent_world/src/bin/world_viewer_live/world_viewer_live_tests.rs`：
    - 新增 `triad_distributed` 的 parse/startup/replication 注入测试。
  - `doc/readme-prod-gap1245-wasm-repl-topology-player.project.md`：回写 T3 完成，下一步切换到 T4。
- 测试：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live`
- 遗留事项：
  - 执行 T4：实现玩家节点身份模型下沉并补齐配置/动作/消息测试。

- 日期：2026-02-19
- 时刻：2026-02-19 00:26:54 CST
- 完成内容：完成 T1 收口修正（required-tier 稳定性）。
  - `crates/agent_world/src/runtime/tests/economy_bootstrap.rs`：将文件级条件从 `feature = "wasmtime"` 调整为 `all(feature = "wasmtime", feature = "test_tier_full")`，避免 default 开启 wasmtime 后重型 m4 用例进入 required-tier。
  - 保持 T1 目标不变：`agent_world` 默认构建启用 `wasmtime`。
- 测试：
  - `CI_VERBOSE=1 ./scripts/ci-tests.sh required`
- 遗留事项：
  - 执行 T2：实现 node libp2p replication request/handler 通道。

- 日期：2026-02-19
- 时刻：2026-02-19 01:02:03 CST
- 完成内容：完成 T4（玩家节点身份模型下沉，节点/动作/消息一致身份语义）。
  - `crates/agent_world_node/src/types.rs`：`NodeConfig` 增加 `player_id`（默认等于 `node_id`），`NodePosConfig` 增加 `validator_player_ids`，`NodeSnapshot` 增加 `player_id`。
  - `crates/agent_world_node/src/pos_validation.rs`：增强 POS 校验，要求 validator-player 一一绑定、禁止空绑定、禁止同玩家绑定多个 validator、禁止未知 validator 绑定。
  - `crates/agent_world_node/src/consensus_action.rs`：`NodeConsensusAction` 增加 `submitter_player_id`，action root 升级到 v2（含 player），并保留 v1 兼容校验。
  - `crates/agent_world_node/src/lib.rs`、`crates/agent_world_node/src/gossip_udp.rs`、`crates/agent_world_node/src/consensus_signature.rs`：proposal/attestation/commit 消息新增 `player_id`，签名负载纳入 `player_id`，引擎 ingest 增加 player-binding 一致性过滤。
  - `crates/agent_world_node/src/node_runtime_core.rs`：新增 `submit_consensus_action_payload_as_player`，强校验提交方 `player_id` 与节点配置一致。
  - `crates/agent_world/src/viewer/live/consensus_bridge.rs`：玩家提交路径改为调用 runtime 的按玩家提交接口；system/agent 维持原接口。
  - `crates/agent_world_node/src/tests.rs`、`crates/agent_world_node/src/tests_action_payload.rs`、`crates/agent_world/src/bin/world_viewer_live/execution_bridge.rs`、`crates/agent_world/src/runtime/node_points_runtime.rs`：补齐 player_id 相关测试与快照构造更新。
  - `doc/readme-prod-gap1245-wasm-repl-topology-player.project.md`：回写 T4 完成，下一步切换到 T5。
- 测试：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_node`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world viewer::live::tests::live_world_consensus_bridge_applies_only_committed_actions`
- 遗留事项：
  - 执行 T5：`env -u RUSTC_WRAPPER cargo check` 与 `CI_VERBOSE=1 ./scripts/ci-tests.sh required` 回归收口。

- 日期：2026-02-19
- 时刻：2026-02-19 01:13:03 CST
- 完成内容：完成 T5（全量回归验证与文档收口）。
  - 执行并通过 `env -u RUSTC_WRAPPER cargo check`（workspace）。
  - 执行并通过 `CI_VERBOSE=1 ./scripts/ci-tests.sh required`（包含 required-tier 测试和 wasm 产物一致性校验）。
  - `doc/readme-prod-gap1245-wasm-repl-topology-player.project.md`：回写 T5 完成，整体状态收口为完成。
- 测试：
  - `env -u RUSTC_WRAPPER cargo check`
  - `CI_VERBOSE=1 ./scripts/ci-tests.sh required`
- 遗留事项：
  - 无。

- 日期：2026-02-19
- 时刻：2026-02-19 08:48:15 CST
- 完成内容：完成 README 缺口 3（安装目标语义）T0 文档建档。
  - 新增设计文档：`doc/readme-gap3-install-target-infrastructure.md`。
  - 新增项目管理文档：`doc/readme-gap3-install-target-infrastructure.project.md`。
  - 项目文档状态初始化：T0 完成，T1~T3 待执行。
- 测试：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world --features test_tier_required`
- 遗留事项：
  - 执行 T1：扩展 `ModuleInstallTarget` 与 action/event/state 类型。

- 日期：2026-02-19
- 时刻：2026-02-19 08:54:40 CST
- 完成内容：完成 README 缺口 3 收口 T1（安装目标类型与事件结构扩展）。
  - `crates/agent_world/src/simulator/types.rs`：新增 `ModuleInstallTarget`；新增动作 `InstallModuleToTargetFromArtifact`。
  - `crates/agent_world/src/simulator/world_model/module_market.rs`：`InstalledModuleState` 新增 `install_target`（默认兼容）。
  - `crates/agent_world/src/simulator/kernel/types.rs`、`crates/agent_world/src/runtime/events.rs`：`ModuleInstalled` 事件新增 `install_target`（`serde(default)` 兼容历史快照/回放）。
  - `crates/agent_world/src/runtime/world/module_runtime_labels.rs`、`crates/agent_world/src/runtime/world/event_processing.rs`、`crates/agent_world/src/runtime/world/module_actions.rs`、`crates/agent_world/src/simulator/kernel/actions.rs`、`crates/agent_world/src/simulator/kernel/step.rs`：补齐新动作分支与兼容路径。
  - `crates/agent_world/src/simulator/llm_agent/behavior_loop.rs`、`crates/agent_world/src/simulator/llm_agent/behavior_prompt.rs`：补齐新字段/新动作的模式匹配。
  - `doc/readme-gap3-install-target-infrastructure.project.md`：回写 T1 完成。
- 测试：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world --features test_tier_required`
- 遗留事项：
  - 执行 T2：实现 `location_infrastructure` 校验与 runtime/simulator 目标语义落库。

- 日期：2026-02-19
- 时刻：2026-02-19 09:08:37 CST
- 完成内容：完成 README 缺口 3 收口 T2（安装目标语义落地与 LLM 新动作入口）。
  - `crates/agent_world/src/simulator/kernel/module_lifecycle.rs`、`crates/agent_world/src/simulator/kernel/actions.rs`：
    - 新动作 `InstallModuleToTargetFromArtifact` 接入真实安装流程，不再退化为旧动作。
    - 新增安装目标统一处理：`SelfAgent` 与 `LocationInfrastructure`。
    - `LocationInfrastructure` 增加两条生产约束：目标 location 必须存在；安装者必须位于该 location。
  - `crates/agent_world/src/simulator/kernel/replay_module_lifecycle.rs`：回放路径补齐 `install_target` 校验与标准化，确保 replay 语义一致。
  - `crates/agent_world/src/runtime/world/module_actions.rs`：
    - 抽取统一安装处理函数，旧动作与新动作共享治理/注册/激活流程。
    - 新动作不再占位拒绝，`DomainEvent::ModuleInstalled` 正确记录 `install_target`。
  - `crates/agent_world/src/simulator/llm_agent/decision_flow.rs`、`crates/agent_world/src/simulator/llm_agent/decision_flow/action_parsers.rs`、`crates/agent_world/src/simulator/llm_agent/openai_payload.rs`、`crates/agent_world/src/simulator/llm_agent/prompt_assembly.rs`：
    - 新增 `install_module_to_target_from_artifact` 决策、schema 字段与解析规则。
    - 新增字段：`install_target_type`、`install_target_location_id`。
  - `crates/agent_world/src/simulator/llm_agent.rs`、`crates/agent_world/src/simulator/llm_agent/behavior_loop.rs`：
    - LLM 内部已知安装记录增加 `install_target`，`module.lifecycle.status` 输出可审计目标信息。
  - `doc/readme-gap3-install-target-infrastructure.project.md`：回写 T2 完成。
- 测试：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world --features test_tier_required`
- 遗留事项：
  - 执行 T3：补齐目标安装语义测试（simulator/runtime/llm）并完成回归收口。

- 日期：2026-02-19
- 时刻：2026-02-19 09:17:42 CST
- 完成内容：完成 README 缺口 3 收口 T3（测试补齐与回归收口）。
  - `crates/agent_world/src/simulator/tests/module_lifecycle.rs`：
    - 新增 `install_module_to_target_from_artifact` 成功用例（同 location 基础设施安装）。
    - 新增失败用例（目标 location 不存在、安装者与目标 location 不同位）。
    - 新增 legacy replay 兼容用例：历史 `module_installed` 事件缺失 `install_target` 时，回放默认 `SelfAgent`。
  - `crates/agent_world/src/runtime/tests/module_action_loop.rs`：
    - 新增 runtime 目标安装动作用例，验证 `DomainEvent::ModuleInstalled.install_target` 透传。
    - 新增 legacy 反序列化兼容用例：`DomainEvent::ModuleInstalled` 缺失 `install_target` 默认 `SelfAgent`。
  - `crates/agent_world/src/simulator/llm_agent/tests_part3_module_lifecycle.rs`：
    - 新增 LLM 解析失败用例：`install_target_type=location_infrastructure` 缺失 `install_target_location_id`。
  - `doc/readme-gap3-install-target-infrastructure.project.md`：回写 T3 完成，整体状态收口完成。
- 测试：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features test_tier_required module_lifecycle_install_to_location_infrastructure`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features test_tier_required module_lifecycle_replay_legacy_module_installed_defaults_install_target_to_self_agent`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features test_tier_required install_module_to_target_from_artifact_action_emits_target`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features test_tier_required module_installed_domain_event_legacy_payload_defaults_install_target`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features test_tier_required llm_parse_install_module_to_target_from_artifact_rejects_missing_location_id`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world --features test_tier_required`
- 遗留事项：
  - 无。

- 日期：2026-02-19
- 时刻：2026-02-19 09:30:46 CST
- 完成内容：完成“基础设施模块执行引擎 + 编译 Sandbox 隔离”T0 文档建档。
  - 新增设计文档：`doc/readme-gap-infra-exec-compiler-sandbox.md`。
  - 新增项目管理文档：`doc/readme-gap-infra-exec-compiler-sandbox.project.md`。
  - 项目文档状态初始化：T0 完成，T1/T2/T3 待执行。
- 测试：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world --features test_tier_required`
- 遗留事项：
  - 执行 T1：实现基础设施模块执行引擎。

- 日期：2026-02-19
- 时刻：2026-02-19 09:35:42 CST
- 完成内容：完成 T1（基础设施模块执行引擎）。
  - `crates/agent_world/src/runtime/state.rs`：`WorldState` 新增 `installed_module_targets`，`ModuleInstalled` 事件应用时落库安装目标。
  - `crates/agent_world/src/runtime/world/module_tick_runtime.rs`：tick 路由按安装目标分流；`LocationInfrastructure` 使用 `origin.kind=infrastructure_tick` 与 `origin.id=<location_id>:<time>`。
  - `crates/agent_world/src/runtime/tests/modules.rs`：新增基础设施安装目标 tick 路由用例，验证 runtime 调用语义。
  - `doc/readme-gap-infra-exec-compiler-sandbox.project.md`：回写 T1 为完成，下一步切换 T2。
- 测试：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features test_tier_required step_with_modules_routes_location_infrastructure_install_as_infrastructure_tick`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features test_tier_required install_module_to_target_from_artifact_action_emits_target`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features test_tier_required step_with_modules_routes_tick_lifecycle_with_wake_and_suspend`
  - `env -u RUSTC_WRAPPER cargo fmt --all`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world --features test_tier_required`
- 遗留事项：
  - 执行 T2：实现编译 Sandbox 隔离（源码包约束 + timeout + 最小化环境）。

- 日期：2026-02-19
- 时刻：2026-02-19 09:42:22 CST
- 完成内容：完成 T2（编译 sandbox 隔离）。
  - `crates/agent_world/src/runtime/module_source_compiler.rs`：新增源码包限制（文件数/单文件大小/总大小），支持环境变量覆盖；新增编译进程超时控制；编译命令改为最小环境白名单（`env_clear` + allowlist）；`TMPDIR/TMP/TEMP` 固定为工作目录内隔离 `tmp` 子目录。
  - `crates/agent_world/src/runtime/tests/module_action_loop.rs`：新增 required-tier 用例，覆盖“文件数超限拒绝”“编译超时拒绝”“环境白名单 + TMPDIR 隔离成功路径”；并保持既有编译成功/manifest 缺失场景兼容。
  - `doc/readme-gap-infra-exec-compiler-sandbox.project.md`：回写 T2 完成，下一步切换 T3。
- 测试：
  - `env -u RUSTC_WRAPPER cargo fmt --all`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features test_tier_required compile_module_artifact_from_source_rejects_when_file_count_exceeds_limit`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features test_tier_required compile_module_artifact_from_source_rejects_when_compiler_times_out`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features test_tier_required compile_module_artifact_from_source_sanitizes_env_and_isolates_tmpdir`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features test_tier_required compile_module_artifact_from_source_registers_compiled_artifact`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features test_tier_required compile_module_artifact_from_source_rejects_when_manifest_path_missing_in_files`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world --features test_tier_required`
- 遗留事项：
  - 执行 T3：全仓 `cargo check` 与 required CI 回归收口。

- 日期：2026-02-19
- 时刻：2026-02-19 09:46:56 CST
- 完成内容：完成 T3（回归验证与收口）。
  - 执行并通过 workspace 级 `cargo check`。
  - 执行并通过 `required` 门禁脚本（含格式、内置 wasm 产物一致性、required-tier 测试、`agent_world_viewer` wasm32 check）。
  - `doc/readme-gap-infra-exec-compiler-sandbox.project.md`：回写 T3 完成，整体状态收口为完成。
- 测试：
  - `env -u RUSTC_WRAPPER cargo check`
  - `CI_VERBOSE=1 ./scripts/ci-tests.sh required`
- 遗留事项：
  - 无。

- 日期：2026-02-19
- 时刻：2026-02-19 10:02:31 CST
- 完成内容：完成 README 资源模型口径修订 T0（文档建档）。
  - 新增设计文档：`doc/readme-resource-model-layering.md`。
  - 新增项目管理文档：`doc/readme-resource-model-layering.project.md`。
  - 项目管理文档状态初始化：T0 完成，T1 待执行。
- 测试：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world --features test_tier_required`
- 遗留事项：
  - 执行 T1：修订 `README.md` 资源口径并回归校验。

- 日期：2026-02-19
- 时刻：2026-02-19 10:04:57 CST
- 完成内容：完成 README 资源模型口径修订 T1（README 实改与项目状态收口）。
  - `README.md`：将资源叙述调整为“内建最小资源 + 模块扩展资源”分层。
  - `README.md`：明确当前内建资源为 `Electricity/Compound/Hardware/Data`，并说明算力/存储/带宽可由内建资源组合与模块规则共同表达。
  - `doc/readme-resource-model-layering.project.md`：回写 T1 完成，状态收口为全部完成。
- 测试：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world --features test_tier_required`
- 遗留事项：
  - 无。

- 日期：2026-02-19
- 时刻：2026-02-19 10:10:25 CST
- 完成内容：完成 Compound/Hardware 硬迁移 T0（文档建档）。
  - 新增设计文档：`doc/resource-kind-compound-hardware-hard-migration.md`。
  - 新增项目管理文档：`doc/resource-kind-compound-hardware-hard-migration.project.md`。
  - 项目管理文档状态初始化：T0 完成，T1/T2 待执行。
- 测试：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world --features test_tier_required`
- 遗留事项：
  - 执行 T1：代码硬迁移（移除 `ResourceKind::Compound/Hardware`）。

- 日期：2026-02-19
- 时刻：2026-02-19 10:27:10 CST
- 完成内容：完成 Compound/Hardware 硬迁移 T1（代码硬迁移与 README/场景同步）。
  - `crates/agent_world/src/simulator/types.rs`：`ResourceKind` 收敛为 `Electricity | Data`，移除 `Compound/Hardware`。
  - `crates/agent_world/src/simulator/llm_agent/decision_flow.rs`：移除 `compound/hardware` 资源 kind 解析入口，仅保留 `electricity/data`。
  - `crates/agent_world/src/simulator/llm_agent/prompt_assembly.rs`：工具参数 schema 与恢复策略改为 `electricity/data` 口径（不再给出 compound/hardware kind）。
  - `crates/agent_world/scenarios/resource_bootstrap.json`、`crates/agent_world/scenarios/asteroid_fragment_bootstrap.json`：场景资源 kind 从 `hardware` 迁移到 `data`。
  - `README.md`：内建资源描述调整为仅 `Electricity/Data`，`Compound/Hardware` 改为 WASM 模块层定义。
  - `crates/agent_world_viewer/src/ui_text_economy.rs`、`crates/agent_world_viewer/src/ui_text_industrial.rs`、`crates/agent_world_viewer/src/world_overlay.rs`：viewer 统计口径迁移到双资源模型并清理重复 `Data` 分支。
- 测试：
  - `env -u RUSTC_WRAPPER cargo fmt --all`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world --features test_tier_required`
  - `env -u RUSTC_WRAPPER cargo check`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --lib --features test_tier_required`
- 遗留事项：
  - 执行 T2：required 门禁回归与项目状态收口。

- 日期：2026-02-19
- 时刻：2026-02-19 10:28:38 CST
- 完成内容：完成 Compound/Hardware 硬迁移 T2（门禁回归与文档收口）。
  - 通过 required 门禁（格式、内置 wasm 产物一致性、required-tier 测试、`agent_world_viewer` wasm32 check）。
  - `doc/resource-kind-compound-hardware-hard-migration.project.md`：回写 T1/T2 完成，状态收口为全部完成。
  - 同步补记本日 devlog（本条）。
- 测试：
  - `CI_VERBOSE=1 ./scripts/ci-tests.sh required`
- 遗留事项：
  - 无。

- 日期：2026-02-19
- 时刻：2026-02-19 10:56:50 CST
- 完成内容：完成 Web 端定位口径修订（方案1：Viewer + 网关，不要求浏览器具备完整分布式节点能力）。
  - `README.md`：补充架构说明，明确 Web 端默认是 Viewer/间接控制客户端，通过 `world_viewer_live --web-bind` 桥接接入。
  - `doc/viewer-manual.md`：在适用范围、浏览器模式、Web 闭环章节补充角色边界说明，明确 Web 端不承担 gossip/replication/共识职责。
  - `doc/world-simulator/viewer-websocket-http-bridge.md`：目标与范围外新增边界说明，避免误解为浏览器端完整节点实现。
  - `doc/world-simulator/viewer-websocket-http-bridge.project.md`：新增 WLB6 文档口径澄清任务并回写状态。
- 测试：
  - `env -u RUSTC_WRAPPER cargo check`
- 遗留事项：
  - 无。

- 日期：2026-02-19
- 时刻：2026-02-19 11:14:29 CST
- 完成内容：完成“LLM 工业闭环未收口稳定性项复现与评估（MMD10）”。
  - 阅读并对齐项目文档：`doc/world-simulator/llm-industrial-mining-debug-tools.project.md`（未收口项 TODO-21/26/27）。
  - 按 2026-02-18 同口径 prompt 执行 `llm_bootstrap --ticks 120` 完整复现，产物：
    - `output/llm_bootstrap/repro_mmd9_2026-02-19_110325/run.log`
    - `output/llm_bootstrap/repro_mmd9_2026-02-19_110325/report.json`
  - 完整样本结果：`action_failure=71`，其中 `rule_denied=42`、`facility_not_found=25`、`location_not_found=3`、`agent_already_at_location=1`；并出现多段 `---` 输出（7 次）、`llm_input_chars_max=60197`、`prompt_section_clipped=380`。
  - 执行二次复现（同口径）到 `tick=51` 后手动中断，失败模式一致：`rule_denied=12`、`facility_not_found=6`、`location_not_found=1`。
  - 评估结论：需要进入下一轮优化，优先级为 P0（TODO-26/27）> P1（location_id 归一）> P2（多段输出协议 + prompt 体积治理）。
  - 回写项目管理文档：新增 MMD10 复现摘要，更新状态与 TODO-21/26/27，新增 TODO-28/29。
- 测试：
  - `AGENT_WORLD_LLM_SYSTEM_PROMPT='你是工业闭环调度Agent。每轮只输出一个可执行 tool call 对应的 decision，不输出解释文本。优先形成稳定工业闭环，避免在同一耗尽矿点连续重试。' AGENT_WORLD_LLM_SHORT_TERM_GOAL='120 tick 内完成：1) build_factory(factory.power.radiation.mk1) 成功>=1；2) build_factory(factory.assembler.mk1) 成功>=1；3) schedule_recipe 成功覆盖 recipe.assembler.control_chip / recipe.assembler.motor_mk1 / recipe.assembler.logistics_drone 各>=1。覆盖完成后继续排产，禁止 wait/wait_ticks。恢复规则：electricity不足->harvest_radiation；hardware不足->mine_compound+refine_compound；factory_not_found->build_factory。' AGENT_WORLD_LLM_LONG_TERM_GOAL='维持 harvest_radiation -> mine_compound -> refine_compound -> build_factory -> schedule_recipe 的持续产出闭环，减少 move/mine 抖动和无效重试。' env -u RUSTC_WRAPPER cargo run -p agent_world --bin world_llm_agent_demo -- llm_bootstrap --ticks 120 --print-llm-io --llm-io-max-chars 1800 --report-json output/llm_bootstrap/repro_mmd9_2026-02-19_110325/report.json`
  - `AGENT_WORLD_LLM_SYSTEM_PROMPT='你是工业闭环调度Agent。每轮只输出一个可执行 tool call 对应的 decision，不输出解释文本。优先形成稳定工业闭环，避免在同一耗尽矿点连续重试。' AGENT_WORLD_LLM_SHORT_TERM_GOAL='120 tick 内完成：1) build_factory(factory.power.radiation.mk1) 成功>=1；2) build_factory(factory.assembler.mk1) 成功>=1；3) schedule_recipe 成功覆盖 recipe.assembler.control_chip / recipe.assembler.motor_mk1 / recipe.assembler.logistics_drone 各>=1。覆盖完成后继续排产，禁止 wait/wait_ticks。恢复规则：electricity不足->harvest_radiation；hardware不足->mine_compound+refine_compound；factory_not_found->build_factory。' AGENT_WORLD_LLM_LONG_TERM_GOAL='维持 harvest_radiation -> mine_compound -> refine_compound -> build_factory -> schedule_recipe 的持续产出闭环，减少 move/mine 抖动和无效重试。' env -u RUSTC_WRAPPER cargo run -p agent_world --bin world_llm_agent_demo -- llm_bootstrap --ticks 120 --report-json output/llm_bootstrap/repro_mmd9_b_2026-02-19_111015/report.json`（手动中断于 tick=51）
- 遗留事项：
  - 进入 MMD11：先做 TODO-26/TODO-27（factory_id 与 recipe/factory_kind guardrail 收敛），再收敛 TODO-28/TODO-29。

- 日期：2026-02-19
- 时刻：2026-02-19 11:42:01 CST
- 完成内容：完成 MMD11.1（TODO-26~29 文档增量设计与任务拆解）。
  - `doc/world-simulator/llm-industrial-mining-debug-tools.md`：新增《MMD11 增量优化（TODO-26 ~ TODO-29）》章节，补齐目标、范围、接口/数据、里程碑、风险。
  - `doc/world-simulator/llm-industrial-mining-debug-tools.project.md`：新增 MMD11.1~MMD11.4 任务拆解并更新状态到“进入 MMD11.2 实现阶段”。
- 测试：
  - `CI_VERBOSE=1 ./scripts/ci-tests.sh required`（由提交钩子执行）
- 遗留事项：
  - 执行 MMD11.2：实现 guardrail 修复（factory/location 归一 + recipe/factory_kind 兼容改写）。

- 日期：2026-02-19
- 时刻：2026-02-19 12:03:46 CST
- 完成内容：完成 MMD11.2/MMD11.3（guardrail 修复 + required-tier 回归）。
  - `crates/agent_world/src/simulator/llm_agent/behavior_runtime_helpers.rs`：新增 recipe->factory_kind 推导、factory_kind->canonical_factory_id、缺失 recipe 依赖推导等运行时辅助方法。
  - `crates/agent_world/src/simulator/llm_agent/behavior_guardrails.rs`：
    - `schedule_recipe` 增加 factory kind 兼容前置检查，支持兼容工厂改写与缺厂时 `build_factory` 回退；
    - `build_factory` 增加 location 归一（未知 location 回退当前 location）、同位预检（异位先 `move_agent`）和兼容去重改写。
  - `crates/agent_world/src/simulator/llm_agent/behavior_prompt.rs`、`crates/agent_world/src/simulator/llm_agent/prompt_assembly.rs`：补齐 `rule_denied/location_not_found` reject reason 透传与恢复策略提示。
  - `crates/agent_world/src/simulator/llm_agent/tests_part2.rs`：
    - 补齐 MMD11 新 guardrail 预置场景（已知工厂）并修正脆弱断言；
    - 将部分易受 prompt 裁剪影响的断言收敛到稳定中间表示（history/observation JSON）。
- 测试：
  - `env -u RUSTC_WRAPPER cargo fmt --all`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world llm_agent_reroutes_schedule_recipe --features test_tier_required -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world llm_agent_build_factory_normalizes_unknown_location_to_current_location --features test_tier_required -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world llm_agent_user_prompt_preserves_ --features test_tier_required -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world llm_agent --features test_tier_required -- --nocapture`
- 遗留事项：
  - 执行 MMD11.4 在线复验并回写项目文档/结论。

- 日期：2026-02-19
- 时刻：2026-02-19 12:03:55 CST
- 完成内容：完成 MMD11.4 在线复验与文档回写。
  - 执行同 MMD10 口径 `llm_bootstrap --ticks 120`，产物：
    - `output/llm_bootstrap/mmd11_verify_2026-02-19_115519/run.log`
    - `output/llm_bootstrap/mmd11_verify_2026-02-19_115519/report.json`
  - 对比基线 `output/llm_bootstrap/repro_mmd9_2026-02-19_110325/report.json`：
    - 主拒绝项改善：`rule_denied: 42 -> 0`、`facility_not_found: 25 -> 0`、`action_failure: 71 -> 10`；
    - 新退化项：`location_not_found: 3 -> 10`、`parse_errors: 0 -> 60`、`decision_wait: 0 -> 60`、`prompt_section_clipped: 380 -> 1192`；
    - `run.log` 中多段 `---`：`7 -> 214`。
  - 更新 `doc/world-simulator/llm-industrial-mining-debug-tools.project.md`：
    - 勾选 MMD11.2/MMD11.3/MMD11.4；
    - 新增 MMD11 在线复验摘要与下一阶段优先级（TODO-29/TODO-28 提升为优先）。
- 测试：
  - `AGENT_WORLD_LLM_SYSTEM_PROMPT='你是工业闭环调度Agent。每轮只输出一个可执行 tool call 对应的 decision，不输出解释文本。优先形成稳定工业闭环，避免在同一耗尽矿点连续重试。' AGENT_WORLD_LLM_SHORT_TERM_GOAL='120 tick 内完成：1) build_factory(factory.power.radiation.mk1) 成功>=1；2) build_factory(factory.assembler.mk1) 成功>=1；3) schedule_recipe 成功覆盖 recipe.assembler.control_chip / recipe.assembler.motor_mk1 / recipe.assembler.logistics_drone 各>=1。覆盖完成后继续排产，禁止 wait/wait_ticks。恢复规则：electricity不足->harvest_radiation；hardware不足->mine_compound+refine_compound；factory_not_found->build_factory。' AGENT_WORLD_LLM_LONG_TERM_GOAL='维持 harvest_radiation -> mine_compound -> refine_compound -> build_factory -> schedule_recipe 的持续产出闭环，减少 move/mine 抖动和无效重试。' env -u RUSTC_WRAPPER cargo run -p agent_world --bin world_llm_agent_demo -- llm_bootstrap --ticks 120 --print-llm-io --llm-io-max-chars 1800 --report-json output/llm_bootstrap/mmd11_verify_2026-02-19_115519/report.json`
- 遗留事项：
  - 进入下一轮：优先收敛 TODO-29（多段输出协议 + prompt 体积治理），随后复核 TODO-28（location 归一）。

- 日期：2026-02-19
- 时刻：2026-02-19 12:42:56 CST
- 完成内容：完成 README 世界设定章节摘要化并统一细则入口任务。
  - 新增设计文档：`doc/readme-world-config-summary-link.md`。
  - 新增项目管理文档：`doc/readme-world-config-summary-link.project.md`。
  - `README.md`：将 `# 一、世界设定（Default World Configuration）` 从细节条目收敛为摘要，并统一指向 `world-rule.md` 作为细则文档。
- 测试：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world --features test_tier_required`
- 遗留事项：
  - 无。

- 日期：2026-02-19
- 时刻：2026-02-19 12:50:04 CST
- 完成内容：完成 README 章节 2/3/5 细则收敛到 `world-rule.md`（不提交）。
  - 新增设计文档：`doc/readme-sim-wasm-sandbox-consolidation.md`。
  - 新增项目管理文档：`doc/readme-sim-wasm-sandbox-consolidation.project.md`。
  - `world-rule.md`：补齐并整合了模拟机制细则（行动闭环、记忆关系、制度演化与多玩家磨合）、WASM 模块开发/部署/运行周期细则、开放沙盒涌现细则。
  - `README.md`：`# 二、模拟机制`、`# 三、WASM 模块运行机制`、`# 五、开放沙盒特性` 收敛为摘要，并统一指向 `world-rule.md`。
- 测试：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world --features test_tier_required`
- 遗留事项：
  - 无。

- 日期：2026-02-19
- 时刻：2026-02-19 12:53:51 CST
- 完成内容：完成 README `# 一`~`# 六` 导航化整合（不提交）。
  - 新增设计文档：`doc/readme-section1-6-navigation-consolidation.md`。
  - 新增项目管理文档：`doc/readme-section1-6-navigation-consolidation.project.md`。
  - `README.md`：将 1~6 统一为“摘要 + 细则入口”的一致结构，并在章节顶部集中声明文档分工（世界规则/运行说明/测试手册）。
- 测试：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world --features test_tier_required`
- 遗留事项：
  - 无。

- 日期：2026-02-19
- 时刻：2026-02-19 12:56:53 CST
- 完成内容：完成 README 章节层级修正（章节标题改为二级）。
  - `README.md`：`世界设定与运行机制补充说明` 与 `一~六` 章节标题由一级改为二级；各节 `摘要` 由二级改为三级，层级关系与目录语义一致。
  - `doc/readme-section1-6-navigation-consolidation.project.md`：新增并完成 T3（层级规范修正）。
- 测试：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world --features test_tier_required`
- 遗留事项：
  - 无。

- 日期：2026-02-19
- 时刻：2026-02-19 12:58:39 CST
- 完成内容：完成未提交设计/项目管理文档合并（3 组合并为 1 组）。
  - 新增统一设计文档：`doc/readme-world-rules-consolidation.md`。
  - 新增统一项目管理文档：`doc/readme-world-rules-consolidation.project.md`。
  - 删除并并入的文档：
    - `doc/readme-world-config-summary-link.md`
    - `doc/readme-world-config-summary-link.project.md`
    - `doc/readme-sim-wasm-sandbox-consolidation.md`
    - `doc/readme-sim-wasm-sandbox-consolidation.project.md`
    - `doc/readme-section1-6-navigation-consolidation.md`
    - `doc/readme-section1-6-navigation-consolidation.project.md`
- 时刻：2026-02-19 12:21:54 CST
- 完成内容：完成“Builtin Wasm Canonical 构建环境固化（Docker/容器化路线停止推进）”收口标记。
  - `doc/scripts/builtin-wasm-canonical-build-environment.md`：文档标题改为“已终止”，新增终止说明，明确 Docker/Podman 容器化 canonical builder 路线不再推进，并指向 nightly build-std 替代路线。
  - `doc/scripts/builtin-wasm-canonical-build-environment.project.md`：将 CBE-3~CBE-9 统一标记为“已取消（2026-02-19）”，状态改为“已终止”。
  - 代码残留检查：检索后未发现已落地的 Docker/容器化 canonical builder 代码或脚本（仅存在文档方案描述）。
- 测试：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world --features test_tier_required`
- 遗留事项：
  - 无。

- 日期：2026-02-19
- 时刻：2026-02-19 13:15:38 CST
- 完成内容：完成 WASM 主链路收口任务 T0（文档建档）。
  - 新增设计文档：`doc/readme-gap-wasm-live-persistence-instance-upgrade.md`。
  - 新增项目管理文档：`doc/readme-gap-wasm-live-persistence-instance-upgrade.project.md`。
  - 项目状态初始化：T0 完成，T1~T4 待执行（进入 T1）。
- 测试：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world --features test_tier_required`
- 遗留事项：
  - 执行 T1：live/bridge 主循环切换到 `step_with_modules` 并补 required-tier 端到端测试。

- 日期：2026-02-19
- 时刻：2026-02-19 13:22:54 CST
- 完成内容：完成 README WASM 主链路收口 T1（live/bridge 主循环切换到 `step_with_modules` + required-tier e2e 用例）。
  - `crates/agent_world/src/bin/world_viewer_live/execution_bridge.rs`：
    - `NodeRuntimeExecutionDriver` 注入并持有 `ModuleSandbox`，默认使用 `WasmExecutor`。
    - `on_commit` 的执行步从 `step()` 切换到 `step_with_modules(&mut sandbox)`，确保 committed action 回放后触发模块执行管线。
    - `bridge_committed_heights(...)` 增加 sandbox 参数并切换到模块执行步。
    - 补充 required-tier 用例 `node_runtime_execution_driver_commit_routes_modules_via_step_with_modules`，通过注入失败 sandbox 断言 commit 路径确实经由模块执行。
  - `crates/agent_world/src/bin/world_viewer_live.rs`：reward runtime bridge 路径新增 `WasmExecutor` 实例并传入 `bridge_committed_heights(...)`，与 live 驱动保持同口径。
  - `doc/readme-gap-wasm-live-persistence-instance-upgrade.project.md`：回写 T1 完成，阶段切换到 T2。
- 测试：
  - `env -u RUSTC_WRAPPER cargo fmt --all`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live node_runtime_execution_driver_commit_routes_modules_via_step_with_modules`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live bridge_committed_heights_persists_records_and_state`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live execution_bridge::tests::`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world --features test_tier_required`
- 遗留事项：
  - 执行 T2：将 `save_to_dir/load_from_dir` 默认路径升级为 module store 闭环（兼容旧目录）。
