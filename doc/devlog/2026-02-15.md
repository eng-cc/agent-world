- 日期：2026-02-15
- 完成内容：完成 V2D2（2D 标签可读性增强）。
  - 在 `crates/agent_world_viewer/src/label_lod.rs` 增加按 `ViewerCameraMode` 分支的 LOD 参数策略，2D 模式放宽可见距离、标签容量和遮挡配额，3D 模式保持既有策略。
  - 补充测试 `label_lod_params_two_d_are_more_permissive`，并在已有 label LOD 测试中显式注入 `ViewerCameraMode` 资源。
  - 更新项目文档状态：
    - `doc/world-simulator/viewer-2d-visual-polish.project.md`（V2D2.1~V2D2.3 勾选完成）
    - `doc/world-simulator.project.md`（Viewer 2D 可视化精修任务 2 勾选完成）
- 完成内容：执行并通过回归验证（test_tier_required 本任务最小闭环）。
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer label_lod -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer label_lod_params_two_d_are_more_permissive -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
  - `./scripts/capture-viewer-frame.sh --scenario llm_bootstrap --addr 127.0.0.1:5023 --tick-ms 300 --viewer-wait 12 --capture-max-wait 90 --no-prewarm`
- 遗留事项：当前 Viewer 2D 可视化精修 V2D0~V2D2 已完成；如仍存在“2D 过于简陋”反馈，进入下一轮精修需求拆解（新增文档与任务）。

- 日期：2026-02-15
- 完成内容：新增 V2D3（流向层工业化表达）任务定义并挂载总项目文档。
  - 更新设计文档 `doc/world-simulator/viewer-2d-visual-polish.md`：补充 2D flow overlay 平面化、线宽增强、终点箭头头部设计。
  - 更新项目文档 `doc/world-simulator/viewer-2d-visual-polish.project.md`：新增 V2D3.1~V2D3.3 任务拆解。
  - 更新总项目文档 `doc/world-simulator.project.md`：新增“Viewer 2D 可视化精修任务 3”入口。
- 完成内容：执行并通过文档任务最小回归。
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
- 遗留事项：继续执行 V2D3 代码落地（flow overlay 2D 参数分支 + 箭头头部），并补齐测试与截图闭环。

- 日期：2026-02-15
- 完成内容：完成 V2D3（2D 流向层工业化表达）代码落地。
  - 修改 `crates/agent_world_viewer/src/world_overlay.rs`：
    - `update_world_overlays_3d` 按 `ViewerCameraMode` 渲染 flow。
    - 2D 模式下将 flow 统一到平面高度并增强线宽。
    - 新增 flow 终点箭头头部渲染（`overlay:flow:arrow`），Power/Trade 复用现有材质语义色。
  - 新增单测：
    - `flow_render_profile_two_d_flattens_and_boosts_thickness`
    - `flow_arrow_transform_tip_matches_segment_target`
  - 更新项目文档状态：
    - `doc/world-simulator/viewer-2d-visual-polish.project.md`（V2D3.1~V2D3.3 勾选完成）
    - `doc/world-simulator.project.md`（Viewer 2D 可视化精修任务 3 勾选完成）
- 完成内容：执行并通过回归验证（test_tier_required 本任务最小闭环）。
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer world_overlay::tests:: -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
  - `./scripts/capture-viewer-frame.sh --scenario llm_bootstrap --addr 127.0.0.1:5023 --tick-ms 300 --viewer-wait 12 --capture-max-wait 90 --no-prewarm`
- 遗留事项：当前 V2D0~V2D3 已完成；若仍需提升 2D 工业感，下一步建议增加“链路负载数字标注/节点聚类层级”任务。

- 日期：2026-02-15
- 完成内容：完成 Viewer 缩放上限放开，解决大场景下“无法拉远看全貌”问题。
  - 修改 `crates/agent_world_viewer/src/main.rs`：将 `ORBIT_MAX_RADIUS` 从 `300.0` 提升到 `5_000.0`。
  - 修改 `crates/agent_world_viewer/src/camera_controls.rs`：将 2D 正交缩放上限 `ORTHO_MAX_SCALE` 从 `8.0` 提升到 `128.0`。
  - 修改 `crates/agent_world_viewer/src/viewer_automation.rs`：同步自动化缩放上限 `AUTOMATION_ORTHO_MAX_SCALE` 到 `128.0`，保证截图闭环路径一致。
  - 新增测试：
    - `two_d_ortho_scale_supports_large_zoom_out`
    - `apply_orbit_input_zoom_out_clamps_to_expanded_max_radius`
  - 更新项目文档状态：
    - `doc/world-simulator/viewer-open-world-sandbox-readiness.project.md`（新增并勾选 OWR3.8）
- 完成内容：执行并通过回归验证（test_tier_required 本任务最小闭环）。
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer camera_controls::tests:: -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
  - `./scripts/capture-viewer-frame.sh --scenario llm_bootstrap --addr 127.0.0.1:5023 --tick-ms 300 --viewer-wait 12 --capture-max-wait 120 --automation-steps "zoom=80" --no-prewarm`
- 遗留事项：当前闭环截图可稳定产出；若后续仍出现“全貌不完整”，建议在下一任务中增加“按场景包围盒自动初始缩放”策略，避免依赖手工缩放。

- 日期：2026-02-15
- 完成内容：完成缩放常量去重，改为单一来源。
  - 在 `crates/agent_world_viewer/src/main.rs` 新增共享常量：`ORTHO_MIN_SCALE`、`ORTHO_MAX_SCALE`。
  - 在 `crates/agent_world_viewer/src/camera_controls.rs` 移除本地 `ORTHO_*` 定义，改为引用父模块共享常量。
  - 在 `crates/agent_world_viewer/src/viewer_automation.rs` 移除 `AUTOMATION_ORTHO_*` 定义，自动化缩放改为与手动缩放共用 `ORTHO_*` 边界。
  - 更新项目文档状态：
    - `doc/world-simulator/viewer-open-world-sandbox-readiness.project.md`（新增并勾选 OWR3.9）
- 完成内容：执行并通过回归验证（test_tier_required 本任务最小闭环）。
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer camera_controls::tests:: -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer viewer_automation::tests:: -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
- 遗留事项：`agent_world_viewer` 仍存在既有未使用 import 警告（`selection_emphasis.rs`），与本任务无关，后续可单独清理。

- 日期：2026-02-15
- 完成内容：完成 QAG2/QAG3（Viewer 事件联动“快速定位 Agent”按钮）代码落地。
  - 修改 `crates/agent_world_viewer/src/selection_linking.rs`：新增 `quick_locate_agent_action`（优先定位当前选中 Agent，否则定位字典序首个 Agent），并补充按钮组件与标签刷新逻辑。
  - 修改 `crates/agent_world_viewer/src/egui_right_panel.rs`：在 Event Link 区新增“定位 Agent / Locate Agent”按钮并接入快速定位动作。
  - 修改 `crates/agent_world_viewer/src/ui_locale_text.rs`：新增 `quick_locate_agent_label`，并补充联动状态文案的中文映射。
  - 修改 `crates/agent_world_viewer/src/selection_linking/tests.rs`：新增快速定位行为测试，并更新事件联动按钮布局/标签测试覆盖。
  - 更新项目文档状态：`doc/world-simulator/viewer-agent-quick-locate.project.md`（QAG2~QAG4 勾选完成）。
- 完成内容：完成 QAG4/QAG5 回归与文档收口。
  - 更新 `doc/world-simulator.project.md`：勾选“Viewer 事件联动新增快速定位 Agent 按钮”。
  - 更新 `doc/world-simulator/viewer-agent-quick-locate.project.md`：QAG5 勾选完成，状态改为已完成。
  - 执行并通过回归验证（test_tier_required 本任务最小闭环）：
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer selection_linking::tests:: -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer ui_locale_text -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
  - 提交钩子附带执行并通过：`env -u RUSTC_WRAPPER cargo test -p agent_world --tests --features test_tier_required`。
- 遗留事项：`agent_world_viewer` 仍有既有未使用 import 警告（`selection_emphasis.rs`），与本任务无关，后续可单独清理。

- 日期：2026-02-15
- 完成内容：补齐快速定位 Agent 按钮的旧 UI 系统调度接线。
  - 修改 `crates/agent_world_viewer/src/app_bootstrap.rs`：在 Update 链中接入 `selection_linking::handle_quick_locate_agent_button`。
  - 修改 `crates/agent_world_viewer/src/selection_linking.rs`：移除临时 `dead_code` 抑制属性。
  - 执行并通过回归：
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer selection_linking::tests:: -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
- 遗留事项：`agent_world_viewer` 仍有既有未使用 import 警告（`selection_emphasis.rs`），与本任务无关。
