- 日期：2026-02-15
- 完成内容：完成 V2D2（2D 标签可读性增强）。
  - 在 `crates/agent_world_viewer/src/label_lod.rs` 增加按 `ViewerCameraMode` 分支的 LOD 参数策略，2D 模式放宽可见距离、标签容量和遮挡配额，3D 模式保持既有策略。
  - 补充测试 `label_lod_params_two_d_are_more_permissive`，并在已有 label LOD 测试中显式注入 `ViewerCameraMode` 资源。
  - 更新项目文档状态：
    - `doc/world-simulator/viewer-2d-visual-polish.project.md`（V2D2.1~V2D2.3 勾选完成）
    - `doc/world-simulator.project.md`（Viewer 2D 可视化精修任务 2 勾选完成）
- 完成内容：执行并通过回归验证（test_tier_required 本任务最小闭环）。
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer label_lod -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer label_lod_params_two_d_are_more_permissive -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
  - `./scripts/capture-viewer-frame.sh --scenario llm_bootstrap --addr 127.0.0.1:5023 --tick-ms 300 --viewer-wait 12 --capture-max-wait 90 --no-prewarm`
- 遗留事项：当前 Viewer 2D 可视化精修 V2D0~V2D2 已完成；如仍存在“2D 过于简陋”反馈，进入下一轮精修需求拆解（新增文档与任务）。

- 日期：2026-02-15
- 完成内容：新增 V2D3（流向层工业化表达）任务定义并挂载总项目文档。
  - 更新设计文档 `doc/world-simulator/viewer-2d-visual-polish.md`：补充 2D flow overlay 平面化、线宽增强、终点箭头头部设计。
  - 更新项目文档 `doc/world-simulator/viewer-2d-visual-polish.project.md`：新增 V2D3.1~V2D3.3 任务拆解。
  - 更新总项目文档 `doc/world-simulator.project.md`：新增“Viewer 2D 可视化精修任务 3”入口。
- 完成内容：执行并通过文档任务最小回归。
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
- 遗留事项：继续执行 V2D3 代码落地（flow overlay 2D 参数分支 + 箭头头部），并补齐测试与截图闭环。

- 日期：2026-02-15
- 完成内容：完成 V2D3（2D 流向层工业化表达）代码落地。
  - 修改 `crates/agent_world_viewer/src/world_overlay.rs`：
    - `update_world_overlays_3d` 按 `ViewerCameraMode` 渲染 flow。
    - 2D 模式下将 flow 统一到平面高度并增强线宽。
    - 新增 flow 终点箭头头部渲染（`overlay:flow:arrow`），Power/Trade 复用现有材质语义色。
  - 新增单测：
    - `flow_render_profile_two_d_flattens_and_boosts_thickness`
    - `flow_arrow_transform_tip_matches_segment_target`
  - 更新项目文档状态：
    - `doc/world-simulator/viewer-2d-visual-polish.project.md`（V2D3.1~V2D3.3 勾选完成）
    - `doc/world-simulator.project.md`（Viewer 2D 可视化精修任务 3 勾选完成）
- 完成内容：执行并通过回归验证（test_tier_required 本任务最小闭环）。
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer world_overlay::tests:: -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
  - `./scripts/capture-viewer-frame.sh --scenario llm_bootstrap --addr 127.0.0.1:5023 --tick-ms 300 --viewer-wait 12 --capture-max-wait 90 --no-prewarm`
- 遗留事项：当前 V2D0~V2D3 已完成；若仍需提升 2D 工业感，下一步建议增加“链路负载数字标注/节点聚类层级”任务。

- 日期：2026-02-15
- 完成内容：完成 Viewer 缩放上限放开，解决大场景下“无法拉远看全貌”问题。
  - 修改 `crates/agent_world_viewer/src/main.rs`：将 `ORBIT_MAX_RADIUS` 从 `300.0` 提升到 `5_000.0`。
  - 修改 `crates/agent_world_viewer/src/camera_controls.rs`：将 2D 正交缩放上限 `ORTHO_MAX_SCALE` 从 `8.0` 提升到 `128.0`。
  - 修改 `crates/agent_world_viewer/src/viewer_automation.rs`：同步自动化缩放上限 `AUTOMATION_ORTHO_MAX_SCALE` 到 `128.0`，保证截图闭环路径一致。
  - 新增测试：
    - `two_d_ortho_scale_supports_large_zoom_out`
    - `apply_orbit_input_zoom_out_clamps_to_expanded_max_radius`
  - 更新项目文档状态：
    - `doc/world-simulator/viewer-open-world-sandbox-readiness.project.md`（新增并勾选 OWR3.8）
- 完成内容：执行并通过回归验证（test_tier_required 本任务最小闭环）。
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer camera_controls::tests:: -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
  - `./scripts/capture-viewer-frame.sh --scenario llm_bootstrap --addr 127.0.0.1:5023 --tick-ms 300 --viewer-wait 12 --capture-max-wait 120 --automation-steps "zoom=80" --no-prewarm`
- 遗留事项：当前闭环截图可稳定产出；若后续仍出现“全貌不完整”，建议在下一任务中增加“按场景包围盒自动初始缩放”策略，避免依赖手工缩放。

- 日期：2026-02-15
- 完成内容：完成缩放常量去重，改为单一来源。
  - 在 `crates/agent_world_viewer/src/main.rs` 新增共享常量：`ORTHO_MIN_SCALE`、`ORTHO_MAX_SCALE`。
  - 在 `crates/agent_world_viewer/src/camera_controls.rs` 移除本地 `ORTHO_*` 定义，改为引用父模块共享常量。
  - 在 `crates/agent_world_viewer/src/viewer_automation.rs` 移除 `AUTOMATION_ORTHO_*` 定义，自动化缩放改为与手动缩放共用 `ORTHO_*` 边界。
  - 更新项目文档状态：
    - `doc/world-simulator/viewer-open-world-sandbox-readiness.project.md`（新增并勾选 OWR3.9）
- 完成内容：执行并通过回归验证（test_tier_required 本任务最小闭环）。
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer camera_controls::tests:: -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer viewer_automation::tests:: -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
- 遗留事项：`agent_world_viewer` 仍存在既有未使用 import 警告（`selection_emphasis.rs`），与本任务无关，后续可单独清理。

- 日期：2026-02-15
- 完成内容：完成 QAG2/QAG3（Viewer 事件联动“快速定位 Agent”按钮）代码落地。
  - 修改 `crates/agent_world_viewer/src/selection_linking.rs`：新增 `quick_locate_agent_action`（优先定位当前选中 Agent，否则定位字典序首个 Agent），并补充按钮组件与标签刷新逻辑。
  - 修改 `crates/agent_world_viewer/src/egui_right_panel.rs`：在 Event Link 区新增“定位 Agent / Locate Agent”按钮并接入快速定位动作。
  - 修改 `crates/agent_world_viewer/src/ui_locale_text.rs`：新增 `quick_locate_agent_label`，并补充联动状态文案的中文映射。
  - 修改 `crates/agent_world_viewer/src/selection_linking/tests.rs`：新增快速定位行为测试，并更新事件联动按钮布局/标签测试覆盖。
  - 更新项目文档状态：`doc/world-simulator/viewer-agent-quick-locate.project.md`（QAG2~QAG4 勾选完成）。
- 完成内容：完成 QAG4/QAG5 回归与文档收口。
  - 更新 `doc/world-simulator.project.md`：勾选“Viewer 事件联动新增快速定位 Agent 按钮”。
  - 更新 `doc/world-simulator/viewer-agent-quick-locate.project.md`：QAG5 勾选完成，状态改为已完成。
  - 执行并通过回归验证（test_tier_required 本任务最小闭环）：
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer selection_linking::tests:: -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer ui_locale_text -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
  - 提交钩子附带执行并通过：`env -u RUSTC_WRAPPER cargo test -p agent_world --tests --features test_tier_required`。
- 遗留事项：`agent_world_viewer` 仍有既有未使用 import 警告（`selection_emphasis.rs`），与本任务无关，后续可单独清理。

- 日期：2026-02-15
- 完成内容：补齐快速定位 Agent 按钮的旧 UI 系统调度接线。
  - 修改 `crates/agent_world_viewer/src/app_bootstrap.rs`：在 Update 链中接入 `selection_linking::handle_quick_locate_agent_button`。
  - 修改 `crates/agent_world_viewer/src/selection_linking.rs`：移除临时 `dead_code` 抑制属性。
  - 执行并通过回归：
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer selection_linking::tests:: -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
- 遗留事项：`agent_world_viewer` 仍有既有未使用 import 警告（`selection_emphasis.rs`），与本任务无关。

- 日期：2026-02-15
- 完成内容：新增“Viewer 2D/3D 可视化清晰度修复”文档与任务挂载。
  - 新增设计文档：`doc/world-simulator/viewer-2d-3d-clarity-fix.md`。
  - 新增项目管理文档：`doc/world-simulator/viewer-2d-3d-clarity-fix.project.md`。
  - 更新总项目文档：`doc/world-simulator.project.md`，新增清晰度修复任务 1~3 入口。
- 遗留事项：继续执行 CFX2（Location 尺度映射修复）并补齐测试与回归截图。

- 日期：2026-02-15
- 完成内容：完成 CFX2（Location 渲染尺度映射修复）。
  - 修改 `crates/agent_world_viewer/src/scene_helpers.rs`：Location 实体缩放从“米口径”改为按 `radius_cm * cm_to_unit` 的 world unit 映射，并增加渲染半径上下限钳制，避免 `llm_bootstrap` 场景中大体量碎片遮屏。
  - 新增测试：`location_render_radius_units_scales_by_world_units_and_clamps`。
  - 更新项目文档状态：
    - `doc/world-simulator/viewer-2d-3d-clarity-fix.project.md`（CFX2.1/CFX2.2 勾选完成）
    - `doc/world-simulator.project.md`（清晰度修复任务 1 勾选完成）
- 完成内容：执行并通过回归验证（test_tier_required 本任务最小闭环）。
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer location_render_radius_units_scales_by_world_units_and_clamps -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
  - `./scripts/capture-viewer-frame.sh --scenario llm_bootstrap --addr 127.0.0.1:5023 --tick-ms 300 --viewer-wait 12 --capture-max-wait 120 --no-prewarm --keep-tmp`
  - `./scripts/capture-viewer-frame.sh --scenario llm_bootstrap --addr 127.0.0.1:5023 --tick-ms 300 --viewer-wait 12 --capture-max-wait 120 --automation-steps "mode=3d;wait=0.8" --no-prewarm --keep-tmp`
- 遗留事项：继续执行 CFX3（2D 自动聚焦缩放同步），解决 2D 自动聚焦半径变化未同步正交投影问题。

- 日期：2026-02-15
- 完成内容：完成 CFX3（2D 自动聚焦缩放同步）。
  - 修改 `crates/agent_world_viewer/src/camera_controls.rs`：将 2D 正交缩放同步函数提升为模块内可复用接口。
  - 修改 `crates/agent_world_viewer/src/auto_focus.rs`：2D 模式自动聚焦写入 `orbit.radius` 后，同步正交投影 `scale`；若投影类型异常则回填 2D 正交投影。
  - 新增测试：`apply_focus_to_camera_syncs_two_d_projection_scale_with_radius`。
  - 更新项目文档状态：
    - `doc/world-simulator/viewer-2d-3d-clarity-fix.project.md`（CFX3.1/CFX3.2 勾选完成）
    - `doc/world-simulator.project.md`（清晰度修复任务 2 勾选完成）
- 完成内容：执行并通过回归验证（test_tier_required 本任务最小闭环）。
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer apply_focus_to_camera_syncs_two_d_projection_scale_with_radius -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
  - `./scripts/capture-viewer-frame.sh --scenario llm_bootstrap --addr 127.0.0.1:5023 --tick-ms 300 --viewer-wait 12 --capture-max-wait 120 --auto-focus-target first_fragment --auto-focus-radius 5000 --auto-focus-keep-2d --no-prewarm --keep-tmp`
- 遗留事项：继续执行 CFX4（默认信息密度收敛），并做最终截图回归对照收口。

- 日期：2026-02-15
- 完成内容：完成 CFX4（默认信息密度收敛与回归收口）。
  - 修改 `crates/agent_world_viewer/src/right_panel_module_visibility.rs`：调整右侧模块默认可见性，保留核心区块（controls/overview/event_link），默认收起 overlay/diagnosis/timeline/details。
  - 更新测试：`visibility_defaults_to_core_sections`，并保持持久化兼容用例通过。
  - 更新项目文档状态：
    - `doc/world-simulator/viewer-2d-3d-clarity-fix.project.md`（CFX4.1~CFX4.3 勾选完成，状态收口）
    - `doc/world-simulator.project.md`（清晰度修复任务 3 勾选完成）
- 完成内容：执行并通过回归验证（test_tier_required 本任务最小闭环）。
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer right_panel_module_visibility -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
  - `./scripts/capture-viewer-frame.sh --scenario llm_bootstrap --addr 127.0.0.1:5023 --tick-ms 300 --viewer-wait 12 --capture-max-wait 120 --no-prewarm --keep-tmp`
- 遗留事项：清晰度修复 CFX1~CFX4 已完成；若后续仍有“3D 线框干扰”反馈，可新增“3D 世界网格默认隐藏/分级显示”任务。

- 日期：2026-02-15
- 完成内容：新增“Viewer 默认渲染 Frag 且不渲染 Location”设计与项目管理文档。
  - 新增设计文档：`doc/world-simulator/viewer-frag-default-rendering.md`。
  - 新增项目管理文档：`doc/world-simulator/viewer-frag-default-rendering.project.md`（FDR1 勾选完成，进入 FDR2）。
- 完成内容：执行文档任务回归检查。
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
- 遗留事项：继续执行 FDR2/FDR3（代码改造与测试补齐）。

- 日期：2026-02-15
- 完成内容：完成 FDR2~FDR5（Viewer 默认渲染 Frag 且不渲染 Location）代码与文档收口。
  - 渲染路径改造：`location` 仅保留锚点实体（不再渲染外层 mesh/label 及 detail 子节点），`frag` 分块默认渲染，移除 frag 渲染开关与环境变量入口。
  - 选择与详情改造：新增 `FragmentElementMarker` 并接入 3D 选择链路；新增 `SelectionKind::Fragment`，详情面板新增 frag 分支，显示所属 `location`（ID 与名称）。
  - UI/配置改造：移除右侧面板 fragment 渲染开关；更新 overlay 配置结构与降级默认配置构造。
  - 测试更新：
    - 修复/更新 `tests_scene_entities` 以匹配“location 不可视、仅锚点”语义。
    - 新增 `rebuild_scene_spawns_fragments_by_default_without_location_mesh`。
    - 新增 `update_ui_populates_fragment_selection_details_with_owner_location`。
    - 修复 `egui_kittest_module_toggle_switches_visibility` 的默认状态断言。
  - 文档更新：`doc/viewer-manual.md` 移除 frag 开关/环境变量描述，更新为“默认渲染 frag + frag 详情显示所属 location”。
  - 项目文档状态：`doc/world-simulator/viewer-frag-default-rendering.project.md` 勾选 FDR2~FDR5 并标记完成。
- 完成内容：执行并通过回归验证（test_tier_required）。
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
- 遗留事项：`agent_world_viewer` 存在既有未使用代码/导入告警（location detail 旧渲染辅助与材质句柄），与本任务目标无冲突，后续可单独清理。

- 日期：2026-02-15
- 完成内容：完成 Viewer 编译告警清理（`agent_world_viewer` warning=0）。
  - 清理 `scene_helpers` / `scene_helpers_entities` 中已失效的 Location detail 遗留代码（未使用常量、函数与导入），保留当前“location 仅锚点 + frag 默认渲染”语义。
  - 清理 `selection_emphasis.rs` 未使用导入（仅保留运行时依赖，测试改为显式导入 `SelectionInfo/SelectionKind`）。
  - 清理 `Viewer3dAssets` 中未使用的 `location_material_library` 依赖链；同步精简 `material_library.rs` 中仅测试侧使用的旧 location 材质构建逻辑。
  - 同步更新测试构造：`tests_scene_entities.rs`、`tests_scene_grid.rs` 移除已删除字段初始化。
  - 更新项目文档状态：
    - `doc/world-simulator/viewer-frag-default-rendering.project.md`（新增并勾选 FDR6）
    - `doc/world-simulator.project.md`（新增并勾选 Viewer 编译告警清理项）
- 完成内容：执行并通过回归验证（test_tier_required 本任务最小闭环）。
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer`
- 遗留事项：当前 `agent_world_viewer` 编译告警已清零；后续若重新引入 location 细节渲染，需以新任务重新设计并接入最小可验证测试。

- 日期：2026-02-15
- 完成内容：新增“Viewer Frag 实际比例与选中显示修复”文档与任务挂载。
  - 新增设计文档：`doc/world-simulator/viewer-frag-scale-selection-fix.md`。
  - 新增项目管理文档：`doc/world-simulator/viewer-frag-scale-selection-fix.project.md`（FSF1.1/FSF1.2 勾选完成）。
  - 更新总项目文档：`doc/world-simulator.project.md`，新增 frag 比例修复与选中显示修复任务入口。
- 完成内容：执行文档任务最小回归。
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
- 遗留事项：继续执行 FSF2（frag 尺度线性映射 + 选中显示修复）并补齐测试回归。

- 日期：2026-02-15
- 完成内容：完成 FSF2（frag 实际比例与选中显示修复）代码落地。
  - 修改 `crates/agent_world_viewer/src/scene_helpers.rs`：`location_render_radius_units` 改为 `radius_cm * cm_to_unit` 线性映射，移除渲染钳制，确保 frag 尺寸比例与数据口径一致。
  - 修改 `crates/agent_world_viewer/src/location_fragment_render.rs`：frag 分块实体新增 `BaseScale`（取初始 `Transform.scale`），修复选中高亮后比例被覆盖、取消选中无法恢复的问题。
  - 修改测试：
    - `crates/agent_world_viewer/src/tests_scene_entities.rs`：`spawn_location_entity_uses_linear_anchor_radius_scale`。
    - `crates/agent_world_viewer/src/tests_scene_grid.rs`：新增 `rebuild_scene_fragment_entities_preserve_base_scale_for_selection_reset`。
    - `crates/agent_world_viewer/src/scene_helpers.rs`：更新尺度映射单测为无钳制口径。
  - 更新项目文档状态：
    - `doc/world-simulator/viewer-frag-scale-selection-fix.project.md`（FSF2~FSF4 勾选完成，状态收口）。
    - `doc/world-simulator.project.md`（frag 比例修复与选中显示修复勾选完成）。
- 完成内容：执行并通过回归验证（test_tier_required）。
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer location_render_radius_units_scales_by_world_units_without_clamp -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer rebuild_scene_fragment_entities_preserve_base_scale_for_selection_reset -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer spawn_location_entity_uses_linear_anchor_radius_scale -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
- 遗留事项：FSF1~FSF4 已完成；若后续仍有“超大 frag 首屏压画面”反馈，可新增“真实尺度 + 视图辅助层”任务，不回退数据比例。

- 日期：2026-02-15
- 完成内容：完成 FSF5（二次修复：误选与选中缩放）代码落地。
  - 修改 `crates/agent_world_viewer/src/selection_linking.rs`：`pick_3d_selection` 的 location 拾取改为 `With<Mesh3d>` 过滤，避免点击时误选不可见 location 锚点。
  - 修改 `crates/agent_world_viewer/src/scene_helpers.rs`：新增 `should_apply_scale_highlight`，对 `SelectionKind::Fragment` 返回 false。
  - 修改 `crates/agent_world_viewer/src/main.rs`、`crates/agent_world_viewer/src/selection_linking.rs`、`crates/agent_world_viewer/src/event_click_list.rs`：高亮逻辑按 `should_apply_scale_highlight` 分支，frag 选中不再缩放，保持真实比例。
  - 新增/更新测试：
    - `selection_linking::tests::apply_selection_does_not_scale_fragment_entity`
    - `scene_helpers::depletion_tests::should_apply_scale_highlight_skips_fragment`
  - 更新项目文档状态：
    - `doc/world-simulator/viewer-frag-scale-selection-fix.project.md`（FSF5.1~FSF5.3 勾选完成）。
    - `doc/world-simulator.project.md`（新增并勾选 frag 二次修复项）。
- 完成内容：执行并通过回归验证（test_tier_required）。
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer apply_selection_does_not_scale_fragment_entity -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer should_apply_scale_highlight_skips_fragment -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
- 遗留事项：FSF1~FSF5 已完成；若仍出现“点击不稳定”，下一步建议把点选由“点到线距离”升级为“包围体射线命中”以进一步提升稳定性。

- 日期：2026-02-15
- 完成内容：完成 FSF6（frag 三次修复：去掉黄色 halo + Agent 量纲修正）代码落地。
  - 修改 `crates/agent_world_viewer/src/selection_emphasis.rs`：`SelectionKind::Fragment` 选中时不再显示 selection halo，并补充 `selection_emphasis_hides_halo_for_fragment_selection`。
  - 修改 `crates/agent_world_viewer/src/scene_helpers.rs`：Agent 几何尺寸（主体、模块环、标签偏移、附着位置）统一按 `effective_cm_to_unit` 映射至世界单位，修复与 frag/位置半径量纲不一致问题。
  - 修改 `crates/agent_world_viewer/src/scene_helpers_entities.rs`：2D Agent 地图标记的半径/厚度/偏移统一按世界单位缩放。
  - 修改 `crates/agent_world_viewer/src/tests_scene_entities.rs`：更新 Agent 尺寸与位置断言，按 `effective_cm_to_unit` 推导期望值，避免旧米制常量导致误判。
  - 更新项目文档状态：
    - `doc/world-simulator/viewer-frag-scale-selection-fix.project.md`（勾选 FSF6.1~FSF6.3，标记 FSF1~FSF6 已完成）
    - `doc/world-simulator.project.md`（勾选“Viewer Frag 三次修复”）
- 完成内容：执行并通过回归验证（test_tier_required）。
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
- 遗留事项：若后续反馈“真实尺度下目标过小导致点选难度上升”，建议新增“非侵入式辅助视觉层”任务（仅辅助显示，不改真实尺度）。

- 日期：2026-02-15
- 完成内容：完成 FSF7（相机缩放/裁剪量纲修复，恢复 Agent 放大可见性）代码落地。
  - 修改 `/Users/scc/ccwork/agent-world/crates/agent_world_viewer/src/camera_controls.rs`：
    - 新增 `orbit_min_radius(cm_to_unit)`，将 Orbit 最小半径按 `effective_cm_to_unit` 映射到世界单位，修复默认最小半径过大导致无法靠近 Agent。
    - 调整 `camera_projection_for_mode`：近裁剪面按世界单位缩放，远裁剪面按“物理 far 映射值 vs 世界视野兜底值”取较大值，避免放大时近裁剪吞掉小尺度实体。
    - 更新相机相关单测，新增 `camera_projection_scales_near_and_keeps_far_covering_world`、`orbit_min_radius_scales_with_world_units`。
  - 修改 `/Users/scc/ccwork/agent-world/crates/agent_world_viewer/src/auto_focus.rs`：
    - 自动聚焦/快捷聚焦半径下限改为米制语义再映射至世界单位，避免聚焦逻辑把相机强制拉回“公里级半径”。
  - 修改 `/Users/scc/ccwork/agent-world/crates/agent_world_viewer/src/viewer_automation.rs`：
    - automation `ZoomFactor` 使用动态最小半径口径，和手动缩放行为对齐。
  - 更新项目文档状态：
    - `/Users/scc/ccwork/agent-world/doc/world-simulator/viewer-frag-scale-selection-fix.project.md`（FSF7.1~FSF7.3 勾选完成）
    - `/Users/scc/ccwork/agent-world/doc/world-simulator.project.md`（勾选 Viewer Frag 四次修复）
- 完成内容：执行并通过回归验证（test_tier_required）。
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
- 遗留事项：若后续在超大场景中仍反馈“目标可见但点选困难”，建议新增“可选辅助描边/图标层”任务，不改真实几何尺度。

- 日期：2026-02-15
- 完成内容：完成 OVZ1（Viewer 全览图缩放切换）文档任务初始化。
  - 新增设计文档：`/Users/scc/ccwork/agent-world/doc/world-simulator/viewer-overview-map-zoom.md`。
  - 新增项目管理文档：`/Users/scc/ccwork/agent-world/doc/world-simulator/viewer-overview-map-zoom.project.md`（OVZ1.1/OVZ1.2 勾选）。
  - 更新总项目文档：`/Users/scc/ccwork/agent-world/doc/world-simulator.project.md`，挂载全览图任务入口。
- 完成内容：执行文档任务最小回归。
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
- 遗留事项：继续执行 OVZ2/OVZ3（缩放层级状态机、可见性联动与测试收口）。

- 日期：2026-02-15
- 完成内容：完成 OVZ2/OVZ3（Viewer 全览图缩放切换）代码与回归。
  - 缩放层级机制：
    - 在 `/Users/scc/ccwork/agent-world/crates/agent_world_viewer/src/camera_controls.rs` 新增 `TwoDZoomTier`（`Detail/Overview`）与迟滞阈值判定（`sync_two_d_zoom_tier`）。
    - 2D 默认 orbit 半径改为细节态默认倍率（不再默认世界全宽视角）。
  - 全览图可见性联动：
    - `TwoDMapMarker` 改为仅在 `TwoD + Overview` 显示。
    - 新增 `DetailZoomEntity`（`/Users/scc/ccwork/agent-world/crates/agent_world_viewer/src/scene_helpers.rs`），在 `TwoD + Overview` 隐藏细节几何（Agent 细节与 frag 分块）。
    - `DetailZoomEntity` 接入 `spawn_agent_entity` 与 `/Users/scc/ccwork/agent-world/crates/agent_world_viewer/src/location_fragment_render.rs`。
  - 调度接入：
    - `/Users/scc/ccwork/agent-world/crates/agent_world_viewer/src/app_bootstrap.rs` 新增 `TwoDZoomTier` 资源并接入 `sync_two_d_zoom_tier/sync_two_d_map_marker_visibility/sync_detail_zoom_visibility` 系统顺序。
    - `/Users/scc/ccwork/agent-world/crates/agent_world_viewer/src/main.rs` 补充 `TwoDZoomTier` 导入供启动装配使用。
  - 测试更新：
    - 在 `camera_controls` 新增 `two_d_zoom_tier_switches_with_hysteresis`、`detail_zoom_visibility_hides_detail_entities_in_overview`，并更新 `two_d_map_marker_visibility_follows_zoom_tier`。
    - 全量 `agent_world_viewer` 测试从 211 增至 213，全部通过。
  - 项目文档更新：`/Users/scc/ccwork/agent-world/doc/world-simulator/viewer-overview-map-zoom.project.md` 勾选 OVZ2.1~OVZ3.2。
- 完成内容：执行并通过回归验证（test_tier_required）。
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
- 遗留事项：执行 OVZ4.1（总项目文档勾选与最终收口）。
