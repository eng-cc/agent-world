日期: 2026-02-14

完成内容:
1. 完成 M4 材料多账本与物流约束任务1（多账本基础与迁移）。
   - 新增 `MaterialLedgerId`（world/agent/site/factory）。
   - `WorldState` 新增 `material_ledgers`，并保留 `materials` 兼容字段。
   - `World::new_with_state` 接入旧状态迁移：旧快照中的 `materials` 自动迁移到 `world` ledger。
2. 完成 runtime 账本路由改造（建造/配方）。
   - `BuildFactory` 支持优先从 builder ledger 扣料，不足时回退 world ledger。
   - `ScheduleRecipe` 支持优先从 factory 输入 ledger 扣料，不足时回退 world ledger。
   - 配方产物在“从 world 扣料”时回写 world ledger，保持旧行为兼容；否则写入 factory 输出 ledger（默认 site ledger）。
3. 完成账本 API 与状态字段扩展。
   - `resources.rs` 新增 ledger 级材料接口：`ledger_material_balance`、`set_ledger_material_balance`、`adjust_ledger_material_balance`、`transfer_material_between_ledgers`。
   - `FactoryState` / `RecipeJobState` / `FactoryBuildJobState` 增加 ledger 字段并加 serde 默认值，保障旧 journal/snapshot 兼容读取。
4. 完成文档与测试。
   - 新增设计文档：`doc/world-simulator/material-multi-ledger-logistics.md`。
   - 新增项目管理文档：`doc/world-simulator/material-multi-ledger-logistics.project.md`（任务1标记完成）。
   - 新增/更新测试：
     - `runtime::tests::basic::new_world_migrates_legacy_world_materials_into_material_ledgers`
     - `runtime::tests::economy::build_factory_prefers_builder_material_ledger_when_available`
     - `runtime::tests::economy::schedule_recipe_reads_and_writes_site_material_ledger`
5. 验证通过。
   - `cargo fmt --all`
   - `env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::basic:: -- --nocapture`
   - `env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::economy:: -- --nocapture`

遗留事项:
1. 任务2待做：新增 `TransferMaterial` 与在途物流队列，补齐距离/损耗/延迟/吞吐约束。
2. 任务3待做：ABI 增加 `available_inputs_by_ledger`，并完成场景与文档收口。
