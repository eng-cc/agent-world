- 日期：2026-02-13
- 完成内容：推进 distributed crate split 二十二次扩展阶段，进一步消除 runtime 与新 crate 的重复实现：
  - `agent_world::runtime` 5 个模块改为直接复用新 crate 同源实现（`include!`）：
    - `crates/agent_world/src/runtime/distributed_net.rs`
    - `crates/agent_world/src/runtime/distributed_dht.rs`
    - `crates/agent_world/src/runtime/distributed_gateway.rs`
    - `crates/agent_world/src/runtime/distributed_lease.rs`
    - `crates/agent_world/src/runtime/distributed_mempool.rs`
  - 为支持跨 crate 同源复用，调整共享实现文件引用路径与导出可见性：
    - `crates/agent_world_net/src/network.rs`
    - `crates/agent_world_net/src/dht.rs`
    - `crates/agent_world_net/src/gateway.rs`
    - `crates/agent_world_net/src/lib.rs`
    - `crates/agent_world_consensus/src/lease.rs`
    - `crates/agent_world_consensus/src/mempool.rs`
  - `agent_world` 增加 `extern crate self as agent_world;`，使同源文件可统一通过 `agent_world::runtime::*` 路径解析：`crates/agent_world/src/lib.rs`
  - 回写设计/项目管理文档：
    - `doc/world-runtime/distributed-crate-split-net-consensus.md`
    - `doc/world-runtime/distributed-crate-split-net-consensus.project.md`
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_consensus`
  - `env -u RUSTC_WRAPPER cargo test --workspace`
- 遗留事项：继续下一阶段，把 `distributed_client/index/provider_cache/dht_cache` 等 runtime 模块继续收敛到同源复用，并评估彻底切到 crate 级直接依赖所需的循环依赖解除方案。

- 日期：2026-02-13
- 完成内容：推进 distributed crate split 二十三次扩展阶段，继续消除 runtime 与 `agent_world_net` 的重复实现：
  - `agent_world::runtime` 5 个模块改为直接复用 `agent_world_net` 同源实现（`include!`）：
    - `crates/agent_world/src/runtime/distributed_client.rs`
    - `crates/agent_world/src/runtime/distributed_index.rs`
    - `crates/agent_world/src/runtime/distributed_index_store.rs`
    - `crates/agent_world/src/runtime/distributed_provider_cache.rs`
    - `crates/agent_world/src/runtime/distributed_dht_cache.rs`
  - 为支持跨 crate 同源复用，调整 `agent_world_net` 对应模块引用路径到 `super::distributed_*` / `super::error` / `super::modules`，并补齐兼容 alias 导出：
    - `crates/agent_world_net/src/client.rs`
    - `crates/agent_world_net/src/index.rs`
    - `crates/agent_world_net/src/index_store.rs`
    - `crates/agent_world_net/src/provider_cache.rs`
    - `crates/agent_world_net/src/dht_cache.rs`
    - `crates/agent_world_net/src/lib.rs`
    - `crates/agent_world_net/src/util.rs`
  - 回写设计/项目管理文档：
    - `doc/world-runtime/distributed-crate-split-net-consensus.md`
    - `doc/world-runtime/distributed-crate-split-net-consensus.project.md`
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net`
  - `env -u RUSTC_WRAPPER cargo test --workspace`
- 遗留事项：继续下一阶段，把 `distributed_bootstrap/head_follow/observer/observer_replay/storage/validation` 模块收敛到同源复用，并逐步推进解除 `agent_world` 与新 crate 的循环依赖。

- 日期：2026-02-13
- 完成内容：推进 distributed crate split 二十四次扩展阶段，继续消除 runtime 与 `agent_world_net` 的重复实现：
  - `agent_world::runtime` 6 个模块改为直接复用 `agent_world_net` 同源实现（`include!`）：
    - `crates/agent_world/src/runtime/distributed_bootstrap.rs`
    - `crates/agent_world/src/runtime/distributed_head_follow.rs`
    - `crates/agent_world/src/runtime/distributed_observer.rs`
    - `crates/agent_world/src/runtime/distributed_observer_replay.rs`
    - `crates/agent_world/src/runtime/distributed_storage.rs`（保留 `ExecutionWriteConfig/ExecutionWriteResult` 类型定义）
    - `crates/agent_world/src/runtime/distributed_validation.rs`（保留 `HeadValidationResult` 类型定义）
  - 为支持跨 crate 同源复用，调整 `agent_world_net` 对应模块引用路径到 `super::distributed_*` / `super::blob_store` / `super::world` / `super::events` / `super::segmenter` / `super::snapshot` / `super::types` / `super::world_event`，并补齐兼容 alias 导出：
    - `crates/agent_world_net/src/bootstrap.rs`
    - `crates/agent_world_net/src/head_follow.rs`
    - `crates/agent_world_net/src/observer.rs`
    - `crates/agent_world_net/src/observer_replay.rs`
    - `crates/agent_world_net/src/execution_storage.rs`
    - `crates/agent_world_net/src/head_validation.rs`
    - `crates/agent_world_net/src/lib.rs`
  - 回写设计/项目管理文档：
    - `doc/world-runtime/distributed-crate-split-net-consensus.md`
    - `doc/world-runtime/distributed-crate-split-net-consensus.project.md`
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net`
  - `env -u RUSTC_WRAPPER cargo test --workspace`
- 遗留事项：继续下一阶段，把 `distributed_consensus` / `distributed_membership_sync` 等 runtime 模块收敛到同源复用，并逐步推进解除 `agent_world` 与新 crate 的循环依赖。

- 日期：2026-02-13
- 完成内容：推进 distributed crate split 二十五次扩展阶段，继续消除 runtime 与 `agent_world_consensus` 的重复实现：
  - `agent_world::runtime` 的 `distributed_consensus` 改为直接复用 `agent_world_consensus` 同源实现（`include!`）：
    - `crates/agent_world/src/runtime/distributed_consensus.rs`
  - 为支持跨 crate 同源复用，调整 `agent_world_consensus` 对应模块引用路径到 `super::distributed_*` / `super::error` / `super::util`，并补齐兼容 alias 导出：
    - `crates/agent_world_consensus/src/quorum.rs`
    - `crates/agent_world_consensus/src/lib.rs`
  - 回写设计/项目管理文档：
    - `doc/world-runtime/distributed-crate-split-net-consensus.md`
    - `doc/world-runtime/distributed-crate-split-net-consensus.project.md`
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_consensus`
  - `env -u RUSTC_WRAPPER cargo test --workspace`
- 遗留事项：继续下一阶段，把 `distributed_membership_sync` runtime 模块收敛到 `agent_world_consensus` 同源复用，并逐步推进解除 `agent_world` 与新 crate 的循环依赖。
- 完成内容：完成 BMS-35（runtime cutover 阶段一期收口）并执行回归验证：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_builtin_wasm`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::agent_default_modules::`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::power_bootstrap::`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features wasmtime runtime::tests::agent_default_modules::`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features wasmtime runtime::tests::power_bootstrap::`
- 完成内容：更新项目管理文档状态并标记 BMS-35 完成：
  - `doc/world-runtime/builtin-wasm-crate-split.project.md`
  - `doc/world-runtime.project.md`
- 遗留事项：进入 cutover 阶段二，按模块域逐步删除 runtime builtin fallback，优先收敛 `rule/body` 相关 builtin 路径。

- 日期：2026-02-13
- 完成内容：完成 BMS-36（cutover 阶段二设计扩展与任务拆解）：
  - 设计文档扩展阶段三目标与里程碑：`doc/world-runtime/builtin-wasm-crate-split.md`
  - 项目管理文档新增 BMS-36~BMS-39 任务并更新阶段状态：
    - `doc/world-runtime/builtin-wasm-crate-split.project.md`
    - `doc/world-runtime.project.md`
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::power_bootstrap::install_power_bootstrap_modules_registers_and_activates`
- 遗留事项：执行 BMS-37，从 `rule/body` 开始下线 builtin 测试注册并切到 wasm 工件优先执行。

- 日期：2026-02-13
- 完成内容：完成 BMS-37（`rule/body` 相关 builtin 测试注册下线，wasm 工件优先）：
  - `crates/agent_world/src/runtime/tests/rules.rs`：
    - `m1.rule.move/visibility/transfer` 安装夹具改为注册 `m1_builtin_modules.wasm` 工件。
    - 对应 `m1_*` 规则测试改为直接使用 `WasmExecutor`，去除 `register_builtin`。
    - wasm 路径测试加 `#[cfg(feature = "wasmtime")]` 门控。
  - `crates/agent_world/src/runtime/tests/body.rs`：
    - `m1.body.core` 安装夹具改为注册 `m1_builtin_modules.wasm` 工件。
    - body 动作相关测试改为 `WasmExecutor` 执行并移除 builtin 注册。
    - wasm 路径测试加 `#[cfg(feature = "wasmtime")]` 门控。
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::rules::`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::body::`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features wasmtime runtime::tests::rules::`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features wasmtime runtime::tests::body::`
- 遗留事项：继续执行 BMS-38，迁移 `sensor/mobility/memory/storage/power` 相关测试的 builtin fallback。

- 日期：2026-02-13
- 完成内容：完成 BMS-38（`sensor/mobility/memory/storage/power` 相关 builtin fallback 下线）：
  - `crates/agent_world/src/runtime/tests/agent_default_modules.rs`：
    - 模块级 `#[cfg(feature = "wasmtime")]` 门控，移除 builtin fallback 注册。
    - 默认/场景 sandbox 改为直接 `WasmExecutor`。
  - `crates/agent_world/src/runtime/tests/power_bootstrap.rs`：
    - 模块级 `#[cfg(feature = "wasmtime")]` 门控，移除 builtin fallback 注册。
    - power sandbox 改为直接 `WasmExecutor`。
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::agent_default_modules::`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::power_bootstrap::`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features wasmtime runtime::tests::agent_default_modules::`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features wasmtime runtime::tests::power_bootstrap::`
- 遗留事项：执行 BMS-39，清理 runtime 中不再使用的 builtin 模块实现导出与冗余回退路径。

- 日期：2026-02-13
- 完成内容：完成 BMS-39（runtime builtin 导出/回退路径收口）：
  - `crates/agent_world/src/runtime/mod.rs`：
    - 移除不再使用的 builtin 具体实现类型导出（仅保留 sandbox 抽象与模块常量导出）。
  - `crates/agent_world/src/runtime/builtin_modules.rs`：
    - `BuiltinModuleSandbox` 去除冗余 `new/with_fallback` 构造与 `prefer_fallback` 分支，统一为 wasm-first fallback 语义。
    - 增加模块级 `#![allow(dead_code, unused_imports)]`，用于 cutover 期间保留 native 实现代码但不作为默认执行路径。
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world runtime::builtin_modules::tests::`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features wasmtime runtime::tests::rules::`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features wasmtime runtime::tests::power_bootstrap::`
- 遗留事项：BMS cutover 阶段二已收口；是否进入阶段三（物理删除 native builtin 实现代码）待下一步指令。

- 日期：2026-02-13
- 完成内容：完成 BMS-40（cutover 阶段三启动与任务拆解）：
  - `doc/world-runtime/builtin-wasm-crate-split.md`：
    - 增补阶段三执行路线（BMS-40~BMS-43）与里程碑 M17。
    - 更新 runtime 装载工厂接口描述为 `with_preferred_fallback`。
  - `doc/world-runtime/builtin-wasm-crate-split.project.md`：
    - 新增 BMS-40~BMS-43 任务并将状态切换为阶段三进行中。
  - `doc/world-runtime.project.md`：
    - 同步新增 BMS-40~BMS-43 与全局状态更新。
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world runtime::builtin_modules::tests::`
- 遗留事项：执行 BMS-41，物理删除 `runtime/builtin_modules/*` native 实现文件并回归验证。

- 日期：2026-02-13
- 完成内容：完成 BMS-41（物理删除 runtime native builtin 老代码第一批）：
  - `crates/agent_world/src/runtime/builtin_modules.rs`：
    - 收敛为“模块常量 + `BuiltinModule` trait + `BuiltinModuleSandbox` 最小兼容层”。
    - 内联保留 `m1.power.*` 模块 ID、版本和参数常量，删除旧实现辅助函数与数据结构。
  - 删除 legacy native 实现源码：
    - `crates/agent_world/src/runtime/builtin_modules/body_module.rs`
    - `crates/agent_world/src/runtime/builtin_modules/default_modules.rs`
    - `crates/agent_world/src/runtime/builtin_modules/rule_modules.rs`
    - `crates/agent_world/src/runtime/builtin_modules/power_modules.rs`
    - `crates/agent_world/src/runtime/builtin_modules/power_modules/power_radiation_module.rs`
    - `crates/agent_world/src/runtime/builtin_modules/power_modules/power_storage_module.rs`
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world runtime::builtin_modules::tests::`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features wasmtime runtime::tests::rules::`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features wasmtime runtime::tests::power_bootstrap::`
- 遗留事项：执行 BMS-42，继续下线 `BuiltinModuleSandbox` 的 builtin 注册兜底能力并清理相关引用。

- 日期：2026-02-13
- 完成内容：完成 BMS-42（下线 `BuiltinModuleSandbox` builtin 注册兜底能力）：
  - `crates/agent_world/src/runtime/builtin_modules.rs`：
    - 删除 `BuiltinModule` trait 与 `register_builtin` 机制。
    - `BuiltinModuleSandbox` 收敛为 wasm fallback 透传层（仅保留 `with_preferred_fallback` + `call`）。
    - 更新单测为“fallback 成功/失败透传”两条用例。
  - `crates/agent_world/src/runtime/mod.rs`：
    - 移除 `BuiltinModule` 的 re-export，保留 `BuiltinModuleSandbox` 与模块常量导出。
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world runtime::builtin_modules::tests::`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features wasmtime runtime::tests::rules::`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features wasmtime runtime::tests::power_bootstrap::`
- 遗留事项：执行 BMS-43，完成阶段三首轮回归收口与文档闭环。

- 日期：2026-02-13
- 完成内容：完成 BMS-43（cutover 阶段三首轮回归收口）：
  - 执行阶段三首轮回归并确认 wasm 路径稳定：
    - `agent_world_builtin_wasm` 全量单测通过。
    - `agent_world` 下 `runtime::tests::rules::`（wasmtime）通过。
    - `agent_world` 下 `runtime::tests::power_bootstrap::`（wasmtime）通过。
  - 更新项目管理文档并标记 BMS-43 完成：
    - `doc/world-runtime/builtin-wasm-crate-split.project.md`
    - `doc/world-runtime.project.md`
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_builtin_wasm`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features wasmtime runtime::tests::rules::`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --features wasmtime runtime::tests::power_bootstrap::`
- 遗留事项：评估是否启动下一轮下线（移除 `BuiltinModuleSandbox` 兼容层及相关导出）。

- 日期：2026-02-13
- 完成内容：推进 distributed crate split 二十六次扩展阶段，继续消除 runtime 与 `agent_world_consensus` 的重复实现：
  - `agent_world::runtime` 的 `distributed_membership_sync` 主体改为直接复用 `agent_world_consensus` 同源实现（`include!` + `shared` 包装）：
    - `crates/agent_world/src/runtime/distributed_membership_sync.rs`
  - 保留 runtime 本地 `reconciliation/recovery` 子模块与导出 API，不改变 `runtime` 对外命名面。
  - 为支持跨 crate 同源复用，补齐 `agent_world_consensus` 兼容 alias 和工具导出：
    - `crates/agent_world_consensus/src/lib.rs`（`distributed_consensus`、`distributed_net`、`distributed_dht::MembershipDirectorySnapshot`、`util::to_canonical_cbor`）
    - `crates/agent_world_consensus/src/membership.rs`（切换到 `super::*` alias 路径并导出 `to_canonical_cbor`）
  - 回写设计/项目管理文档：
    - `doc/world-runtime/distributed-crate-split-net-consensus.md`
    - `doc/world-runtime/distributed-crate-split-net-consensus.project.md`
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_consensus`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test --workspace`
- 遗留事项：继续下一阶段，评估 `distributed_membership_sync` 的 `reconciliation/recovery` 子模块是否可进一步同源复用，减少 runtime 侧重复实现与 alias 成本。
