- 时刻：2026-02-27 10:55:03 CST
- 完成内容：完成“Viewer Live 完全事件驱动改造 Phase 6”T3（回归测试补强）。
  - 更新 `crates/agent_world/src/viewer/live/tests.rs`：
    - 新增 `live_world_drive_modes_split_pulse_and_event_paths`，覆盖非共识 script/llm 驱动模式分流语义。
    - 新增 `emit_step_outcome_skips_idle_metrics_when_disabled`，覆盖“无进展时 metrics 节流”语义。
    - 新增测试辅助 `read_response_line`，用于验证响应发射行为。
  - 更新项目管理文档：`doc/world-simulator/viewer-live-full-event-driven-phase6-2026-02-26.project.md`，标记 T3 完成并进入 T4。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world viewer::live::tests:: -- --nocapture`
- 遗留事项：
  - 执行 T4：完成 Phase 6 文档收口并评估完全事件驱动达成度。

- 时刻：2026-02-27 10:57:19 CST
- 完成内容：完成“Viewer Live 完全事件驱动改造 Phase 6”T4（文档与日志收口）。
  - 更新 `doc/world-simulator/viewer-live-full-event-driven-phase6-2026-02-26.md`：新增“Phase 6 完成态”与“Phase 7 入口（完全事件驱动达成度评估）”。
  - 更新 `doc/world-simulator/viewer-live-full-event-driven-phase6-2026-02-26.project.md`：标记 T4 完成，状态收敛为“已完成（T0~T4）”。
  - 本阶段（Phase 6）全部任务完成并结项。
- 测试：
  - 文档任务，无新增代码测试（代码回归已在 T1~T3 完成）。
- 遗留事项：
  - 评估是否启动 Phase 7：script 路径定时脉冲策略与完整事件驱动验收清单。

- 时刻：2026-02-27 10:59:05 CST
- 完成内容：完成“Viewer Live 完全事件驱动改造 Phase 7”T0（建档）。
  - 新增设计文档：`doc/world-simulator/viewer-live-full-event-driven-phase7-2026-02-27.md`。
  - 新增项目管理文档：`doc/world-simulator/viewer-live-full-event-driven-phase7-2026-02-27.project.md`。
  - 项目状态设置为“进行 T1（script 节拍策略双模接线）”。
- 测试：
  - 文档任务，无代码测试。
- 遗留事项：
  - 执行 T1：完成 script `timer_pulse`/`event_drive` 双模接线。

- 时刻：2026-02-27 11:07:00 CST
- 完成内容：完成“Viewer Live 完全事件驱动改造 Phase 7”T1（script 节拍策略双模接线）。
  - 更新 `crates/agent_world/src/viewer/live_split_part1.rs`：
    - `ViewerLiveServerConfig` 新增 `script_pacing_mode`（默认 `TimerPulse`）并透传到 `LiveWorld`。
    - `LiveWorld` 接入 script 双模策略：`TimerPulse` 走 playback pulse，`EventDrive` 走 non-consensus event drive。
    - 非共识 event drive 新增重入判定 `should_requeue_non_consensus_drive`，script 在 idle step 时停止重入，避免空转。
  - 更新 `crates/agent_world/src/viewer/live/tests.rs`：
    - 补充 config/驱动模式覆盖，校验 script `TimerPulse` 与 `EventDrive` 分流语义。
    - 新增 `live_world_script_event_drive_stops_requeue_on_idle_step`，覆盖 script 事件驱动空闲止损语义。
    - 同步 `new_with_consensus_gate` 构造参数到新策略配置。
  - 更新 `crates/agent_world/src/viewer/mod.rs`：导出 `ViewerLiveScriptPacingMode`。
  - 更新项目管理文档：`doc/world-simulator/viewer-live-full-event-driven-phase7-2026-02-27.project.md`，标记 T1 完成并进入 T2。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world viewer::live::tests:: -- --nocapture`
- 遗留事项：
  - 执行 T2：补齐信号级可观测性（吞吐/merge/drop/处理耗时）并接线到 live 主循环。

- 时刻：2026-02-27 11:15:00 CST
- 完成内容：完成“Viewer Live 完全事件驱动改造 Phase 7”T2（信号级可观测性接线）。
  - 更新 `crates/agent_world/src/viewer/live_split_part2.rs`：
    - 引入 `LiveLoopSignalKind` 分型，覆盖 request/playback/llm/consensus/step/seek 全部主循环信号。
    - 在 `LiveLoopBackpressure` 中新增每类信号入队数、处理数、处理耗时总量/最大值统计，并在快照中输出 `avg_us/max_us`。
    - `enqueue_coalesced_signal` 与 `read_requests` 接入入队计数，保留既有 merge/drop 语义。
    - 新增 `format_live_loop_signal_stats` 统一输出信号级统计文本。
  - 更新 `crates/agent_world/src/viewer/live_split_part1.rs`：
    - live 主循环改为统一信号处理入口，按信号类型记录处理耗时。
    - request 分支对 deferred `Step/Seek` 入队补充计数。
    - 结束日志输出扩展为 `merge/drop + per-signal in/handled/avg_us/max_us`。
  - 更新 `crates/agent_world/src/viewer/live/tests.rs`：
    - 补充 `live_loop_backpressure_records_per_signal_latency_metrics`，验证 per-signal 吞吐与耗时统计。
    - 增补 coalesced enqueue 测试对入队计数的断言。
  - 更新项目管理文档：`doc/world-simulator/viewer-live-full-event-driven-phase7-2026-02-27.project.md`，标记 T2 完成并进入 T3。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world viewer::live::tests:: -- --nocapture`
- 遗留事项：
  - 执行 T3：完成回归测试 + Web 闭环验证，并输出“完全事件驱动”达成度证据。

- 时刻：2026-02-27 11:25:08 CST
- 完成内容：完成“Viewer Live 完全事件驱动改造 Phase 7”T3（回归测试 + Web 闭环验证）。
  - 回归测试：
    - 执行 `env -u RUSTC_WRAPPER cargo test -p agent_world --features test_tier_required viewer::live::tests:: -- --nocapture`，37/37 通过。
  - Web 闭环（Playwright，headed）：
    - 首轮 `CODEX_HOME=$PWD/.codex env -u NO_COLOR ./scripts/viewer-release-qa-loop.sh --headed`：
      - 语义 gate 通过，截图生成；
      - 附加 zoom texture gate 失败（`zoom stage near initial: not connected`），整体 summary 为 FAIL。
    - 按 S6 最小门禁执行手动 smoke（保持 headed）：
      - `window.__AW_TEST__` 可用；
      - `getState()` 返回 `tick/connectionStatus`，且 `play` 后 tick 推进到 1；
      - console dump 显示 `Errors: 0`；
      - 截图落盘：`output/playwright/viewer/phase7-t3-web-smoke-20260227-112259.png`。
    - 产物：
      - `output/playwright/viewer/phase7-t3-live-20260227-112259.log`
      - `output/playwright/viewer/phase7-t3-web-20260227-112259.log`
      - `output/playwright/viewer/phase7-t3-web-smoke-20260227-112259.png`
      - `output/playwright/viewer/release-qa-summary-20260227-112032.md`
      - `output/playwright/viewer/release-qa-playwright-20260227-112032.log`
      - `output/playwright/viewer/release-qa-semantic-20260227-112032.log`
      - `output/playwright/viewer/release-qa-zoom-20260227-112032.log`
  - 更新项目管理文档：`doc/world-simulator/viewer-live-full-event-driven-phase7-2026-02-27.project.md`，标记 T3 完成并进入 T4。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world --features test_tier_required viewer::live::tests:: -- --nocapture`
  - Web 闭环（S6 smoke, headed）：
    - `CODEX_HOME=$PWD/.codex env -u NO_COLOR ./scripts/viewer-release-qa-loop.sh --headed`（语义通过，zoom gate 失败）
    - 手动 S6 smoke（headed + `__AW_TEST__` + console + screenshot）通过
- 遗留事项：
  - 执行 T4：收口 Phase 7 设计文档与项目文档，给出“完全事件驱动”达成度结论与剩余改造项。

- 时刻：2026-02-27 11:27:57 CST
- 完成内容：完成“Viewer Live 完全事件驱动改造 Phase 7”T4（文档与日志收口）。
  - 更新设计文档：`doc/world-simulator/viewer-live-full-event-driven-phase7-2026-02-27.md`
    - 新增“Phase 7 完成态（T4）”，沉淀交付结果、验收证据与达成度结论。
    - 给出“默认完全事件驱动”剩余改造点（默认切换、节奏整形、pulse 角色收敛、zoom gate 抖动修复）。
  - 更新项目管理文档：`doc/world-simulator/viewer-live-full-event-driven-phase7-2026-02-27.project.md`
    - 标记 T4 完成，阶段状态收敛为“已完成（T0~T4）”。
  - Phase 7 全部任务完成并结项。
- 测试：
  - 文档任务，无新增代码测试（代码/Web 闭环验证已在 T1~T3 完成）。
- 遗留事项：
  - 可选后续：在新阶段推进“默认切到 script event_drive + release QA zoom gate 稳定化”。

- 时刻：2026-02-27 11:42:32 CST
- 完成内容：完成“Viewer Live 完全事件驱动改造 Phase 8”T0（建档）。
  - 新增设计文档：`doc/world-simulator/viewer-live-full-event-driven-phase8-2026-02-27.md`。
  - 新增项目管理文档：`doc/world-simulator/viewer-live-full-event-driven-phase8-2026-02-27.project.md`。
  - 明确 Phase 8 目标：script 默认且唯一 `event_drive`，删除回退开关与回退链路。
- 测试：
  - 文档任务，无代码测试。
- 遗留事项：
  - 执行 T1：清理 `timer_pulse` 回退链路代码，仅保留 event_drive。

- 时刻：2026-02-27 11:49:27 CST
- 完成内容：完成“Viewer Live 完全事件驱动改造 Phase 8”T1（代码收敛）。
  - 更新 `crates/agent_world/src/viewer/live_split_part1.rs`：
    - 删除 `ViewerLiveScriptPacingMode`、`script_pacing_mode` 及相关配置/构造链路。
    - 删除 `PlaybackPulse` 信号分支与 `handle_playback_pulse` 处理函数。
    - script 非共识路径仅保留 `NonConsensusDriveRequested` 事件驱动，`should_requeue_non_consensus_drive` 对 script 直接以 `step.event.is_some()` 判定。
  - 更新 `crates/agent_world/src/viewer/live_split_part2.rs`：
    - 删除 playback pulse 控制结构、发射线程与 backpressure 对应 merge/drop 统计项。
    - 收敛 live 信号种类到纯事件驱动集合（request/llm/consensus/drive/step/seek）。
  - 更新 `crates/agent_world/src/viewer/mod.rs`：移除 `ViewerLiveScriptPacingMode` 导出。
  - 更新 `crates/agent_world/src/bin/world_viewer_live/world_viewer_live_split_part1.rs`：移除 live server 的 `.with_tick_interval(...)` 接线。
  - 更新项目管理文档：`doc/world-simulator/viewer-live-full-event-driven-phase8-2026-02-27.project.md`，标记 T1 完成并进入 T2。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world viewer::live::tests:: -- --nocapture`
- 遗留事项：
  - 执行 T2：完成测试改造收口并跑 required 回归。

- 时刻：2026-02-27 11:52:34 CST
- 完成内容：完成“Viewer Live 完全事件驱动改造 Phase 8”T2（测试改造与回归）。
  - 更新 `crates/agent_world/src/viewer/live/tests.rs`：
    - 清理 `TimerPulse`/`script_pacing_mode` 相关断言与构造。
    - 删除 playback pulse 线程测试（对应链路已下线）。
    - 新增/保留 event-drive 语义断言：
      - `live_world_non_consensus_path_is_event_drive_only`
      - `live_world_event_drive_gate_tracks_llm_mailbox`
  - 更新项目管理文档：`doc/world-simulator/viewer-live-full-event-driven-phase8-2026-02-27.project.md`，标记 T2 完成并进入 T3。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world viewer::live::tests:: -- --nocapture`
- 遗留事项：
  - 执行 T3：完成 Phase 8 文档收口与结项。

- 时刻：2026-02-27 11:54:35 CST
- 完成内容：完成“Viewer Live 完全事件驱动改造 Phase 8”T3（文档收口）。
  - 更新设计文档：`doc/world-simulator/viewer-live-full-event-driven-phase8-2026-02-27.md`
    - 新增“Phase 8 完成态（T3）”，沉淀交付结果、验收证据与阶段结论。
  - 更新项目管理文档：`doc/world-simulator/viewer-live-full-event-driven-phase8-2026-02-27.project.md`
    - 标记 T3 完成，阶段状态收敛为“已完成（T0~T3）”。
  - Phase 8 全部任务完成并结项。
- 测试：
  - 文档任务，无新增代码测试（T1/T2 与 pre-commit required 已完成回归）。
- 遗留事项：
  - 可选后续：针对 release QA 的 zoom gate 连接抖动单独开阶段治理。

- 时刻：2026-02-27 12:01:42 CST
- 完成内容：完成“Viewer Live 完全事件驱动改造 Phase 9”T0（建档）。
  - 新增设计文档：`doc/world-simulator/viewer-live-full-event-driven-phase9-2026-02-27.md`。
  - 新增项目管理文档：`doc/world-simulator/viewer-live-full-event-driven-phase9-2026-02-27.project.md`。
  - 明确边界：清理 viewer live 旧 `tick-ms` 入口与传递链路；不改 node/runtime 共识 tick。
- 测试：
  - 文档任务，无代码测试。
- 遗留事项：
  - 执行 T1：删除 `world_viewer_live --tick-ms` 与 `CliOptions.tick_ms`，同步更新测试。

- 时刻：2026-02-27 12:08:43 CST
- 完成内容：完成“Viewer Live 完全事件驱动改造 Phase 9”T1（CLI 与代码收敛）。
  - 更新 `crates/agent_world/src/bin/world_viewer_live/cli.rs`：删除 `CliOptions.tick_ms`、`--tick-ms` 解析与 help 文案，仅保留 `--node-tick-ms`。
  - 更新 `crates/agent_world/src/bin/world_viewer_live/world_viewer_live_split_part2.rs`：reward runtime `poll_interval` 改为 `node_tick_ms`。
  - 更新 `crates/agent_world/src/bin/world_viewer_live/world_viewer_live_tests_split_part1.rs`：移除 `tick_ms` 断言与 custom 参数，新增 legacy `--tick-ms` 拒绝断言并同步 release-config 非白名单测试。
  - 更新 `crates/agent_world/tests/viewer_live_integration.rs`：移除已废弃的 `.with_tick_interval(...)` 调用。
  - 更新 `crates/agent_world/src/viewer/live_split_part1.rs`：live 主循环由 `recv()` 改为 `recv_timeout + loop_running`，修复客户端断开后可能阻塞不退出的问题。
  - 更新项目管理文档：`doc/world-simulator/viewer-live-full-event-driven-phase9-2026-02-27.project.md`，标记 T1 完成并进入 T2。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world viewer::live::tests:: -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world world_viewer_live_tests:: -- --nocapture`
  - test_tier_full：`env -u RUSTC_WRAPPER cargo test -p agent_world --features "viewer_live_integration test_tier_full" --test viewer_live_integration -- --nocapture`
- 遗留事项：
  - 执行 T2：清理脚本侧 `--tick-ms` 参数定义、校验与透传链路。

- 时刻：2026-02-27 12:14:06 CST
- 完成内容：完成“Viewer Live 完全事件驱动改造 Phase 9”T2（脚本收敛）。
  - 更新脚本并删除 `--tick-ms` 参数入口/校验/透传：
    - `scripts/capture-viewer-frame.sh`
    - `scripts/viewer-theme-pack-preview.sh`
    - `scripts/run-game-test.sh`
    - `scripts/p2p-longrun-soak.sh`
    - `scripts/viewer-owr4-stress.sh`
    - `scripts/viewer-release-qa-loop.sh`
    - `scripts/viewer-texture-inspector.sh`
  - 同步清理脚本内 `tick_ms` 元数据与 CSV 列（OWR4/p2p 相关 run config 与 summary 输出）。
  - 更新项目管理文档：`doc/world-simulator/viewer-live-full-event-driven-phase9-2026-02-27.project.md`，标记 T2 完成并进入 T3。
- 测试：
  - test_tier_required（脚本语法）：`bash -n scripts/capture-viewer-frame.sh scripts/viewer-theme-pack-preview.sh scripts/run-game-test.sh scripts/p2p-longrun-soak.sh scripts/viewer-owr4-stress.sh scripts/viewer-release-qa-loop.sh scripts/viewer-texture-inspector.sh`
  - test_tier_required（脚本帮助入口）：
    - `./scripts/capture-viewer-frame.sh --help`
    - `./scripts/viewer-theme-pack-preview.sh --help`
    - `./scripts/run-game-test.sh --help`
    - `./scripts/p2p-longrun-soak.sh --help`
    - `./scripts/viewer-owr4-stress.sh --help`
    - `./scripts/viewer-release-qa-loop.sh --help`
    - `./scripts/viewer-texture-inspector.sh --help`
- 遗留事项：
  - 执行 T3：更新活跃手册与文档示例，移除 `--tick-ms`。

- 时刻：2026-02-27 12:17:11 CST
- 完成内容：完成“Viewer Live 完全事件驱动改造 Phase 9”T3（文档收敛）。
  - 更新活跃手册并移除 `--tick-ms` 示例：
    - `testing-manual.md`
    - `doc/viewer-manual.md`
    - `doc/scripts/capture-viewer-frame.md`
    - `doc/testing/web-ui-playwright-closure-manual.md`
    - `doc/world-simulator/viewer-release-qa-iteration-loop.md`
  - 同步静态站手册示例：
    - `site/doc/en/viewer-manual.html`
    - `site/doc/cn/viewer-manual.html`
  - 更新项目管理文档：`doc/world-simulator/viewer-live-full-event-driven-phase9-2026-02-27.project.md`，标记 T3 完成并进入 T4。
- 测试：
  - test_tier_required（文档残留扫描）：`rg --line-number --no-heading -- "--tick-ms" testing-manual.md doc/viewer-manual.md doc/scripts/capture-viewer-frame.md doc/testing/web-ui-playwright-closure-manual.md doc/world-simulator/viewer-release-qa-iteration-loop.md site/doc/en/viewer-manual.html site/doc/cn/viewer-manual.html`
- 遗留事项：
  - 执行 T4：完成 required 回归、Phase 9 设计/项目文档收口并结项。

- 时刻：2026-02-27 12:19:05 CST
- 完成内容：完成“Viewer Live 完全事件驱动改造 Phase 9”T4（回归与结项）。
  - 更新设计文档：`doc/world-simulator/viewer-live-full-event-driven-phase9-2026-02-27.md`
    - 新增“Phase 9 完成态（T4）”，沉淀交付结果、验收证据与阶段结论。
  - 更新项目管理文档：`doc/world-simulator/viewer-live-full-event-driven-phase9-2026-02-27.project.md`
    - 标记 T4 完成，阶段状态收敛为“已完成（T0~T4）”。
  - Phase 9 全部任务完成并结项。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world viewer::live::tests:: -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world world_viewer_live_tests:: -- --nocapture`
- 遗留事项：
  - 无（Phase 9 目标范围内事项已完成）。

- 时刻：2026-02-27 12:24:22 CST
- 完成内容：完成“Viewer Live 完全事件驱动改造 Phase 10”T0（建档）。
  - 新增设计文档：`doc/world-simulator/viewer-live-full-event-driven-phase10-2026-02-27.md`。
  - 新增项目管理文档：`doc/world-simulator/viewer-live-full-event-driven-phase10-2026-02-27.project.md`。
  - 明确范围：清理 `viewer/server` 与 `viewer/web_bridge` 的 tick/poll 轮询链路，不改 node/runtime 基础 tick 机制。
- 测试：
  - 文档任务，无代码测试。
- 遗留事项：
  - 执行 T1：删除 offline server `tick_interval` 与定时回放推进。

- 时刻：2026-02-27 12:27:47 CST
- 完成内容：完成“Viewer Live 完全事件驱动改造 Phase 10”T1（offline server 去 tick 化）。
  - 更新 `crates/agent_world/src/viewer/server.rs`：删除 `ViewerServerConfig.tick_interval` 与 `with_tick_interval`。
  - 更新 `crates/agent_world/src/viewer/server.rs`：主循环从 `recv_timeout + tick` 改为纯请求驱动 `recv()`；移除 `playing/tick_interval/should_emit_event` 定时推进链路。
  - 更新 `crates/agent_world/src/viewer/server.rs`：`Control::Play` 改为事件触发批量发送（`emit_playback_events`），`Pause` 退化为空操作。
  - 更新 `crates/agent_world/tests/viewer_offline_integration.rs`：新增 `offline_server_play_control_streams_events_without_timer_ticks`，验证 `Play` 无 timer tick 也可连续输出事件。
  - 更新项目管理文档：`doc/world-simulator/viewer-live-full-event-driven-phase10-2026-02-27.project.md`，标记 T1 完成并进入 T2。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world viewer::server::tests:: -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world --features test_tier_required --test viewer_offline_integration -- --nocapture`
- 遗留事项：
  - 执行 T2：删除 `viewer/web_bridge` 的 `poll_interval` 与轮询 sleep。

- 时刻：2026-02-27 12:30:54 CST
- 完成内容：完成“Viewer Live 完全事件驱动改造 Phase 10”T2（web bridge 去轮询配置化）。
  - 更新 `crates/agent_world/src/viewer/web_bridge.rs`：删除 `ViewerWebBridgeConfig.poll_interval` 与 `with_poll_interval`。
  - 更新 `crates/agent_world/src/viewer/web_bridge.rs`：删除 `thread::sleep` 轮询；改为 socket `read_timeout` + 事件触发转发循环。
  - 更新 `crates/agent_world/src/viewer/web_bridge.rs`：测试同步清理 `poll_interval` 默认值与构造调用断言。
  - 更新项目管理文档：`doc/world-simulator/viewer-live-full-event-driven-phase10-2026-02-27.project.md`，标记 T2 完成并进入 T3。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world viewer::web_bridge::tests:: -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world`
- 遗留事项：
  - 执行 T3：清理活跃入口示例中的 `--tick-ms` 残留并同步测试收口。

- 时刻：2026-02-27 12:35:07 CST
- 完成内容：完成“Viewer Live 完全事件驱动改造 Phase 10”T3（活跃入口与测试收口）。
  - 更新 `site/index.html`、`site/en/index.html`：移除 live 启动示例中的 `--tick-ms`。
  - 更新 `doc/world-simulator/visualization.md`：在线模式描述改为事件驱动，并移除 `--tick-ms` 示例。
  - 更新 `doc/world-simulator/viewer-i18n.md`、`doc/world-simulator/viewer-open-world-sandbox-readiness.md`、`doc/world-simulator/viewer-open-world-sandbox-readiness.stress-report.template.md`、`doc/testing/p2p-storage-consensus-longrun-online-stability-2026-02-24.md`：清理活跃文档中的 `--tick-ms` 残留。
  - 更新 `crates/agent_world/src/bin/world_viewer_live/world_viewer_live_tests_split_part1.rs`：删除 legacy `--tick-ms` 拒绝断言测试。
  - 更新项目管理文档：`doc/world-simulator/viewer-live-full-event-driven-phase10-2026-02-27.project.md`，标记 T3 完成并进入 T4。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world world_viewer_live_tests:: -- --nocapture`
  - test_tier_required（文档残留扫描）：`rg --line-number --no-heading --glob '!doc/devlog/**' --glob '!doc/world-simulator/viewer-live-full-event-driven-phase9-2026-02-27*' -- "--tick-ms" .`
- 遗留事项：
  - 执行 T4：required 回归、Phase 10 设计/项目文档收口并结项。

- 时刻：2026-02-27 12:37:50 CST
- 完成内容：完成“Viewer Live 完全事件驱动改造 Phase 10”T4（回归与结项）。
  - 更新设计文档：`doc/world-simulator/viewer-live-full-event-driven-phase10-2026-02-27.md`
    - 新增“Phase 10 完成态（T4）”，沉淀交付结果、验收证据与阶段结论。
  - 更新项目管理文档：`doc/world-simulator/viewer-live-full-event-driven-phase10-2026-02-27.project.md`
    - 标记 T4 完成，阶段状态收敛为“已完成（T0~T4）”。
  - Phase 10 全部任务完成并结项。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world viewer::live::tests:: -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world viewer::web_bridge::tests:: -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world --features test_tier_required --test viewer_offline_integration -- --nocapture`
  - test_tier_required（残留扫描）：
    - `rg --line-number --no-heading "with_tick_interval|tick_interval" crates/agent_world/src/viewer crates/agent_world/src/bin/world_viewer_server.rs`
    - `rg --line-number --no-heading "poll_interval|with_poll_interval" crates/agent_world/src/viewer`
    - `rg --line-number --no-heading --glob '!doc/devlog/**' --glob '!doc/world-simulator/viewer-live-full-event-driven-phase9-2026-02-27*' -- "--tick-ms" .`
- 遗留事项：
  - 无（Phase 10 目标范围内事项已完成）。

- 时刻：2026-02-27 13:13:09 CST
- 完成内容：完成“Viewer Live 旧 Tick 驱动文档归档”（文档任务）。
  - 新增设计文档：`doc/world-simulator/viewer-live-tick-driven-doc-archive-2026-02-27.md`。
  - 新增项目管理文档：`doc/world-simulator/viewer-live-tick-driven-doc-archive-2026-02-27.project.md`，并完成 T0~T2 状态收口。
  - 将 Viewer Live 旧 tick 驱动阶段文档归档到 `doc/world-simulator/archive/`：
    - `viewer-live-full-event-driven-phase1-2026-02-26(.project).md`
    - `viewer-live-full-event-driven-phase2-2026-02-26(.project).md`
    - `viewer-live-full-event-driven-phase3-2026-02-26(.project).md`
    - `viewer-live-full-event-driven-phase4-2026-02-26(.project).md`
    - `viewer-live-full-event-driven-phase5-2026-02-26(.project).md`
    - `viewer-live-full-event-driven-phase6-2026-02-26(.project).md`
    - `viewer-live-full-event-driven-phase7-2026-02-27(.project).md`
  - 更新归档索引：`doc/world-simulator/archive/README.md`，补充 2026-02-27 归档原因与替代文档。
- 测试：
  - 文档/路径校验：`rg --files doc/world-simulator | rg "viewer-live-full-event-driven-phase[1-7]-2026-02-(26|27)"`
- 时刻：2026-02-27 10:53:37 CST
- 完成内容：完成主链 Token 分配机制二期 T4（测试矩阵回归与文档收口）。
  - 执行并通过回归：`runtime::tests::main_token`、`runtime::tests::reward_asset_settlement_action`，以及脚本 `./scripts/main-token-regression.sh required`。
  - 回写项目管理文档 `doc/p2p/mainchain-token-allocation-mechanism-phase2-governance-bridge-distribution-2026-02-26.project.md`：标记 T4 完成，状态更新为 T0~T4 全部完成。
- 测试：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::main_token:: -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::reward_asset_settlement_action:: -- --nocapture`
  - `./scripts/main-token-regression.sh required`
- 遗留事项：
  - 无。

- 时刻：2026-02-27 12:01:06 CST
- 完成内容：完成“文档治理工程化全量优化”T0 建档。
  - 新建设计文档：`doc/engineering/documentation-governance-engineering-closure-2026-02-27.md`。
  - 新建项目管理文档：`doc/engineering/documentation-governance-engineering-closure-2026-02-27.project.md`。
  - 在项目文档中标记 T0 完成，并进入 T1（文档治理检查脚本实现）。
- 测试：
  - `wc -l doc/engineering/documentation-governance-engineering-closure-2026-02-27.md doc/engineering/documentation-governance-engineering-closure-2026-02-27.project.md`
  - `rg -n "目标|范围|接口/数据|里程碑|风险" doc/engineering/documentation-governance-engineering-closure-2026-02-27.md`
  - `rg -n "任务拆解|依赖|状态" doc/engineering/documentation-governance-engineering-closure-2026-02-27.project.md`
- 遗留事项：
  - 继续执行 T1~T5。

- 时刻：2026-02-27 12:08:45 CST
- 完成内容：完成“文档治理工程化全量优化”T1~T4（脚本落地 + 全量路径治理 + 门禁接入）。
  - 新增脚本：`scripts/doc-governance-check.sh`，覆盖文档结构字段、绝对路径与行数上限检查。
  - 全量修复非归档非 devlog 文档中的环境相关绝对路径，统一为仓库相对路径。
  - 补齐历史文档规范缺口（章节命名/字段）并新增缺失配对设计文档：
    - `doc/p2p/node-contribution-points-runtime-closure.md`
    - `doc/testing/systematic-application-testing-manual.md`
  - 将文档治理检查接入 `scripts/ci-tests.sh` required/full 默认门禁，并同步 `testing-manual.md` 的 S0 与 CI 覆盖说明。
  - 回写项目管理文档 `doc/engineering/documentation-governance-engineering-closure-2026-02-27.project.md`：标记 T1~T4 完成，进入 T5。
- 测试：
  - `bash -n scripts/doc-governance-check.sh`
  - `./scripts/doc-governance-check.sh`
- 遗留事项：
  - 执行 T5：回归验证、文档状态最终收口与提交。

- 时刻：2026-02-27 12:11:59 CST
- 完成内容：完成“文档治理工程化全量优化”T5（回归验证与项目收口）。
  - 复验 `scripts/doc-governance-check.sh` 通过（文档结构/路径/行数检查全绿）。
  - 复验脚本语法：`scripts/ci-tests.sh` 与 `scripts/doc-governance-check.sh` 均通过 `bash -n`。
  - 回写项目文档 `doc/engineering/documentation-governance-engineering-closure-2026-02-27.project.md`：标记 T5 完成，状态收口为 T0~T5 全完成。
- 测试：
  - `./scripts/doc-governance-check.sh`
  - `bash -n scripts/ci-tests.sh`
  - `bash -n scripts/doc-governance-check.sh`
- 遗留事项：
  - 无。

- 时刻：2026-02-27 13:25:29 CST
- 完成内容：完成“游戏发布前测试（game-test）”T12（按 `doc/game-test.md` 执行真实玩家试玩并填写卡片）。
  - 使用 `./scripts/run-game-test.sh` 启动默认 Web 闭环链路（`ws://127.0.0.1:5011`）。
  - 使用 Playwright headed + 录屏执行真实试玩，完成状态采样、键盘操作、3D 切换、`runSteps(25)` 推进、控制台/网络抓取。
  - 本轮结果：`connectionStatus=connected`，`tick` 从 `10` 增长到 `49`，`runSteps(25)` 返回 `null`，无致命错误。
  - 新增测试卡：`doc/playability_test_result/card_2026_02_27_13_23_51.md`。
  - 产物归档：`output/playwright/playability/20260227-132351/`（含 `playthrough.webm`、截图、控制台日志、启动日志）。
  - 更新项目管理文档：`doc/game-test.project.md`（T12 勾选、测试记录与状态更新）。
- 测试：
  - test_tier_required：`./scripts/run-game-test.sh`
  - test_tier_required：`PLAYWRIGHT_CLI_SESSION=playability-20260227-132351 ./.codex/skills/playwright/scripts/playwright_cli.sh open "http://127.0.0.1:4173/?ws=ws://127.0.0.1:5011&test_api=1" --headed`
  - test_tier_required：`PLAYWRIGHT_CLI_SESSION=playability-20260227-132351 ./.codex/skills/playwright/scripts/playwright_cli.sh video-start`
  - test_tier_required：`PLAYWRIGHT_CLI_SESSION=playability-20260227-132351 ./.codex/skills/playwright/scripts/playwright_cli.sh eval '() => JSON.stringify(window.__AW_TEST__?.getState?.() ?? null)'`
  - test_tier_required：`PLAYWRIGHT_CLI_SESSION=playability-20260227-132351 ./.codex/skills/playwright/scripts/playwright_cli.sh eval '() => { try { return JSON.stringify(window.__AW_TEST__?.runSteps?.(25) ?? null); } catch (e) { return String(e); } }'`
  - test_tier_required：`PLAYWRIGHT_CLI_SESSION=playability-20260227-132351 ./.codex/skills/playwright/scripts/playwright_cli.sh video-stop --filename output/playwright/playability/20260227-132351/playthrough.webm`
- 遗留事项：
  - 玩家体验层面仍有 `sendControl ignored` 警告，需后续补充输入语义提示或示例。

- 时刻：2026-02-27 14:30:09 CST
- 完成内容：完成“Viewer Live 逻辑时间与事件游标接口改造 Phase 11”T0（建档）。
  - 新增设计文档：`doc/world-simulator/viewer-live-logical-time-interface-phase11-2026-02-27.md`。
  - 新增项目管理文档：`doc/world-simulator/viewer-live-logical-time-interface-phase11-2026-02-27.project.md`。
  - 明确边界：调度保持事件驱动；runtime 内部保留逻辑时间；对外接口逐步去 tick 耦合。
- 测试：
  - test_tier_required：`wc -l doc/world-simulator/viewer-live-logical-time-interface-phase11-2026-02-27.md doc/world-simulator/viewer-live-logical-time-interface-phase11-2026-02-27.project.md`
  - test_tier_required：`rg -n "目标|范围|接口/数据|里程碑|风险" doc/world-simulator/viewer-live-logical-time-interface-phase11-2026-02-27.md`
  - test_tier_required：`rg -n "任务拆解|依赖|状态" doc/world-simulator/viewer-live-logical-time-interface-phase11-2026-02-27.project.md`
- 遗留事项：
  - 执行 T1/T2：完成 Web Test API 的 `logicalTime/eventSeq` 输出与 `seek_event` 控制迁移。

- 时刻：2026-02-27 14:32:36 CST
- 完成内容：完成“Viewer Live 逻辑时间与事件游标接口改造 Phase 11”T1（状态输出迁移）。
  - 更新 `crates/agent_world_viewer/src/web_test_api.rs`：`__AW_TEST__.getState()` 新增 `logicalTime`、`eventSeq` 字段。
  - 保持兼容：`tick` 字段继续输出，值与 `logicalTime` 一致。
  - `logicalTime` 来源收敛为 `max(snapshot.time, metrics.total_ticks)`；`eventSeq` 来源为当前事件窗口最大 `event.id`。
  - 更新项目文档：`doc/world-simulator/viewer-live-logical-time-interface-phase11-2026-02-27.project.md`（T1 完成，进入 T2）。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world_viewer --target wasm32-unknown-unknown`
- 遗留事项：
  - 执行 T2：补齐 `sendControl("seek_event", payload)` 的事件游标控制迁移。

- 时刻：2026-02-27 14:35:05 CST
- 完成内容：完成“Viewer Live 逻辑时间与事件游标接口改造 Phase 11”T2（控制入口迁移）。
  - 更新 `crates/agent_world_viewer/src/web_test_api.rs`：
    - `sendControl` 新增 `seek_event`/`seek_event_seq` 动作。
    - 新增 `eventSeq` 解析（支持 `eventSeq` / `event_seq` / `seq` / 纯数字）。
    - 新增 `WebTestApiCommand::SeekEventSeq`，在前端侧映射到既有 `ViewerControl::Seek { tick }`。
    - 映射规则：从当前事件窗口中选择 `id >= eventSeq` 的最小事件并取其 `time` 作为 seek 目标；找不到则稳定告警，不触发无效控制。
  - 更新项目文档：`doc/world-simulator/viewer-live-logical-time-interface-phase11-2026-02-27.project.md`（T2 完成，进入 T3）。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world_viewer --target wasm32-unknown-unknown`
- 遗留事项：
  - 执行 T3：跑 required 门禁并完成 Phase 11 文档收口。

- 时刻：2026-02-27 14:37:14 CST
- 完成内容：完成“Viewer Live 逻辑时间与事件游标接口改造 Phase 11”T3（回归与收口）。
  - 更新设计文档：`doc/world-simulator/viewer-live-logical-time-interface-phase11-2026-02-27.md`，新增“Phase 11 完成态（T3）”与验收证据。
  - 更新项目文档：`doc/world-simulator/viewer-live-logical-time-interface-phase11-2026-02-27.project.md`，标记 T3 完成并收口为 T0~T3 全完成。
  - Phase 11 阶段结项。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world_viewer --target wasm32-unknown-unknown`
  - test_tier_required（pre-commit）：`cargo test -p agent_world --tests --features test_tier_required`
  - test_tier_required（pre-commit）：`cargo test -p agent_world_consensus --lib`
  - test_tier_required（pre-commit）：`cargo test -p agent_world_distfs --lib`
  - test_tier_required（pre-commit）：`cargo test -p agent_world_viewer`
- 遗留事项：
  - 后续可选：将 viewer timeline/术语从 tick 文案进一步迁移到 logicalTime/eventSeq（协议层可在新阶段考虑新增 `seek_event` 原生消息）。
- 时刻：2026-02-27 13:28:00 CST
- 完成内容：完成“可发行统一启动器（Launcher）”T0（建档）。
  - 新增设计文档：`doc/world-simulator/game-unified-launcher-2026-02-27.md`。
  - 新增项目管理文档：`doc/world-simulator/game-unified-launcher-2026-02-27.project.md`。
  - 项目状态切换为执行 T1（launcher 核心托管链路）。
- 测试：
  - 文档任务，无代码测试。
- 遗留事项：
  - 执行 T1：实现 `world_game_launcher` 的参数解析、`world_viewer_live` 子进程托管与统一 URL 输出。

- 时刻：2026-02-27 13:36:05 CST
- 完成内容：完成“可发行统一启动器（Launcher）”T1（核心托管链路）。
  - 新增 `crates/agent_world/src/bin/world_game_launcher.rs`：
    - 实现 launcher CLI 参数解析（scenario/live-bind/web-bind/viewer-host/viewer-port/llm/open-browser）。
    - 接线 `world_viewer_live` 子进程托管，默认 `single topology + viewer-no-consensus-gate`。
    - 接线 `scripts/run-viewer-web.sh` 子进程托管，统一输出玩家访问 URL。
    - 启动就绪探测：viewer HTTP 与 web bridge TCP 监听探测。
    - 支持自动拉起浏览器（可 `--no-open-browser` 关闭）。
  - 新增 launcher 解析与 URL 组装相关单元测试（9 项）。
  - 更新项目管理文档：`doc/world-simulator/game-unified-launcher-2026-02-27.project.md`，标记 T1 完成并进入 T2。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world world_game_launcher_tests:: -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world --bin world_game_launcher`
- 遗留事项：
  - 执行 T2：将 launcher 前端链路从 `run-viewer-web.sh` 切换为内置静态 HTTP 服务，消除运行时 `trunk serve` 依赖。

- 时刻：2026-02-27 13:41:21 CST
- 完成内容：完成“可发行统一启动器（Launcher）”T2（内置静态 HTTP 服务）。
  - 重构 `crates/agent_world/src/bin/world_game_launcher.rs`：
    - 前端链路由 `run-viewer-web.sh` 子进程切换为 launcher 内置静态 HTTP 服务。
    - 新增 `--viewer-static-dir` 参数（默认 `web`），用于加载预构建 Web 资源目录。
    - 新增静态资源请求处理（`GET/HEAD`）、MIME 映射、SPA 路由回退（无扩展名回退 `index.html`）。
    - 新增路径安全处理（拒绝 `..`/反斜杠路径片段），避免目录穿越。
    - 启动与监控链路改为“`world_viewer_live` + 内置静态服务”双组件。
  - 新增单元测试（13 项）：参数解析、URL 组装、路径安全、SPA fallback、MIME 映射。
  - 更新项目管理文档：`doc/world-simulator/game-unified-launcher-2026-02-27.project.md`，标记 T2 完成并进入 T3。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world world_game_launcher_tests:: -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world --bin world_game_launcher`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo run -p agent_world --bin world_game_launcher -- --help`
- 遗留事项：
  - 执行 T3：新增发行打包脚本，自动产出 `bin/world_game_launcher`、`bin/world_viewer_live`、`web/` 目录。

- 时刻：2026-02-27 13:44:01 CST
- 完成内容：完成“可发行统一启动器（Launcher）”T3（发行打包脚本）。
  - 新增脚本：`scripts/build-game-launcher-bundle.sh`。
    - 构建产物：`bin/world_game_launcher`、`bin/world_viewer_live`、`web/`。
    - 支持参数：`--out-dir`、`--profile`、`--web-dist`、`--dry-run`。
    - 默认链路：构建 native 二进制 + `trunk build` 产出 web 静态资源。
    - 可从现有目录复制 web 资源（`--web-dist`），便于 CI/离线流程。
    - 自动生成 `run-game.sh`（统一入口）与 `README.txt`（玩家启动说明）。
  - 更新项目管理文档：`doc/world-simulator/game-unified-launcher-2026-02-27.project.md`，标记 T3 完成并进入 T4。
- 测试：
  - test_tier_required：`bash -n scripts/build-game-launcher-bundle.sh`
  - test_tier_required：`./scripts/build-game-launcher-bundle.sh --help`
  - test_tier_required：`./scripts/build-game-launcher-bundle.sh --dry-run --web-dist site --out-dir .tmp/launcher_bundle_test --profile dev`
- 遗留事项：
  - 执行 T4：同步设计文档/Viewer 手册并补充 launcher 验收命令，完成项目结项。

- 时刻：2026-02-27 13:46:54 CST
- 完成内容：完成“可发行统一启动器（Launcher）”T4（文档与验收收口）。
  - 更新设计文档：`doc/world-simulator/game-unified-launcher-2026-02-27.md`
    - 同步最终口径：`--viewer-static-dir` 默认 `web`。
    - 新增“手册入口（落地命令）”与“完成态（2026-02-27）”。
  - 更新项目管理文档：`doc/world-simulator/game-unified-launcher-2026-02-27.project.md`
    - 标记 T4 完成，项目状态收敛为“已完成（T0~T4）”。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo run -p agent_world --bin world_game_launcher -- --help`
  - test_tier_required：`./scripts/build-game-launcher-bundle.sh --help`
  - test_tier_required：`./scripts/build-game-launcher-bundle.sh --dry-run --web-dist site --out-dir .tmp/launcher_bundle_test_t4 --profile dev`
- 遗留事项：
  - 无（当前项目文档任务已全部完成）。

- 时刻：2026-02-27 14:50:34 CST
- 完成内容：完成“游戏发布前测试（game-test）”T13（按 `doc/game-test.md` 执行真实玩家试玩并填写卡片）。
  - 使用 `./scripts/run-game-test.sh` 启动默认 Web 闭环链路（`ws://127.0.0.1:5011`）。
  - 使用 Playwright headed + `video-start/video-stop` 执行真实试玩，完成 2D/3D 模式切换、按键输入与步进推进。
  - 本轮结果：`connectionStatus=connected`，`tick` 从 `28` 增长到 `287`，`runSteps(25)` 返回 `null`，无致命错误。
  - 新增测试卡：`doc/playability_test_result/card_2026_02_27_14_44_41.md`。
  - 产物归档：`output/playwright/playability/20260227-144441/`（含 `playthrough.webm`、截图、控制台日志、启动日志）。
  - 更新项目管理文档：`doc/game-test.project.md`（T13 勾选、测试记录与状态更新）。
- 测试：
  - test_tier_required：`./scripts/run-game-test.sh`
  - test_tier_required：`PLAYWRIGHT_CLI_SESSION=playability-20260227-144441 ./.codex/skills/playwright/scripts/playwright_cli.sh open "http://127.0.0.1:4173/?ws=ws://127.0.0.1:5011&test_api=1" --headed`
  - test_tier_required：`PLAYWRIGHT_CLI_SESSION=playability-20260227-144441 ./.codex/skills/playwright/scripts/playwright_cli.sh video-start`
  - test_tier_required：`PLAYWRIGHT_CLI_SESSION=playability-20260227-144441 ./.codex/skills/playwright/scripts/playwright_cli.sh eval '() => JSON.stringify(window.__AW_TEST__?.getState?.() ?? null)'`
  - test_tier_required：`PLAYWRIGHT_CLI_SESSION=playability-20260227-144441 ./.codex/skills/playwright/scripts/playwright_cli.sh eval '() => { try { return JSON.stringify(window.__AW_TEST__?.runSteps?.(25) ?? null); } catch (e) { return String(e); } }'`
  - test_tier_required：`PLAYWRIGHT_CLI_SESSION=playability-20260227-144441 ./.codex/skills/playwright/scripts/playwright_cli.sh video-stop --filename output/playwright/playability/20260227-144441/playthrough.webm`
- 遗留事项：
  - 玩家体验层面仍有 `sendControl ignored (invalid action or payload)` 与 `AudioContext` 警告，建议后续补充控制语义提示与可用 payload 示例。

- 时刻：2026-02-27 15:01:12 CST
- 完成内容：完成“游戏发布前测试（game-test）”T14（`run-game-test.sh` 默认开启 LLM）。
  - 更新 `scripts/run-game-test.sh`：`ENABLE_LLM` 默认从 `0` 调整为 `1`。
  - 更新脚本帮助文案：默认启动参数改为 `llm_bootstrap --llm ...`。
  - 新增 `--no-llm` 参数，用于显式回退到内置脚本决策；`--with-llm` 仍保留且可显式声明。
  - 更新项目管理文档：`doc/game-test.project.md`（新增并勾选 T14，补充默认 LLM 前置风险说明）。
- 测试：
  - test_tier_required：`bash -n scripts/run-game-test.sh`
  - test_tier_required：`./scripts/run-game-test.sh --help`
  - test_tier_required：`rg --line-number --no-heading "ENABLE_LLM=|--with-llm|--no-llm|llm_bootstrap --llm" scripts/run-game-test.sh`
- 遗留事项：
  - 默认开启 LLM 后，执行 game-test 前需确保本地 LLM 配置可用；否则使用 `--no-llm` 回退。

- 时刻：2026-02-27 15:11:47 CST
- 完成内容：完成“游戏发布前测试（game-test）”T15（按 `doc/game-test.md` 执行真实玩家试玩并填写卡片）。
  - 使用 `./scripts/run-game-test.sh` 启动默认 Web 闭环链路（`ws://127.0.0.1:5011`，默认开启 LLM）。
  - 使用 Playwright headed + `video-start/video-stop` 执行真实试玩，完成状态采样、2D/3D 切换、按键输入与控制探测。
  - 本轮结果：`connectionStatus=connected`，`tick` 从 `24` 增长到 `40`，`runSteps(30)` 返回 `null`，无 console error。
  - 新增测试卡：`doc/playability_test_result/card_2026_02_27_15_05_28.md`。
  - 产物归档：`output/playwright/playability/20260227-150528/`（含 `playthrough.webm`、截图、console dump、启动日志）。
  - 更新项目管理文档：`doc/game-test.project.md`（新增并勾选 T15，更新测试记录与状态）。
- 测试：
  - test_tier_required：`./scripts/run-game-test.sh`
  - test_tier_required：`PLAYWRIGHT_CLI_SESSION=playability-20260227-150528 ./.codex/skills/playwright/scripts/playwright_cli.sh open "http://127.0.0.1:4173/?ws=ws://127.0.0.1:5011&test_api=1" --headed`
  - test_tier_required：`PLAYWRIGHT_CLI_SESSION=playability-20260227-150528 ./.codex/skills/playwright/scripts/playwright_cli.sh video-start`
  - test_tier_required：`PLAYWRIGHT_CLI_SESSION=playability-20260227-150528 ./.codex/skills/playwright/scripts/playwright_cli.sh eval '() => JSON.stringify(window.__AW_TEST__?.getState?.() ?? null)'`
  - test_tier_required：`PLAYWRIGHT_CLI_SESSION=playability-20260227-150528 ./.codex/skills/playwright/scripts/playwright_cli.sh eval '() => { try { return JSON.stringify(window.__AW_TEST__?.runSteps?.(30) ?? null); } catch (e) { return String(e); } }'`
  - test_tier_required：`PLAYWRIGHT_CLI_SESSION=playability-20260227-150528 ./.codex/skills/playwright/scripts/playwright_cli.sh video-stop --filename output/playwright/playability/20260227-150528/playthrough.webm`
- 遗留事项：
  - 玩家输入语义仍不透明，`sendControl` 继续出现 `invalid action or payload`；需要在 UI 中补充动作字典与 payload 示例。
  - 本轮后半段出现 `tick` 停留（40）但无错误提示，建议补充“推进停滞原因”可视化反馈。

- 时刻：2026-02-27 15:21:55 CST
- 完成内容：完成“Viewer 首局目标与控制语义可解释反馈优化”T0（建档）。
  - 新增设计文档：`doc/world-simulator/viewer-first-session-goal-control-feedback-2026-02-27.md`。
  - 新增项目管理文档：`doc/world-simulator/viewer-first-session-goal-control-feedback-2026-02-27.project.md`。
  - 明确范围：首局主/短目标可视化、`sendControl` 可发现性、输入可解释反馈。
- 测试：
  - test_tier_required：`wc -l doc/world-simulator/viewer-first-session-goal-control-feedback-2026-02-27.md doc/world-simulator/viewer-first-session-goal-control-feedback-2026-02-27.project.md`
  - test_tier_required：`rg -n "目标|范围|接口/数据|里程碑|风险" doc/world-simulator/viewer-first-session-goal-control-feedback-2026-02-27.md`
  - test_tier_required：`rg -n "任务拆解|依赖|状态" doc/world-simulator/viewer-first-session-goal-control-feedback-2026-02-27.project.md`
- 遗留事项：
  - 执行 T1：首局目标卡片改造（主目标 + 两个短目标）。

- 时刻：2026-02-27 15:27:00 CST
- 完成内容：完成“Viewer 首局目标与控制语义可解释反馈优化”T1（首局主/短目标改造）。
  - 更新 `crates/agent_world_viewer/src/egui_right_panel_player_guide.rs`：
    - `PlayerMissionLoopSnapshot` 新增 `short_goals` 字段，结构化输出 `2` 个短目标。
    - 新增 `PlayerShortGoalSnapshot`，按 `PlayerGuideStep` + 进度映射短目标文案与完成态。
    - Mission HUD 渲染改为显式显示“主目标 + 短目标”块，满足首局目标可见化。
  - 更新 `crates/agent_world_viewer/src/egui_right_panel_player_mission_tests.rs`：补充短目标文案与完成态断言。
  - 更新项目管理文档：`doc/world-simulator/viewer-first-session-goal-control-feedback-2026-02-27.project.md`，标记 T1 完成并进入 T2/T3。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer player_mission_hud -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer build_player_mission_loop_snapshot -- --nocapture`
- 遗留事项：
  - 执行 T2/T3：补齐 `sendControl` 动作字典/示例入口与结构化输入反馈。

- 时刻：2026-02-27 15:37:14 CST
- 完成内容：完成“Viewer 首局目标与控制语义可解释反馈优化”T2/T3（控制语义可发现 + 输入可解释反馈）。
  - 更新 `crates/agent_world_viewer/src/web_test_api.rs`：
    - 新增 `describeControls()`：返回可用动作清单、说明与 payload 示例。
    - 新增 `fillControlExample(action)`：一键填充动作与示例 payload。
    - `sendControl(action, payload)` 改为返回结构化对象（`accepted/action/parsedControl/reason/hint/effect/delta*`），不再只有 `null`。
    - `getState()` 新增 `lastControlFeedback`，用于读取最近一次输入的解释与世界变化摘要。
    - dispatch 流程补充失败分支反馈（如无 client、`eventSeq` 不在窗口内）并给出下一步提示。
    - 在状态发布阶段补充控制输入后效应跟踪（`logicalTime/eventSeq` delta）。
  - 更新项目管理文档：`doc/world-simulator/viewer-first-session-goal-control-feedback-2026-02-27.project.md`，标记 T2/T3 完成并进入 T4。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world_viewer --target wasm32-unknown-unknown`
- 遗留事项：
  - 执行 T4：回归测试与文档收口，完成本阶段结项。

- 时刻：2026-02-27 15:39:25 CST
- 完成内容：完成“Viewer 首局目标与控制语义可解释反馈优化”T4（测试与收口）。
  - 更新设计文档：`doc/world-simulator/viewer-first-session-goal-control-feedback-2026-02-27.md`，新增“完成态（2026-02-27）”。
  - 更新项目管理文档：`doc/world-simulator/viewer-first-session-goal-control-feedback-2026-02-27.project.md`，标记 T4 完成，状态收敛为“已完成（T0~T4）”。
  - 本阶段交付闭环完成：首局主/短目标、控制语义发现、输入解释反馈均已落地。
- 测试：
  - test_tier_required（T1 提交前）：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required（T1 提交前）：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer player_mission_hud -- --nocapture`
  - test_tier_required（T1 提交前）：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer build_player_mission_loop_snapshot -- --nocapture`
  - test_tier_required（T2/T3 提交前）：`env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
  - test_tier_required（T2/T3 提交前）：`env -u RUSTC_WRAPPER cargo check -p agent_world_viewer --target wasm32-unknown-unknown`
  - test_tier_required（pre-commit 全量门禁）：`cargo test -p agent_world --tests --features test_tier_required`、`cargo test -p agent_world_consensus --lib`、`cargo test -p agent_world_distfs --lib`、`cargo test -p agent_world_viewer`、`cargo check -p agent_world_viewer --target wasm32-unknown-unknown`
- 遗留事项：
  - 无（本项目任务已全部完成）。

- 时刻：2026-02-27 16:09:49 CST
- 完成内容：完成“game-test 真实玩家追加复测”T16（按 `doc/game-test.md` 执行 Playwright 闭环并填写卡片）。
  - 使用 `./scripts/run-game-test.sh` 启动默认链路（`ws://127.0.0.1:5011`），执行 headed Playwright 实际游玩并录屏。
  - 新增测试卡片：`doc/playability_test_result/card_2026_02_27_16_06_17.md`。
  - 新增证据目录：`output/playwright/playability/20260227-160617/`（`playthrough.webm`、`step0~step3` 截图、console dump、playwright 过程日志、world/web 日志）。
  - 复测观测：`connectionStatus=connected`，`tick` 从 `6` 增长到 `28`；`sendControl("play", {})` 接受并返回推进反馈；`sendControl("move", ...)` 被拒并给出可用动作提示。
  - 更新项目管理文档：`doc/game-test.project.md`，标记 T16 完成并登记本轮产物与状态。
- 测试：
  - test_tier_full：`./scripts/run-game-test.sh`
  - test_tier_full：Playwright Web 闭环实玩（`open/snapshot/video-start/eval/press/console/video-stop/close`）
- 遗留事项：
  - UI 内仍缺少可用控制动作的直观入口，玩家需额外调用 `describeControls` 才能快速建立稳定控制策略。
- 时刻：2026-02-27 14:43:18 CST
- 完成内容：完成“可发行客户端启动器（Desktop）”T0（建档）。
  - 新增设计文档：`doc/world-simulator/game-client-launcher-desktop-2026-02-27.md`。
  - 新增项目管理文档：`doc/world-simulator/game-client-launcher-desktop-2026-02-27.project.md`。
  - 项目状态切换至 T1（实现桌面 GUI 启动器）。
- 测试：
  - 文档任务，无代码测试。
- 遗留事项：
  - 执行 T1：新增 `agent_world_client_launcher` 并接线 `world_game_launcher` 子进程控制与日志展示。

- 时刻：2026-02-27 14:49:50 CST
- 完成内容：完成“可发行客户端启动器（Desktop）”T1（GUI 启动器实现）。
  - 新增 crate：`crates/agent_world_client_launcher`（`Cargo.toml` + `src/main.rs`）。
  - 新增桌面启动器能力：
    - GUI 参数编辑（scenario/live-bind/web-bind/viewer host/port/static dir）。
    - 启动/停止 `world_game_launcher` 子进程。
    - stdout/stderr 日志滚动展示。
    - 一键打开游戏 URL。
    - 进程异常退出检测与状态回写。
  - 更新 workspace 成员：`Cargo.toml` 加入 `crates/agent_world_client_launcher`。
  - 更新项目管理文档：`doc/world-simulator/game-client-launcher-desktop-2026-02-27.project.md`，标记 T1 完成并进入 T2。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_client_launcher -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world_client_launcher`
- 遗留事项：
  - 执行 T2：更新 `build-game-launcher-bundle.sh`，打包客户端启动器并提供 `run-client.sh` 入口。

- 时刻：2026-02-27 14:54:39 CST
- 完成内容：完成“可发行客户端启动器（Desktop）”T2（打包脚本接入客户端启动器）。
  - 更新 `scripts/build-game-launcher-bundle.sh`：
    - 打包产物新增 `bin/agent_world_client_launcher`。
    - 新增客户端入口脚本 `run-client.sh`。
    - `README.txt` 与终端摘要同步新增 desktop launcher 入口说明。
  - 更新项目管理文档：`doc/world-simulator/game-client-launcher-desktop-2026-02-27.project.md`，标记 T2 完成并进入 T3。
- 测试：
  - test_tier_required：`bash -n scripts/build-game-launcher-bundle.sh`
  - test_tier_required：`./scripts/build-game-launcher-bundle.sh --help`
  - test_tier_required：`./scripts/build-game-launcher-bundle.sh --dry-run --web-dist site --out-dir .tmp/launcher_bundle_client_t2 --profile dev`
- 遗留事项：
  - 执行 T3：完成文档收口（项目状态、手册入口、验收记录）。

- 时刻：2026-02-27 14:57:03 CST
- 完成内容：完成“可发行客户端启动器（Desktop）”T3（文档与验收收口）。
  - 更新设计文档：`doc/world-simulator/game-client-launcher-desktop-2026-02-27.md`
    - 新增“手册入口（落地命令）”，明确 `run-client.sh` / `run-game.sh` 玩家启动路径。
    - 新增“完成态（2026-02-27）”，沉淀 M1~M3 完成结论。
  - 更新项目管理文档：`doc/world-simulator/game-client-launcher-desktop-2026-02-27.project.md`
    - 标记 T3 完成，项目状态收敛为“已完成（T0~T3）”。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world_client_launcher`
  - test_tier_required：`./scripts/build-game-launcher-bundle.sh --help`
- 遗留事项：
  - 无（当前项目文档任务已全部完成）。

- 时刻：2026-02-27 15:10:02 CST
- 完成内容：完成“可发行客户端启动器（Desktop）”T4（中文字体乱码修复）。
  - 更新 `crates/agent_world_client_launcher/src/main.rs`：
    - 启动阶段接入 `egui` CJK 字体安装逻辑，修复中文 UI 文本乱码。
    - 默认使用内置 CJK 字体（复用仓库字体资源）。
    - 支持 `AGENT_WORLD_CLIENT_LAUNCHER_FONT` 环境变量覆盖自定义字体路径。
    - 新增字体安装测试 `install_cjk_font_registers_font_and_priority`。
  - 更新设计文档：`doc/world-simulator/game-client-launcher-desktop-2026-02-27.md`，补充乱码修复完成态说明。
  - 更新项目管理文档：`doc/world-simulator/game-client-launcher-desktop-2026-02-27.project.md`，新增并标记 T4 完成。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_client_launcher -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world_client_launcher`
- 遗留事项：
  - 无（当前项目文档任务已全部完成）。

- 时刻：2026-02-27 15:14:58 CST
- 完成内容：完成“可发行客户端启动器（Desktop）”T5（默认启用 LLM）。
  - 更新 `crates/agent_world_client_launcher/src/main.rs`：
    - `LaunchConfig::default()` 中 `llm_enabled` 从默认关闭改为默认开启。
    - 新增回归测试 `launch_config_defaults_enable_llm`，确保默认值不回退。
  - 更新设计文档：`doc/world-simulator/game-client-launcher-desktop-2026-02-27.md`，在默认参数中补充“LLM 默认启用”。
  - 更新项目管理文档：`doc/world-simulator/game-client-launcher-desktop-2026-02-27.project.md`，新增并标记 T5 完成。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_client_launcher -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world_client_launcher`
- 遗留事项：
  - 无（当前项目文档任务已全部完成）。

- 时刻：2026-02-27 15:27:34 CST
- 完成内容：完成“可发行客户端启动器（Desktop）”T6（打包脚本 release 实跑修复）。
  - 更新 `scripts/build-game-launcher-bundle.sh`：
    - release/dev 均改为两步构建：
      - `agent_world`（`world_game_launcher` + `world_viewer_live`）
      - `agent_world_client_launcher`
    - 修复多包 `cargo build ... --bin ...` 过滤导致 `agent_world_client_launcher` 未产出的问题。
  - 更新设计文档：`doc/world-simulator/game-client-launcher-desktop-2026-02-27.md`，补充 release 构建修复说明。
  - 更新项目管理文档：`doc/world-simulator/game-client-launcher-desktop-2026-02-27.project.md`，新增并标记 T6 完成。
- 测试：
  - test_tier_required：`bash -n scripts/build-game-launcher-bundle.sh`
  - test_tier_required：`./scripts/build-game-launcher-bundle.sh --out-dir output/release/game-launcher-local --web-dist site`
- 遗留事项：
  - 无（当前项目文档任务已全部完成）。

- 时刻：2026-02-27 16:00:38 CST
- 完成内容：完成“可发行客户端启动器（Desktop）”T7（前端资源误用与打包路径修复）。
  - 更新 `scripts/build-game-launcher-bundle.sh`：
    - `--web-dist` 新增防误用校验：当误传 `site/` 文档站目录时直接报错并给出提示，避免启动后跳到 GitHub Pages/官网页面。
    - `trunk build` 调用改为 `env -u NO_COLOR trunk build`，修复 `NO_COLOR=1` 环境下 trunk 参数报错。
    - 规范 `OUT_DIR` 为绝对路径，修复 `trunk build --dist` 在子目录执行时把产物写错位置的问题。
  - 更新设计文档：`doc/world-simulator/game-client-launcher-desktop-2026-02-27.md`，补充上述脚本修复说明。
  - 更新项目管理文档：`doc/world-simulator/game-client-launcher-desktop-2026-02-27.project.md`，新增并标记 T7 完成。
- 测试：
  - test_tier_required：`bash -n scripts/build-game-launcher-bundle.sh`
  - test_tier_required（误用拦截）：`./scripts/build-game-launcher-bundle.sh --out-dir output/release/game-launcher-local --web-dist site`
  - test_tier_required（正确链路实跑）：`./scripts/build-game-launcher-bundle.sh --out-dir output/release/game-launcher-local`
  - 产物校验：`output/release/game-launcher-local/web/index.html` 为 `Agent World Viewer (Web)`，并包含 `agent_world_viewer-*.js` / `agent_world_viewer-*_bg.wasm`。
- 遗留事项：
  - 无（当前项目文档任务已全部完成）。

- 时刻：2026-02-27 16:40:20 CST
- 完成内容：完成“game-test A/B 分段量化复测闭环优化”T17（稳定脚本 + 卡片量化字段 + 手册收口）。
  - 新增脚本：`scripts/run-game-test-ab.sh`
    - 默认 headed 真实玩家链路；支持 `--headless`、`--url`、`--startup-timeout`。
    - 自动执行 A/B 分段控制实验：A=`play/pause`，B=`step/seek`，并附带无效动作探针（`move`）。
    - 自动落盘证据：录屏、固定命名截图、console dump、启动日志。
    - 自动落盘量化结果：`ab_metrics.json`、`ab_metrics.md`、`card_quant_metrics.md`。
  - 更新模板：`doc/playability_test_card.md` 新增“零、量化指标”区块（TTFC/有效控制命中率/无进展窗口/A-B 结论）。
  - 更新手册：`doc/game-test.md` 新增 A/B 量化复测入口与产物说明。
  - 更新项目管理文档：`doc/game-test.project.md` 新增并勾选 T17，登记量化产物与风险观测。
  - 实跑产物：`output/playwright/playability/20260227-163758/`。
    - 本轮量化结果：TTFC=`null`，有效控制命中率=`0/3`，无进展窗口=`6162ms`，`tick` 保持 `0`；A/B 均 FAIL。
    - 说明：脚本可稳定捕获“连接可达但不可推进”故障。
- 测试：
  - test_tier_required：`bash -n scripts/run-game-test-ab.sh scripts/run-game-test.sh`
  - test_tier_required：`./scripts/run-game-test-ab.sh --help`
  - test_tier_full：`./scripts/run-game-test-ab.sh`
- 遗留事项：
  - 需在 UI 主界面直接暴露可用控制动作与 payload 示例，减少玩家必须依赖 `describeControls` 的发现成本。

- 时刻：2026-02-27 16:47:56 CST
- 完成内容：完成“game-test 手册改版同步”T18（尊重用户锁定手册并同步项目状态）。
  - 用户将 `doc/game-test.md` 收敛为最小执行手册，并显式标注“你不能改这个文档”。
  - 未改动 `doc/game-test.md`；仅更新 `doc/game-test.project.md`：
    - 新增并勾选 T18。
    - 记录手册改版事实与文档约束风险。
    - 更新当前阶段为“手册改版同步已完成”。
- 测试：
  - test_tier_required：`rg -n "你不能改这个文档|可玩性测试|一键启动" doc/game-test.md`
  - test_tier_required：`rg -n "T18|手册改版|文档约束" doc/game-test.project.md`
  - test_tier_required：`bash -n scripts/run-game-test.sh`
- 遗留事项：
  - 后续若需恢复 A/B 量化流程说明，应新增外围文档（不直接修改 `doc/game-test.md`）。

- 时刻：2026-02-27 17:24:27 CST
- 完成内容：完成“game-test 文档治理白名单”T19（修复提交被基线拦截）。
  - 更新 `scripts/doc-governance-check.sh`：
    - 增加 `DESIGN_SECTION_EXEMPT_PROJECT_DOCS` 白名单机制。
    - 将 `doc/game-test.project.md` 加入白名单，仅跳过其配对设计文档章节校验。
    - 保持配对设计文档存在性检查不变，避免治理规则被整体绕过。
  - 更新 `doc/game-test.project.md`：
    - 新增并勾选 T19。
    - 记录“白名单最小化使用”的治理风险约束。
- 测试：
  - test_tier_required：`bash -n scripts/doc-governance-check.sh`
  - test_tier_required：`./scripts/doc-governance-check.sh`
- 遗留事项：
  - 后续如需新增白名单，需在对应项目文档同步记录原因与范围，避免白名单扩散。
- 时刻：2026-02-27 17:11:30 CST
- 完成内容：完成 Intent/分布式/生产物流闭环项目 T0（建档）。
  - 新增设计文档：`doc/world-simulator/intent-distributed-runtime-closure-2026-02-27.md`。
  - 新增项目管理文档：`doc/world-simulator/intent-distributed-runtime-closure-2026-02-27.project.md`。
- 测试：
  - test_tier_required：文档任务，无代码变更测试。
- 遗留事项：
  - 继续执行 T1。

- 时刻：2026-02-27 17:11:30 CST
- 完成内容：完成 T1（Intent 批次执行与冲突裁决）。
  - `WorldKernel` 新增批次入口：`step_intents_batch` / `step_intents_batch_from_envelopes`。
  - 新增 `IntentBatchReport` 与冲突解释，支持同 tick 冲突可复现、可解释。
  - `AgentRunner` 新增 `tick_collect_intents_and_commit`，支持同 tick 收集多个 agent intent 后统一提交。
  - 新增测试：`agent_runner_batch_intents_conflict_is_deterministic_and_explainable`。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world simulator::tests::runner::agent_runner_batch_intents_conflict_is_deterministic_and_explainable -- --nocapture`
- 遗留事项：
  - 继续执行 T2。

- 时刻：2026-02-27 17:11:30 CST
- 完成内容：完成 T2（分布式幂等键与批次哈希增强）。
  - `agent_world_proto::distributed::ActionEnvelope` 新增 `intent_batch_hash`、`idempotency_key`、`zone_id`。
  - `ActionMempool` 增加 `(actor_id,idempotency_key)` 去重索引。
  - 批次哈希输入扩展为 `action_id + intent_batch_hash + idempotency_key`。
  - 新增按 zone 分批 API：`take_zone_batches_with_rules`。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_consensus mempool_ -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_consensus batch_id_is_stable_with_intent_hash_and_idempotency_keys -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_consensus take_zone_batches_segments_actions_by_zone -- --nocapture`
- 遗留事项：
  - 继续执行 T3。

- 时刻：2026-02-27 17:11:30 CST
- 完成内容：完成 T3（生产队列优先级）。
  - `runtime/world/economy.rs` 为 due build/recipe 队列增加优先级排序：保命 > 供能 > 扩产 > 扩张。
  - 增加资源压力感知（低电力、低硬件件数）对优先级的提升。
  - 新增测试：`due_recipe_jobs_prioritize_survival_over_expansion`。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::economy::due_recipe_jobs_prioritize_survival_over_expansion -- --nocapture`
- 遗留事项：
  - 继续执行 T4。

- 时刻：2026-02-27 17:11:30 CST
- 完成内容：完成 T4（物流 SLA 指标）。
  - `World` 新增 `logistics_sla_metrics` 及 `breach_rate/fulfillment_rate/average_delay_ticks`。
  - `process_due_material_transits` 在完工时记录 SLA 履约与延迟。
  - 新增测试：`logistics_sla_metrics_are_observable_after_transit_completion`。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::economy::logistics_sla_metrics_are_observable_after_transit_completion -- --nocapture`
- 遗留事项：
  - 继续执行 T5。

- 时刻：2026-02-27 17:11:30 CST
- 完成内容：完成 T5（情报 TTL 缓存）。
  - `WorldKernel` 新增 `intel_ttl_ticks` 与观测缓存。
  - `observe` 支持 TTL 内命中缓存、过期后回源刷新。
  - 新增测试：`observation_intel_ttl_uses_cached_view_until_expired`。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world simulator::tests::runner::observation_intel_ttl_uses_cached_view_until_expired -- --nocapture`
- 遗留事项：
  - 继续执行 T6。

- 时刻：2026-02-27 17:11:30 CST
- 完成内容：完成 T6（区域自治 + 全局协调基础）。
  - `LeaseManager` 扩展 `ScopedLeaseManager`，支持按 zone 独立租约。
  - 新增测试：`scoped_manager_allows_parallel_zone_leases`、`scoped_manager_blocks_conflict_within_same_zone`。
  - `ActionMempool` 新增 zone 批次聚合接口，形成区域边界清晰的批次输出。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_consensus scoped_manager_ -- --nocapture`
- 遗留事项：
  - 继续执行 T7。

- 时刻：2026-02-27 17:11:30 CST
- 完成内容：完成 T7（威胁热图）。
  - `World` 新增 `threat_heatmap` 与刷新逻辑，按战争/危机场景输出风险指数。
  - 在 runtime `step` / `step_with_modules` 周期接入热图刷新。
  - 新增测试：`threat_heatmap_tracks_active_war_and_crisis_risk`。
  - 更新项目文档状态为已完成（T0~T7）。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world threat_heatmap_tracks_active_war_and_crisis_risk -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world -p agent_world_consensus -p agent_world_proto -p agent_world_net`
- 遗留事项：
  - 无（本项目任务已收口）。

- 时刻：2026-02-27 17:15:59 CST
- 完成内容：补充一次结构化维护任务（测试文件拆分以满足单文件行数约束）。
  - 将 `runtime/tests/economy.rs` 中新增的优先级与物流 SLA 两个测试拆分到新文件 `runtime/tests/economy_priority_logistics.rs`。
  - 在 `runtime/tests/mod.rs` 注册新测试模块，保持测试语义与断言不变。
  - `runtime/tests/economy.rs` 行数从 1307 降至 1195，满足单 Rust 文件不超过 1200 行约束。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world -p agent_world_consensus -p agent_world_proto -p agent_world_net`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world due_recipe_jobs_prioritize_survival_over_expansion`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world logistics_sla_metrics_are_observable_after_transit_completion`
- 遗留事项：
  - 无（本次维护任务收口）。

- 时刻：2026-02-27 17:22:14 CST
- 完成内容：修复 Intent 批次重构引入的规则上下文时间回归。
  - 调整 `kernel/step.rs`：恢复“规则读取旧 tick 上下文时间，事件以新 tick 落账”的语义。
  - 单步与批次执行均改为 `rule_context_time` 与 `event_time` 分离，避免 pre-action hook/wasm 观测时间漂移。
  - 修复后 `kernel_rule_decisions` 与 wasm rule bridge 相关断言恢复通过。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world kernel_pre_action_rule_can_read_kernel_time_context`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world kernel_wasm_pre_action_evaluator_can_allow_and_read_context`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world kernel_wasm_sandbox_bridge_allow_path_captures_encoded_request`
- 遗留事项：
  - 无。

- 时刻：2026-02-27 18:13:01 CST
- 完成内容：完成 builtin wasm hash 路线（B）收口，修复严格验签下的 bootstrap 失败。
  - 更新 hash 清单：
    - `crates/agent_world/src/runtime/world/artifacts/m1_builtin_modules.sha256`（`m1.power.radiation_harvest` Linux hash 更新）
    - `crates/agent_world/src/runtime/world/artifacts/m5_builtin_modules.sha256`（5 个 gameplay 模块 hash 更新）
  - 重新补齐并重签 identity：`m1/m4/m5 *_builtin_modules.identity.json`，恢复 `signer_node_id/signature_scheme/artifact_signatures` 完整字段。
  - 同步 runtime 内置 signer 公钥：`crates/agent_world/src/runtime/world/mod.rs`。
  - 修复随 hash 变更失效的测试锚点：`crates/agent_world/src/runtime/tests/builtin_wasm_identity.rs` 中 m5 war hash 更新为新值。
  - 更新项目管理文档：`doc/p2p/builtin-wasm-identity-consensus.project.md`，新增并完成 BWI-14。
- 测试：
  - test_tier_required：`./scripts/sync-m1-builtin-wasm-artifacts.sh --check`
  - test_tier_required：`./scripts/sync-m4-builtin-wasm-artifacts.sh --check`
  - test_tier_required：`./scripts/sync-m5-builtin-wasm-artifacts.sh --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world install_power_bootstrap_modules_is_idempotent -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world step_with_modules_uses_gameplay_tick_modules_without_fallback -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::builtin_wasm_identity -- --nocapture`
- 遗留事项：
  - 无。

- 时刻：2026-02-27 18:45:29 CST
- 完成内容：完成“Viewer 首局目标清晰度加固（2026-02-27）”T0（建档）。
  - 新增设计文档：`doc/world-simulator/viewer-first-session-goal-clarity-hardening-2026-02-27.md`。
  - 新增项目管理文档：`doc/world-simulator/viewer-first-session-goal-clarity-hardening-2026-02-27.project.md`。
  - 明确范围：聚焦首局目标清晰度（动作句/完成条件/耗时、次任务折叠、卡住提示、首局结算），不改 runtime 规则。
- 测试：
  - 文档任务，无代码测试。
- 遗留事项：
  - 执行 T1：实现主任务结构化文案与次任务折叠。

- 时刻：2026-02-27 18:49:46 CST
- 完成内容：完成“Viewer 首局目标清晰度加固（2026-02-27）”T1（主任务结构化 + 次任务折叠）。
  - 更新 `crates/agent_world_viewer/src/egui_right_panel_player_guide.rs`：
    - `PlayerMissionLoopSnapshot` 新增 `completion_condition`、`eta` 字段。
    - 主任务文本改为动作句（action sentence），并补充“完成条件 + 预计耗时”展示。
    - 短目标改为 `CollapsingHeader` 默认折叠，降低首屏信息密度。
  - 更新 `crates/agent_world_viewer/src/egui_right_panel_player_mission_tests.rs`：同步断言新主任务结构字段与动作句文案。
  - 更新项目管理文档：`doc/world-simulator/viewer-first-session-goal-clarity-hardening-2026-02-27.project.md`，标记 T1 完成并进入 T2。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer player_mission_hud -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer build_player_mission_loop_snapshot -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
- 遗留事项：
  - 执行 T2：补齐“下一步”按钮语义与主任务剩余提示。

- 时刻：2026-02-27 18:52:57 CST
- 完成内容：完成“Viewer 首局目标清晰度加固（2026-02-27）”T2（下一步按钮语义 + 主任务剩余提示）。
  - 更新 `crates/agent_world_viewer/src/egui_right_panel_player_guide.rs`：
    - 主任务按钮统一为“执行下一步”语义文案（按步骤给出明确 CTA）。
    - 新增 `build_player_mission_remaining_hint(...)`，按当前引导步骤与世界状态输出剩余目标提示。
    - 探索阶段点击“执行下一步”时自动切换到 Command 布局，并尝试发送 `ViewerControl::Play`。
    - `render_player_mission_hud` 新增 `client` 入参用于探索阶段直达推进。
  - 更新 `crates/agent_world_viewer/src/egui_right_panel_player_experience.rs` 与 `crates/agent_world_viewer/src/egui_right_panel.rs`：补齐 `client` 调用链传递。
  - 更新 `crates/agent_world_viewer/src/egui_right_panel_player_mission_tests.rs`：新增剩余提示断言并同步 CTA 文案断言。
  - 更新项目管理文档：`doc/world-simulator/viewer-first-session-goal-clarity-hardening-2026-02-27.project.md`，标记 T2 完成并进入 T3。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer player_mission_tests:: -- --nocapture`（10 passed）
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
- 遗留事项：
  - 执行 T3：加入 5 秒无进展卡住检测与恢复提示。

- 时刻：2026-02-27 18:55:15 CST
- 完成内容：完成“Viewer 首局目标清晰度加固（2026-02-27）”T3（5 秒无进展卡住检测与恢复提示）。
  - 更新 `crates/agent_world_viewer/src/egui_right_panel_player_experience.rs`：
    - `PlayerOnboardingState` 新增 `no_progress_watch`，跟踪最近进展的 `tick/event_count/time`。
    - 新增 `sync_player_stuck_hint_state(...)`：连接成功后连续 5 秒无进展触发卡住提示；一旦有进展自动清除。
    - 新增 `build_player_stuck_hint(...)`：按当前引导步骤输出恢复动作提示文案。
    - `render_player_experience_layers(...)` 接入 stuck hint 生成并传给 mission HUD。
  - 更新 `crates/agent_world_viewer/src/egui_right_panel_player_guide.rs`：mission HUD 新增橙色卡住提示块。
  - 更新 `crates/agent_world_viewer/src/egui_right_panel_tests.rs`：注册新测试模块。
  - 新增 `crates/agent_world_viewer/src/egui_right_panel_player_stuck_tests.rs`：覆盖阈值触发、进展清除、提示文案三类断言。
  - 更新项目管理文档：`doc/world-simulator/viewer-first-session-goal-clarity-hardening-2026-02-27.project.md`，标记 T3 完成并进入 T4。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer player_stuck_tests:: -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer player_mission_tests:: -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
- 遗留事项：
  - 执行 T4：补齐首局结算卡片与本阶段收口。

- 时刻：2026-02-27 18:58:18 CST
- 完成内容：完成“Viewer 首局目标清晰度加固（2026-02-27）”T4（首局结算卡片 + 测试 + 文档收口）。
  - 更新 `crates/agent_world_viewer/src/egui_right_panel_player_experience.rs`：
    - `PlayerOnboardingState` 新增首局统计基线与 summary 显示状态。
    - 新增 `sync_player_first_session_summary_state(...)`、`build_player_first_session_summary_snapshot(...)`、`render_player_first_session_summary(...)`，实现首局完成后一次性回顾卡片（时长、tick 增量、事件增量、下一步建议）。
    - 新增 `dismiss_player_first_session_summary(...)`，支持关闭结算卡片。
  - 更新 `crates/agent_world_viewer/src/egui_right_panel_tests.rs`：注册 summary 测试模块。
  - 新增 `crates/agent_world_viewer/src/egui_right_panel_player_summary_tests.rs`：覆盖 summary 可见性触发与统计快照断言。
  - 更新设计文档：`doc/world-simulator/viewer-first-session-goal-clarity-hardening-2026-02-27.md`，补充“完成态（2026-02-27）”。
  - 更新项目管理文档：`doc/world-simulator/viewer-first-session-goal-clarity-hardening-2026-02-27.project.md`，标记 T4 完成，状态收敛为“已完成（T0~T4）”。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer player_summary_tests:: -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer player_stuck_tests:: -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer player_mission_tests:: -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
- 遗留事项：
  - 无（本项目任务已完成）。

- 时刻：2026-02-27 19:35:21 CST
- 完成内容：完成 game-test 追加任务 T20（首局目标清晰度加固后 A/B 实机复测 + 卡片落盘）。
  - 复用已启动链路 `http://127.0.0.1:4173/?ws=ws://127.0.0.1:5011&test_api=1`，执行 `scripts/run-game-test-ab.sh --url ... --headed`。
  - 新增证据目录：`output/playwright/playability/20260227-193149/`（`playthrough.webm`、截图、`playwright.log`、console dump、`ab_metrics.json/md`）。
  - 补齐启动链路证据副本：`startup.session.meta`、`startup.world.initial.log`、`startup.web.initial.log`。
  - 新增测试卡片：`doc/playability_test_result/card_2026_02_27_19_32_27.md`。
  - 更新项目管理文档：`doc/game-test.project.md`（新增并完成 T20，补充本轮测试记录与风险观测）。
- 测试：
  - test_tier_required：`./scripts/run-game-test-ab.sh --url 'http://127.0.0.1:4173/?ws=ws://127.0.0.1:5011&test_api=1' --headed`
- 遗留事项：
  - `step` 在本轮出现 accepted 但未推进（B 段 FAIL），后续仍需在控制反馈层补“未推进原因”可视化解释。

- 时刻：2026-02-27 19:48:08 CST
- 完成内容：完成 game-test 追加任务 T21（按 `doc/game-test.md` 实机游玩 + 录屏 + 卡片填写）。
  - 按手册执行 `./scripts/run-game-test-ab.sh --headed`，走 `run-game-test.sh` 默认链路并完成一轮 A/B 控制复测。
  - 新增证据目录：`output/playwright/playability/20260227-194519/`（`playthrough.webm`、步骤截图、`playwright.log`、`ab_metrics.json/md`）。
  - 新增测试卡片：`doc/playability_test_result/card_2026_02_27_19_47_08.md`。
  - 更新项目管理文档：`doc/game-test.project.md`（新增并完成 T21，补充本轮测试记录与风险观测）。
- 测试：
  - test_tier_required：`./scripts/run-game-test-ab.sh --headed`
- 遗留事项：
  - `step` 在本轮仍出现 accepted 但不推进（`tick 2 -> 2`，B 段 FAIL），后续仍需补“未推进原因 + 下一步建议”的可视化反馈。

- 时刻：2026-02-27 20:01:07 CST
- 完成内容：完成“游戏设计师视角迭代清单”文档任务（基于最新可玩性卡片）。
  - 新增设计文档：`doc/world-simulator/viewer-control-feedback-iteration-checklist-2026-02-27.md`。
  - 新增项目管理文档：`doc/world-simulator/viewer-control-feedback-iteration-checklist-2026-02-27.project.md`。
  - 清单聚焦控制反馈闭环（P0/P1/P2）、量化目标（TTFC/有效命中率/无进展窗口）与下一轮验收口径。
- 测试：
  - test_tier_required：`./scripts/doc-governance-check.sh`
- 遗留事项：
  - 无（本次为文档与迭代计划任务，实施工作待后续按清单执行）。

- 时刻：2026-02-27 20:21:20 CST
- 完成内容：完成“Viewer 控制反馈迭代清单”实现阶段 T4~T7（P0）。
  - 更新 `crates/agent_world_viewer/src/web_test_api.rs`：
    - 控制反馈新增阶段字段 `stage` 与入队标记 `enqueued`，覆盖 `received/executing/applied/blocked`。
    - 在 `publish_web_test_api_state` 增加 connected 下“长期无增量”阻断判定（stall），输出阻断原因与下一步提示。
    - 新增 `latest_web_test_api_control_feedback()`，为 HUD 提供最新控制反馈快照。
  - 更新 `crates/agent_world_viewer/src/egui_right_panel_player_guide.rs`：
    - Mission HUD 增加“控制反馈”卡片（动作、阶段、effect、reason、hint）。
    - 卡住提示区增加恢复快捷动作按钮：`play` / `step x8` / `seek +12`。
    - 维持文件行数约束：`egui_right_panel_player_guide.rs` 当前 `1200` 行。
  - 更新项目管理文档：`doc/world-simulator/viewer-control-feedback-iteration-checklist-2026-02-27.project.md`，标记 T4~T7 完成。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer player_mission_tests:: -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
- 遗留事项：
  - 当前新增的控制反馈卡片主要消费 Web Test API 的 `lastControlFeedback`；后续可继续扩展到非 Web test 路径下的统一反馈源。
- 时刻：2026-02-27 19:34:36 CST
- 完成内容：完成“结合当前游戏现状的产业链可借鉴点文档”任务。
  - 新增设计文档：`doc/world-simulator/m4/m4-industrial-benchmark-current-state-2026-02-27.md`
    - 基于当前实现整理资源/工业链/物流/治理现状基线。
    - 输出 P0/P1/P2 可借鉴点、接口增量建议、里程碑与风险。
    - 文档中避免使用禁用关键字（按本轮约束执行）。
  - 新增项目管理文档：`doc/world-simulator/m4/m4-industrial-benchmark-current-state-2026-02-27.project.md`
    - 完成 T0~T3 拆解与状态收口。
- 测试：
  - 文档约束校验：`wc -l doc/world-simulator/m4/m4-industrial-benchmark-current-state-2026-02-27.md doc/world-simulator/m4/m4-industrial-benchmark-current-state-2026-02-27.project.md`（均 < 500 行）
  - 关键字校验：`rg -n "Screeps: World|Screeps" doc/world-simulator/m4/m4-industrial-benchmark-current-state-2026-02-27.md doc/world-simulator/m4/m4-industrial-benchmark-current-state-2026-02-27.project.md`（无匹配）
- 遗留事项：
  - 若进入实现阶段，优先立项 P0：共享中间件竞争与物流时效分层，并补齐 `test_tier_required/test_tier_full` 闭环。

- 时刻：2026-02-27 19:45:22 CST
- 完成内容：完成“资源与产品系统（合理性+可玩性）”设计任务。
  - 新增设计文档：`doc/world-simulator/m4/m4-resource-product-system-playability-2026-02-27.md`
    - 基于当前实现基线给出资源/产品分层（R0~R5）、可玩性闭环（前中后期）与合理性机制（维护/回收/运损/防通胀）。
    - 给出可直接对接当前 runtime 的接口/数据建议（`MaterialProfileV1`、`ProductProfileV1`、`RecipeProfileV1`、运输优先级、阶段进度状态）。
    - 明确 P0/P1/P2 里程碑与 `test_tier_required/test_tier_full` 验收口径。
  - 新增项目管理文档：`doc/world-simulator/m4/m4-resource-product-system-playability-2026-02-27.project.md`
    - 完成 T0~T3 拆解与状态收口。
- 测试：
  - 文档行数约束：`wc -l doc/world-simulator/m4/m4-resource-product-system-playability-2026-02-27.md doc/world-simulator/m4/m4-resource-product-system-playability-2026-02-27.project.md`（均 < 500 行）。
  - 关键字约束：`rg -n "Screeps|Screeps: World" doc/world-simulator/m4/m4-resource-product-system-playability-2026-02-27.md doc/world-simulator/m4/m4-resource-product-system-playability-2026-02-27.project.md`（无匹配）。
- 遗留事项：
  - 下一阶段可按 P0 立项实现：共享中间件竞争与运输优先级。

- 时刻：2026-02-27 19:52:19 CST
- 完成内容：完成“资源与产品系统 P0（共享中间件竞争 + 运输优先级）”T0 建档。
  - 新增设计文档：`doc/world-simulator/m4/m4-resource-product-system-p0-shared-bottleneck-logistics-priority-2026-02-27.md`。
  - 新增项目管理文档：`doc/world-simulator/m4/m4-resource-product-system-p0-shared-bottleneck-logistics-priority-2026-02-27.project.md`。
  - 项目状态设置为“进行中（下一步 T1 代码接线）”。
- 测试：
  - 文档任务，无代码测试。
- 遗留事项：
  - 执行 T1：完成 runtime 事件/状态/排序/指标接线。

- 时刻：2026-02-27 20:03:16 CST
- 完成内容：完成“资源与产品系统 P0（共享中间件竞争 + 运输优先级）”T1（代码接线）。
  - 更新 `crates/agent_world/src/runtime/events.rs`：
    - 新增 `MaterialTransitPriority`（`urgent`/`standard`，默认 `standard`）。
    - 为 `MaterialTransferred`、`MaterialTransitStarted`、`MaterialTransitCompleted` 接入 `priority` 字段并加 `serde(default)`。
    - 为 `RecipeStarted`、`RecipeCompleted` 接入 `bottleneck_tags` 字段并加 `serde(default)`。
  - 更新 `crates/agent_world/src/runtime/state.rs`、`crates/agent_world/src/runtime/state/apply_domain_event_industry.rs`：
    - `MaterialTransitJobState` 与 `RecipeJobState` 持久化新字段。
    - 事件应用链路完成 `priority/bottleneck_tags` 写入。
  - 更新 `crates/agent_world/src/runtime/world/event_processing/action_to_event_core.rs`：
    - 新增运输优先级推断（urgent 关键词命中）。
  - 更新 `crates/agent_world/src/runtime/world/event_processing/action_to_event_economy.rs`：
    - 新增 `bottleneck_tags` 推断并写入 `RecipeStarted`。
  - 更新 `crates/agent_world/src/runtime/world/economy.rs`：
    - `RecipeCompleted` 透传 `bottleneck_tags`。
    - 增加 bottleneck 低库存压力提升（优先级上调一级）并接入 recipe 完工排序。
  - 更新 `crates/agent_world/src/runtime/world/logistics.rs`、`crates/agent_world/src/runtime/world/mod.rs`：
    - 在途完工排序改为 `ready_at -> priority -> job_id`。
    - SLA 指标新增 urgent 维度计数（完成/按时/延迟/延迟总 tick）。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all`
- 遗留事项：
  - 执行 T2：补齐 required 测试并完成回归。

- 时刻：2026-02-27 20:03:16 CST
- 完成内容：完成“资源与产品系统 P0（共享中间件竞争 + 运输优先级）”T2（测试补齐与回归）。
  - 更新 `crates/agent_world/src/runtime/tests/economy_priority_logistics.rs`：
    - 新增 `bottleneck_pressure_bumps_recipe_completion_priority`。
    - 新增 `due_transits_prioritize_urgent_before_standard_with_same_ready_at`。
    - 扩展 `logistics_sla_metrics_and_priority_are_observable_after_transit_completion`，校验事件 priority 可观测及 urgent 指标。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::economy_priority_logistics -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::economy -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world`
- 遗留事项：
  - 执行 T3：回写项目管理文档状态并收口日志。

- 时刻：2026-02-27 20:03:16 CST
- 完成内容：完成“资源与产品系统 P0（共享中间件竞争 + 运输优先级）”T3（文档与日志收口）。
  - 更新 `doc/world-simulator/m4/m4-resource-product-system-p0-shared-bottleneck-logistics-priority-2026-02-27.project.md`：标记 T1/T2/T3 完成，状态收敛为“已完成（T0~T3）”。
  - 追加今日 devlog，记录 T1~T3 任务完成与测试闭环。
- 测试：
  - 文档任务，无新增代码测试（回归已在 T2 完成）。
- 遗留事项：
  - 无（P0 范围内事项已收口）。

- 时刻：2026-02-27 20:33:42 CST
- 完成内容：完成 game-test 追加任务 T22（按 `doc/game-test.md` 实机游玩 + 录屏 + 卡片填写）。
  - 执行 `./scripts/run-game-test-ab.sh --headed`，按手册一键起服并完成一轮真实玩家 A/B 控制复测。
  - 新增证据目录：`output/playwright/playability/20260227-202842/`（`playthrough.webm`、步骤截图、`playwright.log`、`ab_metrics.json/md`）。
  - 新增测试卡片：`doc/playability_test_result/card_2026_02_27_20_32_17.md`。
  - 更新项目管理文档：`doc/game-test.project.md`（新增并完成 T22，补充本轮测试记录与风险观测）。
- 测试：
  - test_tier_required：`./scripts/run-game-test-ab.sh --headed`
- 遗留事项：
  - B 段 `step` 在本轮仍为 accepted 但不推进（`tick 2 -> 2`）；建议后续继续优先补齐“未推进原因 + 下一步建议”反馈，降低玩家控制黑盒感。

- 时刻：2026-02-27 20:46:29 CST
- 完成内容：完成“Viewer 控制反馈 P0：Step 卡住恢复与强反馈”T0（建档）。
  - 新增设计文档：`doc/world-simulator/viewer-control-feedback-step-recovery-p0-2026-02-27.md`。
  - 新增项目管理文档：`doc/world-simulator/viewer-control-feedback-step-recovery-p0-2026-02-27.project.md`。
  - 明确范围：`step` 卡住自动恢复（`seek(tick+1)`）与 Cause/Next 强反馈文案，保持最小代码改动。
- 测试：
  - 文档任务，无代码测试。
- 遗留事项：
  - 执行 T1：落地 `web_test_api` 卡住恢复与强反馈实现。

- 时刻：2026-02-27 20:54:34 CST
- 完成内容：完成“Viewer 控制反馈 P0：Step 卡住恢复与强反馈”T1（代码实现）。
  - 更新 `crates/agent_world_viewer/src/web_test_api.rs`：
    - `publish_web_test_api_state` 接入 `ViewerClient`（可选）用于卡住恢复动作下发。
    - 当 `step` 在 connected 下超过阈值无增量时，自动补发 `seek(tick+1)`。
    - 将控制反馈文案升级为玩家可见的 Cause/Next 强反馈：
      - `reason`: `Cause: ...`
      - `hint`: `Next: ...`
      - `effect`: 明确记录是否触发自动恢复。
  - 约束处理：`web_test_api.rs` 行数保持 `1200`（未超上限）。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer player_mission_tests:: -- --nocapture`
- 遗留事项：
  - 执行 T2：A/B 实测并收口文档与日志。

- 时刻：2026-02-27 20:54:34 CST
- 完成内容：完成“Viewer 控制反馈 P0：Step 卡住恢复与强反馈”T2（实测与收口）。
  - 执行 `./scripts/run-game-test-ab.sh --headless`，产物目录：`output/playwright/playability/20260227-205043/`。
  - 结果：`phase_b_step` 从历史常见停滞改善为可推进（`tick 2 -> 3`）；但 `phase_b_seek` 本轮出现 `3 -> 3`，B 段整体仍 FAIL。
  - 更新设计/项目文档：
    - `doc/world-simulator/viewer-control-feedback-step-recovery-p0-2026-02-27.md`
    - `doc/world-simulator/viewer-control-feedback-step-recovery-p0-2026-02-27.project.md`
- 测试：
  - test_tier_required：`./scripts/run-game-test-ab.sh --headless`
- 遗留事项：
  - 建议后续单独立项：`seek` 无推进语义一致性治理（当前已非本次 T1 的 `step` 核心问题）。

- 时刻：2026-02-27 21:07:22 CST
- 完成内容：完成 game-test 追加任务 T23（按 `doc/game-test.md` 实机游玩 + 录屏 + 卡片填写）。
  - 启动一键链路：`./scripts/run-game-test.sh`（默认 `ws://127.0.0.1:5011`）。
  - 使用 Playwright headed 会话完成真实玩家控制复测，并录制视频。
  - 新增证据目录：`output/playwright/playability/20260227-210446/`（`playthrough.webm`、步骤截图、`ab_metrics.json/md`、控制台导出）。
  - 新增测试卡片：`doc/playability_test_result/card_2026_02_27_21_04_46.md`。
  - 更新项目管理文档：`doc/game-test.project.md`（新增并完成 T23，补充本轮测试记录与风险观测）。
- 测试：
  - test_tier_required：`./scripts/run-game-test.sh`
  - test_tier_required：`PLAYWRIGHT_CLI_SESSION=game-test-open-20260227-2100 ./.codex/skills/playwright/scripts/playwright_cli.sh run-code "<A/B playability probe>"`
- 遗留事项：
  - 本轮 A/B 均 PASS，但 `move` 仍触发 `sendControl ignored (unsupported action: move)`；建议在 UI 内持续强化动作白名单与示例参数提示，降低新玩家误操作成本。

- 时刻：2026-02-27 21:35:09 CST
- 完成内容：完成“Viewer Live 禁用 Seek（P2P 不可回退）”T0（建档）。
  - 新增设计文档：`doc/world-simulator/viewer-live-disable-seek-p2p-2026-02-27.md`。
  - 新增项目管理文档：`doc/world-simulator/viewer-live-disable-seek-p2p-2026-02-27.project.md`。
  - 明确范围：live 模式禁用 `seek`，并同步收敛 viewer/web_test_api 的动作暴露。
- 测试：
  - test_tier_required：`wc -l doc/world-simulator/viewer-live-disable-seek-p2p-2026-02-27.md doc/world-simulator/viewer-live-disable-seek-p2p-2026-02-27.project.md`（均 < 500 行）。
- 遗留事项：
  - 执行 T1：改造 live 控制处理，禁止 `ViewerControl::Seek` 在 live 模式生效。

- 时刻：2026-02-27 21:43:13 CST
- 完成内容：完成“Viewer Live 禁用 Seek（P2P 不可回退）”T1（live 控制处理收敛）。
  - 更新 `crates/agent_world/src/viewer/live_split_part2.rs`：`ViewerRequest::Control::Seek` 在 live 模式改为忽略，不再进入 deferred 控制队列。
  - 更新 `crates/agent_world/src/viewer/live_split_part1.rs`：移除 live loop 的 `SeekRequested` 信号与处理分支，避免 seek 执行路径残留。
  - 更新 `crates/agent_world/src/viewer/live/tests.rs`：将 seek 控制测试改为 `seek_control_is_ignored_in_live_request_handler`，并删除 live seek 时间跳转语义测试。
  - 更新 `crates/agent_world/src/viewer/live/consensus_bridge.rs`：`reset_pending` 收敛为 test-only，配合 live 结构字段 test-only 化，清理无用警告。
  - 更新项目管理文档：`doc/world-simulator/viewer-live-disable-seek-p2p-2026-02-27.project.md`（标记 T1 完成，进入 T2）。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world viewer::live::tests:: -- --nocapture`
- 遗留事项：
  - 执行 T2：收敛 viewer/web_test_api 对 `seek` 的动作暴露，保证玩家与测试入口一致。

- 时刻：2026-02-27 21:43:56 CST
- 完成内容：完成“Viewer Live 禁用 Seek（P2P 不可回退）”T2（viewer/test-api 入口收敛）。
  - 更新 `crates/agent_world_viewer/src/web_test_api.rs`：
    - 控制白名单收敛为 `play/pause/step`，移除 `seek/seek_event` 暴露与解析分支。
    - `step` 卡住自动恢复由 `seek` 改为 `play`，反馈文案同步改为无 seek 语义。
  - 更新 `crates/agent_world_viewer/src/egui_right_panel_controls.rs`：高级调试区移除 `Seek 0` 按钮。
  - 更新 `crates/agent_world_viewer/src/egui_right_panel_player_guide.rs`：卡住恢复按钮移除 `Recover: seek +12`，仅保留 `play/step`。
  - 更新 `crates/agent_world_viewer/src/egui_right_panel_tests.rs`：同步 UI 按钮断言。
  - 更新项目管理文档：`doc/world-simulator/viewer-live-disable-seek-p2p-2026-02-27.project.md`（标记 T2 完成，进入 T3）。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer egui_kittest_control_buttons_merge_play_pause_and_fold_advanced_debug -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer player_mission -- --nocapture`
- 遗留事项：
  - 执行 T3：完成项目文档结项与最终日志收口。

- 时刻：2026-02-27 21:44:27 CST
- 完成内容：完成“Viewer Live 禁用 Seek（P2P 不可回退）”T3（文档与日志收口）。
  - 更新项目管理文档：`doc/world-simulator/viewer-live-disable-seek-p2p-2026-02-27.project.md`，标记 T3 完成并结项（T0~T3）。
  - 追加今日 devlog，沉淀 T1/T2/T3 实施与测试结果。
- 测试：
  - 文档任务，无新增代码测试（T1/T2 回归已完成）。
- 遗留事项：
  - 可选后续：将 `scripts/run-game-test-ab.sh` 的 B 段量化从 `step/seek` 调整为无 seek 的等价探针，避免历史口径混淆。

- 时刻：2026-02-27 21:48:56 CST
- 完成内容：完成“run-game-test-ab 无 Seek 的 B 段量化口径”T0（建档）。
  - 新增设计文档：`doc/scripts/run-game-test-ab-no-seek-b-phase-2026-02-27.md`。
  - 新增项目管理文档：`doc/scripts/run-game-test-ab-no-seek-b-phase-2026-02-27.project.md`。
  - 明确范围：B 段不再使用 `seek`，改为纯 `step` 推进探针。
- 测试：
  - test_tier_required：`wc -l doc/scripts/run-game-test-ab-no-seek-b-phase-2026-02-27.md doc/scripts/run-game-test-ab-no-seek-b-phase-2026-02-27.project.md`（均 < 500 行）。
- 遗留事项：
  - 执行 T1：改造 `scripts/run-game-test-ab.sh` 的 B 段动作与指标文案。

- 时刻：2026-02-27 21:49:58 CST
- 完成内容：完成“run-game-test-ab 无 Seek 的 B 段量化口径”T1（脚本改造）。
  - 更新 `scripts/run-game-test-ab.sh`：B 段从 `step/seek` 改为纯 `step` 探针链路（`step x8` + `step x2`），保留无效动作探针 `move`。
  - 更新 A/B 量化摘要文案：`B (step chain)` / `B（step链路）`。
  - 更新项目管理文档：`doc/scripts/run-game-test-ab-no-seek-b-phase-2026-02-27.project.md`（标记 T1 完成，进入 T2）。
- 测试：
  - test_tier_required：`bash -n scripts/run-game-test-ab.sh`
  - test_tier_required：`./scripts/run-game-test-ab.sh --help`
- 遗留事项：
  - 执行 T2：完成项目文档结项与日志收口。

- 时刻：2026-02-27 21:50:45 CST
- 完成内容：完成“run-game-test-ab 无 Seek 的 B 段量化口径”T2（文档与日志收口）。
  - 更新项目管理文档：`doc/scripts/run-game-test-ab-no-seek-b-phase-2026-02-27.project.md`，标记 T2 完成并结项（T0~T2）。
  - 追加今日 devlog，沉淀本任务收口记录与测试结果。
- 测试：
  - test_tier_required：`wc -l doc/scripts/run-game-test-ab-no-seek-b-phase-2026-02-27.md doc/scripts/run-game-test-ab-no-seek-b-phase-2026-02-27.project.md`（均 < 500 行）。
- 遗留事项：
  - 无（本任务已结项）。

- 时刻：2026-02-27 22:02:26 CST
- 完成内容：完成“Viewer 控制面拆分：回放/Live 分离”T0（建档）。
  - 新增设计文档：`doc/world-simulator/viewer-control-plane-split-live-playback-2026-02-27.md`。
  - 新增项目管理文档：`doc/world-simulator/viewer-control-plane-split-live-playback-2026-02-27.project.md`。
  - 明确方案：协议新增 playback/live 控制面与 `HelloAck` profile，服务端拆分处理并兼容 legacy `Control`。
- 测试：
  - test_tier_required：`wc -l doc/world-simulator/viewer-control-plane-split-live-playback-2026-02-27.md doc/world-simulator/viewer-control-plane-split-live-playback-2026-02-27.project.md`（均 < 500 行）。
- 遗留事项：
  - 执行 T1：实现协议类型与 server/live 控制处理拆分。

- 时刻：2026-02-27 22:17:49 CST
- 完成内容：完成“Viewer 控制面拆分：回放/Live 分离”T1（协议与 server/live 处理拆分）。
  - 更新 `crates/agent_world_proto/src/viewer.rs`：
    - 新增 `ViewerControlProfile`、`PlaybackControl`、`LiveControl`。
    - `ViewerRequest` 新增 `PlaybackControl`/`LiveControl` 请求变体，并保留 legacy `Control`。
    - `ViewerResponse::HelloAck` 增加 `control_profile`（serde default 兼容旧 payload）。
    - 增加 control 类型转换与 round-trip/兼容测试。
  - 更新 `crates/agent_world/src/viewer/{protocol.rs,mod.rs}`：导出新控制面类型。
  - 更新 `crates/agent_world/src/viewer/server.rs`：
    - `HelloAck` 声明 `control_profile=playback`。
    - 回放服务新增 `handle_playback_control`，并对 `PlaybackControl`/legacy `Control` 执行回放语义。
    - `LiveControl` 在离线回放服务返回 unsupported 错误。
  - 更新 `crates/agent_world/src/viewer/live_split_part{1,2}.rs`：
    - `HelloAck` 声明 `control_profile=live`。
    - live 服务新增统一控制应用函数，接收 `LiveControl`/`PlaybackControl`/legacy `Control`，并保持 seek 忽略策略。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world_proto -p agent_world`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_proto -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world viewer::protocol::tests::viewer_request_round_trip -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world viewer::live::tests::step_control_is_deferred_from_request_handler -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world viewer::live::tests::seek_control_is_ignored_in_live_request_handler -- --nocapture`
- 遗留事项：
  - 执行 T2：viewer 根据 `HelloAck.control_profile` 发送对应控制请求，并在 live 收敛 seek 发送入口。

- 时刻：2026-02-27 23:02:45 CST
- 完成内容：完成“Viewer 控制面拆分：回放/Live 分离”T2（viewer 按 profile 路由控制发送）。
  - 更新 `crates/agent_world_viewer/src/main.rs`：新增 `ViewerControlProfileState` 资源。
  - 更新 `crates/agent_world_viewer/src/app_bootstrap.rs`：运行时注入 `ViewerControlProfileState`。
  - 更新 `crates/agent_world_viewer/src/main_connection.rs`：
    - 新增 `dispatch_viewer_control` 路由函数（profile->`PlaybackControl`/`LiveControl`，握手前 fallback legacy `Control`）。
    - `poll_viewer_messages` 从 `HelloAck.control_profile` 同步 profile 状态。
    - 连接错误/断开/重连时清空 profile，避免陈旧模式污染。
    - 新增 profile 路由单测（含 live 下 seek 拒绝）。
  - 更新 `crates/agent_world_viewer/src/{timeline_controls.rs,egui_right_panel_controls.rs,egui_right_panel.rs,egui_right_panel_player_experience.rs,egui_right_panel_player_guide.rs,web_test_api.rs,headless.rs}`：
    - 控制发送链路统一改为调用 `dispatch_viewer_control`。
    - timeline seek 与 player mission/recover、web_test_api 自动恢复、headless autoplay 均接入 profile 路由。
    - live profile 下 seek 不再发出控制请求。
  - 更新测试文件：`crates/agent_world_viewer/src/egui_right_panel_tests.rs`（签名同步）。
  - 更新项目管理文档：`doc/world-simulator/viewer-control-plane-split-live-playback-2026-02-27.project.md`（标记 T2 完成，进入 T3）。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer --no-run`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer main_connection::tests::control_request_rejects_seek_in_live_profile -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer tests::handle_control_buttons_sends_request -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer tests::timeline_adjust_and_submit_sends_seek_request -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer tests::headless_auto_play_sends_play_once_after_connected -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer send_control_request_updates_playing_state -- --nocapture`
- 遗留事项：
  - 执行 T3：完成最终收口测试与项目结项日志。

- 时刻：2026-02-27 23:04:10 CST
- 完成内容：完成“Viewer 控制面拆分：回放/Live 分离”T3（测试与文档结项）。
  - 执行最终回归：格式检查、三 crate 编译、协议/live/viewer 关键测试通过。
  - 更新项目管理文档：`doc/world-simulator/viewer-control-plane-split-live-playback-2026-02-27.project.md`，标记 T3 完成并结项（T0~T3）。
  - 追加今日 devlog，沉淀本任务收口记录。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world_proto -p agent_world -p agent_world_viewer`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_proto -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world viewer::live::tests::seek_control_is_ignored_in_live_request_handler -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer main_connection::tests::control_request_maps_to_live_channel_without_seek -- --nocapture`
- 遗留事项：
  - 无（本任务已结项）。

- 时刻：2026-02-27 23:46:50 CST
- 完成内容：完成 game-test 追加任务 T24（按 `doc/game-test.md` 实机游玩 + 录屏 + 卡片填写）。
  - 启动一键链路：`./scripts/run-game-test.sh`（默认 `ws://127.0.0.1:5011`）。
  - 使用 Playwright headed 会话完成真实玩家控制复测，并录制视频。
  - 新增证据目录：`output/playwright/playability/20260227-232100/`（`playthrough.webm`、步骤截图、`ab_metrics.json/md`、控制台导出）。
  - 新增测试卡片：`doc/playability_test_result/card_2026_02_27_23_21_00.md`。
  - 更新项目管理文档：`doc/game-test.project.md`（新增并完成 T24，补充本轮测试记录与风险观测）。
- 测试：
  - test_tier_required：`./scripts/run-game-test.sh`
  - test_tier_required：`PLAYWRIGHT_CLI_SESSION=game-test-open-20260227-232100 ./.codex/skills/playwright/scripts/playwright_cli.sh run-code "<A/B playability probe>"`
- 遗留事项：
  - 本轮 A 段可稳定推进，但 B 段 `step(count=2)` 再次出现 accepted 无推进（`tick 14 -> 14`）；建议继续强化“无推进原因 + 下一步动作建议”反馈，降低玩家判断成本。
- 时刻：2026-02-27 20:30:19 CST
- 完成内容：完成“资源与产品系统 P1（维护压力与本地稀缺供给延迟）”T0 建档。
  - 新增设计文档：`doc/world-simulator/m4/m4-resource-product-system-p1-maintenance-scarcity-pressure-2026-02-27.md`。
  - 新增项目管理文档：`doc/world-simulator/m4/m4-resource-product-system-p1-maintenance-scarcity-pressure-2026-02-27.project.md`。
  - 项目状态设置为“进行中（下一步 T1 代码接线）”。
- 测试：
  - 文档任务，无代码测试。
- 遗留事项：
  - 执行 T1：完成负载折旧与本地稀缺供给延迟的 runtime 接线。

- 时刻：2026-02-27 20:50:19 CST
- 完成内容：修复 builtin wasm 身份校验基线漂移，恢复 required 测试可编译/可执行状态。
  - 恢复 `m1/m4/m5` identity manifest 为带签名 schema（替代同步脚本生成的缺失字段 schema）。
  - 对齐 `m1/m5` hash 清单到当前本地可用产物组合，避免 `bootstrap_*` 测试在 identity 解析阶段触发 invariant panic。
  - 调整 `BUILTIN_MODULE_SIGNER_PUBLIC_KEY_HEX` 为与当前 manifest 签名一致的值，恢复模块签名校验链路。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::power_bootstrap::install_power_bootstrap_modules_registers_and_activates -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::gameplay_protocol::step_with_modules_applies_gameplay_directive_emits_to_domain_events -- --nocapture`
- 遗留事项：
  - 后续需要将 `sync_builtin_wasm_identity` 输出与 runtime 解析器 schema 统一，避免再次出现“hash 已更新但签名字段缺失”的漂移。

- 时刻：2026-02-27 21:00:35 CST
- 完成内容：完成“资源与产品系统 P1（维护压力与本地稀缺供给延迟）”T1（代码接线）。
  - 更新 `crates/agent_world/src/runtime/world/economy.rs`：
    - `process_factory_depreciation` 接入负载折旧系数，按 `active_jobs / recipe_slots` 计算 `load_factor_bps`（10000~20000）并放大基础衰减。
  - 更新 `crates/agent_world/src/runtime/world/event_processing/action_to_event_economy.rs`：
    - 在 `ScheduleRecipe` 链路新增本地稀缺延迟计算：当 `preferred_consume_ledger != world` 且回退 `consume_ledger == world` 且命中 `bottleneck_tags` 时，按缺口占比追加 `+1/+2` tick。
    - 新增 `compute_local_scarcity_delay_ticks` 辅助函数。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::power_bootstrap::install_power_bootstrap_modules_registers_and_activates -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::gameplay_protocol::step_with_modules_applies_gameplay_directive_emits_to_domain_events -- --nocapture`
- 遗留事项：
  - 执行 T2：补齐 P1 行为单测并完成回归。

- 时刻：2026-02-27 21:09:56 CST
- 完成内容：完成“资源与产品系统 P1（维护压力与本地稀缺供给延迟）”T2（测试补齐与回归）。
  - 更新 `crates/agent_world/src/runtime/tests/economy_factory_lifecycle.rs`：
    - 新增 `factory_depreciation_scales_with_active_recipe_load`，覆盖工厂负载折旧倍率。
    - 新增 `schedule_recipe_world_fallback_adds_one_tick_delay_for_moderate_bottleneck_deficit`。
    - 新增 `schedule_recipe_world_fallback_adds_two_tick_delay_for_severe_bottleneck_deficit`。
  - 更新 `crates/agent_world/src/runtime/tests/economy.rs`：
    - 将 4 个 recipe 完工断言改为“有限步推进直到 pending 清空”，避免本地稀缺延迟引入的时序抖动导致误报。
  - 更新 `crates/agent_world/src/runtime/tests/economy_priority_logistics.rs`：
    - 为优先级用例补齐站点输入库存，避免 world fallback 延迟干扰同 ready_at 优先级验证。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::economy -- --nocapture`
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::economy_priority_logistics -- --nocapture`
- 遗留事项：
  - 执行 T3：回写项目管理文档状态并完成 P1 收口。

- 时刻：2026-02-27 21:11:42 CST
- 完成内容：完成“资源与产品系统 P1（维护压力与本地稀缺供给延迟）”T3（文档与日志收口）。
  - 更新 `doc/world-simulator/m4/m4-resource-product-system-p1-maintenance-scarcity-pressure-2026-02-27.project.md`：标记 T1/T2/T3 完成，阶段状态收敛为“已完成（T0~T3）”。
  - 追加今日 devlog，记录 P1 任务闭环与交付状态。
- 测试：
  - 文档任务，无新增代码测试（required 回归已在 T1/T2 提交链路执行）。
- 遗留事项：
  - 无（P1 范围内事项已完成）。
