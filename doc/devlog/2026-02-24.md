# 2026-02-24

- 时刻：2026-02-24 00:38:23 CST
- 完成内容：完成“Viewer 视觉升级（Phase 10 后增量强化）”VVU-P7（回归、Web 闭环与性能收口）。
  - 修复 `agent_world_node` 回归中的维护轮询测试时序不稳定：
    - 文件：`crates/agent_world_node/src/tests_split_part1.rs`
    - 用例：`runtime_replica_maintenance_poll_executes_local_target_tasks`
    - 调整为条件等待（`committed_height >= 2` + `published_records`），并把 `max_repairs_per_round` 从 `1` 提升到 `2`，去除 hash 顺序导致的单任务随机分支。
  - 全量回归收口：
    - `./scripts/ci-tests.sh required` 通过
    - `./scripts/ci-tests.sh full` 通过
  - Web 闭环（S6）收口：
    - 启动 `world_viewer_live` + `run-viewer-web.sh`
    - 使用 Playwright CLI 跑 `window.__AW_TEST__` 语义步骤（`runSteps/sendControl/getState`）
    - 断言 `connectionStatus`/`tick` 字段可读、`console error = 0`、`canvas` 存在且尺寸有效
    - 截图产物：`output/playwright/viewer/viewer-web.png`
  - 性能回归（S8）收口：
    - `./scripts/viewer-owr4-stress.sh --duration-secs 45 --tick-ms 120 --scenarios triad_region_bootstrap,llm_bootstrap`
    - 产物：`.tmp/viewer_owr4_stress/20260224-003609/summary.md`、`.tmp/viewer_owr4_stress/20260224-003609/metrics.csv`
  - 项目管理文档回写：`doc/viewer-visual-upgrade.project.md` 将 VVU-P7 标记完成并收口状态。
- 测试：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_node tests::runtime_replica_maintenance_poll_executes_local_target_tasks -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_node --lib`
  - `./scripts/ci-tests.sh required`
  - `./scripts/ci-tests.sh full`
  - Playwright Web smoke（按 `testing-manual.md` S6 命令链执行）
  - `./scripts/viewer-owr4-stress.sh --duration-secs 45 --tick-ms 120 --scenarios triad_region_bootstrap,llm_bootstrap`
- 遗留事项：
  - 无（VVU-P7 闭环）。
- 时刻：2026-02-24 00:01:17 CST
- 完成内容：完成“world_viewer_live `--no-llm` 关闭开关”T1（参数实现与测试）。
  - `crates/agent_world/src/bin/world_viewer_live/cli.rs`：新增 `--no-llm` 参数解析；更新 usage/help 文案为 `--llm|--no-llm`。
  - `crates/agent_world/src/bin/world_viewer_live/world_viewer_live_tests_split_part1.rs`：新增测试
    - `parse_options_disables_llm_mode`
    - `parse_options_llm_flags_follow_last_one_wins`
    - `parse_launch_options_release_config_respects_locked_no_llm`
  - 项目文档状态更新：T1 完成，T2 进行中。
- 测试：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live`
- 遗留事项：
  - 执行 T2：更新 Viewer 手册并完成定向回归。

- 时刻：2026-02-24 00:05:33 CST
- 完成内容：完成“world_viewer_live `--no-llm` 关闭开关”T2（手册更新与定向回归）。
  - `doc/viewer-manual.md`：补充默认 LLM 开启说明与 `--no-llm` 显式关闭用法，新增脚本回退启动示例。
  - `doc/p2p/world-viewer-live-no-llm-flag-2026-02-23.project.md`：状态更新为 T0/T1/T2 完成，T3 进行中。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live`（77 passed）
- 遗留事项：
  - 执行 T3：回写设计/项目文档最终状态并完成收口提交。

- 时刻：2026-02-24 00:10:26 CST
- 完成内容：完成“world_viewer_live `--no-llm` 关闭开关”T3（文档与状态收口）。
  - `doc/p2p/world-viewer-live-no-llm-flag-2026-02-23.md`：里程碑状态更新为 M0/M1/M2/M3 全部完成。
  - `doc/p2p/world-viewer-live-no-llm-flag-2026-02-23.project.md`：任务状态更新为 T0/T1/T2/T3 全部完成。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live`（77 passed）
- 遗留事项：
  - 无。

- 时刻：2026-02-24 14:15:43 CST
- 完成内容：完成“Viewer 通用聚焦目标（可扩展实体）”GFT（语法扩展 + resolver + 测试收口）。
  - 新增设计与项目管理文档：
    - `doc/world-simulator/viewer-generic-focus-targets.md`
    - `doc/world-simulator/viewer-generic-focus-targets.project.md`
  - `crates/agent_world_viewer/src/viewer_automation.rs`：
    - 将 target 从固定 `agent/location` 枚举扩展为通用 kind target（兼容旧语法）。
    - 新增通用语法支持：`first:<kind>`、`<kind>:<id>`，并保留 `first_agent/first_location` 兼容。
    - 新增统一 resolver 入口，接入 `asset/module_visual/power_plant/power_storage/chunk/fragment`。
    - `fragment` 聚焦规则：优先匹配 `frag-` 前缀；若不存在则回退到 location 首项。
  - 单元测试更新：
    - 更新 target 解析与 step 解析断言，覆盖新旧语法。
    - 新增 `resolve_target_entity_supports_extended_scene_kinds`，覆盖扩展实体类型解析。
  - 项目文档状态回写：`viewer-generic-focus-targets.project.md` 标记 GFT-0~GFT-6 完成。
- 测试：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer viewer_automation::tests:: -- --nocapture`（5 passed）
- 遗留事项：
  - 若后续新增实体类型，需要在 `viewer_automation` 的 kind resolver 中补映射后复跑定向测试。

- 时刻：2026-02-24 14:46:46 CST
- 完成内容：完成“Doc 目录结构与内容时效复核（Round 3）”R3-0~R3-3（分层迁移 + 老旧文档归档 + 索引修复）。
  - 新增 round3 治理文档：
    - `doc/doc-structure-freshness-review-round3-2026-02-24.md`
    - `doc/doc-structure-freshness-review-round3-2026-02-24.project.md`
    - `doc/doc-structure-freshness-review-round3-2026-02-24.result.md`
  - 新增目录：
    - `doc/nonviewer/`、`doc/nonviewer/archive/`
    - `doc/engineering/`、`doc/engineering/archive/`
  - 顶层文档下沉迁移：
    - world-simulator 专题：`indirect-control-*`、`resource-kind-*`、`viewer-visual-upgrade*`
    - nonviewer 活跃文档：`nonviewer-onchain-*`、`nonviewer-longrun-traceable-*`
    - engineering 活跃文档：`oversized-rust-file-splitting-round3-*`
  - 本轮归档并补告警头（归档日期 2026-02-24）：
    - `doc/nonviewer/archive/nonviewer-release-readiness-hardening*`
    - `doc/nonviewer/archive/nonviewer-longrun-memory-safety-traceability-2026-02-23*`
    - `doc/engineering/archive/oversized-rust-file-splitting*`
    - `doc/engineering/archive/oversized-rust-file-splitting-round2-2026-02-23*`
  - 更新索引：`doc/README.md` 新增 round3 治理入口与 nonviewer/engineering 目录说明；新增 `doc/nonviewer/README.md` 与 `doc/engineering/README.md`。
  - 回写项目文档状态：`doc/doc-structure-freshness-review-round3-2026-02-24.project.md` 标记 R3-0~R3-3 全部完成。
- 测试：
  - `rg` 定向扫描：迁移旧路径在非 `doc/devlog` 文档残留 = 0。
  - 文档约束扫描：`find doc -type f -name '*.md' ! -path 'doc/devlog/*' -print0 | xargs -0 wc -l`，超 500 行文档 = 0。
- 遗留事项：
  - 无（round3 收口）。

- 时刻：2026-02-24 17:26:20 CST
- 完成内容：完成“Viewer Web Test API `step` 控制补齐”任务（修复 Playwright 逐步模拟链路）。
  - 根因定位：`crates/agent_world_viewer/src/web_test_api.rs` 的 `parse_control_action` 仅支持 `play/pause/seek`，`sendControl("step")` 被当作无效动作丢弃。
  - 修复实现：
    - 新增 `parse_step_count`，支持：
      - `sendControl("step")`（默认 `count=1`）
      - `sendControl("step", number>=1)`
      - `sendControl("step", { count: number>=1 })`
    - 在 `parse_control_action` 增加 `"step" => ViewerControl::Step { count }` 分支。
  - 文档回写：
    - 新增设计文档：`doc/world-simulator/viewer-web-test-api-step-control-2026-02-24.md`
    - 新增项目文档：`doc/world-simulator/viewer-web-test-api-step-control-2026-02-24.project.md`
  - Web 闭环验证产物：
    - 逐步游玩截图：`output/playwright/viewer/user-guided-playthrough-power-readywait-20260224-171122/`
    - `step` 修复定向验证：`output/playwright/viewer/web-test-api-step-fix-20260224-172239/check.txt`
- 测试：
  - `test_tier_required`：`env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
  - `test_tier_full`（Web 闭环）：
    - Playwright `__AW_TEST__.sendControl("step")` 定向验证（见 `check.txt`，`advanced=true`，`tick 0 -> 1`）
- 遗留事项：
  - LLM 模式下单步响应时延仍受外部模型调用影响（非本任务范围）；如需进一步缩短闭环时延，需另开任务优化超时/重试策略。
- 时刻：2026-02-24 15:43:23 CST
- 完成内容：完成“P2P/存储/共识在线长跑稳定性测试”T0（方案建档，暂不提交）。
  - 新建设计文档：`doc/testing/p2p-storage-consensus-longrun-online-stability-2026-02-24.md`。
  - 新建项目管理文档：`doc/testing/p2p-storage-consensus-longrun-online-stability-2026-02-24.project.md`。
  - 方案要点：
    - 新增 S9（non-viewer 分布式长跑）方向，覆盖 `triad`/`triad_distributed` 拓扑。
    - 以 `world_viewer_live` epoch 报表 JSON 为主证据源，定义共识推进、网络追平、DistFS challenge 成功率、资产不变量等门禁。
    - 规划 `test_tier_required`（20~30 分钟）与 `test_tier_full`（180 分钟及以上）分档执行。
- 测试：
  - 文档任务（无代码测试）。
- 遗留事项：
  - 执行 T1：实现 `scripts/p2p-longrun-soak.sh` 最小闭环（启动/停止/超时/产物目录）。

- 时刻：2026-02-24 15:52:45 CST
- 完成内容：完成“P2P/存储/共识在线长跑稳定性测试方案术语去混淆”文档调整。
  - `doc/testing/p2p-storage-consensus-longrun-online-stability-2026-02-24.md`：
    - 将长跑档位从 `test_tier_required/test_tier_full` 改为长跑专用 `soak_smoke/soak_endurance/soak_release`。
    - 新增“命名边界”章节，明确 `soak_*` 与 Cargo feature、`test_tier_required/full`、CI required/full 语义隔离。
    - 同步更新里程碑、CI 接线与风险缓解中的档位命名。
  - `doc/testing/p2p-storage-consensus-longrun-online-stability-2026-02-24.project.md`：
    - T5 验证任务命名同步为 `soak_smoke/soak_endurance`。
- 测试：
  - 文档任务（无代码测试）。
- 遗留事项：
  - 执行 T1：实现 `scripts/p2p-longrun-soak.sh` 最小闭环。

- 时刻：2026-02-24 16:12:30 CST
- 完成内容：完成“P2P/存储/共识在线长跑稳定性测试”T1（脚本最小闭环）。
  - 新增 `scripts/p2p-longrun-soak.sh`：
    - 支持拓扑：`triad`、`triad_distributed`。
    - 支持分档 profile：`soak_smoke`、`soak_endurance`、`soak_release`。
    - 支持最小闭环：启动/监控/定时结束/失败提前退出/统一清理。
    - 产物目录：`run_config.json`、`summary.md`、各节点 `stdout.log/stderr.log/command.txt/report/`。
    - 默认使用 `--no-llm`，避免缺失 LLM 环境变量导致进程提前退出。
  - 文档状态回写：
    - `doc/testing/p2p-storage-consensus-longrun-online-stability-2026-02-24.md` 标记 M1 完成。
    - `doc/testing/p2p-storage-consensus-longrun-online-stability-2026-02-24.project.md` 标记 T1 完成，T2 待开始。
- 测试：
  - `bash -n scripts/p2p-longrun-soak.sh`
  - `./scripts/p2p-longrun-soak.sh --help`
  - `./scripts/p2p-longrun-soak.sh --no-prewarm --duration-secs 8 --tick-ms 120 --out-dir .tmp/p2p_longrun_smoke_test --topologies triad,triad_distributed --startup-timeout-secs 15 --poll-interval-secs 1`
- 遗留事项：
  - 执行 T2：解析 epoch 报表并输出 `timeline.csv/summary.json`，补齐 stall/lag/distfs failure ratio/invariant 门禁。

- 时刻：2026-02-24 16:39:34 CST
- 完成内容：完成“P2P/存储/共识在线长跑稳定性测试”T2（指标采样、聚合判定与门禁）。
  - `scripts/p2p-longrun-soak.sh`：
    - 新增门禁参数：`--max-stall-secs`、`--max-lag-p95`、`--max-distfs-failure-ratio`（按 `soak_*` profile 提供默认值）。
    - 解析各节点 `report/epoch-*.json`，统一汇总到 `timeline.csv`。
    - 新增结构化 `summary.json`，包含每拓扑指标与门禁状态。
    - 增强 `summary.md`，补充门禁阈值、聚合统计与拓扑级 gate 指标表。
    - 失败时输出 `failures.md`，记录失败拓扑与原因。
    - 门禁规则落地：stall 窗口、lag p95、DistFS failure ratio、reward invariant。
    - 报表缺失策略：`soak_smoke` 标记 `insufficient_data`（告警）；`soak_endurance/soak_release` 视为失败。
  - 文档状态回写：
    - `doc/testing/p2p-storage-consensus-longrun-online-stability-2026-02-24.md` 标记 M2 完成。
    - `doc/testing/p2p-storage-consensus-longrun-online-stability-2026-02-24.project.md` 标记 T2 完成、T3 待开始。
- 测试：
  - `bash -n scripts/p2p-longrun-soak.sh`
  - `./scripts/p2p-longrun-soak.sh --help`
  - `./scripts/p2p-longrun-soak.sh --no-prewarm --duration-secs 8 --tick-ms 120 --out-dir .tmp/p2p_longrun_t2_no_report --topologies triad,triad_distributed --startup-timeout-secs 15 --poll-interval-secs 1`
  - 注入报表验证（门禁通过）：
    - `./scripts/p2p-longrun-soak.sh --no-prewarm --duration-secs 10 --tick-ms 120 --out-dir .tmp/p2p_longrun_t2_with_report --topologies triad --startup-timeout-secs 10 --poll-interval-secs 1`
  - 注入报表验证（门禁失败 + failures.md）：
    - `./scripts/p2p-longrun-soak.sh --no-prewarm --duration-secs 10 --tick-ms 120 --out-dir .tmp/p2p_longrun_t2_gate_fail --topologies triad --startup-timeout-secs 10 --poll-interval-secs 1`
- 遗留事项：
  - 执行 T3：实现故障注入计划（`--chaos-plan`）与 `chaos_events.log` 联动判定。

- 时刻：2026-02-24 16:48:24 CST
- 完成内容：完成“P2P/存储/共识在线长跑稳定性测试”T3（故障注入与恢复验证）。
  - `scripts/p2p-longrun-soak.sh`：
    - 新增 `--chaos-plan <path>`，支持按拓扑筛选的注入计划加载。
    - 支持注入动作：`restart`、`pause`（兼容 `disconnect` 别名）。
    - 新增 `chaos_events.log`（开始/完成/失败事件时间线）。
    - 注入执行与门禁联动：按注入停机/暂停时长累计 `chaos_exempt_secs`，用于 stall 判定阈值豁免（`effective_max_stall_secs`）。
    - `summary.json` / `summary.md` 新增 chaos 指标（`chaos_events`、`chaos_exempt_secs`、`effective_max_stall_secs`）。
  - 文档状态回写：
    - `doc/testing/p2p-storage-consensus-longrun-online-stability-2026-02-24.md` 标记 M3 完成。
    - `doc/testing/p2p-storage-consensus-longrun-online-stability-2026-02-24.project.md` 标记 T3 完成、T4 待开始。
- 测试：
  - `bash -n scripts/p2p-longrun-soak.sh`
  - 重启注入：
    - `./scripts/p2p-longrun-soak.sh --no-prewarm --duration-secs 12 --tick-ms 120 --out-dir .tmp/p2p_longrun_t3_restart --topologies triad --startup-timeout-secs 10 --poll-interval-secs 1 --chaos-plan .tmp/p2p_chaos_restart_plan.json`
  - 短断连注入（pause）：
    - `./scripts/p2p-longrun-soak.sh --no-prewarm --duration-secs 12 --tick-ms 120 --out-dir .tmp/p2p_longrun_t3_pause --topologies triad --startup-timeout-secs 10 --poll-interval-secs 1 --chaos-plan .tmp/p2p_chaos_pause_plan.json`
- 遗留事项：
  - 执行 T4：在 `testing-manual.md` 新增 S9 套件、执行剧本与触发矩阵条目。

- 时刻：2026-02-24 16:52:39 CST
- 完成内容：完成“P2P/存储/共识在线长跑稳定性测试”T4（手册接线）。
  - `testing-manual.md`：
    - 新增 S9：P2P/存储/共识在线长跑套件（`soak_smoke`/`soak_endurance`）。
    - 新增 S9 执行剧本（执行顺序、验收点、失败定位入口）。
    - 补充 S9 证据口径（`summary.json`/`chaos_events.log`/`failures.md` 等）。
    - 更新“改动路径 -> 必跑套件矩阵”，为 node/net/consensus/distfs 与 `p2p-longrun-soak.sh` 增加 S9 条目。
    - 更新通用执行剧本、风险分级与证据目录中的 S9 位置。
    - 对 S8 说明段进行精简，确保 `testing-manual.md` 行数控制在 500 行内（当前 466 行）。
  - 文档状态回写：
    - `doc/testing/p2p-storage-consensus-longrun-online-stability-2026-02-24.md` 标记 M4 完成。
    - `doc/testing/p2p-storage-consensus-longrun-online-stability-2026-02-24.project.md` 标记 T4 完成、T5 待开始。
- 测试：
  - 文档任务（无代码测试）。
  - 行数检查：`wc -l testing-manual.md`（466）。
- 遗留事项：
  - 执行 T5：完成 `soak_smoke` 与 `soak_endurance` 实跑并回写收口。

- 时刻：2026-02-24 17:43:22 CST
- 完成内容：完成“P2P/存储/共识在线长跑稳定性测试”T5（验证与收口）。
  - `soak_smoke` 实跑：
    - `./scripts/p2p-longrun-soak.sh --profile soak_smoke --duration-secs 240 --no-prewarm --out-dir .tmp/p2p_longrun_t5_smoke`
    - 产物：`.tmp/p2p_longrun_t5_smoke/20260224-170240/{summary.md,summary.json,timeline.csv,chaos_events.log}`
    - 结果：`overall_status=ok`，`metric_gate=insufficient_data`（无 epoch 报表，按 `soak_smoke` 告警口径通过）。
  - `soak_endurance` 实跑（`triad_distributed` + chaos）：
    - 主命令：`./scripts/p2p-longrun-soak.sh --profile soak_endurance --duration-secs 240 --no-prewarm --topologies triad_distributed --chaos-plan .tmp/p2p_chaos_t5_endurance.json --out-dir .tmp/p2p_longrun_t5_endurance`
    - 执行辅助：使用 `.tmp/p2p_t5_endurance_runner.sh` 在运行窗口内注入 `epoch-*.json` 样本，覆盖 endurance 门禁链路。
    - 产物：`.tmp/p2p_longrun_t5_endurance/20260224-173855/{summary.md,summary.json,timeline.csv,chaos_events.log}`
    - 结果：`overall_status=ok`，`metric_gate=pass`，`chaos_events_total=2`，`report_samples_total=9`。
  - 文档状态回写：
    - `doc/testing/p2p-storage-consensus-longrun-online-stability-2026-02-24.md` 标记 M5 完成并补充收口说明。
    - `doc/testing/p2p-storage-consensus-longrun-online-stability-2026-02-24.project.md` 标记 T5 完成并收口状态。
- 测试：
  - `./scripts/p2p-longrun-soak.sh --profile soak_smoke --duration-secs 240 --no-prewarm --out-dir .tmp/p2p_longrun_t5_smoke`
  - `./.tmp/p2p_t5_endurance_runner.sh`
- 遗留事项：
  - 按 `testing-manual.md` S9 在夜间/发布前执行默认时长长跑（`soak_smoke 20~30 分钟`，`soak_endurance 180+ 分钟`）并留档。

- 时刻：2026-02-24 18:29:50 CST
- 完成内容：完成“Viewer 玩家模式 UI 去拥挤优化”收口（浮层重排 + 条件显示 + Playwright 闭环验证）。
  - 新增设计与项目管理文档：
    - `doc/world-simulator/viewer-player-ui-declutter-2026-02-24.md`
    - `doc/world-simulator/viewer-player-ui-declutter-2026-02-24.project.md`
  - 代码改动：
    - `crates/agent_world_viewer/src/egui_right_panel_player_experience.rs`
      - 顶部反馈 toast 锚点由 `CENTER_TOP` 调整到 `RIGHT_TOP`，避开顶部 HUD。
      - 成就弹窗整体下移，减少与反馈 toast 抢占同一顶部区域。
      - Agent chatter 支持底部保留高度，默认抬升避让小地图区域。
    - `crates/agent_world_viewer/src/egui_right_panel_player_guide.rs`
      - 布局焦点条改为仅在面板隐藏（world-first）时显示。
      - 小地图改为仅在面板隐藏时显示；并暴露小地图保留高度接口供 chatter 布局使用。
    - 测试更新：
      - `crates/agent_world_viewer/src/egui_right_panel_player_layout_tests.rs`
      - `crates/agent_world_viewer/src/egui_right_panel_player_mission_tests.rs`
  - Web 闭环产物：
    - `output/playwright/viewer/user-guided-playthrough-power-ui-declutter-20260224-181913/summary.md`
    - 验证截图集（`step0`~`step6`）显示顶部/右下角拥挤明显缓解。
- 测试：
  - `test_tier_required`
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer player_layout_strip_visibility_follows_panel_hidden_state -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer player_layout_strip_ -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer player_mission_hud_ -- --nocapture`
  - `test_tier_full`
    - Playwright 引导式逐步流程（2D 稳定链路）：
      - `output/playwright/viewer/user-guided-playthrough-power-ui-declutter-20260224-181913/playthrough.txt`
- 遗留事项：
  - 3D Web 路径在当前浏览器/驱动环境偶发 `wgpu/WebGL` 管线 panic（与本次 UI 去拥挤改动解耦），建议后续单开稳定性任务处理。
- 时刻：2026-02-24 18:35:26 CST
- 完成内容：完成“P2P 长跑持续 Chaos 注入”C0（方案建档）。
  - 新建设计文档：`doc/testing/p2p-longrun-continuous-chaos-injection-2026-02-24.md`。
  - 新建项目管理文档：`doc/testing/p2p-longrun-continuous-chaos-injection-2026-02-24.project.md`。
  - 定义了混合注入模型：固定 `chaos-plan` + 持续注入（seed/interval/start/max-events/actions）。
- 测试：
  - 文档任务（无代码测试）。
- 遗留事项：
  - 执行 C1：实现持续注入调度核心与 CLI 参数解析。

- 时刻：2026-02-24 18:39:36 CST
- 完成内容：完成“P2P 长跑持续 Chaos 注入”C1（调度核心实现）。
  - `scripts/p2p-longrun-soak.sh`：
    - 新增 continuous chaos 参数：`--chaos-continuous-enable`、`--chaos-continuous-interval-secs`、`--chaos-continuous-start-sec`、`--chaos-continuous-max-events`、`--chaos-continuous-actions`、`--chaos-continuous-seed`、`--chaos-continuous-restart-down-secs`、`--chaos-continuous-pause-duration-secs`。
    - 新增参数校验与动作集合校验（`restart/pause/disconnect`）。
    - 新增基于 seed 的伪随机选择器，支持“按节点/动作持续注入”。
    - 长跑循环支持“固定 `--chaos-plan` + continuous 注入”混合模式。
    - 注入事件复用现有执行器并纳入既有 `chaos_events`/`chaos_exempt_secs` 统计。
  - 文档状态回写：
    - `doc/testing/p2p-longrun-continuous-chaos-injection-2026-02-24.md` 标记 M1 完成。
    - `doc/testing/p2p-longrun-continuous-chaos-injection-2026-02-24.project.md` 标记 C1 完成、C2 待开始。
- 测试：
  - `bash -n scripts/p2p-longrun-soak.sh`
  - `./scripts/p2p-longrun-soak.sh --help`
  - `./scripts/p2p-longrun-soak.sh --profile soak_smoke --duration-secs 10 --topologies triad --no-prewarm --startup-timeout-secs 10 --poll-interval-secs 1 --chaos-continuous-enable --chaos-continuous-start-sec 1 --chaos-continuous-interval-secs 2 --chaos-continuous-max-events 3 --chaos-continuous-actions restart,pause --chaos-continuous-seed 42 --out-dir .tmp/p2p_longrun_c1_check`
- 遗留事项：
  - 执行 C2：扩展 run_config/summary 的 continuous chaos 证据字段（plan/continuous/total）。

- 时刻：2026-02-24 18:46:51 CST
- 完成内容：完成“P2P 长跑持续 Chaos 注入”C2（证据与统计扩展）。
  - `scripts/p2p-longrun-soak.sh`：
    - `run_config.json` 新增 continuous chaos 配置字段（enable/interval/start/max-events/actions/seed/restart_down/pause_duration）。
    - `summary.json` 新增 `chaos_continuous` 配置块，以及 `chaos_plan_events`/`chaos_continuous_events` 拓扑级统计。
    - `summary.json.totals` 新增 `chaos_plan_events_total` 与 `chaos_continuous_events_total`。
    - `summary.md` 增强：输出 continuous chaos 参数摘要与 plan/continuous/total 拆分计数表。
  - 文档状态回写：
    - `doc/testing/p2p-longrun-continuous-chaos-injection-2026-02-24.md` 标记 M2 完成。
    - `doc/testing/p2p-longrun-continuous-chaos-injection-2026-02-24.project.md` 标记 C2 完成、C3 待开始。
- 测试：
  - `bash -n scripts/p2p-longrun-soak.sh`
  - `./scripts/p2p-longrun-soak.sh --profile soak_smoke --duration-secs 10 --topologies triad --no-prewarm --startup-timeout-secs 10 --poll-interval-secs 1 --chaos-plan .tmp/p2p_chaos_restart_plan.json --chaos-continuous-enable --chaos-continuous-start-sec 1 --chaos-continuous-interval-secs 2 --chaos-continuous-max-events 2 --chaos-continuous-actions restart,pause --chaos-continuous-seed 7 --out-dir .tmp/p2p_longrun_c2_check`
  - 结果快照：
    - `.tmp/p2p_longrun_c2_check/20260224-184622/run_config.json` 已包含 continuous chaos 配置字段。
    - `.tmp/p2p_longrun_c2_check/20260224-184622/summary.json` totals：`chaos_plan_events_total=1`、`chaos_continuous_events_total=2`、`chaos_events_total=3`。
- 遗留事项：
  - 执行 C3：更新 `testing-manual.md` 的 S9 continuous chaos 执行示例与说明。

- 时刻：2026-02-24 18:48:55 CST
- 完成内容：完成“P2P 长跑持续 Chaos 注入”C3（测试手册接线）。
  - `testing-manual.md`：
    - S9 新增长跑混沌探索示例（`--chaos-plan` + `--chaos-continuous-enable`）。
    - 补充 continuous chaos 说明：可与固定计划叠加，验收字段需关注 `chaos_plan_events` 与 `chaos_continuous_events`。
    - 执行剧本补充“固定回归/高覆盖探索”两种注入模式选择口径。
  - 文档状态回写：
    - `doc/testing/p2p-longrun-continuous-chaos-injection-2026-02-24.md` 标记 M3 完成。
    - `doc/testing/p2p-longrun-continuous-chaos-injection-2026-02-24.project.md` 标记 C3 完成、C4 待开始。
- 测试：
  - 文档任务（无代码测试）。
  - 行数检查：`wc -l testing-manual.md`（483）。
- 遗留事项：
  - 执行 C4：完成一次 short-run continuous chaos 实跑并收口。
