- 日期：2026-02-14
- 完成内容：启动 R4（WASM 运行时激进迁移 Phase 4）文档任务，新增设计文档 `doc/world-runtime/wasm-runtime-crate-split-phase4.md` 与项目管理文档 `doc/world-runtime/wasm-runtime-crate-split-phase4.project.md`。
- 完成内容：更新总设计文档 `doc/world-runtime.md` 分册索引与里程碑（新增 M10）。
- 完成内容：更新总项目文档 `doc/world-runtime.project.md`，新增 R4 任务段并回写阶段状态。
- 遗留事项：继续推进 R4-1（迁移模块清单与变更计划类型到 `agent_world_wasm_abi`）。
- 完成内容：完成 T96（继续激进下沉 runtime 逻辑，去掉 `distributed_head_follow` 路径包装）：
  - `crates/agent_world_net/src/head_tracking.rs`：
    - 新增 `HeadTracker`（world_id 过滤、best head 选择、冲突/重复/陈旧判定、apply 记录）与 `HeadUpdateDecision`，将纯状态机逻辑下沉到 split crate。
  - `crates/agent_world_net/src/head_follow.rs`：
    - 收敛为 `HeadTracker` + bootstrap 组合，删除重复的 head 比较/判定实现。
  - `crates/agent_world_net/src/lib.rs`：
    - 导出 `HeadTracker`/`HeadUpdateDecision`，并调整 runtime_bridge 下 `distributed_head_follow` 导出，避免重复导出冲突。
  - `crates/agent_world/src/runtime/distributed_head_follow.rs`：
    - 从 `#[path]` 同源包装改为 runtime 本地薄适配实现，复用 `agent_world_net::HeadTracker`，保留 `World` 引导语义和原对外 API（`HeadFollower`/`HeadUpdateDecision`）。
  - `doc/world-runtime/distributed-crate-split-net-consensus.project.md`：
    - 新增并标记 T96 完成，更新阶段状态与下一步。
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --test distributed_head_follow`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --test distributed_observer_sync`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_net`
  - `./scripts/check-include-warning-baseline.sh`
- 遗留事项：继续下一阶段，优先把 `distributed_observer` / `distributed_observer_replay` 中可独立的状态编排逻辑下沉到 `agent_world_net`，进一步压缩 runtime 路径包装与别名层。

- 日期：2026-02-14
- 完成内容：完成 T97（继续激进下沉 observer 编排逻辑并去掉 runtime 路径包装）：
  - `crates/agent_world_net/src/head_sync.rs`：
    - 新增通用 observer flow 抽象：`HeadSyncResult` / `HeadSyncReport` / `HeadFollowReport`、`compose_head_sync_report`、`follow_head_sync`，统一 head 同步报告与 follow 循环编排。
  - `crates/agent_world_net/src/observer.rs`：
    - 收敛为复用 `head_sync` 抽象，删除本地重复的 report 组装与循环逻辑。
  - `crates/agent_world_net/src/lib.rs`：
    - 新增 `observer_flow` 导出入口，向 runtime 暴露可复用的 observer 编排能力。
  - `crates/agent_world/src/runtime/distributed_observer.rs`：
    - 从 `#[path]` 同源包装切换为 runtime 本地薄适配实现，复用 `agent_world_net::observer_flow`，保留原有 `ObserverClient` / `HeadSyncReport` / `HeadFollowReport` API。
  - `doc/world-runtime/distributed-crate-split-net-consensus.project.md`：
    - 新增并标记 T97 完成，更新阶段状态与下一步。
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --test distributed_observer_sync`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --test distributed_head_follow`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_net`
  - `./scripts/check-include-warning-baseline.sh`
- 遗留事项：继续下一阶段，优先收敛 `distributed_observer_replay` 路径包装，并将其可独立校验编排抽象继续下沉到 `agent_world_net`。

- 日期：2026-02-14
- 完成内容：完成 T98（继续激进下沉 observer replay 编排逻辑并去掉 runtime 路径包装）：
  - `crates/agent_world_net/src/replay_flow.rs`：
    - 新增通用 replay 编排抽象 `load_manifest_and_segments`，统一 manifest/journal blob 拉取、完整性校验、分片落盘流程。
  - `crates/agent_world_net/src/observer_replay.rs`：
    - 收敛为复用 `replay_flow` 抽象，删除重复的 manifest/journal 解码与拉取循环逻辑。
  - `crates/agent_world_net/src/lib.rs`：
    - 新增 `observer_replay_flow` 导出入口，供 runtime 复用 replay 编排能力。
  - `crates/agent_world/src/runtime/distributed_observer_replay.rs`：
    - 从 `#[path]` 同源包装切换为 runtime 本地薄适配实现，复用 `agent_world_net::observer_replay_flow`，保留原有 `replay_validate_*` API。
  - `doc/world-runtime/distributed-crate-split-net-consensus.project.md`：
    - 新增并标记 T98 完成，更新阶段状态与下一步。
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --test distributed_observer_sync`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --test distributed_head_follow`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --test distributed_bootstrap`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_net`
  - `./scripts/check-include-warning-baseline.sh`
- 遗留事项：继续下一阶段，优先收敛剩余路径包装模块，并继续推进 `agent_world_net --features runtime_bridge` 的可编译闭环抽象。

- 日期：2026-02-14
- 完成内容：完成 T99（继续激进去除 runtime `distributed_bootstrap` 路径包装）：
  - `crates/agent_world/src/runtime/distributed_bootstrap.rs`：
    - 从 `#[path]` 同源包装切换为 runtime 本地薄适配实现。
    - 复用 runtime `distributed_observer_replay` 的 `replay_validate_with_head(_and_dht)` 结果组装 `World::from_snapshot`，保持 `bootstrap_world_from_head*` / `bootstrap_world_from_dht` 对外 API 与语义不变。
  - `doc/world-runtime/distributed-crate-split-net-consensus.project.md`：
    - 新增并标记 T99 完成，更新阶段状态与下一步。
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --test distributed_bootstrap`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --test distributed_observer_sync`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_net`
  - `./scripts/check-include-warning-baseline.sh`
- 遗留事项：继续下一阶段，优先处理 `distributed_storage` / `distributed_validation` 的路径包装，推进 runtime 到 split crate 的直接依赖闭环。

- 日期：2026-02-14
- 完成内容：完成 T100（继续激进去除 `distributed_storage` / `distributed_validation` 路径包装）：
  - `crates/agent_world/src/runtime/distributed_storage.rs`：
    - 从 `#[path]` 包装切换为 runtime 本地实现，直接复用 proto 下沉的 `ExecutionWriteConfig` / `ExecutionWriteResult` 类型，保持 `store_execution_result` 运行时行为不变。
  - `crates/agent_world/src/runtime/distributed_validation.rs`：
    - 从 `#[path]` 包装切换为 runtime 本地实现，保留 `HeadValidationResult` 与 `assemble_*` / `validate_head_update` API，继续校验 snapshot/journal/hash 闭环。
  - `doc/world-runtime/distributed-crate-split-net-consensus.project.md`：
    - 新增并标记 T100 完成，更新阶段状态与下一步。
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --test distributed_consistency`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --test distributed_bootstrap`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --test distributed_observer_sync`
  - `./scripts/check-include-warning-baseline.sh`
- 遗留事项：继续下一阶段，优先推进 `agent_world_net --features runtime_bridge` 在 storage/validation 方向的抽象闭环，减少 runtime 与 net 的重复实现面。
