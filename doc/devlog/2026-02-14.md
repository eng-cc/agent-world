- 日期：2026-02-14
- 完成内容：启动 R4（WASM 运行时激进迁移 Phase 4）文档任务，新增设计文档 `doc/world-runtime/wasm-runtime-crate-split-phase4.md` 与项目管理文档 `doc/world-runtime/wasm-runtime-crate-split-phase4.project.md`。
- 完成内容：更新总设计文档 `doc/world-runtime.md` 分册索引与里程碑（新增 M10）。
- 完成内容：更新总项目文档 `doc/world-runtime.project.md`，新增 R4 任务段并回写阶段状态。
- 遗留事项：继续推进 R4-1（迁移模块清单与变更计划类型到 `agent_world_wasm_abi`）。
- 完成内容：完成 T96（继续激进下沉 runtime 逻辑，去掉 `distributed_head_follow` 路径包装）：
  - `crates/agent_world_net/src/head_tracking.rs`：
    - 新增 `HeadTracker`（world_id 过滤、best head 选择、冲突/重复/陈旧判定、apply 记录）与 `HeadUpdateDecision`，将纯状态机逻辑下沉到 split crate。
  - `crates/agent_world_net/src/head_follow.rs`：
    - 收敛为 `HeadTracker` + bootstrap 组合，删除重复的 head 比较/判定实现。
  - `crates/agent_world_net/src/lib.rs`：
    - 导出 `HeadTracker`/`HeadUpdateDecision`，并调整 runtime_bridge 下 `distributed_head_follow` 导出，避免重复导出冲突。
  - `crates/agent_world/src/runtime/distributed_head_follow.rs`：
    - 从 `#[path]` 同源包装改为 runtime 本地薄适配实现，复用 `agent_world_net::HeadTracker`，保留 `World` 引导语义和原对外 API（`HeadFollower`/`HeadUpdateDecision`）。
  - `doc/world-runtime/distributed-crate-split-net-consensus.project.md`：
    - 新增并标记 T96 完成，更新阶段状态与下一步。
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --test distributed_head_follow`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --test distributed_observer_sync`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_net`
  - `./scripts/check-include-warning-baseline.sh`
- 遗留事项：继续下一阶段，优先把 `distributed_observer` / `distributed_observer_replay` 中可独立的状态编排逻辑下沉到 `agent_world_net`，进一步压缩 runtime 路径包装与别名层。

- 日期：2026-02-14
- 完成内容：完成 T97（继续激进下沉 observer 编排逻辑并去掉 runtime 路径包装）：
  - `crates/agent_world_net/src/head_sync.rs`：
    - 新增通用 observer flow 抽象：`HeadSyncResult` / `HeadSyncReport` / `HeadFollowReport`、`compose_head_sync_report`、`follow_head_sync`，统一 head 同步报告与 follow 循环编排。
  - `crates/agent_world_net/src/observer.rs`：
    - 收敛为复用 `head_sync` 抽象，删除本地重复的 report 组装与循环逻辑。
  - `crates/agent_world_net/src/lib.rs`：
    - 新增 `observer_flow` 导出入口，向 runtime 暴露可复用的 observer 编排能力。
  - `crates/agent_world/src/runtime/distributed_observer.rs`：
    - 从 `#[path]` 同源包装切换为 runtime 本地薄适配实现，复用 `agent_world_net::observer_flow`，保留原有 `ObserverClient` / `HeadSyncReport` / `HeadFollowReport` API。
  - `doc/world-runtime/distributed-crate-split-net-consensus.project.md`：
    - 新增并标记 T97 完成，更新阶段状态与下一步。
- 完成内容：执行并通过验证：
  - `env -u RUSTC_WRAPPER cargo check -p agent_world`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_net`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --test distributed_observer_sync`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world --test distributed_head_follow`
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_net`
  - `./scripts/check-include-warning-baseline.sh`
- 遗留事项：继续下一阶段，优先收敛 `distributed_observer_replay` 路径包装，并将其可独立校验编排抽象继续下沉到 `agent_world_net`。
