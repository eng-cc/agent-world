# 2026-02-25

- 时刻：2026-02-25 10:38:34 CST
- 完成内容：完成“Viewer WebGL Deferred 兼容降级”T0（设计建档）。
  - 新增设计文档：`doc/world-simulator/viewer-webgl-deferred-compat-2026-02-24.md`
  - 新增项目管理文档：`doc/world-simulator/viewer-webgl-deferred-compat-2026-02-24.project.md`
  - 项目状态：T0 完成，T1 进行中。
- 测试：
  - 文档任务（无代码测试）。
- 遗留事项：
  - 执行 T1：实现 wasm 路径关闭默认 deferred lighting 插件。

- 时刻：2026-02-25 10:43:37 CST
- 完成内容：完成“Viewer WebGL Deferred 兼容降级”T1（wasm 渲染兼容改造）。
  - `crates/agent_world_viewer/src/app_bootstrap.rs`：
    - 新增 `default_pbr_plugin_for_runtime()`，在 wasm 目标下将 `PbrPlugin.add_default_deferred_lighting_plugin` 设为 `false`。
    - `run_ui` 的 `DefaultPlugins` 配置接入该函数。
    - 新增单测 `default_pbr_plugin_for_runtime_tracks_target_compat_mode`。
  - 项目状态：T0/T1 完成，T2 进行中。
- 测试：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer default_pbr_plugin_for_runtime_tracks_target_compat_mode -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer --target wasm32-unknown-unknown`
- 遗留事项：
  - 执行 T2：Playwright 3D 闭环复验，确认不再出现 `copy_deferred_lighting_id_pipeline` panic。

- 时刻：2026-02-25 10:52:53 CST
- 完成内容：完成“Viewer WebGL Deferred 兼容降级”T2（定向回归验证）。
  - 新增回归总结：`output/playwright/viewer/webgl-3d-panic-fix-20260225-104748/summary.md`
  - Playwright 3D 用例结果：
    - `cameraMode` 从 `2d` 切至 `3d`，并在 step/play 后持续推进。
    - `apiAlive: true`，稳定等待后仍可访问测试 API。
    - 未复现 `copy_deferred_lighting_id_pipeline` panic。
  - 项目状态：T0/T1/T2 完成，T3 进行中。
- 测试：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer default_pbr_plugin_for_runtime_tracks_target_compat_mode -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer --target wasm32-unknown-unknown`
  - Playwright 3D 回归产物：`output/playwright/viewer/webgl-3d-panic-fix-20260225-104748/check3d.txt`
- 遗留事项：
  - 执行 T3：回写最终状态并收口。

- 时刻：2026-02-25 10:54:33 CST
- 完成内容：完成“Viewer WebGL Deferred 兼容降级”T3（文档与日志收口）。
  - 更新项目管理文档：`doc/world-simulator/viewer-webgl-deferred-compat-2026-02-24.project.md`
  - 项目状态：T0/T1/T2/T3 全部完成。
- 测试：
  - 文档收口任务（无新增代码测试）。
- 遗留事项：
  - 无（本设计任务已收口）。

- 时刻：2026-02-25 12:20:35 CST
- 完成内容：完成“按 game-test.md 进行真实玩家游玩并填写可玩性卡片”任务。
  - 按 Web 闭环链路启动并接入：`world_viewer_live` + `run-viewer-web.sh` + Playwright CLI。
  - 完成实际游玩交互（模式切换、选中对象、播放/暂停控制、鼠标键盘基础操作）。
  - 产出测试卡片：`doc/playability_test_result/card_2026_02_25_12_20_02.md`。
  - 过程截图：`output/playwright/playability/20260225-120744/step0-home.png`、`step1-3d-location.png`、`step2-2d-agent.png`。
- 测试：
  - Playwright 实机闭环操作（非单元测试任务）。
- 遗留事项：
  - 如需批量评估，后续可按 `doc/playability_test_manual.md` 将多份卡片转为量化雷达图汇总。

- 时刻：2026-02-25 13:23:57 CST
- 完成内容：完成“按 game-test.md 真实玩家游玩并填写卡片（录屏版）”任务复测。
  - 使用 Playwright CLI 执行一轮真实游玩并启用 `video-start/video-stop` 录屏。
  - 产出录屏与证据：`output/playwright/playability/20260225-132109/`（含 `playthrough.webm` 与控制台日志）。
  - 新增测试卡片：`doc/playability_test_result/card_2026_02_25_13_22_15.md`。
  - 回写项目管理文档：`doc/game-test.project.md`（新增 T4 与第二次测试记录）。
- 测试：
  - Playwright Web 闭环实测（真实操作 + 录屏）：打开 Viewer、模式/选择/控制操作、截图、控制台采样、视频归档。
- 遗留事项：
  - Web 端存在 `copy_deferred_lighting_id_pipeline` 渲染 panic，导致 `window.__AW_TEST__.getState()` 长时间停留 `connecting/tick=0`；需后续修复后再进行可玩性复验。

- 时刻：2026-02-25 14:38:32 CST
- 完成内容：完成“作为开发者排查 game-test 不可玩原因”任务。
  - 基于 Playwright Web 闭环复现并确认：不可玩并非单点问题，存在两层故障链。
    - 基线故障：`copy_deferred_lighting_id_pipeline` 在 WebGL2 + SwiftShader 环境会触发 `wgpu` Validation Error，导致 wasm 中断。
    - 架构耦合：`CopyDeferredLightingIdPlugin` 与 `Core3d` render graph 存在硬耦合，单独禁用该插件会触发新的启动 panic（`Option::expect` -> `RuntimeError: unreachable`）。
  - 回写项目管理文档：`doc/game-test.project.md`（新增 T5 排查任务与证据路径）。
- 测试：
  - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer target_compat_mode -- --nocapture`
  - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer --target wasm32-unknown-unknown`
  - Playwright 复现证据：
    - `output/playwright/viewer/webgl-deferred-disable-verify2-20260225-143042/`
    - `output/playwright/viewer/webgl-panic-locate-20260225-143645/`
- 遗留事项：
  - 需要设计“成对修正方案”（同时处理 pipeline 初始化与 Core3d graph 依赖），避免再次出现“修一处炸一处”的启动崩溃。

- 时刻：2026-02-25 16:43:20 CST
- 完成内容：完成“按 game-test.md 作为真实玩家游玩并填写卡片（用户追加轮次）”任务。
  - 按默认链路重跑：`world_viewer_live`（默认节点拓扑）+ `run-viewer-web.sh` + Playwright CLI。
  - 完成带录屏实操（模式切换、目标选中、播放/暂停、状态采样）。
  - 新增测试卡片：`doc/playability_test_result/card_2026_02_25_16_40_22.md`。
  - 产物归档：`output/playwright/playability/20260225-163706/`（含 `playthrough.webm`、截图、控制台日志、pids/meta）。
  - 回写项目管理文档：`doc/game-test.project.md`（新增 T6 与测试记录）。
- 测试：
  - Playwright Web 闭环实测（真实操作 + 录屏）：`output/playwright/playability/20260225-163706/playwright.log`
  - 控制台采样：`output/playwright/playability/20260225-163706/console_all_messages.log`（`Errors: 0, Warnings: 8`）
- 遗留事项：
  - 追加复测未出现启动崩溃，但 `window.__AW_TEST__.getState()` 中 `tick` 持续为 `0`，仍需后续定位“世界不推进”根因。
