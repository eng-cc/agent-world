- 时刻：2026-02-28 11:44:48 CST
- 完成内容：完成“M4 资源产业链可玩性优先强化”T0（建档）。
  - 新增设计文档：`doc/world-simulator/m4/m4-resource-product-system-playability-priority-hardening-2026-02-28.md`。
  - 新增项目管理文档：`doc/world-simulator/m4/m4-resource-product-system-playability-priority-hardening-2026-02-28.project.md`。
  - 项目状态设置为“进行中（T0 已完成，执行 T1）”。
- 测试：
  - test_tier_required（文档行数约束）：`wc -l doc/world-simulator/m4/m4-resource-product-system-playability-priority-hardening-2026-02-28.md doc/world-simulator/m4/m4-resource-product-system-playability-priority-hardening-2026-02-28.project.md`。
  - test_tier_required（设计文档结构）：`rg -n "目标|范围|接口 / 数据|里程碑|风险" doc/world-simulator/m4/m4-resource-product-system-playability-priority-hardening-2026-02-28.md`。
  - test_tier_required（项目文档结构）：`rg -n "任务拆解|依赖|状态" doc/world-simulator/m4/m4-resource-product-system-playability-priority-hardening-2026-02-28.project.md`。
- 遗留事项：
  - 执行 T1：补齐 `polymer_resin` 内置配方链路与 bootstrap/artifact 同步。

- 时刻：2026-02-28 11:55:56 CST
- 完成内容：完成“M4 资源产业链可玩性优先强化”T1（`polymer_resin` 配方链路 + bootstrap/artifact 同步）。
  - 新增内置模块 crate：`crates/agent_world_builtin_wasm_modules/m4_recipe_smelter_polymer_resin`（`Cargo.toml`/`Cargo.lock`/`src/lib.rs`）。
  - 更新 `crates/agent_world_wasm_store/src/lib.rs`、`crates/agent_world/src/runtime/mod.rs`：新增并导出 `M4_RECIPE_SMELT_POLYMER_RESIN_MODULE_ID`。
  - 更新 `crates/agent_world/src/runtime/world/bootstrap_economy.rs`：
    - bootstrap 模块清单新增 `m4.recipe.smelter.polymer_resin`；
    - 默认 `RecipeProfile` 新增 `recipe.smelter.polymer_resin`（`bootstrap` 阶段）。
  - 更新清单：
    - `crates/agent_world/src/runtime/world/artifacts/m4_builtin_module_ids.txt`
    - `crates/agent_world/src/runtime/world/artifacts/builtin_module_manifest_map.txt`
    - `crates/agent_world/src/runtime/world/artifacts/m4_builtin_modules.sha256`
    - `crates/agent_world/src/runtime/world/artifacts/m4_builtin_modules.identity.json`
  - 更新 `crates/agent_world/src/runtime/tests/economy_bootstrap.rs`：
    - 模块常量期望列表纳入新 recipe 模块；
    - 端到端链路测试改为先产出 `polymer_resin`，移除预置 `polymer_resin` 依赖。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`。
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::builtin_wasm_identity -- --nocapture`。
  - test_tier_full：`env -u RUSTC_WRAPPER cargo test -p agent_world --features "wasmtime test_tier_full" runtime::tests::economy_bootstrap -- --nocapture`。
  - test_tier_full：`./scripts/sync-m4-builtin-wasm-artifacts.sh --check`。
- 遗留事项：
  - 执行 T2：落地 `unlock_stage` 校验与 `TransferMaterial` 显式优先级。

- 时刻：2026-02-28 12:03:36 CST
- 完成内容：完成“M4 资源产业链可玩性优先强化”T2（`unlock_stage` 校验 + `TransferMaterial` 显式优先级）。
  - 更新 `crates/agent_world/src/runtime/events.rs`：`Action::TransferMaterial` 新增可选字段 `priority: Option<MaterialTransitPriority>`（`serde(default)`，兼容旧输入）。
  - 更新 `crates/agent_world/src/runtime/world/event_processing/action_to_event_core.rs`：物流优先级解析链路改为“显式输入 > material profile 默认优先级 > 关键词推断”。
  - 更新 `crates/agent_world/src/runtime/world/event_processing/action_to_event_economy.rs`：`ScheduleRecipe` 新增 `ProductProfile.unlock_stage` 校验，阶段不足时拒绝排产。
  - 更新 `crates/agent_world/src/runtime/tests/economy_priority_logistics.rs`：
    - 新增 `due_transits_allow_explicit_priority_override_for_non_urgent_material`；
    - 新增 `schedule_recipe_rejects_when_product_unlock_stage_exceeds_current_stage`。
  - 更新 `crates/agent_world/src/runtime/tests/economy.rs` 与既有物流测试调用点，补齐 `priority: None`。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`。
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::economy_priority_logistics -- --nocapture`。
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::economy -- --nocapture`。
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world`。
- 遗留事项：
  - 执行 T3：落地 `maintenance_sink` 持续消耗并更新默认 profile 参数。

- 时刻：2026-02-28 12:12:44 CST
- 完成内容：完成“M4 资源产业链可玩性优先强化”T3（`maintenance_sink` 持续消耗接线 + 默认参数更新）。
  - 更新 `crates/agent_world/src/runtime/world/event_processing/action_to_event_economy.rs`：
    - 新增 `merge_recipe_consume_with_maintenance_sink`，将 `ProductProfile.maintenance_sink` 按产出数量折算后并入配方实际消耗；
    - `ScheduleRecipe` 的库存校验、账本回退、报价观测、bottleneck 推断、事件 `consume` 字段统一改为基于“合并后消耗”。
  - 更新 `crates/agent_world/src/runtime/world/bootstrap_economy.rs`：
    - M4 默认 `ProductProfile` 为中后期产品补齐 `maintenance_sink` 首版参数；
    - `factory_core` 额外接入 `alloy_plate` 维护消耗。
  - 更新 `crates/agent_world/src/runtime/tests/economy_priority_logistics.rs`：新增 `schedule_recipe_applies_product_maintenance_sink_to_consume`，验证维护消耗并入排产消耗。
  - 更新 `crates/agent_world/src/runtime/tests/economy_bootstrap.rs`：补充 `hardware_part` 初始库存并同步断言（`alloy_plate/hardware_part` 余额）。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`。
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::economy_priority_logistics -- --nocapture`。
  - test_tier_full：`env -u RUSTC_WRAPPER cargo test -p agent_world --features "wasmtime test_tier_full" runtime::tests::economy_bootstrap -- --nocapture`。
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world`。
- 遗留事项：
  - 执行 T4：完成项目文档状态收口并结项提交。

- 时刻：2026-02-28 12:15:42 CST
- 完成内容：完成“M4 资源产业链可玩性优先强化”T4（回归收口与结项）。
  - 更新项目管理文档：`doc/world-simulator/m4/m4-resource-product-system-playability-priority-hardening-2026-02-28.project.md`。
  - 状态收敛为“已完成（T0~T4）”，本轮任务结项。
- 测试：
  - 文档收口任务，无新增代码测试（T1~T3 已完成 required/full 回归）。
- 遗留事项：
  - 无（当前项目文档内任务已全部完成）。

- 时刻：2026-02-28 12:37:00 CST
- 完成内容：完成“S10 五节点真实游戏数据在线长跑套件”T0（建档）。
  - 新建设计文档：`doc/testing/s10-five-node-real-game-soak.md`。
  - 新建项目管理文档：`doc/testing/s10-five-node-real-game-soak.project.md`。
  - 项目状态设置为“进行中（T0 已完成，执行 T1）”。
- 测试：
  - test_tier_required（文档行数约束）：`wc -l doc/testing/s10-five-node-real-game-soak.md doc/testing/s10-five-node-real-game-soak.project.md`。
  - test_tier_required（设计文档结构）：`rg -n "目标|范围|接口 / 数据|里程碑|风险" doc/testing/s10-five-node-real-game-soak.md`。
  - test_tier_required（项目文档结构）：`rg -n "任务拆解|依赖|状态" doc/testing/s10-five-node-real-game-soak.project.md`。
- 遗留事项：
  - 执行 T1：实现 `scripts/s10-five-node-game-soak.sh` 五节点编排脚本。

- 时刻：2026-02-28 12:46:07 CST
- 完成内容：完成“S10 五节点真实游戏数据在线长跑套件”T1（五节点编排脚本落地）。
  - 新增脚本：`scripts/s10-five-node-game-soak.sh`（`single` 拓扑五进程编排）。
  - 实现能力：
    - 五节点启动/停止、输出目录管理与节点级日志/命令留存；
    - full-mesh gossip + full-mesh libp2p replication 配置；
    - 固定五验证人集合注入（`35/20/20/15/10`）；
    - 指标聚合并输出 `run_config.json`、`timeline.csv`、`summary.json`、`summary.md`、`failures.md`（失败时）；
    - 门禁覆盖 `stall/lag_p95/distfs_failure_ratio/invariant` 与真实数据交换信号（`settlement_report.total_distributed_points`、`minted_records`）；
    - 支持 `--help`、`--dry-run`、`--llm/--no-llm`、阈值参数。
  - 更新项目管理文档：`doc/testing/s10-five-node-real-game-soak.project.md`，T1 勾选完成，状态推进至 T2。
- 测试：
  - test_tier_required（脚本语法）：`bash -n scripts/s10-five-node-game-soak.sh`。
  - test_tier_required（帮助输出）：`./scripts/s10-five-node-game-soak.sh --help`。
  - test_tier_required（闭环干跑）：`./scripts/s10-five-node-game-soak.sh --dry-run --no-prewarm --duration-secs 60 --out-dir .tmp/s10_game_longrun`。
- 遗留事项：
  - 执行 T2：将 S10 接入 `testing-manual.md` 并明确与 S9 的边界与触发口径。

- 时刻：2026-02-28 12:48:45 CST
- 完成内容：完成“S10 五节点真实游戏数据在线长跑套件”T2（`testing-manual.md` 接线）。
  - 更新 `testing-manual.md`：
    - 套件目录由 `S0~S9` 扩展为 `S0~S10`；
    - 新增 `S10` 章节（命令、产物、门禁、与 S9 的职责边界）；
    - 更新改动路径触发矩阵，增加 `scripts/s10-five-node-game-soak.sh` 路径规则；
    - 更新高风险建议、证据目录、执行剧本和模板中的 S10 引用。
  - 更新项目管理文档：`doc/testing/s10-five-node-real-game-soak.project.md`，T2 勾选完成，状态推进至 T3。
- 测试：
  - test_tier_required（文档行数约束）：`wc -l testing-manual.md`。
  - test_tier_required（S10 接线检查）：`rg -n "S0~S10|S10：五节点真实游戏数据在线长跑套件|scripts/s10-five-node-game-soak.sh|s10_game_longrun" testing-manual.md`。
- 遗留事项：
  - 执行 T3：完成脚本级验证收口、项目文档结项和日志收口。

- 时刻：2026-02-28 12:50:35 CST
- 完成内容：完成“S10 五节点真实游戏数据在线长跑套件”T3（脚本验证与结项收口）。
  - 脚本级验证完成：`syntax/help/dry-run` 三项均通过。
  - 更新项目管理文档：`doc/testing/s10-five-node-real-game-soak.project.md`，T3 勾选完成，状态收敛为“已完成（T0~T3）”。
  - 本轮 S10 建设任务结项。
- 测试：
  - test_tier_required（脚本语法）：`bash -n scripts/s10-five-node-game-soak.sh`。
  - test_tier_required（帮助输出）：`./scripts/s10-five-node-game-soak.sh --help`。
  - test_tier_required（闭环干跑）：`./scripts/s10-five-node-game-soak.sh --dry-run --no-prewarm --duration-secs 60 --out-dir .tmp/s10_game_longrun`。
- 遗留事项：
  - 无（当前项目文档内任务已全部完成）。
- 时刻：2026-02-28 12:04:06 CST
- 完成内容：完成“step completion ack”文档收口任务（T6）。
  - 更新 `doc/world-simulator/viewer-step-completion-ack-2026-02-28.project.md`：T1~T6 全部标记完成。
  - 汇总当前结论：`step` 完成语义已由协议 ack 稳定化（`advanced` / `timeout_no_progress`）；A/B 仍暴露 live 侧真实无推进窗口。
- 遗留事项：无（本设计范围内任务已闭环）；后续若继续优化 B 段成功率，建议立项独立任务。

- 时刻：2026-02-28 12:30:39 CST
- 完成内容：完成“Viewer 产业链图谱化/分层符号化/语义缩放”任务（5 项落地 + 回归）。
  - 文档：新增设计文档 `doc/world-simulator/viewer-industry-graph-layered-symbolic-zoom-2026-02-28.md` 与项目文档 `doc/world-simulator/viewer-industry-graph-layered-symbolic-zoom-2026-02-28.project.md`。
  - 统一中间层：新增 `crates/agent_world_viewer/src/industry_graph_view_model.rs`，集中实现节点/边/层级/状态/根因链/语义缩放切片，替代原有散落文本聚合。
  - 文本层改造：
    - `ui_text_industrial.rs`、`ui_text_economy.rs`、`ui_text_ops_navigation.rs` 改为消费图谱模型。
    - 运营导航输出根因链：`Reject -> Shortage -> Congestion -> Stall`，并附 `target=` 跳转对象标识。
  - 主图层与符号：`world_overlay.rs` 接入图谱边渲染（material/electricity/data 三类流、吞吐线宽、流型颜色），新增节点符号（R1~R5 形态差异、阶段外环、瓶颈/拥塞/告警角标）。
  - 语义缩放：`egui_right_panel.rs` 新增世界/区域/节点三层缩放控件，并联动文本与 overlay 细节级别。
  - 接线：`app_bootstrap.rs` 注入 `IndustrySemanticZoomState`；`main.rs` 挂载新模块；`ui_text.rs` 统一通过图谱模型入口向三块摘要分发。
  - 本地化：`ui_locale_text.rs` 补充新文案映射。
- 测试：
  - test_tier_required：
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer industry_graph_view_model::tests -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer ui_text_industrial::tests -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer ui_text_economy::tests -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer ui_text_ops_navigation::tests -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer world_overlay::tests -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer overlay_section_renders_chunk_legend_and_width_hint -- --nocapture`
  - test_tier_full：
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer`
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer --target wasm32-unknown-unknown`
- 遗留事项：
  - 当前根因链 `target=` 已可用于定位标识，但尚未在 card 文本区做直接点击跳转；若需要“一键定位”，建议后续单独接入按钮式交互层。

- 时刻：2026-02-28 13:23:22 CST
- 完成内容：完成“S10 五节点真实游戏数据在线长跑套件”T4（奖励 epoch 时长可控化）。
  - `world_viewer_live` 新增参数 `--reward-runtime-epoch-duration-secs <n>`，支持以正整数覆盖默认 `epoch_duration_seconds`。
  - 奖励运行时接线完成：无状态初始化与状态恢复两条路径均支持 epoch 秒数覆盖。
  - `scripts/s10-five-node-game-soak.sh` 接线参数 `--reward-runtime-epoch-duration-secs`（默认 `60`），并将配置写入 `run_config.json` 与 `summary.md`。
  - 执行五节点真实短跑：`.tmp/s10_game_longrun/20260228-131900`，验证每节点均产出 `3` 份 `epoch-*.json`，且 `reward-runtime-state.json` 中 `epoch_duration_seconds=60`。
  - 更新项目管理文档：`doc/testing/s10-five-node-real-game-soak.project.md`，T4 勾选完成，状态收敛为“已完成（T0~T4）”。
- 测试：
  - test_tier_required（CLI 解析默认值）：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live parse_options_defaults`。
  - test_tier_required（CLI 自定义值）：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live parse_options_reads_custom_values`。
  - test_tier_required（CLI 参数校验）：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live parse_options_rejects_zero_reward_runtime_epoch_duration_secs`。
  - test_tier_required（脚本语法/帮助/干跑）：`bash -n scripts/s10-five-node-game-soak.sh`、`./scripts/s10-five-node-game-soak.sh --help`、`./scripts/s10-five-node-game-soak.sh --dry-run --no-prewarm --duration-secs 60 --out-dir .tmp/s10_game_longrun`。
  - test_tier_required（五节点真实短跑）：`./scripts/s10-five-node-game-soak.sh --duration-secs 180 --out-dir .tmp/s10_game_longrun --no-prewarm`（验证 epoch 产物通过；当前门禁仍因 `minted_records_empty` 失败）。
- 遗留事项：
  - `minted_records_empty` 门禁失败仍存在（不影响本次 epoch 可控化目标达成），建议后续单独立项排查 mint 前置条件与身份绑定链路。

- 时刻：2026-02-28 14:45:50 CST
- 完成内容：完成“S10 五节点真实游戏数据在线长跑套件”T5（`minted_records_empty` 门禁修复）。
  - 奖励运行时增加 settlement 发布“共识就绪”判定：除 `last_status=Committed` 外，允许 `Pending` 且存在 committed checkpoint（`committed_height>0` 且 `network_committed_height>=committed_height`）的 leader 发布结算。
  - 奖励运行时增加节点身份绑定补齐：启动时预绑定 validator/leader/local/signer；每次结算前对 report 内缺失节点按根密钥派生并补齐绑定，避免 mint 前置校验失败。
  - 验证结果：
    - 首次复跑（`.tmp/s10_game_longrun/20260228-143841`）由于脚本直接使用旧 `target/debug/world_viewer_live` 可执行，仍复现旧门禁失败；
    - 重建二进制后复跑（`.tmp/s10_game_longrun/20260228-144256`）门禁通过，`minted_non_empty_samples=2`，sequencer 节点每 epoch `minted_record_count=3`。
  - 更新项目管理文档：`doc/testing/s10-five-node-real-game-soak.project.md`，新增并完成 T5，状态收敛为“已完成（T0~T5）”。
- 测试：
  - test_tier_required（CLI 回归）：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live parse_options_defaults`。
  - test_tier_required（CLI 回归）：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live parse_options_reads_custom_values`。
  - test_tier_required（mint 预览回归）：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live build_reward_settlement_mint_records_uses_preview_world_without_mutation`。
  - test_tier_required（二进制构建）：`env -u RUSTC_WRAPPER cargo build -p agent_world --bin world_viewer_live`。
  - test_tier_required（五节点真实短跑，最终验证）：`./scripts/s10-five-node-game-soak.sh --duration-secs 130 --out-dir .tmp/s10_game_longrun --no-prewarm`。
- 遗留事项：
  - 无（S10 当前门禁项已闭环）。

- 时刻：2026-02-28 16:47:02 CST
- 完成内容：完成“S10 五节点真实游戏数据在线长跑套件”T6（`committed_height` 长跑 stall 根因修复）。
  - 根因定位结论：
    - S10 固定 `node_id` 复用 `output/node-distfs/s10-*`，跨 run 恢复旧 PoS pending/广播游标后可进入长期无推进；
    - `world_viewer_live` 单节点拓扑此前对非 sequencer 也挂执行 hook + 执行强约束，复制追平后触发 `execution driver requires contiguous committed heights`，导致共识推进链路被打断；
    - no-LLM 五节点在全量关闭 auto-attest 时易长期停在 pending，需提供可控的基线推进策略。
  - 代码改动：
    - 更新 `crates/agent_world/src/bin/world_viewer_live/world_viewer_live_split_part1.rs`：
      - 单节点/triad/triad_distributed 路径中，仅 sequencer 角色启用执行 hook；
      - 执行强约束（`require_execution_on_commit` / `require_peer_execution_hashes`）改为仅 sequencer 角色启用。
    - 更新 `scripts/s10-five-node-game-soak.sh`：
      - 新增默认节点状态隔离（启动前搬迁历史 `output/node-distfs/s10-*` 到 run 目录 `node_state_backup/`）；
      - 新增 auto-attest 策略开关：`--node-auto-attest-all` / `--node-no-auto-attest-all` / `--node-auto-attest-sequencer-only`（默认 `sequencer_only`）；
      - `run_config.json` / `summary.md` 纳入 `node_auto_attest_mode` 与 `isolate_node_state` 配置落盘。
  - 文档改动：
    - 更新设计文档 `doc/testing/s10-five-node-real-game-soak.md`（新增状态隔离与 auto-attest 策略接口说明）。
    - 更新项目文档 `doc/testing/s10-five-node-real-game-soak.project.md`（新增并完成 T6，状态收敛为 T0~T6 已完成）。
- 测试：
  - test_tier_required（world_viewer_live 角色化执行约束回归）：
    - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live start_live_node_applies_pos_options -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live start_live_node_starts_triad_distributed_storage_role -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live start_live_node_starts_triad_distributed_sequencer_without_static_peers -- --nocapture`
  - test_tier_required（脚本语法）：`bash -n scripts/s10-five-node-game-soak.sh`。
  - test_tier_required（五节点真实短跑回归）：
    - 失败复现样本（定位阶段）：`./scripts/s10-five-node-game-soak.sh --duration-secs 260 --max-stall-secs 120 --out-dir .tmp/s10_game_longrun --no-prewarm`（run: `20260228-162536`，stall 超阈）；
    - 修复后通过样本：`./scripts/s10-five-node-game-soak.sh --duration-secs 260 --max-stall-secs 120 --out-dir .tmp/s10_game_longrun --no-prewarm`（run: `20260228-164149`，`status=ok`，`max_stall_secs_observed=0`，各节点高度随 epoch 持续增长）。
- 遗留事项：
  - 无（T6 目标闭环，S10 当前基线门禁可稳定通过）。

- 时刻：2026-02-28 17:37:29 CST
- 完成内容：完成“S10 五节点真实游戏数据在线长跑套件”T7（sequencer 执行桥非连续高度容错修复 + 长跑回归）。
  - 代码改动：`crates/agent_world/src/bin/world_viewer_live/execution_bridge.rs`
    - `NodeRuntimeExecutionDriver::on_commit` 在遇到非连续 committed 高度时不再报错退出，改为记录告警并继续处理当前 commit，避免 `requires contiguous committed heights` 导致共识停摆。
    - 新增测试 `node_runtime_execution_driver_tolerates_non_contiguous_commit_heights`，覆盖 `height: 1 -> 3` 提交容错路径。
  - 文档改动：
    - 更新 `doc/testing/s10-five-node-real-game-soak.md`，补充 sequencer 执行桥非连续高度容错策略说明。
    - 更新 `doc/testing/s10-five-node-real-game-soak.project.md`，新增并完成 T7，状态收敛为“已完成（T0~T7）”。
  - 跑测结论：
    - 失败样本（修复前）：`.tmp/s10_game_longrun/20260228-165423`，`metric_gate_failed`，`stall=842s>300s`。
    - 修复验证样本（新二进制）：`.tmp/s10_game_longrun/20260228-172637`，`600s` 长跑 `status=ok`，`metric_gate=pass`，`max_stall_secs_observed=0`，`minted_non_empty_samples=10`。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live node_runtime_execution_driver_tolerates_non_contiguous_commit_heights -- --nocapture`。
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live node_runtime_execution_driver_persists_chain_records -- --nocapture`。
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live start_live_node_applies_pos_options -- --nocapture`。
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live start_live_node_starts_triad_distributed_storage_role -- --nocapture`。
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live start_live_node_starts_triad_distributed_sequencer_without_static_peers -- --nocapture`。
  - test_tier_required：`env -u RUSTC_WRAPPER cargo build -p agent_world --bin world_viewer_live`。
  - test_tier_required（真实长跑）：`./scripts/s10-five-node-game-soak.sh --duration-secs 600 --max-stall-secs 300 --out-dir .tmp/s10_game_longrun --no-prewarm`。
- 遗留事项：
  - 无（T7 目标闭环，S10 长跑门禁恢复稳定通过）。

- 时刻：2026-02-28 18:05:21 CST
- 完成内容：完成“S10 五节点真实游戏数据在线长跑套件”T8（结算签名错误清零）。
  - 代码改动：
    - `crates/agent_world/src/bin/world_viewer_live/world_viewer_live_split_part2.rs`
      - reward runtime signer key 改为按 `signer_node_id` 从根密钥派生；
      - `reward_runtime_node_identity_bindings` 统一派生，不再对 signer 使用 root 公钥特例；
      - `ensure_reward_runtime_settlement_node_identity_bindings` 改为严格依赖配置绑定，缺失即报错，避免错误派生。
    - `crates/agent_world/src/bin/world_viewer_live/reward_runtime_network.rs`
      - 结算 envelope 编码改为 CBOR；
      - 解码兼容 CBOR 优先，JSON 回退。
    - `crates/agent_world/src/bin/world_viewer_live/world_viewer_live_tests_split_part2.rs`
      - 新增 signer 派生绑定单测；
      - 新增缺失绑定拒绝单测。
  - 验证结果：
    - 回归运行：`.tmp/s10_game_longrun/20260228-180015`（`260s`，门禁通过）；
    - 五节点 `stderr` 中 `reward runtime apply settlement envelope failed`、`verify settlement signature failed`、`settlement signer public key mismatch` 计数均为 `0`。
- 测试：
  - test_tier_required：
    - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live reward_runtime_node_identity_bindings_derive_signer_binding_from_root_key -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live ensure_reward_runtime_settlement_node_identity_bindings_rejects_missing_binding -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live build_reward_settlement_mint_records_uses_preview_world_without_mutation -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live settlement_envelope_roundtrip -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live settlement_envelope_signature_verifies -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo build -p agent_world --bin world_viewer_live`
    - `bash -n scripts/s10-five-node-game-soak.sh`
  - test_tier_required（真实短长跑）：
    - `./scripts/s10-five-node-game-soak.sh --duration-secs 260 --max-stall-secs 120 --out-dir .tmp/s10_game_longrun --no-prewarm`（run: `20260228-180015`）。
- 遗留事项：
  - 执行 T9：将结算 envelope 应用失败率纳入硬门禁并输出到 summary。

- 时刻：2026-02-28 18:19:55 CST
- 完成内容：完成“S10 五节点真实游戏数据在线长跑套件”T9（结算 envelope 应用失败率硬门禁）。
  - 代码改动：
    - `crates/agent_world/src/bin/world_viewer_live/world_viewer_live_split_part2.rs`
      - 增加结算 envelope 应用累计计数：`settlement_apply_attempts_total` / `settlement_apply_failures_total`；
      - 在 epoch 报表 `reward_settlement_transport` 输出 `settlement_apply_attempts_this_tick`、`settlement_apply_failures_this_tick`、`settlement_apply_attempts_total`、`settlement_apply_failures_total`、`settlement_apply_failure_ratio`。
    - `scripts/s10-five-node-game-soak.sh`
      - 新增参数 `--max-settlement-apply-failure-ratio <0~1>`（默认 `0`）；
      - 聚合各节点结算应用累计计数并计算 `settlement_apply_failure_ratio`；
      - 将结算应用失败率纳入硬门禁（并要求 `settlement_apply_attempts > 0`）；
      - `run_config.json` / `summary.json` / `summary.md` / `timeline.csv` 同步输出相关阈值与指标。
  - 文档改动：
    - 更新设计文档：`doc/testing/s10-five-node-real-game-soak.md`（新增参数、报表字段与门禁口径）。
    - 更新项目文档：`doc/testing/s10-five-node-real-game-soak.project.md`（T9 勾选完成，状态推进至 T10）。
  - 验证结果：
    - 旧二进制失败样本：`.tmp/s10_game_longrun/20260228-181108`（`metric_gate=fail`，`settlement_apply_attempts=0`，用于确认硬门禁生效）；
    - 重建二进制并复跑通过：`.tmp/s10_game_longrun/20260228-181651`（`130s`，`status=ok`，`metric_gate=pass`，`settlement_apply_attempts=7`，`settlement_apply_failures=0`，`settlement_apply_failure_ratio=0`）。
    - 五节点 `stderr` 结算相关计数均为 `0`：`reward runtime apply settlement envelope failed` / `verify settlement signature failed` / `settlement signer public key mismatch`。
- 测试：
  - test_tier_required：
    - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live settlement_envelope_roundtrip -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live settlement_envelope_signature_verifies -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live ensure_reward_runtime_settlement_node_identity_bindings_rejects_missing_binding -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo build -p agent_world --bin world_viewer_live`
    - `bash -n scripts/s10-five-node-game-soak.sh`
    - `./scripts/s10-five-node-game-soak.sh --dry-run --no-prewarm --duration-secs 60 --out-dir .tmp/s10_game_longrun --max-settlement-apply-failure-ratio 0`
    - `./scripts/s10-five-node-game-soak.sh --duration-secs 130 --out-dir .tmp/s10_game_longrun --no-prewarm --max-settlement-apply-failure-ratio 0`（run: `20260228-181651`）
- 遗留事项：
  - 执行 T10：连续多轮长跑（`3x600s + 1x更长`）并给出发布结论。

- 时刻：2026-02-28 19:17:08 CST
- 完成内容：完成“S10 五节点真实游戏数据在线长跑套件”T10（`3x600s + 1x1200s` 连续长跑稳定性验证与发布收口）。
  - 连续四轮跑测（均 `--no-prewarm`，`--max-settlement-apply-failure-ratio 0`）：
    - run `20260228-182339`（`600s`）：`overall_status=ok`，`metric_gate=pass`，`settlement_apply_attempts=48`，`settlement_apply_failures=0`，`minted_non_empty_samples=10`；
    - run `20260228-183422`（`600s`）：`overall_status=ok`，`metric_gate=pass`，`settlement_apply_attempts=49`，`settlement_apply_failures=0`，`minted_non_empty_samples=10`；
    - run `20260228-184508`（`600s`）：`overall_status=ok`，`metric_gate=pass`，`settlement_apply_attempts=46`，`settlement_apply_failures=0`，`minted_non_empty_samples=10`；
    - run `20260228-185554`（`1200s`）：`overall_status=ok`，`metric_gate=pass`，`settlement_apply_attempts=96`，`settlement_apply_failures=0`，`minted_non_empty_samples=20`。
  - 四轮关键告警核验：
    - 五节点 `stderr` 中 `reward runtime apply settlement envelope failed` / `verify settlement signature failed` / `settlement signer public key mismatch` 均为 `0`。
  - 项目文档收口：
    - 更新 `doc/testing/s10-five-node-real-game-soak.project.md`，T10 勾选完成，项目状态更新为“已完成（T0~T10）”。
- 测试：
  - test_tier_required（连续长跑）：
    - `./scripts/s10-five-node-game-soak.sh --duration-secs 600 --out-dir .tmp/s10_game_longrun --no-prewarm --max-settlement-apply-failure-ratio 0`（run: `20260228-182339`）
    - `./scripts/s10-five-node-game-soak.sh --duration-secs 600 --out-dir .tmp/s10_game_longrun --no-prewarm --max-settlement-apply-failure-ratio 0`（run: `20260228-183422`）
    - `./scripts/s10-five-node-game-soak.sh --duration-secs 600 --out-dir .tmp/s10_game_longrun --no-prewarm --max-settlement-apply-failure-ratio 0`（run: `20260228-184508`）
    - `./scripts/s10-five-node-game-soak.sh --duration-secs 1200 --out-dir .tmp/s10_game_longrun --no-prewarm --max-settlement-apply-failure-ratio 0`（run: `20260228-185554`）
  - test_tier_required（结果核验）：
    - `jq` 读取四轮 `summary.json` 门禁与指标；
    - `grep -c` 统计四轮五节点 `stderr` 关键告警计数。
- 遗留事项：
  - 无（S10 T0~T10 全部闭环）。
