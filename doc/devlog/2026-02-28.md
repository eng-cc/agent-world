- 时刻：2026-02-28 11:44:48 CST
- 完成内容：完成“M4 资源产业链可玩性优先强化”T0（建档）。
  - 新增设计文档：`doc/world-simulator/m4/m4-resource-product-system-playability-priority-hardening-2026-02-28.md`。
  - 新增项目管理文档：`doc/world-simulator/m4/m4-resource-product-system-playability-priority-hardening-2026-02-28.project.md`。
  - 项目状态设置为“进行中（T0 已完成，执行 T1）”。
- 测试：
  - test_tier_required（文档行数约束）：`wc -l doc/world-simulator/m4/m4-resource-product-system-playability-priority-hardening-2026-02-28.md doc/world-simulator/m4/m4-resource-product-system-playability-priority-hardening-2026-02-28.project.md`。
  - test_tier_required（设计文档结构）：`rg -n "目标|范围|接口 / 数据|里程碑|风险" doc/world-simulator/m4/m4-resource-product-system-playability-priority-hardening-2026-02-28.md`。
  - test_tier_required（项目文档结构）：`rg -n "任务拆解|依赖|状态" doc/world-simulator/m4/m4-resource-product-system-playability-priority-hardening-2026-02-28.project.md`。
- 遗留事项：
  - 执行 T1：补齐 `polymer_resin` 内置配方链路与 bootstrap/artifact 同步。

- 时刻：2026-02-28 11:55:56 CST
- 完成内容：完成“M4 资源产业链可玩性优先强化”T1（`polymer_resin` 配方链路 + bootstrap/artifact 同步）。
  - 新增内置模块 crate：`crates/agent_world_builtin_wasm_modules/m4_recipe_smelter_polymer_resin`（`Cargo.toml`/`Cargo.lock`/`src/lib.rs`）。
  - 更新 `crates/agent_world_wasm_store/src/lib.rs`、`crates/agent_world/src/runtime/mod.rs`：新增并导出 `M4_RECIPE_SMELT_POLYMER_RESIN_MODULE_ID`。
  - 更新 `crates/agent_world/src/runtime/world/bootstrap_economy.rs`：
    - bootstrap 模块清单新增 `m4.recipe.smelter.polymer_resin`；
    - 默认 `RecipeProfile` 新增 `recipe.smelter.polymer_resin`（`bootstrap` 阶段）。
  - 更新清单：
    - `crates/agent_world/src/runtime/world/artifacts/m4_builtin_module_ids.txt`
    - `crates/agent_world/src/runtime/world/artifacts/builtin_module_manifest_map.txt`
    - `crates/agent_world/src/runtime/world/artifacts/m4_builtin_modules.sha256`
    - `crates/agent_world/src/runtime/world/artifacts/m4_builtin_modules.identity.json`
  - 更新 `crates/agent_world/src/runtime/tests/economy_bootstrap.rs`：
    - 模块常量期望列表纳入新 recipe 模块；
    - 端到端链路测试改为先产出 `polymer_resin`，移除预置 `polymer_resin` 依赖。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`。
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::builtin_wasm_identity -- --nocapture`。
  - test_tier_full：`env -u RUSTC_WRAPPER cargo test -p agent_world --features "wasmtime test_tier_full" runtime::tests::economy_bootstrap -- --nocapture`。
  - test_tier_full：`./scripts/sync-m4-builtin-wasm-artifacts.sh --check`。
- 遗留事项：
  - 执行 T2：落地 `unlock_stage` 校验与 `TransferMaterial` 显式优先级。

- 时刻：2026-02-28 12:03:36 CST
- 完成内容：完成“M4 资源产业链可玩性优先强化”T2（`unlock_stage` 校验 + `TransferMaterial` 显式优先级）。
  - 更新 `crates/agent_world/src/runtime/events.rs`：`Action::TransferMaterial` 新增可选字段 `priority: Option<MaterialTransitPriority>`（`serde(default)`，兼容旧输入）。
  - 更新 `crates/agent_world/src/runtime/world/event_processing/action_to_event_core.rs`：物流优先级解析链路改为“显式输入 > material profile 默认优先级 > 关键词推断”。
  - 更新 `crates/agent_world/src/runtime/world/event_processing/action_to_event_economy.rs`：`ScheduleRecipe` 新增 `ProductProfile.unlock_stage` 校验，阶段不足时拒绝排产。
  - 更新 `crates/agent_world/src/runtime/tests/economy_priority_logistics.rs`：
    - 新增 `due_transits_allow_explicit_priority_override_for_non_urgent_material`；
    - 新增 `schedule_recipe_rejects_when_product_unlock_stage_exceeds_current_stage`。
  - 更新 `crates/agent_world/src/runtime/tests/economy.rs` 与既有物流测试调用点，补齐 `priority: None`。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`。
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::economy_priority_logistics -- --nocapture`。
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::economy -- --nocapture`。
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world`。
- 遗留事项：
  - 执行 T3：落地 `maintenance_sink` 持续消耗并更新默认 profile 参数。

- 时刻：2026-02-28 12:12:44 CST
- 完成内容：完成“M4 资源产业链可玩性优先强化”T3（`maintenance_sink` 持续消耗接线 + 默认参数更新）。
  - 更新 `crates/agent_world/src/runtime/world/event_processing/action_to_event_economy.rs`：
    - 新增 `merge_recipe_consume_with_maintenance_sink`，将 `ProductProfile.maintenance_sink` 按产出数量折算后并入配方实际消耗；
    - `ScheduleRecipe` 的库存校验、账本回退、报价观测、bottleneck 推断、事件 `consume` 字段统一改为基于“合并后消耗”。
  - 更新 `crates/agent_world/src/runtime/world/bootstrap_economy.rs`：
    - M4 默认 `ProductProfile` 为中后期产品补齐 `maintenance_sink` 首版参数；
    - `factory_core` 额外接入 `alloy_plate` 维护消耗。
  - 更新 `crates/agent_world/src/runtime/tests/economy_priority_logistics.rs`：新增 `schedule_recipe_applies_product_maintenance_sink_to_consume`，验证维护消耗并入排产消耗。
  - 更新 `crates/agent_world/src/runtime/tests/economy_bootstrap.rs`：补充 `hardware_part` 初始库存并同步断言（`alloy_plate/hardware_part` 余额）。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo fmt --all -- --check`。
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world runtime::tests::economy_priority_logistics -- --nocapture`。
  - test_tier_full：`env -u RUSTC_WRAPPER cargo test -p agent_world --features "wasmtime test_tier_full" runtime::tests::economy_bootstrap -- --nocapture`。
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world`。
- 遗留事项：
  - 执行 T4：完成项目文档状态收口并结项提交。

- 时刻：2026-02-28 12:15:42 CST
- 完成内容：完成“M4 资源产业链可玩性优先强化”T4（回归收口与结项）。
  - 更新项目管理文档：`doc/world-simulator/m4/m4-resource-product-system-playability-priority-hardening-2026-02-28.project.md`。
  - 状态收敛为“已完成（T0~T4）”，本轮任务结项。
- 测试：
  - 文档收口任务，无新增代码测试（T1~T3 已完成 required/full 回归）。
- 遗留事项：
  - 无（当前项目文档内任务已全部完成）。

- 时刻：2026-02-28 12:37:00 CST
- 完成内容：完成“S10 五节点真实游戏数据在线长跑套件”T0（建档）。
  - 新建设计文档：`doc/testing/s10-five-node-real-game-soak.md`。
  - 新建项目管理文档：`doc/testing/s10-five-node-real-game-soak.project.md`。
  - 项目状态设置为“进行中（T0 已完成，执行 T1）”。
- 测试：
  - test_tier_required（文档行数约束）：`wc -l doc/testing/s10-five-node-real-game-soak.md doc/testing/s10-five-node-real-game-soak.project.md`。
  - test_tier_required（设计文档结构）：`rg -n "目标|范围|接口 / 数据|里程碑|风险" doc/testing/s10-five-node-real-game-soak.md`。
  - test_tier_required（项目文档结构）：`rg -n "任务拆解|依赖|状态" doc/testing/s10-five-node-real-game-soak.project.md`。
- 遗留事项：
  - 执行 T1：实现 `scripts/s10-five-node-game-soak.sh` 五节点编排脚本。

- 时刻：2026-02-28 12:46:07 CST
- 完成内容：完成“S10 五节点真实游戏数据在线长跑套件”T1（五节点编排脚本落地）。
  - 新增脚本：`scripts/s10-five-node-game-soak.sh`（`single` 拓扑五进程编排）。
  - 实现能力：
    - 五节点启动/停止、输出目录管理与节点级日志/命令留存；
    - full-mesh gossip + full-mesh libp2p replication 配置；
    - 固定五验证人集合注入（`35/20/20/15/10`）；
    - 指标聚合并输出 `run_config.json`、`timeline.csv`、`summary.json`、`summary.md`、`failures.md`（失败时）；
    - 门禁覆盖 `stall/lag_p95/distfs_failure_ratio/invariant` 与真实数据交换信号（`settlement_report.total_distributed_points`、`minted_records`）；
    - 支持 `--help`、`--dry-run`、`--llm/--no-llm`、阈值参数。
  - 更新项目管理文档：`doc/testing/s10-five-node-real-game-soak.project.md`，T1 勾选完成，状态推进至 T2。
- 测试：
  - test_tier_required（脚本语法）：`bash -n scripts/s10-five-node-game-soak.sh`。
  - test_tier_required（帮助输出）：`./scripts/s10-five-node-game-soak.sh --help`。
  - test_tier_required（闭环干跑）：`./scripts/s10-five-node-game-soak.sh --dry-run --no-prewarm --duration-secs 60 --out-dir .tmp/s10_game_longrun`。
- 遗留事项：
  - 执行 T2：将 S10 接入 `testing-manual.md` 并明确与 S9 的边界与触发口径。

- 时刻：2026-02-28 12:48:45 CST
- 完成内容：完成“S10 五节点真实游戏数据在线长跑套件”T2（`testing-manual.md` 接线）。
  - 更新 `testing-manual.md`：
    - 套件目录由 `S0~S9` 扩展为 `S0~S10`；
    - 新增 `S10` 章节（命令、产物、门禁、与 S9 的职责边界）；
    - 更新改动路径触发矩阵，增加 `scripts/s10-five-node-game-soak.sh` 路径规则；
    - 更新高风险建议、证据目录、执行剧本和模板中的 S10 引用。
  - 更新项目管理文档：`doc/testing/s10-five-node-real-game-soak.project.md`，T2 勾选完成，状态推进至 T3。
- 测试：
  - test_tier_required（文档行数约束）：`wc -l testing-manual.md`。
  - test_tier_required（S10 接线检查）：`rg -n "S0~S10|S10：五节点真实游戏数据在线长跑套件|scripts/s10-five-node-game-soak.sh|s10_game_longrun" testing-manual.md`。
- 遗留事项：
  - 执行 T3：完成脚本级验证收口、项目文档结项和日志收口。

- 时刻：2026-02-28 12:50:35 CST
- 完成内容：完成“S10 五节点真实游戏数据在线长跑套件”T3（脚本验证与结项收口）。
  - 脚本级验证完成：`syntax/help/dry-run` 三项均通过。
  - 更新项目管理文档：`doc/testing/s10-five-node-real-game-soak.project.md`，T3 勾选完成，状态收敛为“已完成（T0~T3）”。
  - 本轮 S10 建设任务结项。
- 测试：
  - test_tier_required（脚本语法）：`bash -n scripts/s10-five-node-game-soak.sh`。
  - test_tier_required（帮助输出）：`./scripts/s10-five-node-game-soak.sh --help`。
  - test_tier_required（闭环干跑）：`./scripts/s10-five-node-game-soak.sh --dry-run --no-prewarm --duration-secs 60 --out-dir .tmp/s10_game_longrun`。
- 遗留事项：
  - 无（当前项目文档内任务已全部完成）。
- 时刻：2026-02-28 12:04:06 CST
- 完成内容：完成“step completion ack”文档收口任务（T6）。
  - 更新 `doc/world-simulator/viewer-step-completion-ack-2026-02-28.project.md`：T1~T6 全部标记完成。
  - 汇总当前结论：`step` 完成语义已由协议 ack 稳定化（`advanced` / `timeout_no_progress`）；A/B 仍暴露 live 侧真实无推进窗口。
- 遗留事项：无（本设计范围内任务已闭环）；后续若继续优化 B 段成功率，建议立项独立任务。

- 时刻：2026-02-28 12:30:39 CST
- 完成内容：完成“Viewer 产业链图谱化/分层符号化/语义缩放”任务（5 项落地 + 回归）。
  - 文档：新增设计文档 `doc/world-simulator/viewer-industry-graph-layered-symbolic-zoom-2026-02-28.md` 与项目文档 `doc/world-simulator/viewer-industry-graph-layered-symbolic-zoom-2026-02-28.project.md`。
  - 统一中间层：新增 `crates/agent_world_viewer/src/industry_graph_view_model.rs`，集中实现节点/边/层级/状态/根因链/语义缩放切片，替代原有散落文本聚合。
  - 文本层改造：
    - `ui_text_industrial.rs`、`ui_text_economy.rs`、`ui_text_ops_navigation.rs` 改为消费图谱模型。
    - 运营导航输出根因链：`Reject -> Shortage -> Congestion -> Stall`，并附 `target=` 跳转对象标识。
  - 主图层与符号：`world_overlay.rs` 接入图谱边渲染（material/electricity/data 三类流、吞吐线宽、流型颜色），新增节点符号（R1~R5 形态差异、阶段外环、瓶颈/拥塞/告警角标）。
  - 语义缩放：`egui_right_panel.rs` 新增世界/区域/节点三层缩放控件，并联动文本与 overlay 细节级别。
  - 接线：`app_bootstrap.rs` 注入 `IndustrySemanticZoomState`；`main.rs` 挂载新模块；`ui_text.rs` 统一通过图谱模型入口向三块摘要分发。
  - 本地化：`ui_locale_text.rs` 补充新文案映射。
- 测试：
  - test_tier_required：
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer industry_graph_view_model::tests -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer ui_text_industrial::tests -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer ui_text_economy::tests -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer ui_text_ops_navigation::tests -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer world_overlay::tests -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer overlay_section_renders_chunk_legend_and_width_hint -- --nocapture`
  - test_tier_full：
    - `env -u RUSTC_WRAPPER cargo test -p agent_world_viewer`
    - `env -u RUSTC_WRAPPER cargo check -p agent_world_viewer --target wasm32-unknown-unknown`
- 遗留事项：
  - 当前根因链 `target=` 已可用于定位标识，但尚未在 card 文本区做直接点击跳转；若需要“一键定位”，建议后续单独接入按钮式交互层。

- 时刻：2026-02-28 13:23:22 CST
- 完成内容：完成“S10 五节点真实游戏数据在线长跑套件”T4（奖励 epoch 时长可控化）。
  - `world_viewer_live` 新增参数 `--reward-runtime-epoch-duration-secs <n>`，支持以正整数覆盖默认 `epoch_duration_seconds`。
  - 奖励运行时接线完成：无状态初始化与状态恢复两条路径均支持 epoch 秒数覆盖。
  - `scripts/s10-five-node-game-soak.sh` 接线参数 `--reward-runtime-epoch-duration-secs`（默认 `60`），并将配置写入 `run_config.json` 与 `summary.md`。
  - 执行五节点真实短跑：`.tmp/s10_game_longrun/20260228-131900`，验证每节点均产出 `3` 份 `epoch-*.json`，且 `reward-runtime-state.json` 中 `epoch_duration_seconds=60`。
  - 更新项目管理文档：`doc/testing/s10-five-node-real-game-soak.project.md`，T4 勾选完成，状态收敛为“已完成（T0~T4）”。
- 测试：
  - test_tier_required（CLI 解析默认值）：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live parse_options_defaults`。
  - test_tier_required（CLI 自定义值）：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live parse_options_reads_custom_values`。
  - test_tier_required（CLI 参数校验）：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live parse_options_rejects_zero_reward_runtime_epoch_duration_secs`。
  - test_tier_required（脚本语法/帮助/干跑）：`bash -n scripts/s10-five-node-game-soak.sh`、`./scripts/s10-five-node-game-soak.sh --help`、`./scripts/s10-five-node-game-soak.sh --dry-run --no-prewarm --duration-secs 60 --out-dir .tmp/s10_game_longrun`。
  - test_tier_required（五节点真实短跑）：`./scripts/s10-five-node-game-soak.sh --duration-secs 180 --out-dir .tmp/s10_game_longrun --no-prewarm`（验证 epoch 产物通过；当前门禁仍因 `minted_records_empty` 失败）。
- 遗留事项：
  - `minted_records_empty` 门禁失败仍存在（不影响本次 epoch 可控化目标达成），建议后续单独立项排查 mint 前置条件与身份绑定链路。

- 时刻：2026-02-28 14:45:50 CST
- 完成内容：完成“S10 五节点真实游戏数据在线长跑套件”T5（`minted_records_empty` 门禁修复）。
  - 奖励运行时增加 settlement 发布“共识就绪”判定：除 `last_status=Committed` 外，允许 `Pending` 且存在 committed checkpoint（`committed_height>0` 且 `network_committed_height>=committed_height`）的 leader 发布结算。
  - 奖励运行时增加节点身份绑定补齐：启动时预绑定 validator/leader/local/signer；每次结算前对 report 内缺失节点按根密钥派生并补齐绑定，避免 mint 前置校验失败。
  - 验证结果：
    - 首次复跑（`.tmp/s10_game_longrun/20260228-143841`）由于脚本直接使用旧 `target/debug/world_viewer_live` 可执行，仍复现旧门禁失败；
    - 重建二进制后复跑（`.tmp/s10_game_longrun/20260228-144256`）门禁通过，`minted_non_empty_samples=2`，sequencer 节点每 epoch `minted_record_count=3`。
  - 更新项目管理文档：`doc/testing/s10-five-node-real-game-soak.project.md`，新增并完成 T5，状态收敛为“已完成（T0~T5）”。
- 测试：
  - test_tier_required（CLI 回归）：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live parse_options_defaults`。
  - test_tier_required（CLI 回归）：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live parse_options_reads_custom_values`。
  - test_tier_required（mint 预览回归）：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live build_reward_settlement_mint_records_uses_preview_world_without_mutation`。
  - test_tier_required（二进制构建）：`env -u RUSTC_WRAPPER cargo build -p agent_world --bin world_viewer_live`。
  - test_tier_required（五节点真实短跑，最终验证）：`./scripts/s10-five-node-game-soak.sh --duration-secs 130 --out-dir .tmp/s10_game_longrun --no-prewarm`。
- 遗留事项：
  - 无（S10 当前门禁项已闭环）。

- 时刻：2026-02-28 16:47:02 CST
- 完成内容：完成“S10 五节点真实游戏数据在线长跑套件”T6（`committed_height` 长跑 stall 根因修复）。
  - 根因定位结论：
    - S10 固定 `node_id` 复用 `output/node-distfs/s10-*`，跨 run 恢复旧 PoS pending/广播游标后可进入长期无推进；
    - `world_viewer_live` 单节点拓扑此前对非 sequencer 也挂执行 hook + 执行强约束，复制追平后触发 `execution driver requires contiguous committed heights`，导致共识推进链路被打断；
    - no-LLM 五节点在全量关闭 auto-attest 时易长期停在 pending，需提供可控的基线推进策略。
  - 代码改动：
    - 更新 `crates/agent_world/src/bin/world_viewer_live/world_viewer_live_split_part1.rs`：
      - 单节点/triad/triad_distributed 路径中，仅 sequencer 角色启用执行 hook；
      - 执行强约束（`require_execution_on_commit` / `require_peer_execution_hashes`）改为仅 sequencer 角色启用。
    - 更新 `scripts/s10-five-node-game-soak.sh`：
      - 新增默认节点状态隔离（启动前搬迁历史 `output/node-distfs/s10-*` 到 run 目录 `node_state_backup/`）；
      - 新增 auto-attest 策略开关：`--node-auto-attest-all` / `--node-no-auto-attest-all` / `--node-auto-attest-sequencer-only`（默认 `sequencer_only`）；
      - `run_config.json` / `summary.md` 纳入 `node_auto_attest_mode` 与 `isolate_node_state` 配置落盘。
  - 文档改动：
    - 更新设计文档 `doc/testing/s10-five-node-real-game-soak.md`（新增状态隔离与 auto-attest 策略接口说明）。
    - 更新项目文档 `doc/testing/s10-five-node-real-game-soak.project.md`（新增并完成 T6，状态收敛为 T0~T6 已完成）。
- 测试：
  - test_tier_required（world_viewer_live 角色化执行约束回归）：
    - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live start_live_node_applies_pos_options -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live start_live_node_starts_triad_distributed_storage_role -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live start_live_node_starts_triad_distributed_sequencer_without_static_peers -- --nocapture`
  - test_tier_required（脚本语法）：`bash -n scripts/s10-five-node-game-soak.sh`。
  - test_tier_required（五节点真实短跑回归）：
    - 失败复现样本（定位阶段）：`./scripts/s10-five-node-game-soak.sh --duration-secs 260 --max-stall-secs 120 --out-dir .tmp/s10_game_longrun --no-prewarm`（run: `20260228-162536`，stall 超阈）；
    - 修复后通过样本：`./scripts/s10-five-node-game-soak.sh --duration-secs 260 --max-stall-secs 120 --out-dir .tmp/s10_game_longrun --no-prewarm`（run: `20260228-164149`，`status=ok`，`max_stall_secs_observed=0`，各节点高度随 epoch 持续增长）。
- 遗留事项：
  - 无（T6 目标闭环，S10 当前基线门禁可稳定通过）。

- 时刻：2026-02-28 17:37:29 CST
- 完成内容：完成“S10 五节点真实游戏数据在线长跑套件”T7（sequencer 执行桥非连续高度容错修复 + 长跑回归）。
  - 代码改动：`crates/agent_world/src/bin/world_viewer_live/execution_bridge.rs`
    - `NodeRuntimeExecutionDriver::on_commit` 在遇到非连续 committed 高度时不再报错退出，改为记录告警并继续处理当前 commit，避免 `requires contiguous committed heights` 导致共识停摆。
    - 新增测试 `node_runtime_execution_driver_tolerates_non_contiguous_commit_heights`，覆盖 `height: 1 -> 3` 提交容错路径。
  - 文档改动：
    - 更新 `doc/testing/s10-five-node-real-game-soak.md`，补充 sequencer 执行桥非连续高度容错策略说明。
    - 更新 `doc/testing/s10-five-node-real-game-soak.project.md`，新增并完成 T7，状态收敛为“已完成（T0~T7）”。
  - 跑测结论：
    - 失败样本（修复前）：`.tmp/s10_game_longrun/20260228-165423`，`metric_gate_failed`，`stall=842s>300s`。
    - 修复验证样本（新二进制）：`.tmp/s10_game_longrun/20260228-172637`，`600s` 长跑 `status=ok`，`metric_gate=pass`，`max_stall_secs_observed=0`，`minted_non_empty_samples=10`。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live node_runtime_execution_driver_tolerates_non_contiguous_commit_heights -- --nocapture`。
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live node_runtime_execution_driver_persists_chain_records -- --nocapture`。
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live start_live_node_applies_pos_options -- --nocapture`。
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live start_live_node_starts_triad_distributed_storage_role -- --nocapture`。
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live start_live_node_starts_triad_distributed_sequencer_without_static_peers -- --nocapture`。
  - test_tier_required：`env -u RUSTC_WRAPPER cargo build -p agent_world --bin world_viewer_live`。
  - test_tier_required（真实长跑）：`./scripts/s10-five-node-game-soak.sh --duration-secs 600 --max-stall-secs 300 --out-dir .tmp/s10_game_longrun --no-prewarm`。
- 遗留事项：
  - 无（T7 目标闭环，S10 长跑门禁恢复稳定通过）。

- 时刻：2026-02-28 18:05:21 CST
- 完成内容：完成“S10 五节点真实游戏数据在线长跑套件”T8（结算签名错误清零）。
  - 代码改动：
    - `crates/agent_world/src/bin/world_viewer_live/world_viewer_live_split_part2.rs`
      - reward runtime signer key 改为按 `signer_node_id` 从根密钥派生；
      - `reward_runtime_node_identity_bindings` 统一派生，不再对 signer 使用 root 公钥特例；
      - `ensure_reward_runtime_settlement_node_identity_bindings` 改为严格依赖配置绑定，缺失即报错，避免错误派生。
    - `crates/agent_world/src/bin/world_viewer_live/reward_runtime_network.rs`
      - 结算 envelope 编码改为 CBOR；
      - 解码兼容 CBOR 优先，JSON 回退。
    - `crates/agent_world/src/bin/world_viewer_live/world_viewer_live_tests_split_part2.rs`
      - 新增 signer 派生绑定单测；
      - 新增缺失绑定拒绝单测。
  - 验证结果：
    - 回归运行：`.tmp/s10_game_longrun/20260228-180015`（`260s`，门禁通过）；
    - 五节点 `stderr` 中 `reward runtime apply settlement envelope failed`、`verify settlement signature failed`、`settlement signer public key mismatch` 计数均为 `0`。
- 测试：
  - test_tier_required：
    - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live reward_runtime_node_identity_bindings_derive_signer_binding_from_root_key -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live ensure_reward_runtime_settlement_node_identity_bindings_rejects_missing_binding -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live build_reward_settlement_mint_records_uses_preview_world_without_mutation -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live settlement_envelope_roundtrip -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live settlement_envelope_signature_verifies -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo build -p agent_world --bin world_viewer_live`
    - `bash -n scripts/s10-five-node-game-soak.sh`
  - test_tier_required（真实短长跑）：
    - `./scripts/s10-five-node-game-soak.sh --duration-secs 260 --max-stall-secs 120 --out-dir .tmp/s10_game_longrun --no-prewarm`（run: `20260228-180015`）。
- 遗留事项：
  - 执行 T9：将结算 envelope 应用失败率纳入硬门禁并输出到 summary。

- 时刻：2026-02-28 18:19:55 CST
- 完成内容：完成“S10 五节点真实游戏数据在线长跑套件”T9（结算 envelope 应用失败率硬门禁）。
  - 代码改动：
    - `crates/agent_world/src/bin/world_viewer_live/world_viewer_live_split_part2.rs`
      - 增加结算 envelope 应用累计计数：`settlement_apply_attempts_total` / `settlement_apply_failures_total`；
      - 在 epoch 报表 `reward_settlement_transport` 输出 `settlement_apply_attempts_this_tick`、`settlement_apply_failures_this_tick`、`settlement_apply_attempts_total`、`settlement_apply_failures_total`、`settlement_apply_failure_ratio`。
    - `scripts/s10-five-node-game-soak.sh`
      - 新增参数 `--max-settlement-apply-failure-ratio <0~1>`（默认 `0`）；
      - 聚合各节点结算应用累计计数并计算 `settlement_apply_failure_ratio`；
      - 将结算应用失败率纳入硬门禁（并要求 `settlement_apply_attempts > 0`）；
      - `run_config.json` / `summary.json` / `summary.md` / `timeline.csv` 同步输出相关阈值与指标。
  - 文档改动：
    - 更新设计文档：`doc/testing/s10-five-node-real-game-soak.md`（新增参数、报表字段与门禁口径）。
    - 更新项目文档：`doc/testing/s10-five-node-real-game-soak.project.md`（T9 勾选完成，状态推进至 T10）。
  - 验证结果：
    - 旧二进制失败样本：`.tmp/s10_game_longrun/20260228-181108`（`metric_gate=fail`，`settlement_apply_attempts=0`，用于确认硬门禁生效）；
    - 重建二进制并复跑通过：`.tmp/s10_game_longrun/20260228-181651`（`130s`，`status=ok`，`metric_gate=pass`，`settlement_apply_attempts=7`，`settlement_apply_failures=0`，`settlement_apply_failure_ratio=0`）。
    - 五节点 `stderr` 结算相关计数均为 `0`：`reward runtime apply settlement envelope failed` / `verify settlement signature failed` / `settlement signer public key mismatch`。
- 测试：
  - test_tier_required：
    - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live settlement_envelope_roundtrip -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live settlement_envelope_signature_verifies -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_viewer_live ensure_reward_runtime_settlement_node_identity_bindings_rejects_missing_binding -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo build -p agent_world --bin world_viewer_live`
    - `bash -n scripts/s10-five-node-game-soak.sh`
    - `./scripts/s10-five-node-game-soak.sh --dry-run --no-prewarm --duration-secs 60 --out-dir .tmp/s10_game_longrun --max-settlement-apply-failure-ratio 0`
    - `./scripts/s10-five-node-game-soak.sh --duration-secs 130 --out-dir .tmp/s10_game_longrun --no-prewarm --max-settlement-apply-failure-ratio 0`（run: `20260228-181651`）
- 遗留事项：
  - 执行 T10：连续多轮长跑（`3x600s + 1x更长`）并给出发布结论。

- 时刻：2026-02-28 19:17:08 CST
- 完成内容：完成“S10 五节点真实游戏数据在线长跑套件”T10（`3x600s + 1x1200s` 连续长跑稳定性验证与发布收口）。
  - 连续四轮跑测（均 `--no-prewarm`，`--max-settlement-apply-failure-ratio 0`）：
    - run `20260228-182339`（`600s`）：`overall_status=ok`，`metric_gate=pass`，`settlement_apply_attempts=48`，`settlement_apply_failures=0`，`minted_non_empty_samples=10`；
    - run `20260228-183422`（`600s`）：`overall_status=ok`，`metric_gate=pass`，`settlement_apply_attempts=49`，`settlement_apply_failures=0`，`minted_non_empty_samples=10`；
    - run `20260228-184508`（`600s`）：`overall_status=ok`，`metric_gate=pass`，`settlement_apply_attempts=46`，`settlement_apply_failures=0`，`minted_non_empty_samples=10`；
    - run `20260228-185554`（`1200s`）：`overall_status=ok`，`metric_gate=pass`，`settlement_apply_attempts=96`，`settlement_apply_failures=0`，`minted_non_empty_samples=20`。
  - 四轮关键告警核验：
    - 五节点 `stderr` 中 `reward runtime apply settlement envelope failed` / `verify settlement signature failed` / `settlement signer public key mismatch` 均为 `0`。
  - 项目文档收口：
    - 更新 `doc/testing/s10-five-node-real-game-soak.project.md`，T10 勾选完成，项目状态更新为“已完成（T0~T10）”。
- 测试：
  - test_tier_required（连续长跑）：
    - `./scripts/s10-five-node-game-soak.sh --duration-secs 600 --out-dir .tmp/s10_game_longrun --no-prewarm --max-settlement-apply-failure-ratio 0`（run: `20260228-182339`）
    - `./scripts/s10-five-node-game-soak.sh --duration-secs 600 --out-dir .tmp/s10_game_longrun --no-prewarm --max-settlement-apply-failure-ratio 0`（run: `20260228-183422`）
    - `./scripts/s10-five-node-game-soak.sh --duration-secs 600 --out-dir .tmp/s10_game_longrun --no-prewarm --max-settlement-apply-failure-ratio 0`（run: `20260228-184508`）
    - `./scripts/s10-five-node-game-soak.sh --duration-secs 1200 --out-dir .tmp/s10_game_longrun --no-prewarm --max-settlement-apply-failure-ratio 0`（run: `20260228-185554`）
  - test_tier_required（结果核验）：
    - `jq` 读取四轮 `summary.json` 门禁与指标；
    - `grep -c` 统计四轮五节点 `stderr` 关键告警计数。
- 遗留事项：
  - 无（S10 T0~T10 全部闭环）。

- 时刻：2026-02-28 19:26:56 CST
- 完成内容：按用户要求基于 `doc/game-test.md` 执行一轮“真实玩家”Playwright Web 闭环游玩并填写测试卡片。
  - 执行 `./scripts/run-game-test-ab.sh`，完成启动、试玩、A/B 探针、录屏与证据导出。
  - 新增卡片：`doc/playability_test_result/card_2026_02_28_19_22_20.md`。
  - 同步项目管理文档：`doc/game-test.project.md`（新增并完成 T25、补充本轮测试记录与风险观测）。
- 测试：
  - test_tier_required（Web 闭环试玩 + 录屏 + 量化）：`./scripts/run-game-test-ab.sh`
  - test_tier_required（产物核验）：`sed -n '1,260p' output/playwright/playability/20260228-192220/ab_metrics.md`
  - test_tier_required（控制台核验）：`sed -n '1,260p' .playwright-cli/console-2026-02-28T11-25-01-946Z.log`
- 遗留事项：
  - `step` 二次调用仍存在 accepted 但无推进（B 段 FAIL）；后续需继续治理 `step` 推进一致性与“无推进时的下一步建议”提示。

- 时刻：2026-02-28 19:38:45 CST
- 完成内容：按用户要求输出“游戏设计者视角”的可执行任务清单（目标指标 + 验收标准 + A/B 实验项）。
  - 新增设计文档：`doc/world-simulator/viewer-control-predictability-tasklist-2026-02-28.md`。
  - 新增项目管理文档：`doc/world-simulator/viewer-control-predictability-tasklist-2026-02-28.project.md`。
  - 清单聚焦控制可预期性：`step` 二次调用不推进的可解释反馈、无进展恢复 CTA、首局动作发现、A/B 实验止损规则。
- 测试：
  - test_tier_required（文档结构检查）：`rg -n "## 目标|## 范围|## 接口/数据|## 里程碑|## 风险" doc/world-simulator/viewer-control-predictability-tasklist-2026-02-28.md`
  - test_tier_required（项目文档结构检查）：`rg -n "## 任务拆解|## 依赖|## 状态" doc/world-simulator/viewer-control-predictability-tasklist-2026-02-28.project.md`
  - test_tier_required（文档行数约束）：`wc -l doc/world-simulator/viewer-control-predictability-tasklist-2026-02-28.md doc/world-simulator/viewer-control-predictability-tasklist-2026-02-28.project.md`
- 遗留事项：
  - 进入实现阶段时，优先执行 P0 三项并用 `scripts/run-game-test-ab.sh` 做 10 轮回归，先验证 B 段通过率是否达到门槛（`>=80%`）。

- 时刻：2026-02-28 19:50:50 CST
- 完成内容：执行“Viewer 控制可预期性改版”P0.1（控制反馈语义面板改版）。
  - `web_test_api.rs`：控制阶段语义从 `applied/blocked` 混用调整为 `completed_advanced/completed_no_progress`，并保留 `received/executing/blocked`。
  - `egui_right_panel_player_guide.rs`：Mission HUD 控制反馈卡片改为四态展示（Received/Executing/Completed/Blocked），其中 `completed_no_progress` 以 Completed 标签 + 预警色展示。
  - `egui_right_panel_player_mission_tests.rs`：更新阶段标签映射测试，覆盖 `completed_advanced`、`completed_no_progress` 与 legacy `applied` 兼容。
  - 更新项目文档：`doc/world-simulator/viewer-control-predictability-tasklist-2026-02-28.project.md`（T6~T10 完成）。
- 测试：
  - test_tier_required（viewer 定向单测）：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer player_control_stage_label_maps_core_states -- --nocapture`
  - test_tier_required（wasm 编译检查）：`env -u RUSTC_WRAPPER cargo check -p agent_world_viewer --target wasm32-unknown-unknown`
- 遗留事项：
  - 下一任务执行 P0.2：把无进展恢复 CTA（`>2.5s`）从数据层提示推进到玩家可操作交互闭环，并做 A/B 回归验证。
- 时刻：2026-02-28 19:17:54 CST
- 完成内容：完成“启动器链路重构：链运行时与游戏进程解耦”T0（建档）。
  - 新建设计文档：`doc/world-simulator/launcher-chain-runtime-decouple-2026-02-28.md`。
  - 新建项目管理文档：`doc/world-simulator/launcher-chain-runtime-decouple-2026-02-28.project.md`。
  - 项目状态设置为“进行中（T0 已完成，执行 T1）”。
- 测试：
  - test_tier_required（文档行数约束）：`wc -l doc/world-simulator/launcher-chain-runtime-decouple-2026-02-28.md doc/world-simulator/launcher-chain-runtime-decouple-2026-02-28.project.md`。
  - test_tier_required（设计文档结构）：`rg -n "目标|范围|接口 / 数据|里程碑|风险" doc/world-simulator/launcher-chain-runtime-decouple-2026-02-28.md`。
  - test_tier_required（项目文档结构）：`rg -n "任务拆解|依赖|状态" doc/world-simulator/launcher-chain-runtime-decouple-2026-02-28.project.md`。
- 遗留事项：
  - 执行 T1：新增 `world_chain_runtime`（节点启动/停止、状态 API、余额 API）。

- 时刻：2026-02-28 19:31:30 CST
- 完成内容：完成“启动器链路重构：链运行时与游戏进程解耦”T1（新增 `world_chain_runtime`）。
  - 新增二进制：`crates/agent_world/src/bin/world_chain_runtime.rs`。
  - 落地能力：
    - 独立启动 NodeRuntime（支持 `node_id/world_id/role/tick/validator/gossip` 参数）；
    - 默认写入独立执行目录 `output/chain-runtime/<node_id>/...`；
    - 提供 HTTP 接口：`/healthz`、`/v1/chain/status`、`/v1/chain/balances`；
    - `balances` 接口读取 execution world，输出节点 credits、main token 账户余额与 recent mint records。
  - 更新项目管理文档：`doc/world-simulator/launcher-chain-runtime-decouple-2026-02-28.project.md`，T1 勾选完成，状态推进至 T2。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_chain_runtime -- --nocapture`。
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world --bin world_chain_runtime`。
- 遗留事项：
  - 执行 T2：改造 `world_game_launcher` 默认托管 `world_chain_runtime`，并将 `world_viewer_live` 切换为 `--no-node`。

- 时刻：2026-02-28 19:36:48 CST
- 完成内容：完成“启动器链路重构：链运行时与游戏进程解耦”T2（`world_game_launcher` 默认托管链运行时）。
  - 更新 `crates/agent_world/src/bin/world_game_launcher.rs`：
    - 启动器新增链运行时编排：默认启动 `world_chain_runtime` 并监控其生命周期；
    - `world_viewer_live` 启动参数新增 `--no-node`，将节点逻辑从游戏进程链路拆出；
    - CLI 新增链配置项：`--chain-enable/--chain-disable`、`--chain-status-bind`、`--chain-node-*`；
    - 新增环境变量解析：`AGENT_WORLD_WORLD_CHAIN_RUNTIME_BIN`；
    - `wait_until_ready` 新增链状态 HTTP 就绪检查。
  - 更新项目管理文档：`doc/world-simulator/launcher-chain-runtime-decouple-2026-02-28.project.md`，T2 勾选完成，状态推进至 T3。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world --bin world_game_launcher -- --nocapture`。
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world --bin world_game_launcher --bin world_chain_runtime`。
- 遗留事项：
  - 执行 T3：更新发行打包脚本与桌面启动器参数透传，确保发行入口完整承接链运行时配置。

- 时刻：2026-02-28 19:42:54 CST
- 完成内容：完成“启动器链路重构：链运行时与游戏进程解耦”T3（发行链路与桌面启动器参数透传）。
  - 更新 `scripts/build-game-launcher-bundle.sh`：
    - 打包产物纳入 `bin/world_chain_runtime`；
    - `run-client.sh` 注入 `AGENT_WORLD_WORLD_CHAIN_RUNTIME_BIN`；
    - README 与产物摘要同步新增链运行时说明。
  - 更新 `crates/agent_world_client_launcher/src/main.rs`：
    - GUI 增加链运行时配置项（enable/status bind/node id/world id/role/tick/validators）；
    - 参数构建新增 `--chain-*` 透传；
    - 补充链配置解析与参数构建单元测试。
  - 更新项目管理文档：`doc/world-simulator/launcher-chain-runtime-decouple-2026-02-28.project.md`，T3 勾选完成，状态推进至 T4。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo test -p agent_world_client_launcher -- --nocapture`。
  - test_tier_required：`bash -n scripts/build-game-launcher-bundle.sh`。
  - test_tier_required：`./scripts/build-game-launcher-bundle.sh --help`。
  - test_tier_required：`./scripts/build-game-launcher-bundle.sh --dry-run --profile dev --out-dir output/release/game-launcher-dryrun`。
- 遗留事项：
  - 执行 T4：完成收口测试与项目结项。

- 时刻：2026-02-28 19:45:11 CST
- 完成内容：完成“启动器链路重构：链运行时与游戏进程解耦”T4（回归与结项收口）。
  - 更新项目管理文档：`doc/world-simulator/launcher-chain-runtime-decouple-2026-02-28.project.md`。
  - 状态收敛为“已完成（T0~T4）”，当前项目结项。
- 测试：
  - test_tier_required：`env -u RUSTC_WRAPPER cargo check -p agent_world --bin world_game_launcher --bin world_chain_runtime`。
  - test_tier_required：`target/debug/world_game_launcher --help`。
  - test_tier_required：`target/debug/world_chain_runtime --help`。
- 遗留事项：
  - 无（本项目任务已全部完成）。

- 时刻：2026-02-28 20:00:52 CST
- 完成内容：执行“Viewer 控制可预期性改版”P0.2（无进展恢复 CTA 交互闭环）。
  - `web_test_api.rs`：移除 `step` 卡住后的自动 `play` 代跑；在 `>=2.5s`（150 帧）无增量时统一落 `completed_no_progress`，并输出恢复指引。
  - `egui_right_panel_player_guide.rs`：Mission HUD 的 Control Feedback 卡片在 `completed_no_progress` 时显示可操作恢复按钮（`Recover: play` / `Retry: step x8`）。
  - `egui_right_panel_player_guide.rs`：避免与 stuck hint 卡片重复渲染恢复按钮，减少界面干扰。
  - `egui_right_panel_player_mission_tests.rs`：新增恢复 CTA 判定测试。
  - 更新项目文档：`doc/world-simulator/viewer-control-predictability-tasklist-2026-02-28.project.md`（T11~T15 完成）。
- 测试：
  - test_tier_required（viewer 定向单测）：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer player_control_stage_label_maps_core_states -- --nocapture`
  - test_tier_required（viewer 定向单测）：`env -u RUSTC_WRAPPER cargo test -p agent_world_viewer player_control_stage_shows_recovery_actions_only_for_no_progress_completion -- --nocapture`
  - test_tier_required（wasm 编译检查）：`env -u RUSTC_WRAPPER cargo check -p agent_world_viewer --target wasm32-unknown-unknown`
- 遗留事项：
  - 下一任务执行 P0.3：按 `scripts/run-game-test-ab.sh` 做 10 轮回归，验证 B 段通过率门槛（`>=80%`）与无进展窗口目标（`<=2500ms`）。

- 时刻：2026-02-28 20:20:56 CST
- 完成内容：完成“Viewer 控制可预期性改版”P0.3（10 轮 A/B 回归与门槛判定）。
  - 完成 10/10 轮有效样本回归，汇总目录：`output/playwright/playability/p0_3_20260228-201225`。
  - 产出汇总：`p0_3_summary.json`、`p0_3_summary.md`。
  - 门槛判定结果：`B pass rate=70% (7/10, 未达 >=80%)`，`stall>2500ms=100% (10/10)`，`max stall=5892ms`，当前版本未满足发布门槛。
  - 更新项目文档：`doc/world-simulator/viewer-control-predictability-tasklist-2026-02-28.project.md`（新增并完成 T16/T17，推进 T18）。
- 测试：
  - test_tier_required（P0.3 10 轮 A/B 回归，headed）：循环执行 `scripts/run-game-test-ab.sh`，汇总写入 `output/playwright/playability/p0_3_20260228-201225/`。
  - test_tier_required（结果核验）：`cat output/playwright/playability/p0_3_20260228-201225/p0_3_summary.json`。
  - test_tier_required（结果核验）：`cat output/playwright/playability/p0_3_20260228-201225/p0_3_summary.md`。
- 遗留事项：
  - 执行 T18（P0.4）：收敛 `completed_no_progress` reason 分类与恢复策略，目标是将 `maxNoProgressWindowMs` 压到 `<=2500ms` 并把 B 段通过率提升到 `>=80%`。

- 时刻：2026-02-28 20:38:12 CST
- 完成内容：推进“Viewer 控制可预期性改版”T18.1（P0.4 诊断复测）。
  - 连续执行 3 轮 headed A/B 复测并留档：
    - `output/playwright/playability/20260228-202833/ab_metrics.json`
    - `output/playwright/playability/20260228-203202/ab_metrics.json`
    - `output/playwright/playability/20260228-203526/ab_metrics.json`
  - 诊断结论：当前共识链路下 `play` 与 `step followup` 仍频繁出现 accepted 但无推进，`maxNoProgressWindowMs` 维持约 `6s`，B 段稳定性未达门槛。
  - 进行过一轮 runtime 试验性改动验证（非共识/共识 drive 保活与补决策邮箱），复测未体现稳定收益，已在本地回滚，未并入主线。
  - 更新项目文档：`doc/world-simulator/viewer-control-predictability-tasklist-2026-02-28.project.md`（T18.1 勾选完成，T18.2 待执行）。
- 测试：
  - test_tier_required（真实 A/B 复测，headed）：`./scripts/run-game-test-ab.sh --headed`（共 3 轮）。
  - test_tier_required（定向回归）：
    - `env -u RUSTC_WRAPPER cargo test -p agent_world live_world_script_event_drive_keeps_requeue_on_idle_step -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world consensus_committed_advances_world_even_when_session_paused -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world step_request_emits_completion_ack_timeout_when_consensus_has_no_commit -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world live_world_llm_event_driven_gate_avoids_repeated_empty_ticks -- --nocapture`
    - `env -u RUSTC_WRAPPER cargo test -p agent_world live_world_event_drive_gate_tracks_llm_mailbox -- --nocapture`
  - test_tier_required（编译检查）：`env -u RUSTC_WRAPPER cargo check -p agent_world`。
- 遗留事项：
  - 执行 T18.2：针对共识链路 `play` 持续驱动与 `step followup` 推进语义做修复，并重新执行 10 轮门槛回归（目标：`B>=80%`、`maxNoProgressWindowMs<=2500`）。
- 时刻：2026-02-28 15:56:47 CST
- 完成内容：完成“Viewer Texture Inspector Art Capture 优化”T0（建档）。
  - 新建设计文档：`doc/scripts/viewer-texture-inspector-art-capture-2026-02-28.md`。
  - 新建项目管理文档：`doc/scripts/viewer-texture-inspector-art-capture-2026-02-28.project.md`。
  - 项目状态设置为“进行中（T0 已完成，执行 T1）”。
- 测试：
  - test_tier_required（文档行数约束）：`wc -l doc/scripts/viewer-texture-inspector-art-capture-2026-02-28.md doc/scripts/viewer-texture-inspector-art-capture-2026-02-28.project.md`。
  - test_tier_required（设计文档结构）：`rg -n "目标|范围|接口 / 数据|里程碑|风险" doc/scripts/viewer-texture-inspector-art-capture-2026-02-28.md`。
  - test_tier_required（项目文档结构）：`rg -n "任务拆解|依赖|状态" doc/scripts/viewer-texture-inspector-art-capture-2026-02-28.project.md`。
- 遗留事项：
  - 执行 T1：实现 `--art-capture`、分实体镜头与 `viewer_art.png` 产物。

- 时刻：2026-02-28 16:24:52 CST
- 完成内容：完成“Viewer Texture Inspector Art Capture 优化”T1（脚本实现）。
  - 更新 `scripts/viewer-texture-inspector.sh`：新增 `--art-capture`、`--automation-steps`、`--crop-window` 参数。
  - 新增分实体镜头预设（`agent/location/asset/power_plant/power_storage`）并在 art-capture 模式自动启用。
  - art-capture 模式下默认启用 `use_source_mesh` 与 `director` 体验模式，降低 UI 干扰。
  - 新增产物 `viewer_art.png`（裁切图）；并将 `art_capture/automation_steps/crop_window/viewer_art_capture_status` 写入 `meta.txt`。
  - 更新项目管理文档：T1 完成，状态推进到 T2。
- 测试：
  - test_tier_required（脚本语法）：`bash -n scripts/viewer-texture-inspector.sh`。
  - test_tier_required（帮助输出）：`./scripts/viewer-texture-inspector.sh --help`。
  - test_tier_required（最小实跑）：`./scripts/viewer-texture-inspector.sh --inspect agent,location --variants default --scenario llm_bootstrap --art-capture --no-prewarm --out-dir output/texture_inspector/art_capture_smoke_20260228`。
  - test_tier_required（产物检查）：`find output/texture_inspector/art_capture_smoke_20260228 -type f | sort`、`sed -n '1,260p' output/texture_inspector/art_capture_smoke_20260228/*/*/meta.txt`。
- 遗留事项：
  - 执行 T2：完成项目文档结项与日志收口提交。

- 时刻：2026-02-28 16:29:21 CST
- 完成内容：完成“Viewer Texture Inspector Art Capture 优化”T2（验证与收口）。
  - 项目管理文档更新为“已完成（T0~T2）”。
  - 本轮优化任务结项。
- 测试：
  - test_tier_required（沿用 T1 执行结果）：`bash -n scripts/viewer-texture-inspector.sh`。
  - test_tier_required（沿用 T1 执行结果）：`./scripts/viewer-texture-inspector.sh --help`。
  - test_tier_required（沿用 T1 执行结果）：`./scripts/viewer-texture-inspector.sh --inspect agent,location --variants default --scenario llm_bootstrap --art-capture --no-prewarm --out-dir output/texture_inspector/art_capture_smoke_20260228`。
- 遗留事项：
  - 无（当前项目文档内任务已全部完成）。

- 时刻：2026-02-28 18:15:26 CST
- 完成内容：完成“Viewer Texture Inspector Art Capture 优化”T3/T4（closeup 校验增强 + 镜头可读性调参 + 全量复跑）。
  - 更新 `scripts/viewer-texture-inspector.sh`：
    - 新增 closeup 产物链路（`viewer_closeup.png`、`viewer_art_closeup.png`）与 closeup 状态元数据。
    - 新增 `--closeup-automation-steps` 参数与分实体 closeup/fallback 镜头模板。
    - 新增 `power_plant/power_storage` 三变体一致性校验与重试，输出 `variant_validation.txt` 并回写 `meta.txt`。
    - 修复 art-capture 默认镜头“贴脸”问题：将各实体默认 `zoom` 从强近景（<1）重标定为可读近中景（>1）。
  - 更新文档：
    - `doc/scripts/viewer-texture-inspector-art-capture-2026-02-28.md`
    - `doc/scripts/viewer-texture-inspector-art-capture-2026-02-28.project.md`
  - 产物复跑：`output/texture_inspector/closeup_full_20260228_v2`（15/15 组合完整）。
- 测试：
  - test_tier_required（脚本语法）：`bash -n scripts/viewer-texture-inspector.sh`。
  - test_tier_required（帮助输出）：`./scripts/viewer-texture-inspector.sh --help`。
  - test_tier_required（烟测）：`./scripts/viewer-texture-inspector.sh --inspect power_plant,power_storage --variants all --scenario llm_bootstrap --art-capture --no-prewarm --out-dir output/texture_inspector/closeup_validation_smoke_20260228_v2`。
  - test_tier_required（全量复跑）：`./scripts/viewer-texture-inspector.sh --inspect all --variants all --scenario llm_bootstrap --art-capture --no-prewarm --out-dir output/texture_inspector/closeup_full_20260228_v2`。
  - test_tier_required（产物完整性）：`find output/texture_inspector/closeup_full_20260228_v2 -mindepth 2 -maxdepth 2 -type d | wc -l`、`find output/texture_inspector/closeup_full_20260228_v2 -name variant_validation.txt -print -exec cat {} \;`。
- 遗留事项：
  - `power_plant` 三变体在肉眼层面的材质差异仍偏弱（虽已通过“非同图”校验）；若需“强可辨识”美术评审图，建议后续补充差异增强渲染口径（例如专用对比灯位/差异图导出）。

- 时刻：2026-02-28 19:21:59 CST
- 完成内容：完成“Viewer Texture Inspector Art Capture 优化”T5（焦点目标 + 灯光口径 + SSIM 门禁）。
  - 更新 `scripts/viewer-texture-inspector.sh`：
    - 新增参数：`--art-lighting`、`--no-art-lighting`、`--variant-ssim-threshold`。
    - power 实体镜头焦点改为实体类型：`focus=first_power_plant` / `focus=first_power_storage`（含 fallback closeup）。
    - art-capture 默认可启用评审灯光口径（`ACES + bloom off + 曝光/环境光/补光/轮廓光`）。
    - 变体校验从“仅哈希去重”升级为“哈希 + SSIM 阈值门禁”，并输出 `retry_reason/min_pair_ssim/ssim_threshold`。
  - 更新文档：
    - `doc/scripts/viewer-texture-inspector-art-capture-2026-02-28.md`
    - `doc/scripts/viewer-texture-inspector-art-capture-2026-02-28.project.md`
  - 产物：
    - smoke：`output/texture_inspector/ssim_lighting_focus_smoke_20260228`
    - full：`output/texture_inspector/ssim_lighting_focus_full_20260228`
- 测试：
  - test_tier_required（脚本语法）：`bash -n scripts/viewer-texture-inspector.sh`。
  - test_tier_required（帮助输出）：`./scripts/viewer-texture-inspector.sh --help`。
  - test_tier_required（smoke）：`./scripts/viewer-texture-inspector.sh --inspect power_plant,power_storage --variants all --scenario llm_bootstrap --art-capture --no-prewarm --out-dir output/texture_inspector/ssim_lighting_focus_smoke_20260228`。
  - test_tier_required（full）：`./scripts/viewer-texture-inspector.sh --inspect all --variants all --scenario llm_bootstrap --art-capture --no-prewarm --out-dir output/texture_inspector/ssim_lighting_focus_full_20260228`。
  - test_tier_required（产物完整性）：`find output/texture_inspector/ssim_lighting_focus_full_20260228 -mindepth 2 -maxdepth 2 -type d | wc -l`。
  - test_tier_required（门禁结果）：`find output/texture_inspector/ssim_lighting_focus_full_20260228 -name variant_validation.txt -print -exec cat {} \;`。
- 遗留事项：
  - `power_plant/power_storage` 在当前材质与光照下仍高相似（`min_pair_ssim` 高于 `0.9995`），已被门禁稳定识别为 `failed_after_retry`；后续需引入“材质对比专用灯位/差异热图”以支持强可辨识评审。

- 时刻：2026-02-28 20:18:34 CST
- 完成内容：完成“Viewer Texture Inspector Art Capture 优化”T6（非 power 场景构图稳定修复）。
  - 更新 `scripts/viewer-texture-inspector.sh`：
    - 新增场景自适应焦点回退：power 实体在 `*power*` 场景使用 `first_power_*`，其余场景回退 `first_location`，避免 `focus` 目标缺失导致自动化步骤中断。
    - 新增 power 镜头姿态模板函数：`resolve_power_hero_pose` / `resolve_power_closeup_pose` / `resolve_power_fallback_closeup_pose`。
    - 为非 power 场景下 power 实体重标定构图参数：
      - hero：`pan=0.4,0,0;zoom=1.6;orbit=20,-30`
      - closeup：`pan=0.6,0,0;zoom=2.2;orbit=20,-30`
      - fallback closeup：`pan=0.6,0,0;zoom=2.6;orbit=20,-30`
  - 更新文档：
    - `doc/scripts/viewer-texture-inspector-art-capture-2026-02-28.md`
    - `doc/scripts/viewer-texture-inspector-art-capture-2026-02-28.project.md`
  - 产物：
    - smoke：`output/texture_inspector/focus_fallback_fix_smoke_v2_20260228`
    - 抽样验证：
      - `output/texture_inspector/focus_fallback_fix_pp_quick_v3_20260228`
      - `output/texture_inspector/focus_fallback_fix_ps_quick_v2_20260228`
- 测试：
  - test_tier_required（脚本语法）：`bash -n scripts/viewer-texture-inspector.sh`。
  - test_tier_required（quick）：
    - `./scripts/viewer-texture-inspector.sh --inspect power_plant --variants default --scenario llm_bootstrap --art-capture --no-prewarm --out-dir output/texture_inspector/focus_fallback_fix_pp_quick_v3_20260228`
    - `./scripts/viewer-texture-inspector.sh --inspect power_storage --variants default --scenario llm_bootstrap --art-capture --no-prewarm --out-dir output/texture_inspector/focus_fallback_fix_ps_quick_v2_20260228`
  - test_tier_required（smoke）：`./scripts/viewer-texture-inspector.sh --inspect power_plant,power_storage --variants all --scenario llm_bootstrap --art-capture --no-prewarm --out-dir output/texture_inspector/focus_fallback_fix_smoke_v2_20260228`。
  - test_tier_required（产物检查）：
    - `find output/texture_inspector/focus_fallback_fix_smoke_v2_20260228 -mindepth 2 -maxdepth 2 -type d | wc -l`
    - `find output/texture_inspector/focus_fallback_fix_smoke_v2_20260228 -name variant_validation.txt -print -exec cat {} \;`
- 遗留事项：
  - 当前镜头构图可读性已修复，但 `power_plant/power_storage` 三变体仍被 SSIM 门禁判定为高相似（`failed_after_retry`）；后续需从材质资产或差异可视化（热图/对比图）层面继续优化可辨识度。

- 时刻：2026-02-28 20:51:37 CST
- 完成内容：完成“Viewer Texture Inspector 材质可辨识增强”T0（建档）。
  - 新建设计文档：`doc/scripts/viewer-texture-inspector-material-recognizability-2026-02-28.md`。
  - 新建项目管理文档：`doc/scripts/viewer-texture-inspector-material-recognizability-2026-02-28.project.md`。
  - 项目状态设置为“进行中（T0 已完成，执行 T1）”。
- 测试：
  - test_tier_required（文档行数约束）：`wc -l doc/scripts/viewer-texture-inspector-material-recognizability-2026-02-28.md doc/scripts/viewer-texture-inspector-material-recognizability-2026-02-28.project.md`。
  - test_tier_required（设计文档结构）：`rg -n "目标|范围|接口 / 数据|里程碑|风险" doc/scripts/viewer-texture-inspector-material-recognizability-2026-02-28.md`。
  - test_tier_required（项目文档结构）：`rg -n "任务拆解|依赖|状态" doc/scripts/viewer-texture-inspector-material-recognizability-2026-02-28.project.md`。
- 遗留事项：
  - 执行 T1：实现 `--preview-mode lookdev`，补齐 meta 记录并跑 smoke。

- 时刻：2026-02-28 20:54:38 CST
- 完成内容：完成“Viewer Texture Inspector 材质可辨识增强”T1（`--preview-mode lookdev` 落地）。
  - 更新 `scripts/viewer-texture-inspector.sh`：新增 `--preview-mode <scene_proxy|lookdev>` 参数。
  - 在 `lookdev` 模式下显式关闭 location 视觉干扰：
    - `AGENT_WORLD_VIEWER_LOCATION_SHELL_ENABLED=0`
    - `AGENT_WORLD_VIEWER_LOCATION_RADIATION_GLOW=0`
    - `AGENT_WORLD_VIEWER_LOCATION_DAMAGE_VISUAL=0`
  - 更新 `meta.txt` 输出字段：`preview_mode` 与 lookdev 三个开关状态。
  - 更新项目管理文档：`doc/scripts/viewer-texture-inspector-material-recognizability-2026-02-28.project.md`，状态推进至“执行 T2”。
- 测试：
  - test_tier_required（语法）：`bash -n scripts/viewer-texture-inspector.sh`。
  - test_tier_required（帮助输出）：`./scripts/viewer-texture-inspector.sh --help | rg -n "preview-mode|scene_proxy|lookdev"`。
  - test_tier_required（lookdev smoke）：`./scripts/viewer-texture-inspector.sh --inspect power_plant --variants default --art-capture --preview-mode lookdev --viewer-wait 8 --out-dir output/texture_inspector/material_recognizability_t1_smoke_20260228`。
  - test_tier_required（元数据检查）：`nl -ba output/texture_inspector/material_recognizability_t1_smoke_20260228/power_plant/default/meta.txt | sed -n '1,220p'`。
- 遗留事项：
  - 执行 T2：实现 `direct_entity` 预览链路与失败回退元数据。
